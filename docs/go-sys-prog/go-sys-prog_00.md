# 前言

《Go 系统编程》是一本将帮助您使用 Go 开发系统软件的书，它是一种系统编程语言，最初是作为谷歌内部项目开始的，后来变得很受欢迎。Go 之所以如此受欢迎，是因为它让开发人员感到愉快，易于编写、易于阅读、易于理解，并且有一个编译器可以帮助您。这本书并未涵盖 Go 编程语言的每一个可能方面和特性，只涉及与系统编程相关的内容。如果您希望了解更多关于 Go 编程语言的知识，您可以期待我的下一本书《精通 Go》，它将于 2018 年出版！

你即将阅读的书是一本诚实的书，它将呈现工作中的 Go 代码，而不会忽视其潜在缺陷、限制和逻辑错误，这将使您能够自行改进并在未来创建更好的版本。您将无法改进的是将呈现的基本信息，这是 Unix 系统工作方式的基础。如果这本书能帮助您理解系统编程的重要性以及如何开始使用 Go 开发系统软件，我将认为这本书是成功的。如果 Go 成为您最喜欢的编程语言，我同样会感到高兴！

# 本书涵盖的内容

《第一章》《开始使用 Go 和 Unix 系统编程》首先定义了系统编程是什么，然后讨论了 Go 的优缺点、Go 版本 1.8 的特性，两个方便的 Go 工具`gofmt`和`godoc`，以及 Unix 进程的各种状态。

《第二章》《使用 Go 编写程序》帮助您学习如何编译 Go 代码以及如何使用 Go 支持的环境变量，并了解 Go 如何读取程序的命令行参数。然后，我们将讨论获取用户输入和输出，这是基本任务，向您展示如何在 Go 中定义函数，本书中首次提到`defer`关键字，并继续讨论 Go 提供的数据结构，使用方便的代码示例。在本章的其余部分，我们将讨论 Go 接口和随机数生成。我相信您会喜欢这一章节！

《第三章》《高级 Go 特性》深入探讨了一些高级 Go 特性，包括错误处理，在开发系统软件和错误记录时至关重要。然后介绍了模式匹配和正则表达式、Go 反射，并讨论了不安全的代码。之后，它将 Go 与其他编程语言进行了比较，并介绍了两个实用程序，名为`dtrace(1)`和`strace(1)`，它们可以让您在执行程序时看到幕后发生的事情。最后，它讨论了如何使用`go tool`检测不可达代码以及如何避免一些常见的 Go 错误。

《第四章》《Go 包、算法和数据结构》讨论了 Go 中的算法和排序，以及需要 Go 版本 1.8 或更新版本的`sort.Slice()`函数。然后展示了链表、二叉树和哈希表的 Go 实现。之后，它讨论了 Go 包，并教您如何创建和使用自己的 Go 包。本章的最后部分讨论了 Go 中的垃圾回收。

第五章，“文件和目录”，是本书中首个涉及系统编程主题的章节，涉及文件、符号链接和目录的处理。在本章中，你将找到 Unix 工具的核心功能的 Go 实现，比如`which(1)`、`pwd(1)`和`find(1)`，但首先你将学习如何使用`flag`包来解析 Go 程序的命令行参数和选项。此外，你还将学习如何删除、重命名和移动文件，以及如何以 Go 方式遍历目录结构。本章的最后部分实现了一个实用程序，用于创建目录结构的所有目录的副本！

第六章，“文件输入和输出”，向你展示如何读取文件的内容，如何更改文件内容，以及如何将自己的数据写入文件！在本章中，你将了解`io`包、`io.Writer`和`io.Reader`接口，以及用于缓冲输入和输出的`bufio`包。你还将创建`cp(1)`、`wc(1)`和`dd(1)`实用程序的 Go 版本。最后，你将了解稀疏文件，如何在 Go 中创建稀疏文件，如何从文件中读取和写入记录，以及如何在 Go 中锁定文件。

第七章，“处理系统文件”，教你如何处理 Unix 系统文件，包括向 Unix 日志文件写入数据、向现有文件追加数据以及修改文本文件的数据。在本章中，你还将了解标准的 Go 包`log`和`log/syslog`，Unix 文件权限，以及使用实际示例进一步学习模式匹配和正则表达式知识。你还将了解如何找到用户的用户 ID 以及用户所属的 Unix 组。最后，你将了解如何使用`time`包在 Go 中处理日期和时间，以及如何自己创建和旋转日志文件。

第八章，“进程和信号”，首先讨论了在 Go 中如何处理 Unix 信号，借助`os/signal`包展示了三个 Go 程序。然后展示了一个可以使用信号和信号处理来旋转其日志文件的 Go 程序，以及另一个使用信号来展示文件复制操作进度的 Go 程序。本章还将教你如何在 Go 中绘制数据以及如何在 Go 中实现 Unix 管道。然后将在 Go 中实现`cat(1)`实用程序，然后简要介绍 Unix 套接字客户端的 Go 代码。本章的最后一部分快速讨论了如何在 Go 中编写 Unix shell。

第九章，“Goroutines - 基本特性”，讨论了一个非常重要的 Go 主题，即 goroutines，讨论了如何创建 goroutines 以及如何同步它们并在结束程序之前等待它们完成。然后讨论了通道和管道，这有助于 goroutines 以安全的方式进行通信和交换数据。本章的最后部分呈现了一个使用 goroutines 实现的`wc(1)`实用程序的版本。然而，由于 goroutines 是一个庞大的主题，下一章将继续讨论它们。

第十章，“Goroutines - 高级特性”，讨论了与 goroutines 和通道相关的更高级的主题，包括缓冲通道、信号通道、空通道、通道的通道、超时和`select`关键字。然后讨论了与共享内存和互斥锁相关的问题，然后呈现了两个使用通道和共享内存的`wc(1)`实用程序的更多 Go 版本。最后，本章将讨论竞争条件和`GOMAXPROCS`环境变量。

第十一章，*使用 Go 编写 Web 应用程序*，讨论了在 Go 中开发 Web 应用程序和 Web 服务器以及客户端。此外，它还讨论了使用 Go 代码与 MongoDB 和 MySQL 数据库进行通信。然后，它说明了如何使用`html/template`包，该包是 Go 标准库的一部分，允许您使用 Go HTML 模板文件生成 HTML 输出。最后，它讨论了读取和写入 JSON 数据，然后呈现了一个实用程序，该实用程序读取多个网页并返回在这些网页中找到给定关键字的次数。

第十二章，*网络编程*，讨论了使用`net` Go 标准包涉及的 TCP/IP 及其协议的主题。它向您展示了如何创建 TCP 和 UDP 客户端和服务器，如何执行各种类型的 DNS 查找，以及如何使用 Wireshark 检查网络流量。此外，它还讨论了在 Go 中开发 RPC 客户端和服务器，以及开发 Unix 套接字服务器和 Unix 套接字客户端。

正如您将看到的，每章结束时都有一些练习供您完成，以便获取有关重要 Go 包的更多信息并编写自己的 Go 程序。请尝试完成本书的所有练习。

# 您需要为本书做些什么

这本书需要一台运行 Unix 变种的计算机，其中包括运行 Mac OS X、macOS 或 Linux 的任何机器上都有相对较新的 Go 版本。

苹果过去将其操作系统称为 Mac OS X，后面跟着版本号；然而，在 Mac OS X 10.11（El Capitan）之后，苹果进行了更改，现在 Mac OS X 10.12 被称为 macOS 10.12（Sierra）-在本书中，Mac OS X 和 macOS 这两个术语是可以互换使用的。此外，很有可能在您阅读本书时，最新版本的 macOS 将是 macOS 10.13（High Sierra）。您可以通过访问[`en.wikipedia.org/wiki/MacOS`](https://en.wikipedia.org/wiki/MacOS)了解更多关于各个版本 macOS 的信息。

本书中的所有 Go 代码都经过了在运行 macOS 10.12 Sierra 的 iMac 上运行 Go 1.8.x 以及在运行 Debian Linux 机器上运行 Go 版本 1.3.3 的测试。大部分代码可以在这两个 Go 版本上运行而无需任何代码更改。然而，当使用较新的 Go 功能时，代码将无法在 Go 1.3.3 上编译：本书指出了不会在 Go 版本 1.3.3 上编译或需要 Go 版本 1.8 或更新的 Go 程序。

请注意，在撰写本文时，最新的 Go 版本是 1.9。鉴于 Go 的工作方式，您将能够在更新的 Go 版本中编译本书中的所有 Go 代码而无需任何更改。

# 这本书是为谁准备的

这本书适用于 Unix 用户、高级 Unix 用户、Unix 系统管理员和 Unix 系统开发人员，他们在一个或多个 Unix 变种上使用 Go，并希望开始使用 Go 编程语言开发系统软件。

尽管这本书可能不适合对 Unix 操作系统不太熟悉或没有编程经验的人，但业余程序员将会找到大量关于 Unix 的实用信息，这可能会激发他们开始开发自己的系统实用程序。

# 惯例

在本书中，您会发现一些区分不同类型信息的文本样式。以下是一些这些样式的示例以及它们的含义解释。文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下：“这是因为`main()`函数是程序执行开始的地方。”

代码块设置如下：

```go
package main 

import "fmt" 
import "os" 

func main() { 
   arguments := os.Args 
   for i := 0; i < len(arguments); i++ { 
         fmt.Println(arguments[i]) 
   } 
} 
```

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```go
package main 

import "fmt" 
import "os" 

func main() { 
   arguments := os.Args 
   for i := 0; i < len(arguments); i++ { 
         fmt.Println(arguments[i]) 
   } 
} 
```

任何命令行输入或输出都以以下形式书写：

```go
$ go run hw.go
Hello World!  
```

**新术语**和**重要单词**以粗体显示。

警告或重要说明会出现在这样的形式。

提示和技巧会出现在这样的形式。

# 读者反馈

我们始终欢迎读者的反馈。请告诉我们您对本书的看法-您喜欢或不喜欢什么。读者的反馈对我们很重要，因为它可以帮助我们开发出您真正能够充分利用的标题。要发送一般反馈，只需发送电子邮件至`feedback@packtpub.com`，并在主题中提及书名。如果您在某个专题上有专业知识，并且有兴趣撰写或为书籍做出贡献，请参阅我们的作者指南，网址为[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您是 Packt 书籍的自豪所有者，我们有一些东西可以帮助您充分利用您的购买。

# 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)的帐户中下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便直接通过电子邮件接收文件。您可以按照以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的“支持”选项卡上。

1.  点击“代码下载和勘误”。

1.  在搜索框中输入书名。

1.  选择您要下载代码文件的书籍。

1.  从下拉菜单中选择您购买此书的地点。

1.  点击“代码下载”。

文件下载后，请确保使用以下最新版本的软件解压缩文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for Mac

+   7-Zip / PeaZip for Linux

该书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Go-Systems-Programming`](https://github.com/PacktPublishing/Go-Systems-Programming)。我们还有其他书籍和视频的代码包，可以在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。快去看看吧！

# 下载本书的彩色图像

我们还为您提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图像。彩色图像将帮助您更好地理解输出中的变化。您可以从[`www.packtpub.com/sites/default/files/downloads/GoSystemsProgramming_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/GoSystemsProgramming_ColorImages.pdf)下载此文件。

# 勘误

尽管我们已经尽一切努力确保内容的准确性，但错误难免会发生。如果您在我们的书籍中发现错误-可能是文本或代码中的错误-我们将不胜感激，如果您能向我们报告。这样一来，您可以帮助其他读者避免挫折，并帮助我们改进本书的后续版本。如果您发现任何勘误，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)报告错误，选择您的书籍，点击“勘误提交表格”链接，并输入您的勘误详情。一旦您的勘误被验证，您的提交将被接受，并且勘误将被上传到我们的网站或添加到该书籍的勘误列表中的任何现有勘误部分。要查看以前提交的勘误，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索框中输入书名。所需信息将出现在勘误部分下方。

# 盗版

互联网上盗版受版权保护的材料是跨所有媒体持续存在的问题。在 Packt，我们非常重视版权和许可的保护。如果您在互联网上发现我们作品的任何形式的非法副本，请立即向我们提供位置地址或网站名称，以便我们采取补救措施。请通过`copyright@packtpub.com`与我们联系，并附上涉嫌盗版材料的链接。我们感谢您帮助保护我们的作者和我们为您提供有价值内容的能力。

# 问题

如果您对本书的任何方面有问题，可以通过`questions@packtpub.com`与我们联系，我们将尽力解决问题。
