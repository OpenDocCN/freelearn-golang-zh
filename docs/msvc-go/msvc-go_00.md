# 前言

自从首次发布以来，Go 编程语言在所有类型的软件开发者中获得了流行。简单的语言语法、易用性和丰富的库使得 Go 成为编写各种软件的主要语言之一，从小型工具到由数百个组件组成的大型系统。

在 Go 的主要使用场景中，微服务开发占据重要地位——即开发单个应用，称为微服务，它们可以扮演各种角色，从处理支付到存储用户数据。将大型系统组织成一组微服务通常带来多种优势，例如提高开发和部署速度，但也带来了多种类型的挑战。这些挑战包括服务发现和通信、集成测试以及服务监控。

在本书中，我们将展示如何实现 Go 微服务并建立它们之间的通信，如何启用单个微服务的部署并确保其交互的安全性，以及如何存储和检索服务数据并提供服务 API，使其他应用程序能够使用我们的微服务。您将了解与所有这些主题相关的行业最佳实践，并详细了解可能遇到的挑战以及可能的收益。通过阅读本书，您将获得的知识将帮助您创建新的微服务，并有效地维护现有的微服务。我希望这次旅程对您来说将是激动人心的！

# 本书面向的对象

本书面向所有类型的开发者：从对学习如何用 Go 编写微服务感兴趣的人到希望掌握编写可扩展和可靠微服务系统艺术的资深专业人士。本书的前两部分，涵盖微服务开发，对刚开始使用 Go 或对根据行业最佳标准组织 Go 应用程序代码库的最佳实践感兴趣的开发者来说将是有用的；最后一部分对所有开发者都很有用，即使是经验最丰富的开发者，因为它提供了关于在规模上维护和操作微服务的深刻见解。

# 本书涵盖的内容

*第一章*，*微服务简介*，将涵盖微服务架构的关键优势和常见问题，帮助您了解微服务解决哪些问题以及通常引入哪些挑战。本章强调 Go 编程语言在微服务开发中的作用，并为本书的其余部分奠定基础。

*第二章*, *构建 Go 微服务*，将向您介绍 Go 编程语言的主要原则，并提供编写 Go 代码的重要建议。它将涵盖设置正确结构以组织 Go 微服务代码的过程，并介绍一个由三个微服务组成的示例应用程序。最后，本章将说明如何为每个示例微服务构建代码。本章中实现的示例微服务将在整本书中使用，每个章节都会为它们添加新功能。

*第三章*, *服务发现*，将讨论服务发现的问题，并说明不同服务如何在微服务环境中找到彼此。它将涵盖最流行的服务发现工具，并引导您将服务发现逻辑添加到上一章的示例微服务中。

*第四章*, *序列化*，将带我们了解数据序列化的概念，这对于理解即将到来的章节中关于微服务通信的内容是必要的。您将了解 Protocol Buffers 数据格式，它将被用于编码和解码我们示例微服务之间传输的数据。本章将提供如何定义可序列化数据类型以及为它们生成代码的示例，以及如何在 Go 微服务中使用生成的代码。

*第五章*, *同步通信*，将涵盖微服务之间的同步通信话题。它将说明如何使用 Protocol Buffers 格式定义服务 API，并介绍 gRPC，一个服务通信框架。本章将以实现微服务网关和客户端以及在我们微服务之间执行远程调用的示例结束。

*第六章*, *异步通信*，将讨论微服务之间的异步通信。它将向您介绍一个流行的异步通信工具 Apache Kafka，并提供使用它为我们的示例微服务发送和接收消息的示例。本章将以在微服务环境中使用异步通信的最佳实践概述结束。

*第七章*, *存储服务数据*，将涵盖在数据库中持久化服务数据的话题。您将了解常见的数据库类型以及它们为软件开发者带来的好处。本章将引导您了解在 MySQL 数据库中存储服务数据逻辑的实现过程。

*第八章*, *使用 Kubernetes 进行部署*，将讨论服务部署，并概述一个流行的部署和编排平台 Kubernetes。本章将说明如何为部署准备服务代码，以及如何使用 Kubernetes 进行部署。本章将包括部署微服务应用的最佳实践。

*第九章*, *单元和集成测试*，将描述测试 Go 微服务代码的常见技术。它将涵盖 Go 单元和集成测试的基础，并演示如何测试前几章中的微服务代码。本章将以编写和组织测试的行业最佳实践结束。

*第十章*, *可靠性概述*，将向您介绍系统可靠性的主题，并描述构建可靠且高度可用的微服务的核心原则、工具和行业最佳实践。它将说明如何自动化服务对各种类型故障的响应，以及如何建立保持服务可靠性在控制之下的流程。

*第十一章**,* *收集服务遥测数据*，将提供收集服务遥测数据（如日志、指标和跟踪）的现代工具和解决方案的详细概述。本章将提供大量收集不同类型遥测数据的详细示例，并列出一些与它们一起工作的最佳实践。

*第十二章*, *设置服务警报*，将说明如何使用前一章收集的遥测数据为微服务设置自动事件检测和通知。它将向您介绍一个流行的警报和监控工具 Prometheus，并展示如何为我们的示例微服务设置 Prometheus 警报。

*第十三章*, *高级主题*，将总结本书的最后部分，并涵盖微服务开发的一些高级主题，例如性能分析、仪表盘、框架、服务所有权和安全。本章将包括一些使用 JWT 协议在 Go 微服务之间设置安全通信的示例。

# 为了充分利用本书

*我建议您通过实现一些应用程序，例如简单的 Web 服务，来熟悉 Go。熟悉 Docker 工具将是一个加分项，因为我们将在运行微服务将使用的一些工具时使用它。最后，我强烈建议实现、运行和玩转我们将要实现的示例微服务，以便通过实践巩固您的所有知识。*

| 本书涵盖的软件/硬件 | 操作系统要求 |
| --- | --- |
| `Go 1.11`或更高版本 | Windows、macOS 或 Linux |
| `Docker` | Windows、macOS 或 Linux |
| `grpcurl` | Windows、macOS 或 Linux |
| `Kubernetes` | Windows、macOS 或 Linux |
| `Prometheus` | Windows、macOS 或 Linux |
| `Jaeger` | Windows、macOS 或 Linux |
| `Graphviz` | Windows、macOS 或 Linux |

**如果您正在使用这本书的数字版，我们建议您亲自输入代码或从本书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将帮助您避免与代码复制粘贴相关的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/microservices-with-go`](https://github.com/PacktPublishing/microservices-with-go)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富的图书和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。

您可以在此处下载：[`packt.link/1fb2C`](https://packt.link/1fb2C)。

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“将下载的`WebStorm-10*.dmg`磁盘映像文件作为系统中的另一个磁盘挂载。”

代码块设置如下：

```go
package main

import (
    "encoding/json"
    "fmt"
    "os"
    "time"

    "github.com/confluentinc/confluent-kafka-go/kafka"
    "movieexample.com/rating/pkg/model"
)
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```go
    if err := p.Produce(&kafka.Message{
TopicPartition: kafka.TopicPartition{Topic: &topic, Partition: kafka.PartitionAny},
Value:          []byte(encodedEvent),
}, nil); err != nil {
        return err
    }
    return nil
```

任何命令行输入或输出都应如下编写：

```go
mysql movieexample -h localhost -P 3306 --protocol=tcp -u root -p
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**显示。以下是一个示例：“从**管理**面板中选择**系统信息**。”

小贴士或重要注意事项

看起来是这样的。

# 联系我们

欢迎读者反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过 customercare@packtpub.com 给我们发邮件，并在邮件主题中提及本书标题。

**勘误**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现错误，我们将不胜感激，如果您能向我们报告这一点。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 copyright@packt.com 与我们联系，并在邮件主题中提及本书标题。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为本书做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

前言

# 分享您的想法

读完《使用 Go 进行微服务》后，我们非常乐意听到您的想法！请[点击此处直接进入本书的亚马逊评论页面](https://packt.link/r/1804617008)并分享您的反馈。

您的评论对我们和科技社区非常重要，它将帮助我们确保我们提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢您购买本书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在每购买一本 Packt 书籍，您都可以免费获得该书的 DRM-free PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠远不止于此，您还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件访问权限。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接

![图片](img/B18865_QR_Free_PDF.jpg)

https://packt.link/free-ebook/978-1-80461-700-7

1.  提交您的购买证明

1.  就这样！我们将直接将您的免费 PDF 和其他优惠发送到您的电子邮件。

# 第一部分：简介

本部分提供了微服务架构模型的概述。它涵盖了微服务的关键优势和常见问题，帮助读者理解微服务架构有助于解决哪些问题，以及通常会引入哪些问题。本部分的单章专注于 Go 编程语言在微服务开发中的作用，并为本书的其余部分奠定了基础。

本部分包含以下章节：

+   *第一章*，*微服务简介*
