# 使用 Go 进行安全介绍

安全和隐私作为实际问题，一直在不断引起兴趣，特别是在技术行业。网络安全市场正在蓬勃发展并持续增长。该行业随着创新和研究的不断涌现而发展迅速。安全的兴趣和速度不仅加快了，而且应用程序的规模和风险也成倍增长。该行业需要一种简单易学、跨平台、高效的编程语言。Go 是完美的选择，它拥有非常强大的标准库、学习曲线短、运行速度快。

在本章中，我们将涵盖以下主题：

+   Go 的历史、语言设计、批评、社区和学习技巧

+   为什么使用 Go 进行安全

+   设置开发环境并编写你的第一个程序

+   运行示例程序

# 关于 Go

Go 是由谷歌创建并在 BSD 风格许可下分发的开源编程语言。BSD 许可允许任何人免费使用 Go，只要保留版权声明并且不使用谷歌名称进行认可或推广。Go 受到 C 的重大影响，但语法更简单，内存安全性和垃圾收集更好。有时，Go 被描述为现代的 C++。我认为这太过于简化，但 Go 绝对是一种简单而现代的语言。

# Go 语言设计

Go 的最初目标是创建一种简单、可靠和高效的新语言。正如前面提到的，Go 受到 C 编程语言的重大影响。这种语言本身非常简单，只有 25 个关键字。它被设计成与集成开发环境很好地结合，但并不依赖于它们。根据我的经验，任何尝试过 Go 的人都会发现它非常用户友好，学习曲线很短。

Go 的主要目标之一是解决 C++和 Java 代码的一些负面问题，同时保持性能。这种语言需要简单而一致，以管理非常庞大的开发团队。

变量是静态类型的，应用程序可以快速编译成静态链接的二进制文件。拥有单个静态链接的二进制文件使得创建轻量级容器非常容易。最终的应用程序也运行得很快，接近 C++和 Java 的性能，比 Python 等解释性语言快得多。虽然有指针，但不允许指针算术。Go 并不是自诩为面向对象的编程语言，也没有传统意义上的*类*；然而，它包含了许多与面向对象编程语言非常相似的机制。这将在下一章中更深入地讨论。接口被广泛使用，组合是继承的等价物。

Go 有许多有趣的特性。其中一个突出的特点是内置的并发性。只需在任何函数调用之前加上“go”这个词，它就会生成一个轻量级线程来执行该函数。另一个相当重要的特性是依赖管理，这是非常高效的。依赖管理是 Go 编译速度非常快的原因之一。它不会多次重新包含相同的头文件，就像 C++那样。Go 还具有内置的内存安全性，垃圾收集器处理未使用的内存清理。Go 的标准库也非常令人印象深刻。它是现代的，包含网络、HTTP、TLS、XML、JSON、数据库、图像处理和加密包。Go 还支持 Unicode，允许在源代码中使用各种字符。

Go 工具链是生态系统的核心。它提供了工具来下载和安装远程依赖项，运行单元测试和基准测试，生成代码，并根据 Go 格式标准格式化代码。它还包括编译器、链接器和汇编器，这些工具编译非常快，也允许通过简单地更改`GOOS`和`GOARCH`环境变量来轻松进行交叉编译。

一些功能被排除在 Go 语言之外。泛型、继承、断言、异常、指针算术和隐式类型转换都被排除在 Go 之外。许多功能是有意省略的，特别是泛型、断言和指针算术。作者们故意省略了一些功能，因为他们希望保持性能，尽可能简化语言规范，或者他们无法就最佳实现方式达成一致，或者因为某个功能太有争议。继承也是有意被省略的，而是使用接口和组合。其他一些功能，比如泛型，也是因为关于它们的正确实现存在太多争论而被省略，但它们可能会出现在 Go 2.0 中。作者们认识到，向语言中添加功能要比删除功能容易得多。

# Go 的历史

Go 是一种相对年轻的语言，起源于 2007 年，2009 年开源。它起源于 Google 的*20%项目*，由 Robert Griesemer、Rob Pike 和 Ken Thompson 共同开发。20%项目意味着项目的开发人员将 20%的时间用于作为实验性的副业项目。Go 1.0 于 2012 年 3 月正式发布。从一开始就计划将其作为一种开源语言。直到 Go 1.5 版本，编译器、链接器和汇编器都是用 C 语言编写的。在 1.5 版本之后，一切都是用 Go 语言编写的。

Google 最初为 Linux 和 macOS 推出了 Go，社区推动了其他平台的努力，即 Windows、FreeBSD、OpenBSD、NetBSD 和 Solaris。甚至已经移植到 IBM z 系统主机上。IBM 的 Bill O'Farrell 在 2016 年丹佛的 GopherCon 上做了一个名为*将 Go 移植到 IBM z 架构*的演讲（[`www.youtube.com/watch?v=z0f4Wgi94eo`](https://www.youtube.com/watch?v=z0f4Wgi94eo)）。

谷歌以 Python、Java 和 C++而闻名。他们选择这些语言也是可以理解的。它们各自扮演着特定的角色，有各自的优势和劣势。Go 是为了创建一个符合谷歌需求的新语言。他们需要能够在重负载下表现出色，支持并发，并且易于阅读、编写和快速编译的软件。

启动 Go 项目的触发事件是处理一个庞大的 C++代码库，因为 C++处理依赖关系和重新包含头文件的方式，构建需要花费数小时的时间（[`www.youtube.com/watch?v=bj9T2c2Xk_s`](https://www.youtube.com/watch?v=bj9T2c2Xk_s) (37:15)）。这就是为什么 Go 的主要目标之一是快速编译。Go 帮助将数小时的编译时间缩短到几秒，因为它比 C++更有效地处理依赖关系。

Go 2.0 的讨论已经开始，但仍处于概念阶段。目前没有发布时间表，也没有着急发布新的主要版本。

# 采用和社区

Go 仍然是一种年轻的语言，但它的采用率不断增长，也在人气上持续增长。Go 分别在 2009 年和 2016 年成为 TIOBE 年度语言：

![](img/3d9b13c6-b329-4bdc-8ebe-4e563bf87d0d.png)

来源：https://www.tiobe.com/tiobe-index/go/

Go 团队表达的期望之一是，他们预期 Go 会吸引大量的 C/C++和 Java 开发人员，但当大量用户来自 Python 和 Ruby 等脚本语言时，他们感到惊讶。其他人，比如我自己，发现 Go 是 Python 的一个自然补充，是一种很棒的语言。然而，当你需要更强大的东西时，你会选择哪种语言呢？一些大公司已经证明了 Go 在大规模生产中是稳定的，包括 Google、Dropbox、Netflix、Uber 和 SoundCloud。

第一个 Go 大会名为 GopherCon，于 2014 年举行。从那时起，GopherCon 每年都会举行。在[`gophercon.com`](https://gophercon.com)上了解更多关于 GopherCon 的信息。我有幸在 2016 年的 GopherCon 上发表了关于数据包捕获的演讲，并有了很棒的经历（[`www.youtube.com/watch?v=APDnbmTKjgM`](https://www.youtube.com/watch?v=APDnbmTKjgM)）。

# 关于 Go 的常见批评

社区中经常出现一些批评。可能最臭名昭著且最受讨论的批评是缺乏泛型。这导致重复的代码来处理不同的数据类型。接口在一定程度上可以缓解这个问题。我们可能会在未来的版本中看到泛型，因为作者已经表现出对泛型的开放态度，但他们并没有匆忙做出重要的设计决定。

接下来经常听到的批评是缺乏异常处理。开发人员必须显式处理或忽略每个错误。就我个人而言，我发现这是一种令人耳目一新的改变。这并不是真的多做工作，而且你可以完全控制代码流程。有时候，使用异常处理时，你并不确定它会在哪里被捕获，因为它会一直冒泡上来。而使用 Go，你可以轻松地跟踪错误处理代码。

Go 有一个处理内存清理的垃圾收集器。垃圾收集器随着时间的推移得到了升级和改进。垃圾收集器确实会对性能产生一些影响，但它节省了开发人员大量的思考和担忧。最初，Go 被描述为一种系统编程语言，对内存的控制能力对于非常低级的应用程序来说是有限制的。自那时起，他们已经转变了对 Go 的称呼，不再称其为系统编程语言。如果你需要对内存进行低级别的控制，那么你将不得不用 C 语言编写部分代码。

# Go 工具链

`go`可执行文件是 Go 工具链的主要应用程序。你可以向`go`传递一个命令，它将采取适当的操作。工具链有工具来运行、编译、格式化源代码，下载依赖项等。让我们看看完整的列表，这是通过`go help`命令或`go`本身获得的输出：

+   `build`: 这个命令编译包和依赖项

+   `clean`: 这个命令移除对象文件

+   `doc`: 这个命令显示包或符号的文档

+   `env`: 这个命令打印 Go 环境信息

+   `generate`: 这是代码生成器

+   `fix`: 这个命令在新版本发布时升级 Go 代码

+   `fmt`: 这个命令在包源代码上运行`gofmt`

+   `get`: 这个命令下载并安装包和依赖项

+   `help`: 这个命令提供特定主题的更多帮助

+   `install`: 这个命令编译并安装包和依赖项

+   `list`: 这个命令列出包

+   `run`: 这个命令编译并运行 Go 程序

+   `test`: 这个命令运行单元测试和基准测试

+   `vet`: 这个命令用于检查源代码中的错误

+   `version`: 这个命令显示 Go 版本

有关这些命令的更多信息，请访问[`golang.org/cmd/`](https://golang.org/cmd/)。

# Go 吉祥物

每个人都知道最好的剑有名字，最好的编程语言有吉祥物。Go 的吉祥物是**gopher**。这只 gopher 没有名字。它有一个豆子形状的身体，微小的四肢，巨大的眼睛和两颗牙齿。它是由 Renee French 设计的，其版权属于*知识共享署名 3.0*许可。这意味着你可以使用这些图片，但必须在使用的地方给予其创作者 Renee French 的信用。

Renee French 在 2016 年的丹佛 GopherCon 上做了一个名为*The Go Gopher: A Character Study*的演讲，解释了 gopher 的由来，它所采取的各种媒介和形式，以及在各种情况下画它的技巧([`www.youtube.com/watch?v=4rw_B4yY69k`](https://www.youtube.com/watch?v=4rw_B4yY69k))。

你可以在[`gopherize.me/`](https://gopherize.me/)生成一个定制的 gopher 头像，并在[`blog.golang.org/gopher`](https://blog.golang.org/gopher)上了解更多关于 Go gopher 的信息。

![](img/13098b0b-f4f5-4d83-b780-4a505d29a41b.jpg)

# 学习 Go

如果你以前没有使用过 Go，不要害怕。它有一个温和的学习曲线，只需一两天就可以学会。开始的最佳地点是[`tour.golang.org/`](https://tour.golang.org/)。这是 Go 编程语言的基本教程。如果你已经完成了这个教程，那么你应该已经有了足够的基础来顺利阅读本书。如果你正在阅读本书，但还没有参加过这个教程，你可能会遇到一些你不熟悉的概念，这里没有解释。这个教程是一个学习和练习的好地方。

由于语言规范中只有 25 个保留关键字，它足够简短，可以被“凡人”理解。你可以在[`golang.org/ref/spec`](https://golang.org/ref/spec)上阅读更多关于规范的信息。

你必须已经熟悉了大部分这些关键词。它们包括：`if`，`else`，`goto`，`for`，`import`，`return`，`var`，`continue`，`break`，`range`，`type`，`func`，`interface`，`package`，`const`，`map`，`struct`，`select`，`case`，`switch`，`go`，`defer`，`chan`，`fallthrough`和`default`。

这个教程将帮助你学习关键词、语法和数据结构的基础知识。教程中的游乐场让你可以在浏览器中练习编写和运行代码。

# 为什么使用 Go？

关于 Go，有几个方面吸引了我。并发性，速度和简单性对我来说是最重要的。这种语言非常简单，易于学习。它没有`try`，`catch`和异常流程。尽管有些人批评繁琐的错误处理，但我发现拥有一种简单的语言是令人耳目一新的，它不会在幕后隐藏很多魔法，而是确切地做它所说的。`go fmt`工具标准化了格式，使得阅读他人的代码变得容易，并消除了定义自己的标准的负担。

Go 提供了一种可扩展性和可靠性的感觉，实际上是一种令人愉快的体验。在 Go 之前，快速编译代码的主要选择是 C++，对于不同的平台管理头文件和构建过程并不是一件简单的任务。多年来，C++已经变得非常复杂，对大多数人来说并不像 Go 那样易于接近。

# 为什么在安全领域使用 Go？

我认为我们都明白没有最好的编程语言这回事，但不同的工作有不同的工具。Go 在性能和并发性方面表现出色。它的其他一些优点包括能够编译成单个可执行文件并且容易进行跨平台编译。它还有一个现代化的标准库，非常适合网络应用。

跨编译的便利性在安全领域产生了一些有趣的用例。以下是安全领域中跨编译的一些用例：

+   渗透测试人员可以使用树莓派为 Windows、macOS 和 Linux 编译自定义的 Go 反向外壳，并尝试部署它们。

+   网络防御者可以有一个中央数据库，用来存储所有蜜罐服务器提供的蜜罐信息，然后交叉编译蜜罐服务器。这将使他们能够轻松地在所有平台上部署一致的应用程序，包括 Windows、mac 和 Linux。

+   网络防御者可以在网络中部署非常轻量级的蜜罐，形式为一个 Docker 容器，其中包含一个单一的静态链接二进制文件。容器可以快速创建和销毁，使用最小的带宽和服务器资源。

当你在思考 Go 是否是一个好的语言选择时，将 Go 与其他顶级语言进行比较可能会有所帮助。

# 为什么不使用 Python？

Python 是安全领域中流行的语言。这很可能是因为它的普及性、学习曲线短和大量的库。已经有一些有用的安全工具用 Python 编写，比如用于数据包捕获的 Scapy，用于网页抓取的 Scrapy，用于调试的 Immunity，用于解析 HTML 的 Beautiful Soup，以及用于内存取证的 Volatility。许多供应商和服务提供商也提供了 Python 的 API 示例。

Python 易于学习，并且有大量资源。Go 也易于编写，并且学习曲线平缓。在我看来，学习曲线和编程的简易性并不是 Go 和 Python 之间的主要区别因素。最大的区别，以及 Python 的不足之处，是性能。Python 在性能方面无法与 Go 竞争。部分原因是 Python 的解释性质，但更大的因素是**全局解释器锁**（**GIL**）。GIL 阻止解释器使用超过一个 CPU 的处理能力，即使有多个线程在执行。有一些方法可以绕过这个问题，比如使用多进程，但这也有自己的缺点和限制，因为它实际上是在派生一个新的进程。其他选项是使用 Jython（Python 在 Java 上）或 IronPython（Python 在.NET 上），这些都没有 GIL。

# 为什么不使用 Java？

Java 最大的优势之一是**一次编写，到处运行**（**WORA**）的能力。如果涉及到 GUI、图形或音频等任何事情，这是非常有价值的。Go 在创建 GUI 方面肯定不如 Java，但它是跨平台的，并支持交叉编译。

Java 是成熟且被广泛采用的，有大量可用的资源。与 Go 包相比，Java 库的选择更多。Java 是这两种语言中更冗长的一种。Java 生态系统更加复杂，有几种构建工具和包管理器可供选择。Go 更简单，更标准化。这些差异可能仅仅是由于这两种语言之间的年龄差异，但它可能仍会影响你的语言选择。

在某些情况下，**Java 虚拟机**（**JVM**）在内存或启动时间方面可能过于资源密集。如果需要将几个命令行 Java 应用程序串联在一起，为了运行一系列短暂的程序而启动 JVM 可能会对性能造成显著影响。在内存方面，如果需要运行同一应用程序的多个实例，那么运行每个 JVM 所需的内存可能会累积起来。JVM 也可能会限制，因为它创建了一个沙盒并限制了对主机机器的访问。Go 编译成本机代码，因此不需要虚拟机层。

Go 有很好的文档，并且社区不断增长并提供更多资源。对于有经验的程序员来说，这是一门容易学习的语言。并发性相对简单，并内置于语言中，而不是作为一个库包。

# 为什么不使用 C++？

C++确实提供了更多的控制，因为开发人员负责内存管理，没有垃圾收集器。出于同样的原因，C++的性能会稍微更好。在某些情况下，Go 实际上可以胜过 C++。

C++非常成熟，并拥有大量的第三方库。库并非总是跨平台的，可能具有复杂的 makefile。在 Go 中，交叉编译要简单得多，并且可以使用 Go 工具链完成。

Go 的编译效率更高，因为它具有更好的依赖管理。C++可以多次重新包含相同的头文件，导致编译时间膨胀。Go 中的包系统更一致和标准化。线程和并发在 Go 中是本地的，而在 C++中需要特定于平台的库。

C++的成熟也导致了语言随着时间的推移变得更加复杂。Go 是一种简单而现代的语言，带来了一种清新的变化。对初学者来说，C++不像 Go 那样友好。

# 开发环境

本书中的所有示例都可以在主要平台 Windows、macOS 和 Linux 上运行。话虽如此，这些示例主要是在 Ubuntu Linux 上编写和开发的，这是以下示例的推荐平台。

Ubuntu Linux 可以在[`www.ubuntu.com/download/desktop`](https://www.ubuntu.com/download/desktop)免费下载。下载页面可能会要求捐赠，但您可以选择免费下载。虽然不是必须使用 Ubuntu，但如果您使用相同的环境，阅读本书会更容易。其他 Linux 发行版同样适用，但我强烈建议您使用基于 Debian 的发行版。本书中的大多数 Go 代码示例都可以在 Windows、Linux 和 Mac 上运行，无需任何修改。某些示例可能是特定于 Linux 和 Mac 的，例如文件权限，在 Windows 中处理方式不同。任何特定于平台的示例都会有所提及。

您可以在虚拟机内免费安装 Ubuntu，也可以将其作为主要操作系统。只要您的系统具有足够的 CPU、RAM 和磁盘空间，我建议您使用 Oracle VirtualBox 提供的虚拟机，该虚拟机可在[`www.virtualbox.org/`](https://www.virtualbox.org/)上获得。VMWare Player 是 VirtualBox 的替代品，可在[`www.vmware.com/products/player/playerpro-evaluation.html`](https://www.vmware.com/products/player/playerpro-evaluation.html)上获得。

下载并安装 VirtualBox，然后下载 Ubuntu 桌面 ISO 文件。创建一个虚拟机，让它引导 Ubuntu ISO，并选择安装选项。安装完 Ubuntu 并以您的用户身份登录后，您可以安装 Go 编程语言。Ubuntu 通过提供一个软件包使这变得非常容易。只需打开一个终端窗口，运行以下命令：

```go
sudo apt-get install golang-go
```

使用`sudo`提升您的权限以进行安装，并可能要求您输入密码。如果一切顺利，您现在将可以访问包含整个工具链的`go`可执行文件。您可以运行`go help`或仅运行`go`以获取使用说明。

如果您没有使用 Ubuntu 或想要安装最新版本，您可以从[`golang.org/dl`](https://golang.org/dl/)下载最新版本。Windows 和 Mac 安装程序将负责更新您的`PATH`环境变量，但在 Linux 中，您将不得不将提取的内容移动到所需的位置，例如`/opt/go`，然后手动更新您的`PATH`环境变量以包括该位置。考虑以下示例：

```go
# Extract the downloaded Go tar.gz
tar xzf go1.9.linux-amd64.tar.gz
# Move the extracted directory to /opt
sudo mv go /opt
# Update PATH environment variable to include Go's binaries
echo "export PATH=$PATH:/opt/go/bin" >> ~/.bashrc
```

现在重新启动终端以使更改生效。如果您使用的是 Bash 之外的 shell，您需要更新适合您的 shell 的正确 RC 文件。

# 在其他平台上安装 Go

如果您没有使用 Ubuntu，您仍然可以轻松安装 Go。Go 网站在[`golang.org/dl/`](https://golang.org/dl/)的下载页面提供了多种安装格式。

# 其他 Linux 发行版

第一个选项是使用 Linux 发行版的软件包管理器安装 Go。大多数主要发行版都有 Go 的软件包。名称各不相同，因此可能需要进行网络搜索以获取确切的软件包名称。如果没有可用的软件包，您可以简单地下载预编译的 Linux tarball 并解压缩。将内容解压到`/opt/go`是一个不错的选择。然后，以与上一节中描述的方式相同，将`/opt/go/bin`添加到您的`PATH`环境变量中。

# Windows

官方的 Windows 安装程序可用，安装过程就像运行安装程序一样简单。您可能需要修改环境变量并更新您的`%PATH%`变量。在 Windows 10 中，可以通过导航到控制面板 | 系统 | 高级系统设置 | 环境变量找到。

# Mac

Mac 也有官方的安装程序可用。运行安装程序后，Go 将在您的`PATH`变量中可用。

# 设置 Go

此时，您的环境应该已经安装了 Go，并且您应该能够从终端窗口运行`go`可执行文件。go 程序是您访问 Go 工具链的方式。您可以通过运行以下命令来测试它：

```go
go help
```

现在我们准备编写第一个 Hello World 程序，以确保我们的环境完全正常。不过，在开始编码之前，我们需要创建一个适当的工作区。

# 创建您的工作区

Go 有一个工作区的标准文件夹结构。遵守特定的标准对于 Go 工具链正常工作非常重要。您可以在任何地方创建工作区目录，并且可以随意命名。在实验环境中，我们将简单地使用`Home`目录作为 Go 工作区。这意味着源文件将驻留在`~/src`，包将构建在`~/pkg`，可执行文件将安装到`~/bin`。

# 设置环境变量

为了让大部分 Go 工具链正常工作，必须设置`GOPATH`环境变量。`GOPATH`指定了你将其视为工作区的目录。在构建包之前，必须设置`GOPATH`环境变量。要获取更多帮助和信息，请在终端中运行以下命令调用`go help`命令：

```go
go help gopath
```

我们需要告诉 Go 将我们的`home`目录视为工作区。这是通过设置`GOPATH`环境变量来完成的。您可以通过以下三种方式设置`GOPATH`：

+   第一种方法是每次运行`go`命令时手动设置它。考虑以下示例：

```go
 GOPATH=$HOME go build hello
```

+   您还可以设置`GOPATH`变量，以便在关闭终端时保持设置，环境变量丢失：

```go
 export GOPATH=$HOME
```

+   第三个选项是永久设置`GOPATH`环境变量如下：

1.  1.  将其添加到您的 shell 启动脚本`.bashrc`中。这将在每次启动终端时设置变量。

1.  运行此命令以确保在打开未来的终端/ shell 会话时设置`GOPATH`：

```go
 echo "export GOPATH=$HOME" >> $HOME/.bashrc
```

1.  1.  重新启动终端以使更改生效。如果您使用 Zsh 或其他替代 shell，则需要更新相应的 RC 文件。

请注意，Go 版本 1.8 及更高版本不需要显式设置`GOPATH`环境变量。如果未设置`GOPATH`，它将使用`$HOME/go`作为默认工作区。

# 编辑器

我们将在我们的新`hello`目录中编写我们的第一个程序。您首先需要选择要使用的编辑器。幸运的是，使用 Go 不需要任何特殊的 IDE 或编辑器。Go 工具链可以轻松集成到许多编辑器和 IDE 中。您可以选择使用简单的文本编辑器，如记事本，也可以选择专门用于 Go 的完整的 IDE。

我建议您从一个简单的文本编辑器开始，比如 nano 或 gedit，因为这些都包含在 Ubuntu 中，易于使用，并且支持 Go 的语法高亮。当然，您也可以选择其他编辑器或 IDE。

许多文本编辑器和 IDE 都有 Go 支持的插件。例如，Visual Studio Code、Emacs、Sublime Text、JetBrains IntelliJ、Vim、Atom、NetBeans 和 Eclipse 都有 Go 插件。还有一些专门针对 Go 的 IDE，即 JetBrains GoLand 和 LiteIDE，两者都是跨平台的。

在您熟悉 Go 之后，可以从`nano`或`gedit`命令开始，然后探索其他编辑器和 IDE。本书不会比较编辑器或介绍如何配置它们。

# 创建您的第一个包

在`~/src`目录中，您创建的任何目录都是一个包。您的目录名称成为包或应用程序的名称。我们首先需要确保`src`目录存在。波浪号（`~`）类似于`$HOME`变量，是您的主目录的快捷方式。请参考以下代码块：

```go
mkdir ~/src
```

让我们为我们的第一个应用程序创建一个名为`hello`的新包：

```go
cd ~/src
mkdir hello
```

包只是一个目录。您可以在包中有一个或多个源文件。任何子目录都被视为单独的包。包可以是一个带有`main()`函数（`package main`）的应用程序，也可以是一个只能被其他包导入的库。这个包还没有任何文件，但我们马上就会写第一个文件。现在不要太担心包的结构。您可以在[`golang.org/doc/code.html#PackagePaths`](https://golang.org/doc/code.html#PackagePaths)上阅读有关包路径的更多信息。

# 编写你的第一个程序

您可以在一个目录中拥有的最简单的包是一个目录中的单个文件。创建一个新文件`~/src/hello/hello.go`，并将以下代码放入其中：

```go
package main

import "fmt"

func main() {
   fmt.Println("Hello, world.")
}
```

# 运行可执行文件

执行程序的最简单方法是使用`go run`命令。以下命令将在不留下可执行文件的情况下运行该文件：

```go
go run ~/src/hello/hello.go
```

# 构建可执行文件

要编译和构建可执行文件，请使用`go build`命令。运行`go build`时，必须传递一个包的路径。您提供的包路径是相对于`$GOPATH/src`的。由于我们的包在`~/src/hello`中，我们将运行以下命令：

```go
go build hello
```

只要我们设置了`$GOPATH`，就可以从任何地方调用`go build`。创建的可执行二进制文件将输出到当前工作目录中。然后可以使用以下命令运行它：

```go
./hello
```

# 安装可执行文件

`go build`工具适用于在当前工作目录中生成可执行文件，但有一种方法可以构建和安装您的应用程序，以便将可执行文件收集在同一位置。

当您运行`go install`时，它会将输出文件放在`$GOPATH/bin`的默认位置。在我们的情况下，我们将`$GOPATH`设置为我们的`$HOME`。因此，默认的`bin`目录将是`$HOME/bin`。

如果要将其安装到其他位置，可以通过设置`GOBIN`环境变量来覆盖位置。要安装我们的`hello`程序，我们将运行以下命令：

```go
go install hello
```

这将构建并创建一个可执行文件，`~/bin/hello`。如果`bin`目录尚不存在，它将自动创建。如果多次运行`install`命令，它将重新构建并覆盖`bin`目录中的可执行文件。然后可以使用以下命令运行应用程序：

```go
~/bin/hello
```

为了方便起见，您可以将`~/bin`添加到您的`PATH`环境变量中。这样做将允许您从任何工作目录运行应用程序。要将`bin`目录添加到您的`PATH`中，请在终端中运行以下命令：

```go
echo "export PATH=$PATH:$HOME/gospace/bin" >> ~/.bashrc
```

确保在此之后重新启动您的终端以刷新环境变量。之后，您可以通过在终端中简单地输入以下内容来运行`hello`应用程序：

```go
hello
```

安装应用程序是完全可选的。您不必安装程序来运行或构建它们。在开发时，您可以始终从当前工作目录构建和运行，但安装经常使用的已完成应用程序可能会更方便。

# 使用 go fmt 进行格式化

`go fmt`命令用于格式化源代码文件以符合 Go 格式标准。

这将确保缩进准确，没有过多的空格等。您可以一次格式化单个 Go 源代码文件或整个包。遵循 Go 编码标准并在文件上运行`go fmt`是一个好习惯，这样您就不会怀疑您的代码是否遵循了指南。在[`golang.org/doc/effective_go.html#formatting`](https://golang.org/doc/effective_go.html#formatting)上阅读更多关于格式化的内容。

# 运行 Go 示例

本书提供的示例都是独立的。每个示例都是一个完整的程序，可以运行。大多数示例都很简短，演示了一个特定的主题。虽然这些示例可以作为独立的程序使用，但其中一些可能有限的用途。它们旨在作为参考，并像烹饪书一样用于构建自己的项目。因为每个示例都是一个独立的主包，您可以使用`go build`命令获得可执行文件，并使用`go run`运行文件。以下是有关构建和运行程序的各种选项的更多详细信息。

# 构建单个 Go 文件

如果构建一个文件，它将生成一个以 Go 文件命名的可执行文件。运行以下命令：

```go
go build example.go
```

这将为您生成一个名为 example 的可执行文件，可以像这样执行：

```go
./example
```

# 运行单个 Go 文件

如果您只想运行文件而不生成可执行文件，您不必构建文件。`go run`选项允许您运行`.go`文件，而不会留下可执行文件。您仍然可以传递参数，就像它是一个常规可执行文件一样，如下所示：

```go
go run example.go arg1 arg2
```

# 构建多个 Go 文件

如果一个程序分成多个文件，您可以将它们全部传递给`build`命令。例如，如果您有一个`main.go`文件和一个包含额外函数的`utility.go`文件，您可以通过运行以下命令构建它们：

```go
go build main.go utility.go
```

如果您尝试单独构建`main.go`，它将无法找到`utility.go`中函数的引用。

# 构建文件夹（包）

如果一个包包含多个需要构建的 Go 文件，逐个传递每个文件给`build`命令是很麻烦的。如果在文件夹中不带参数运行`go build`，它将尝试构建目录中的所有`.go`文件。如果其中一个文件在顶部包含`package main`语句，它将生成一个以目录名称命名的可执行文件。如果您编写一个程序，可以编写一个不包含主文件，仅用作库以包含在其他项目中的包。

# 安装程序以供使用

安装程序类似于构建程序，但是，您运行的是`go install`而不是`go build`。您可以在目录中运行它，传递一个绝对目录路径，并传递一个相对于`$GOPATH`环境变量或直接在文件上的目录路径。一旦程序被安装，它将进入您的`$GOBIN`，您应该已经设置好了。您还应该将`$GOBIN`添加到您的`$PATH`中，这样无论您当前在哪个目录，都可以直接从命令行运行已安装的程序。安装是完全可选的，但对于某些程序来说很方便，特别是您想要保存或经常使用的程序。

# 总结

阅读完本章后，您应该对 Go 编程语言及其一些关键特性有一个基本的了解。您还应该在您的机器上安装了 Go 的版本，并设置了环境变量。如果您需要更多关于安装和测试您的环境的说明，请参阅 Go 文档[`golang.org/doc/install`](https://golang.org/doc/install)。

在下一章中，我们将更仔细地了解 Go 编程语言，学习设计、数据类型、关键字、特性、控制结构，以及如何获取帮助和查找文档。如果你已经熟悉 Go，这将是一个很好的复习，以加强你的基础知识。如果你是 Go 的新手，它将作为一个入门指南，为你准备本书的其余部分。
