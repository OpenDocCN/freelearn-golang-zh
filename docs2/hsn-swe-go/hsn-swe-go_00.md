# 前言

在过去的几年里，Go 语言逐渐成为构建可扩展和分布式系统行业中最受欢迎的语言之一。该语言的具有倾向性的设计和内置的并发特性使得工程师能够编写出高效利用所有可用 CPU 核心的代码。

本书提炼了行业编写精简且易于测试和维护的 Go 代码的最佳实践，并通过从头创建一个名为 'Links 'R' Us' 的多层应用程序来探讨其实际应用。你将指导完成设计、实现、测试、部署和扩展应用程序的所有步骤。你将从单体架构开始，逐步将项目转变为支持高效离核处理大型链接图的**面向服务的架构**（**SOA**）。你将了解各种高级和前沿的软件工程技术，如构建可扩展的数据处理管道、使用 gRPC 设计 API 以及大规模运行分布式图处理算法。最后，你将学习如何使用 Docker 编译和打包你的 Go 服务，并自动化它们到 Kubernetes 集群的部署。

在本书结束时，你将开始像一位专业开发者/工程师那样思考，通过编写精简且高效的 Go 代码将理论付诸实践。

# 这本书面向的对象

这本书是为那些对有效使用 Go 语言设计和构建可扩展分布式系统感兴趣的开发商和软件工程师而写的。这本书对那些渴望成为专业软件工程师的业余到中级水平的开发者来说也将非常有用。

# 本书涵盖的内容

第一章，*软件工程鸟瞰*，解释了软件工程与编程之间的区别，概述了你在小型、中型和大型组织中可能遇到的不同工程角色。更重要的是，本章总结了每个**软件工程师**（**SWE**）都应该了解的基本软件设计生命周期模型。

第二章，*编写清晰和可维护的 Go 代码的最佳实践*，解释了 SOLID 设计原则如何应用于 Go 项目，并提供了组织你的 Go 代码包以及编写易于维护和测试的代码的有用技巧。

第三章，*依赖管理*，强调了版本控制 Go 包的重要性，并讨论了用于管理项目依赖项的工具和策略。

第四章，*测试的艺术*，提倡使用诸如存根、模拟、间谍和假对象等原语来编写代码的全面单元测试。此外，本章列举了不同类型测试的优缺点（例如，黑盒与白盒、集成与功能测试），并以关于高级测试技术（如冒烟测试和混沌测试）的有趣讨论结束。

第五章，*Links 'R' Us 项目*，介绍了我们将在接下来的章节中从头开始构建的实战项目。

第六章，*构建持久化层*，专注于为 Links 'R' Us 项目的两个组件：链接图和文本索引器设计并实现数据访问层。

第七章，*数据处理管道*，探讨了数据处理管道背后的基本原理，并实现了一个使用 Go 原语（如通道、上下文和 goroutines）构建通用、并发安全和可重用管道的框架。然后，使用该框架开发 Links 'R' Us 项目的爬虫组件。

第八章，*基于图的数据处理*，解释了计算**批量同步并行**（**BSP**）模型的原理，并从头开始实现了一个用于在图上执行并行算法的框架。作为一个概念验证，我们将使用这个框架来研究流行的基于图的算法（如最短路径和图着色）的并行版本，我们的努力最终将完成 PageRank 算法的完整实现，这是 Links 'R' Us 项目的一个关键组件。

第九章，*与外界沟通*，概述了与路由、安全性和版本化等主题相关的 RESTful 和基于 gRPC 的 API 之间的关键区别。在本章中，我们还将定义 gRPC API，以便通过网络访问 Links 'R' Us 项目的链接图和文本索引器数据存储。

第十章，*构建、打包和部署软件*，列举了将 Go 应用程序 docker 化并优化其大小的最佳实践。此外，本章探讨了 Kubernetes 集群的解剖结构，并列出了我们可以使用的 Kubernetes 资源的基本列表。作为一个概念验证，我们将创建 Links 'R' Us 项目的单体版本，并将其部署到你在本地机器上启动的 Kubernetes 集群中。

第十一章，*将单体拆分为微服务*，解释了 SOA 模式，并讨论了一些你应该注意的常见反模式和从单体设计切换到微服务时想要避免的陷阱。为了测试本章中的想法，我们将把 Links 'R' Us 项目的单体版本拆分为微服务，并将它们部署到 Kubernetes。

第十二章，*构建分布式图处理系统*，结合了前几章的知识，创建了一个基于图的分布式数据处理框架的版本，可用于不适合内存的大规模图（离核处理）。

第十三章，*指标收集与可视化*，列举了收集和索引应用指标最流行的解决方案，重点关注 Prometheus。在讨论了如何对 Go 代码进行仪器化以捕获和导出 Prometheus 指标的方法之后，我们将深入探讨使用 Grafana 等工具进行指标可视化和基于收集指标聚合值的警报管理器设置警报。

第十四章，*结语*，提供了通过扩展我们在本书各章节中构建的动手项目来进一步理解材料的建议。

# 为了充分利用本书

为了充分利用本书并实验配套代码，您需要对 Go 编程有相当好的理解，以及足够使用 Go 生态系统所包含的各种工具的经验。

此外，本书假设您对基本网络理论有扎实的掌握。

最后，本书中的一些更技术性的章节使用了 Docker 和 Kubernetes 等技术。虽然对这些技术的先验知识*不是严格必需的*，但使用这些（或等效）系统的前期经验无疑将有助于更好地理解这些章节中讨论的主题。

# 下载示例代码文件

您可以从[www.packt.com](http://www.packt.com)的账户下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问[www.packtpub.com/support](https://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在[www.packt.com](http://www.packt.com)登录或注册。

1.  选择支持选项卡。

1.  点击代码下载。

1.  在搜索框中输入书名，并遵循屏幕上的说明。

一旦文件下载完成，请确保使用最新版本的以下软件解压或提取文件夹：

+   Windows 上的 WinRAR/7-Zip

+   Mac 上的 Zipeg/iZip/UnRarX

+   Linux 上的 7-Zip/PeaZip

本书代码包也托管在 GitHub 上，地址为**[`github.com/PacktPublishing/Hands-On-Software-Engineering-with-Golang`](https://github.com/PacktPublishing/Hands-On-Software-Engineering-with-Golang)**。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包，可在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**上找到。查看它们吧！

# 代码实战

要查看代码实战，请访问以下链接：[`bit.ly/37QWeR2`](http://bit.ly/37QWeR2)。

# 下载彩色图像

我们还提供包含本书中使用的截图/图表的彩色图像的 PDF 文件。您可以从这里下载：[`static.packt-cdn.com/downloads/9781838554491_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781838554491_ColorImages.pdf)。

# 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“在以下代码中，您可以看到为即将推出的游戏定义的通用`Sword`类型的定义。”

代码块设置如下：

```go
type Sword struct {
  name string // Important tip for RPG players: always name your swords!
}
// Damage returns the damage dealt by this sword.
func (Sword) Damage() int {
  return 2
} 

```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```go
type Sword struct {
  name string // Important tip for RPG players: always name your swords!
}
// Damage returns the damage dealt by this sword.
func (Sword) Damage() int {
  return 2
} 
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。以下是一个示例：“以下摘录是收集系统的一部分。”

将性能指标发布到**键值**存储。

警告或重要注意事项看起来像这样。

小贴士和技巧看起来像这样。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并通过`customercare@packtpub.com`给我们发送邮件。

**勘误表**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告这一点。请访问[www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)，选择您的书，点击勘误表提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过`copyright@packt.com`与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为本书做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下您的评价。一旦您阅读并使用过这本书，为何不在购买它的网站上留下评价呢？潜在读者可以查看并使用您的客观意见来做出购买决定，我们 Packt 可以了解您对我们产品的看法，而我们的作者也可以看到他们对书籍的反馈。谢谢！

如需了解 Packt 的更多信息，请访问[packt.com](http://www.packt.com/).
