<html><head></head><body>
		<div id="_idContainer062">
			<h1 id="_idParaDest-162" class="chapter-number"><a id="_idTextAnchor166"/>8</h1>
			<h1 id="_idParaDest-163"><a id="_idTextAnchor167"/>Building for Humans versus Machines</h1>
			<p>Thinking about your end user while you develop your command-line application will make you a more empathic developer. Consider not just how you feel about the way certain <strong class="bold">command-line interfaces</strong> (<strong class="bold">CLIs</strong>) behave but also how you could improve the experience for yourself and others. Much goes into usability and it’s not possible to cram it all into a single chapter, so we suggest following up with the suggested article and book in the <em class="italic">Further </em><span class="No-Break"><em class="italic">reading</em></span><span class="No-Break"> section.</span></p>
			<p>One of the first points to consider when building your command-line interface is that while it will be primarily used by humans, it can also be called within scripts, and the output from your program could be used as input into another application, such as <strong class="bold">grep</strong> or <strong class="bold">awk</strong>. Within this chapter, we’ll go over how to build for both and how to tell when you’re outputting to one versus <span class="No-Break">the other.</span></p>
			<p>The second point is the use of ASCII art to increase information density. Whether you’re outputting data as a table, or adding color or emojis, the idea is to make information jump out of the terminal in a way that the end user can quickly understand the data presented <span class="No-Break">to them.</span></p>
			<p>Finally, consistency also increases clarity for your users. When your CLI uses consistency within flag names and positional arguments across different commands and subcommands, your user can feel more confident in the steps they need to take when navigating your CLI. By the end of the chapter, you’ll hopefully have more to consider when building your CLI and be prompted to make usability improvements. Within this chapter, we’ll cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Building for humans <span class="No-Break">versus machines</span></li>
				<li>Increasing information density with <span class="No-Break">ASCII art</span></li>
				<li>Being consistent <span class="No-Break">across CLIs</span></li>
			</ul>
			<h1 id="_idParaDest-164"><a id="_idTextAnchor168"/>Technical requirements</h1>
			<p>You’ll need a Unix operating system to understand and run the examples shared in <span class="No-Break">the chapter.</span></p>
			<p>You can also find the code examples on GitHub <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Building-Modern-CLI-Applications-in-Go/tree/main/Chapter08"><span class="No-Break">https://github.com/PacktPublishing/Building-Modern-CLI-Applications-in-Go/tree/main/Chapter08</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-165"><a id="_idTextAnchor169"/>Building for humans versus machines</h1>
			<p>CLIs have a long history where their interactions were tailored for other programs and machines. Their design was more similar to functions within a program than a graphical interface. Because of this, many Unix programs today still operate under the assumption that they will be interacting with <span class="No-Break">another program.</span></p>
			<p>Today, however, CLIs are more often used by humans than other machines while still carrying an outdated interaction design. It’s time that we built CLIs for their primary <span class="No-Break">user—the human.</span></p>
			<p>In this section, we will compare the machine-first design to the human-first design and learn how to check whether you <a id="_idIndexMarker527"/>are outputting to the TTY. As we can recall from <a href="B18883_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Understanding CLI Standards</em>, <strong class="bold">TTY</strong> is short for <strong class="bold">TeleTYpewriter</strong>, which<a id="_idIndexMarker528"/> evolved into the input and output device to interact with large mainframes. In today’s world, desktop environments for operating systems, or <strong class="bold">OSs </strong>for short, provide a terminal window. This terminal window is a virtual teletypewriter. They are often called <strong class="bold">pseudo-teletypes</strong>, or <strong class="bold">PSY</strong> for<a id="_idIndexMarker529"/> short. It’s also an indication that a human is on the other end, versus <span class="No-Break">a program.</span></p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor170"/>Is it a TTY?</h2>
			<p>First, let’s understand devices. <strong class="bold">Devices</strong> can be anything from hard drives, RAM disks, DVD players, keyboards, mouses, printers, tape drivers, to TTYs. A <strong class="bold">device driver</strong> provides <a id="_idIndexMarker530"/>the interface between the operating system and the device; it provides an API that the operating system understands <span class="No-Break">and accepts.</span></p>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/Figure_8.1._B18883.jpg" alt="Figure 8.1 – Figure showing communication from OS to the TTY device via a device driver"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Figure showing communication from OS to the TTY device via a device driver</p>
			<p>On Unix-based OSs, there are two major <span class="No-Break">device drivers:</span></p>
			<ul>
				<li><strong class="bold">Block</strong> – interfaces for <a id="_idIndexMarker531"/>devices such as hard drives, RAM disks, and <span class="No-Break">DVD players</span></li>
				<li><strong class="bold">Character</strong> – interfaces<a id="_idIndexMarker532"/> for the keyboard, mouse, printers, tape drivers, TTYs, and <span class="No-Break">so on</span></li>
			</ul>
			<p>If you check that the standard input, <strong class="bold">stdin</strong>, or standard output, <strong class="bold">stdout</strong>, is a <strong class="bold">character </strong>device, then you can assume that you are receiving input from or sending output to <span class="No-Break">a human.</span></p>
			<h3>Is it a TTY on a Unix or Linux operating system?</h3>
			<p>In a terminal, if you type the <strong class="source-inline">tty</strong> command, it will output the file name connected to <strong class="bold">stdin</strong>. Effectively, it is the number of the <span class="No-Break">terminal window.</span></p>
			<p>Let’s run the command in<a id="_idIndexMarker533"/> our Unix terminal window and see what the <span class="No-Break">result is:</span></p>
			<pre class="console">
mmontagnino@Marians-MacBook-Pro marianina8 % tty
/dev/ttys014</pre>
			<p>There is a shorthand silent, <strong class="source-inline">-s</strong>, flag that can be used to suppress output. However, the application still returns an <span class="No-Break">exit code:</span></p>
			<ul>
				<li>Exit code 0 – standard input is coming from <span class="No-Break">a TTY</span></li>
				<li>Exit code 1 – standard input is not coming from <span class="No-Break">a TTY</span></li>
				<li>Exit code 2 – syntax error from <span class="No-Break">invalid parameters</span></li>
				<li>Exit code 3 – a <span class="No-Break">write error</span></li>
			</ul>
			<p>In Unix, typing <strong class="source-inline">&amp;&amp;</strong> after a <a id="_idIndexMarker534"/>command means that the second command will only execute if the first command runs successfully, with exit code 0. So, let’s try this code to see if we’re running in <span class="No-Break">a TTY:</span></p>
			<pre class="console">
mmontagnino@Marians-MacBook-Pro marianina8 % tty -s &amp;&amp; echo "this is a tty"
this is a tty</pre>
			<p>Since we ran those commands in a terminal, the result is <strong class="source-inline">this is </strong><span class="No-Break"><strong class="source-inline">a tty</strong></span><span class="No-Break">.</span></p>
			<h3>Programmatically check on a Unix or Linux operating system</h3>
			<p>There are a few ways to do this <a id="_idIndexMarker535"/>programmatically. We can use the code located in the <span class="No-Break"><strong class="source-inline">Chapter-8/isatty.go</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
func IsaTTY() {
  fileInfo, _ := os.Stdout.Stat()
  if (fileInfo.Mode() &amp; os.ModeCharDevice) != 0 {
    fmt.Println("Is a TTY")
  } else {
    fmt.Println("Is not a TTY")
  }
}</pre>
			<p>The preceding code grabs the file info from the standard output, <strong class="bold">stdout</strong>, file with the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
<strong class="source-inline">fileInfo, _ := os.Stdout.Stat()</strong></pre>
			<p>Then, we check the result of a bitwise operation, <strong class="source-inline">&amp;</strong>, between <strong class="source-inline">fileInfo.Mode()</strong> and <strong class="source-inline">os.ModeCharDevice</strong>. The bitwise operator, <strong class="source-inline">&amp;</strong>, copies a bit to the result if it exists in <span class="No-Break">both operands.</span></p>
			<p>Let’s take a quite simple example: <strong class="source-inline">7&amp;6</strong> w<a id="_idTextAnchor171"/>ithin a truth table. <strong class="source-inline">7</strong> values are represented by binary <strong class="source-inline">111</strong> and <strong class="source-inline">6</strong> values are represented <span class="No-Break">by </span><span class="No-Break"><strong class="source-inline">110</strong></span><span class="No-Break">.</span></p>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/Figure_8.2._B18883.jpg" alt="Figure 8.2 – Truth table to show the &amp; operation calculation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Truth table to show the &amp; operation calculation</p>
			<p>The <strong class="source-inline">&amp;</strong> operation <a id="_idIndexMarker536"/>checks each bit and whether they are the same, and if so, carry a bit over, or 1. If the bits differ, no bit is carried over, or 0. The resulting value <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">110</strong></span><span class="No-Break">.</span></p>
			<p>Now, in our more complicated example, the following code, <strong class="source-inline">fileInfo.Mode() &amp; os.ModeCharDevice</strong>, performs a bitwise operation between <strong class="source-inline">fileInfo.Mode()</strong> and <strong class="source-inline">os.ModeCharDevice</strong>. Let’s look at what this operation looks like when the code standard output is connected to <span class="No-Break">a terminal:</span></p>
			<table id="table001-2" class="No-Table-Style">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style" colspan="2">
							<p><strong class="bold">Is </strong><span class="No-Break"><strong class="bold">a TTY</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break">Code</span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break">Value</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">fileInfo.Mode()</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">Dcrw--w----</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">os.ModeCharDevice</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">c---------</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="source-inline">fileInfo.Mode()</strong> <strong class="source-inline">&amp; </strong><span class="No-Break"><strong class="source-inline">os.ModeCharDevice</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">c---------</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>(<strong class="source-inline">fileInfo.Mode()</strong> <strong class="source-inline">&amp;</strong> <strong class="source-inline">os.ModeCharDevice)</strong> <strong class="source-inline">!= 0</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">TRUE</strong></span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – The code next to its value when standard output is connected to a TTY</p>
			<p>In <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.3</em>, the file mode of the standard output is defined by the <strong class="source-inline">fileInfo.Mode()</strong> method call; its value is <strong class="bold">Dcrw--w----</strong>. If you look at the documentation for the <strong class="bold">os</strong> package at <a href="https://pkg.go.dev/os">https://pkg.go.dev/os</a>, you will see that the <strong class="source-inline">os.ModeDevice</strong>, <strong class="bold">D</strong>, bit is set to indicate that the file is a device file, followed by the <strong class="source-inline">os.ModeCharDevice</strong>, <strong class="bold">c</strong>, bit set to indicate that it is a Unix character device.  When we do a bitwise operation against the mode of <strong class="source-inline">stdin</strong> against <strong class="source-inline">os.ModCharDevice</strong>, we see that the same bits are carried over and the result does not equal zero, hence <strong class="source-inline">(fileInfo.Mode() &amp; os.ModeCharDevice) != 0</strong> is <strong class="bold">true</strong>, and the device is <span class="No-Break">a TTY.</span></p>
			<p>What would this code look like if the output were piped into another process? <span class="No-Break">Let’s look:</span></p>
			<table id="table002" class="No-Table-Style">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style" colspan="2">
							<p><strong class="bold">Is not </strong><span class="No-Break"><strong class="bold">a TTY</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break">Code</span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break">Value</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">fileInfo.Mode()</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">prw-rw----</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">os.ModeCharDevice</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">c---------</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="source-inline">fileInfo.Mode()</strong> <strong class="source-inline">&amp;</strong> <span class="No-Break"><strong class="source-inline">os.ModeCharDevice</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="source-inline">----------</strong></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>(<strong class="source-inline">fileInfo.Mode()</strong> <strong class="source-inline">&amp;</strong> <strong class="source-inline">os.ModeCharDevice)</strong> <strong class="source-inline">!= 0</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="source-inline">FALSE</strong></span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – The code next to its value when standard output is not connected to a TTY</p>
			<p>Now the <a id="_idIndexMarker537"/>standard output’s value is <strong class="bold">prw-rw----</strong>. The <strong class="source-inline">os.ModeNamedPipe</strong>, <strong class="bold">p</strong>, bit is set to indicate that it is connected to a <strong class="bold">pipe</strong>, a redirection to another process. When the bitwise operation is performed against <strong class="source-inline">os.ModeCharDevice</strong>, we see that no bits are copied over, hence <strong class="source-inline">(fileInfo.Mode() &amp; os.ModeCharDevice) != 0</strong> is <strong class="bold">false</strong>, and the device is not <span class="No-Break">a TTY.</span></p>
			<h3>Programmatically check on any operating system</h3>
			<p>We suggest using a <a id="_idIndexMarker538"/>package that has already gone through the trouble of determining the code for a larger set of operating systems to check whether standard output is sent to a TTY. The most popular package we found was <a href="https://github.com/mattn/go-isatty">github.com/mattn/go-isatty</a>, which we used in the <span class="No-Break"><strong class="source-inline">Chapter-8/utils/isatty.go</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
package utils
import (
  "fmt"
  "os"
  isatty "github.com/mattn/go-isatty"
)
func IsaTTY() {
  if isatty.IsTerminal(os.Stdout.Fd()) ||  isatty.
     IsCygwinTerminal(os.Stdout.Fd()) {
    fmt.Println("Is a TTY")
  } else {
    fmt.Println("Is not a TTY")
  }
}</pre>
			<p>Now that <a id="_idIndexMarker539"/>we know whether we are outputting to a TTY, which indicates that there is a human on the other end, versus not a TTY, we can tailor our <span class="No-Break">output accordingly.</span></p>
			<h2 id="_idParaDest-167">Designing for a<a id="_idTextAnchor172"/> machine</h2>
			<p>As aforementioned, CLIs <a id="_idIndexMarker540"/>were originally designed for machines first. It is important to understand what it exactly means to design another program. Although we would want to tailor our applications toward a human-first design, there will be times when we would need to output in a way that can easily be passed as input to the <strong class="source-inline">grep</strong> or <strong class="source-inline">awk</strong> command, because other applications will expect streams of either plain or <span class="No-Break">JSON text.</span></p>
			<p>Users will be using your CLI in many unexpected ways. Some of those ways are often within a bash script that pipes the output of your command as input into another application. If your application, as it should, outputs in the human-readable format first, it needs to also output in machine-readable format when the standard input is not connected to a TTY terminal. In the latter case, make sure any color and ASCII art, in the form of progress bars, for example, are disabled. The text should also be single-lined tabular data that can easily be integrated with the <strong class="source-inline">grep</strong> and <span class="No-Break"><strong class="source-inline">awk</strong></span><span class="No-Break"> tools.</span></p>
			<p>Also, it is important that you offer several persistent flags for your users to output in machine-readable output <span class="No-Break">when necessary:</span></p>
			<ul>
				<li><strong class="source-inline">--plain</strong>, for outputting plain text with one record of data <span class="No-Break">per line</span></li>
				<li><strong class="source-inline">--json</strong>, for outputting JSON text that can be piped to and from the <span class="No-Break">curl command</span></li>
				<li><strong class="source-inline">--quiet</strong>, <strong class="source-inline">-q</strong>, or <strong class="source-inline">--silent</strong>, <strong class="source-inline">-s</strong>, for suppressing <span class="No-Break">nonessential output</span></li>
			</ul>
			<p>Provide plain text when it does not impact usability. In other cases, offer the optional previous flags <a id="_idIndexMarker541"/>to give the user the ability to pipe its output easily into the input <span class="No-Break">of another.</span></p>
			<h2 id="_idParaDest-168"><a id="_idTextAnchor173"/>Designing for a human</h2>
			<p>The <a id="_idIndexMarker542"/>modern command-line application is designed for its primary consumer—the human. This may seemingly complicate the interface because there’s a bit more to consider. The way data is output and how quickly the data is returned can affect how a user perceives the quality and robustness of your CLI. We’ll go over some key areas <span class="No-Break">of design:</span></p>
			<ul>
				<li>Conversation as <span class="No-Break">the norm</span></li>
				<li><span class="No-Break">Empathy</span></li>
				<li><span class="No-Break">Personalization</span></li>
				<li><span class="No-Break">Visual language</span></li>
			</ul>
			<p>Let’s go into each in more detail so we can fully understand how this impacts a <span class="No-Break">human-centred design.</span></p>
			<h3>Conversation as the norm</h3>
			<p>Since your CLI will be<a id="_idIndexMarker543"/> responding to a human and not another program, interaction should flow like a conversation. As an application leans toward a conversational language, the user will feel more at ease. Consider your application as the guide, as well, toward usage of <span class="No-Break">the CLI.</span></p>
			<p>When a user runs a command and is missing important flags or arguments, then your application can prompt for these values. Prompts, or surveys, are a way to include a conversational back-and-forth flow of asking questions and receiving answers from the user. However, prompts should not be a requirement as flags and arguments should be available options for your commands. We will be going over prompts in more detail in <a href="B18883_10.xhtml#_idTextAnchor225"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">Interactivity with Prompts and </em><span class="No-Break"><em class="italic">Terminal Dashboards</em></span><span class="No-Break">.</span></p>
			<p>If your<a id="_idIndexMarker544"/> application contains a state, then communicate the current state similar to how <strong class="source-inline">git</strong> provides a <strong class="source-inline">status</strong> command and notifies the user when any commands change the state. Similarly, if your application provides workflows, typically defined by a chain of commands, then you can suggest commands to <span class="No-Break">run next.</span></p>
			<p>Being succinct is important when communicating with your user. Just like in conversation, if we muddle our words with too much extraneous information, people can become confused about the point we are trying to make. By communicating what’s important, but keeping it brief, our users will get the most important <span class="No-Break">information quickly.</span></p>
			<p>Context is important. If you are communicating with an end user versus a developer, that makes a difference. In that case, unless you are in verbose mode, there’s no reason to output anything only a developer <span class="No-Break">would understand.</span></p>
			<p>If the user is doing anything dangerous, ask for confirmation and match the level of confirmation with the level of danger that can be invoked by <span class="No-Break">the command:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="bold">Mild</strong></span><span class="No-Break">:</span><ul><li>Example: deleting <span class="No-Break">a file</span></li><li><span class="No-Break">Confirmation:</span><ul><li>If the command is a <strong class="source-inline">delete</strong> command, you don’t need <span class="No-Break">to confirm</span></li><li>If not a <strong class="source-inline">delete</strong> command, prompt <span class="No-Break">for confirmation</span></li></ul></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Moderate</strong></span><span class="No-Break">:</span><ul><li>Example: deleting a directory, remote resource, or bulk modification that cannot easily <span class="No-Break">be reverted</span></li><li><span class="No-Break">Confirmation:</span><ul><li>Prompt <span class="No-Break">for confirmation.</span></li><li>Provide a <strong class="bold">dry run</strong> operation. A <strong class="bold">dry run</strong> operation is used to see the results of the operation without actually making any modifications to <span class="No-Break">the data.</span></li></ul></li></ul></li>
				<li><span class="No-Break"><strong class="bold">Severe</strong></span><span class="No-Break">:</span><ul><li>Example: deleting something complex, such as an entire remote application <span class="No-Break">or server</span></li><li><span class="No-Break">Confirmation:</span><ul><li>Prompt for confirmation along with asking them to either type something non-trivial, such as the name of the resource they are deleting, or use a flag such as <strong class="source-inline">–confirm="name-of-resource"</strong> so it is <span class="No-Break">still scriptable</span></li></ul></li></ul></li>
			</ul>
			<p>In general, we<a id="_idIndexMarker545"/> want to make it increasingly more difficult for the user to do something more difficult. It is a way of guiding the user away from <span class="No-Break">any accidents.</span></p>
			<p>Any user input should always be validated early on to prevent anything unnecessarily bad from happening. Make the error returned understandable to the user who passed in <span class="No-Break">bad data.</span></p>
			<p>In a conversation, any confidential information must be secured. Make sure that any passwords are protected and provide secure methods for users to submit their credentials. For example, consider only accepting sensitive data via files only. You can offer a <strong class="source-inline">–password-file</strong> flag that allows the user to pass in a file or data via standard input. This method provides a discreet method for passing in <span class="No-Break">secret data.</span></p>
			<p>Be transparent in conversation. Any actions that cross the boundaries of the program should be stated explicitly. This includes reading or writing files that the user did not pass in as arguments unless these files are storing an internal state within a cache. This may also include any actions when talking to a <span class="No-Break">remote server.</span></p>
			<p>Finally, response time is more important than speed. Print something to the user in under 100 milliseconds. If you are making a network request, print out something before the request is made so it doesn’t look like the application is hanging or appearing broken. This will make your application appear more robust to its <span class="No-Break">end user.</span></p>
			<p>Let’s revisit our audio metadata CLI project. Under <a href="B18883_08.xhtml#_idTextAnchor166"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>’s <strong class="source-inline">audiofile</strong> repo, we’ll make some changes to create a conversational flow where it might <span class="No-Break">be missing.</span></p>
			<h4>Example 1: Prompt for information when a flag is missing</h4>
			<p>Using the <a id="_idIndexMarker546"/>Cobra CLI, if a flag is required, it would automatically return an error if the flag were missing when the command is called. Based on some of the guidelines mentioned in this section, rather than just returning an error, let’s prompt for missing data instead. In the <strong class="source-inline">audiofile</strong> code for <a href="B18883_08.xhtml#_idTextAnchor166"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, in the <strong class="source-inline">utils/ask.go</strong> file, we create two functions using the survey package <a href="https://github.com/AlecAivazis/survey/v2">github.com/AlecAivazis/survey/v2</a> <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
func AskForID() (string, error) {
  id := ""
  prompt := &amp;survey.Input{
    Message: "What is the id of the audiofile?",
  }
  survey.AskOne(prompt, &amp;id)
  if id == "" {
    return "", fmt.Errorf("missing required argument: id")
  }
  return id, nil
}
func AskForFilename() (string, error) {
  file := ""
  prompt := &amp;survey.Input{
    Message: "What is the filename of the audio to upload
      for metadata extraction?",
    Suggest: func(toComplete string) []string {
      files, _ := filepath.Glob(toComplete + "*")
      return files
    },
  }
  survey.AskOne(prompt, &amp;file)
  if file == "" {
    return "", fmt.Errorf("missing required argument:
      file")
  }
  return file, nil
}</pre>
			<p>These two<a id="_idIndexMarker547"/> functions can now be called when checking the flags that are passed and whether the values are still empty. For example, in the <strong class="source-inline">cmd/get.go</strong> file, we check for the <strong class="source-inline">id </strong>flag value and if it’s still empty, prompt the user for <span class="No-Break">the </span><span class="No-Break"><strong class="source-inline">id</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
id, _ := cmd.Flags().GetString("id")
if id == "" {
  id, err = utils.AskForID()
  if err != nil {
    return nil, err
  }
}</pre>
			<p>Running this gives the user the <span class="No-Break">following experience:</span></p>
			<pre class="console">
mmontagnino@Marians-MBP audiofile % ./bin/audiofile get
? What is the id of the audiofile?</pre>
			<p>Similarly, in the <strong class="source-inline">cmd/upload.go</strong> file, we check for the filename flag value and if it’s still empty, prompt the user for the filename. Because the prompt allows the user to drill down suggested files, we now get the <span class="No-Break">following experience:</span></p>
			<pre class="console">
mmontagnino@Marians-MBP audiofile % ./bin/audiofile upload
? What is the filename of the audio to upload for metadata extraction? [tab for suggestions]</pre>
			<p>Then, press <a id="_idIndexMarker548"/>the Tab key for suggestions to reveal a <span class="No-Break">drill-down menu:</span></p>
			<pre class="console">
mmontagnino@Marians-MBP audiofile % ./bin/audiofile upload
? What is the filename of the audio to upload for metadata extraction? audio/beatdoctor.mp3 [Use arrows to move, enter to select, type to continue]
 audio/algorithms.mp3
&gt; audio/beatdoctor.mp3
 audio/nightowl.mp3</pre>
			<p>Providing a prompt helps to guide the user and for them to understand how to run the <span class="No-Break">command works.</span></p>
			<h4>Example 2: Confirm deletion</h4>
			<p>Another way we can help to guide users toward safely using the CLI and protecting them from making any mistakes is to ask the user for confirmation when doing something dangerous. Although it is not necessary to do so during an explicit delete operation, we created a confirmation function that can be used with a configurable message in any type of dangerous situation. The function exists under the <span class="No-Break"><strong class="source-inline">utils/confirm.go</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
func Confirm(confirmationText string) bool {
  confirmed := false
  prompt := &amp;survey.Confirm{
    Message: confirmationText,
  }
  survey.AskOne(prompt, &amp;confirmed)
  return confirmed
}</pre>
			<h4>Example 3: Notify users when making a network request</h4>
			<p>Before any <a id="_idIndexMarker549"/>HTTP request is made, notifying the user helps them to understand what’s going on, especially if the request hangs or becomes unresponsive. We’ve added a message prior to each network request in each command. The <strong class="source-inline">get</strong> command now has the following line prior to the client running the <span class="No-Break"><strong class="source-inline">Do</strong></span><span class="No-Break"> method:</span></p>
			<pre class="source-code">
fmt.Printf("Sending request: %s %s %s...\n",
           http.MethodGet, path, payload)
resp, err := client.Do(req)
if err != nil {
  return nil, err
}</pre>
			<h3>Empathy</h3>
			<p>There are some<a id="_idIndexMarker550"/> simple modifications you can make to your command-line application to empathize with <span class="No-Break">your users:</span></p>
			<ul>
				<li><span class="No-Break">Be helpful:</span><ul><li>Provide help text <span class="No-Break">and documentation</span></li><li><span class="No-Break">Suggest commands</span></li><li>Rewrite errors in an <span class="No-Break">understandable way</span></li></ul></li>
				<li>Invite user feedback and <span class="No-Break">bug submission</span></li>
			</ul>
			<p>In <a href="B18883_09.xhtml#_idTextAnchor190"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">The Empathic Side of Development</em>, we will go through the ways in which you can help guide your users toward success using help text, documentation, widespread support, and providing an effortless way for users to provide feedback and <span class="No-Break">submit bugs.</span></p>
			<h4>Example 1: Offering command suggestions</h4>
			<p>The Cobra CLI <a id="_idIndexMarker551"/>offers some empathy when a user mistypes a command. Let’s look at the following example where the user mistypes <strong class="source-inline">upload</strong> <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">upolad</strong></span><span class="No-Break">:</span></p>
			<pre class="console">
mmontagnino@Marians-MacBook-Pro audiofile % ./bin/audiofile upolad
Error: unknown command "upolad" for "audiofile"
Did you mean this?
        upload
Run 'audiofile --help' for usage.</pre>
			<h4>Example 2 – Offer an effortless way to submit bugs</h4>
			<p>In <a href="B18883_09.xhtml#_idTextAnchor190"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><em class="italic">, The Empathic Side of Development,</em> we define a bug command that will launch the default browser and navigate to the GitHub repository's new issue page to file a <span class="No-Break">bug report:</span></p>
			<pre class="console">
mmontagnino@Marians-MacBook-Pro audiofile % ./bin/audiofile bug --help
Bug opens the default browser to start a bug report which will include useful system information.
Usage:
  audiofile bug [flags]
Examples:
audiofile bug</pre>
			<h4>Example 3: Print usage command is used incorrectly</h4>
			<p>Suppose a <a id="_idIndexMarker552"/>user does not input a value to search for when running the search command. The CLI application will prompt for a value to search for. If a value is not passed in by the user, the CLI will output the proper usage of <span class="No-Break">the command:</span></p>
			<pre class="console">
mmontagnino@Marians-MacBook-Pro audiofile % ./bin/audiofile search
? <img src="image/012.png" alt=""/> What value are you searching for?
Error: missing required argument (value)
Usage:
  audiofile search [flags]
Flags:
  -h, --help           help for search
      --json           return json format
      --plain          return plain format
      --value string   string to search for in metadata</pre>
			<h3>Personalization</h3>
			<p>In general, make<a id="_idIndexMarker553"/> the default the right thing for most users, but also allow users to personalize their experience with your CLI. The configuration <a id="_idIndexMarker554"/>gives the users a chance to personalize their experience with your CLI and make it more <span class="No-Break">their own.</span></p>
			<h4>Example 1: Technical configuration with Viper</h4>
			<p>Using <strong class="source-inline">audiofile</strong> as an example, let’s create a simple configuration setup with Viper to offer the user the ability to change any defaults to their liking. The configurations that we’ve created are for the API and CLI applications. For the API, we’ve defined the <strong class="source-inline">configs/api.json</strong> file, which contains <span class="No-Break">the following:</span></p>
			<pre class="source-code">
{
  "api": {
    "port": 8000
  }
}</pre>
			<p>The API will always execute locally to where it’s being executed. Then, for the CLI, we’ve defined a similar simple file, <strong class="source-inline">configs/cli.json</strong>, containing <span class="No-Break">the following:</span></p>
			<pre class="source-code">
{
  "cli": {
    "hostname": "localhost",
    "port": 8000
  }
}</pre>
			<p>If the API is running on an external host with a different port, then these values can be modified within the configuration. For the CLI to point to the new hostname, we’ll need to update <a id="_idIndexMarker555"/>any references within the CLI commands to use the value in the configuration. For example, in the <strong class="source-inline">cmd/get.go</strong> file, the path is <span class="No-Break">defined as:</span></p>
			<pre class="source-code">
path := fmt.Sprintf("http://%s:%d/request?%s",
    viper.Get("cli.hostname"), viper.GetInt("cli.port"),
    params)</pre>
			<p>To initialize these values and provide defaults if any required values are missing from the configuration, we run a <strong class="source-inline">Configure</strong> function defined <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">cmd/root.go</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
func Configure() {
  viper.AddConfigPath("./configs")
  viper.SetConfigName("cli")
  viper.SetConfigType("json")
  viper.ReadInConfig()
  viper.SetDefault("cli.hostname", "localhost")
  viper.SetDefault("cli.port", 8000)
}</pre>
			<p>A similar code exists within the <strong class="source-inline">cmd/api.go</strong> file to gather some of the same information. Now that this is set up, if there are any changes the user wants to make to the hostname, log level, or port, there is only one configuration file <span class="No-Break">to modify.</span></p>
			<h4>Example 2: Environment variable configuration</h4>
			<p>Suppose there is an environment variable specific to the application that allows users to define the foreground and background color to use. This environment variable could be named <strong class="source-inline">AUDIOFILE_COLOR_MODE</strong>. Using the Viper configuration again, values for the foreground <a id="_idIndexMarker556"/>and background texts may be used to overwrite default settings. While this is not implemented within our CLI, the Viper configuration may look like <span class="No-Break">the following:</span></p>
			<pre class="source-code">
{
  "cli": {
    "colormode": {
      "foreground": "white",
      "background": "black",
    }
  }
}</pre>
			<h4>Example 3: Storage location</h4>
			<p>Sometimes users want the location of certain output, logging, for example, to be stored in a particular area. Providing details within Viper can allow defaults to be overwritten. Again, this is not currently implemented within our CLI, but if we were to provide this option within our configuration, it may look <span class="No-Break">like this:</span></p>
			<pre class="source-code">
{
  "api": {
    "local_storage": "/Users/mmontagnino/audiofile"
  }
}</pre>
			<p>Any other new configuration values can be added with a similar approach. Providing the ability to configure your application is the start for personalization. Think of the many ways you can <a id="_idIndexMarker557"/>configure your CLI: color settings, disabling prompts or ASCII art, default formatting, <span class="No-Break">and more.</span></p>
			<h3>Pagination</h3>
			<p>Use a pager when<a id="_idIndexMarker558"/> you are outputting a lot of text, but be careful <a id="_idIndexMarker559"/>because sometimes the implementation can <span class="No-Break">be error-prone.</span></p>
			<h4>Pagination for Unix or Linux</h4>
			<p>On a<a id="_idIndexMarker560"/> Unix or Linux machine, you may use the <strong class="source-inline">less</strong> command for pagination. Calling the <strong class="source-inline">less </strong>command with a sensible set of options, such as <strong class="source-inline">less -FIRX</strong>, pagination does not occur if the contents fit on a single screen, case is ignored when searching, color and formatting are enabled, and the content is kept on the screen when <strong class="source-inline">less</strong> quits. We will use this as an example within the next section when outputting table data, and in preparation, within the <strong class="source-inline">utils</strong> package, we add the following files: <strong class="source-inline">pager_darwin.go</strong> and <strong class="source-inline">pager_linux.go</strong>, with a <strong class="source-inline">Pager</strong> function. In our case, though, we use the <strong class="source-inline">–r</strong> flag only because we want to continue displaying colors in <span class="No-Break">the table:</span></p>
			<pre class="source-code">
func Pager(data string) error {
  lessCmd := exec.Command("less", "-r")
  lessCmd.Stdin = strings.NewReader(data)
  lessCmd.Stdout = os.Stdout
  lessCmd.Stderr = os.Stderr
  err := lessCmd.Run()
  if err != nil {
    return err
  }
  return nil
}</pre>
			<h4>Pagination for Windows</h4>
			<p>On a Windows<a id="_idIndexMarker561"/> machine, we use the <strong class="source-inline">more</strong> command instead. Within the <strong class="source-inline">utils</strong> package, we add the <strong class="source-inline">pager_windows.go</strong> file following with a <span class="No-Break"><strong class="source-inline">Pager</strong></span><span class="No-Break"> function:</span></p>
			<pre class="source-code">
func Pager(data string) error {
    moreCmd := exec.Command("cmd", "/C", "more")
    moreCmd.Stdin = strings.NewReader(data)
    moreCmd.Stdout = os.Stdout
    moreCmd.Stderr = os.Stderr
    err := moreCmd.Run()
    if err != nil {
        return err
    }
    return nil
}</pre>
			<p>Now you know how to handle the pagination of output on the three major operating systems. This will also help users when you are outputting a large amount of data to scroll through the <span class="No-Break">output easily.</span></p>
			<h3>Visual language</h3>
			<p>Depending on the data, it might be easier for the users to see it in plain text, table format, or in JSON format. Remember to provide the user with options to return data in the format they prefer with the <strong class="source-inline">–plain</strong> or <strong class="source-inline">–</strong><span class="No-Break"><strong class="source-inline">json</strong></span><span class="No-Break"> flag.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Sometimes, for all of the data to appear within a user’s window, some lines may be wrapped within a cell. This will <span class="No-Break">break scripts.</span></p>
			<p>There are many visual cues that can be displayed to the user to increase information density. For example, if something is going to take a long time, use a progress bar and provide an estimate of the time remaining. If there is a success or failure, utilize color codes to provide an additional level of information for the user <span class="No-Break">to consume.</span></p>
			<p>We now know how<a id="_idIndexMarker562"/> to determine whether we are outputting to a human via a terminal or to another application, so knowing the difference allows us to output data appropriately. Let’s continue to the next section to discuss fun examples to provide data with ASCII visualizations to improve <span class="No-Break">information density.</span></p>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor174"/>Increasing information density with ASCII art</h1>
			<p>As the<a id="_idIndexMarker563"/> title of this section states, you can increase information density using ASCII art. For example, running the <strong class="source-inline">ls</strong> command shows file permissions in a way a user can easily scan with their eyes and understand with pattern recognition. Also, using a highlighter pen when studying in a textbook to literally highlight a sentence or group of words makes certain phrases jump out as more important. In this section, we’ll talk about some common uses for ASCII art to increase the understanding of the importance of <span class="No-Break">shared information.</span></p>
			<h2 id="_idParaDest-170"><a id="_idTextAnchor175"/>Displaying information with tables</h2>
			<p>Probably <a id="_idIndexMarker564"/>the clearest way that data can be displayed to users is in a table format. Just like the <strong class="source-inline">ls</strong> format, patterns can jump out more easily in a table format. Sometimes records can contain data that is longer than the width of the screen and lines become wrapped. This can break scripts that might be relying on one record <span class="No-Break">per line.</span></p>
			<p>Let’s take our audiofile as an example and instead of returning the JSON output, use the package to return the data cleanly in a table. We can keep the ability to return JSON output for when the user decides to require it using the <strong class="source-inline">–</strong><span class="No-Break"><strong class="source-inline">json</strong></span><span class="No-Break"> flag.</span></p>
			<p>The simplest way of outputting data as a table with the <strong class="source-inline">pterm</strong> package is using the default table. Next to the models, there currently exists a <strong class="source-inline">JSON()</strong> method that will take the struct and then output it in JSON format. Similarly, we add a <strong class="source-inline">Table()</strong> method on the pointer to the struct. In the <strong class="source-inline">models/audio.go</strong> file, we add the following bit of code for the <span class="No-Break">header table:</span></p>
			<pre class="source-code">
var header = []string{
  "ID",
  "Path",
  "Status",
  "Title",
  "Album",
  "Album Artist",
  "Composer",
  "Genre",
  "Artist",
  "Lyrics",
  "Year",
  "Comment",
}</pre>
			<p>This<a id="_idIndexMarker565"/> defines the header for the audio table. We then add some code to transform an <strong class="source-inline">audio</strong> struct into <span class="No-Break">a row:</span></p>
			<pre class="source-code">
func row(audio Audio) []string {
  return []string{
    audio.Id,
    audio.Path,
    audio.Status,
    audio.Metadata.Tags.Title,
    audio.Metadata.Tags.Album,
    audio.Metadata.Tags.AlbumArtist,
    audio.Metadata.Tags.Composer,
    audio.Metadata.Tags.Genre,
    audio.Metadata.Tags.Artist,
    audio.Metadata.Tags.Lyrics,
    strconv.Itoa(audio.Metadata.Tags.Year),
    strings.Replace(audio.Metadata.Tags.Comment, "\r\n",
        "", -1),
  }
}</pre>
			<p>Now we use the <strong class="source-inline">pterm</strong> package to create the table from the header row and function to convert an <a id="_idIndexMarker566"/>audio item into a row, each of type <strong class="source-inline">[]string</strong>. The <strong class="source-inline">Table()</strong> method for <strong class="source-inline">Audio</strong> and <strong class="source-inline">AudioList</strong> structs are <span class="No-Break">defined below:</span></p>
			<pre class="source-code">
func (list *AudioList) Table() (string, error) {
  data := pterm.TableData{header}
  for _, audio := range *list {
    data = append(
      data,
      row(audio),
    )
  }
  return pterm.DefaultTable.WithHasHeader()
     .WithData(data).Srender()
}
func (audio *Audio) Table() (string, error) {
  data := pterm.TableData{header, row(*audio)}
  return pterm.DefaultTable.WithHasHeader().WithData(data).
    Srender()
}</pre>
			<p>All the data in this example is output one record per line. If you decide on a different implementation and this is not the case for your code, make sure you add the <strong class="source-inline">–plain</strong> flag as an optional flag where once it is called, it will print one record per line. Doing this will ensure that scripts do not break on the output of the command. Regardless, depending on the size of the data and terminal, you may notice that the data wraps around and might be hard to read. If you are running Unix, run the <strong class="source-inline">tput rmam</strong> command to remove line wrapping from <strong class="source-inline">terminal.app</strong> and then <strong class="source-inline">tput smam</strong> to add line wrapping back in. On Windows, there will be a setting under your console properties. Either way, this should make viewing the table data a <span class="No-Break">bit easier!</span></p>
			<p>If a lot of data<a id="_idIndexMarker567"/> is returned within the table, then it’s important to add paging for increased usability. As mentioned in the last section, we’ve added a <strong class="source-inline">Pager</strong> function to the <strong class="source-inline">utils</strong> package. Let’s modify the code so that it checks whether the data is being output to a terminal, and if so, page the data using the <strong class="source-inline">Pager</strong> function. In the <strong class="source-inline">utils/print.go</strong> file, within the <strong class="source-inline">Print</strong> function, we paginate the JSON formatted data, for example, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
if jsonFormat {
    if IsaTTY() {
        err = Pager(string(b))
        if err != nil {
            return b, fmt.Errorf("\n paging: %v\n ", err)
        }
    } else {
        return b, fmt.Errorf("not a tty")
    }
}</pre>
			<p>If the output is returned to a terminal, then we paginate, otherwise we return the bytes with an error that informs the calling function it is not a terminal.  For example, the <strong class="source-inline">cmd/list.go</strong> file calls the preceding <span class="No-Break"><strong class="source-inline">Print</strong></span><span class="No-Break"> </span><span class="No-Break">function:</span></p>
			<pre class="source-code">
formatedBytes, err := utils.Print(b, jsonFormat)
if err != nil {
    fmt.Fprintf(cmd.OutOrStdout(), string(formatedBytes))
}</pre>
			<p> When it <a id="_idIndexMarker568"/>receives the error, then it just prints the string value to <span class="No-Break">standard output.</span></p>
			<h2 id="_idParaDest-171"><a id="_idTextAnchor176"/>Clarifying with emojis</h2>
			<p>A <a id="_idIndexMarker569"/>picture is worth a thousand words. So much information can be shared just by adding an emoji. For example, think of the simple green checkbox, <img src="image/02.png" alt=""/>, that is so often used on Slack or in GitHub to signal approval. Then, there is the opposite case with a red x, <img src="image/03.png" alt=""/>, to symbolize that something <span class="No-Break">went wrong.</span></p>
			<p>Emojis are letters that exist within the UTF-8 (Unicode) character set, which covers almost all the characters and symbols of the world. There are websites that will share this Unicode emoji mapping. Visit <strong class="source-inline">https://unicode.org/emoji/charts/full-emoji-list.html</strong> to view the full <span class="No-Break">character list.</span></p>
			<h3>Example 1 – Gree<a id="_idTextAnchor177"/>n checkmark for successful operations</h3>
			<p>In our<a id="_idIndexMarker570"/> audiofile, we add the emoji to the output to the <strong class="source-inline">upload</strong> command. At the top of the file, we add the emoji constant with a UTF-8 <span class="No-Break">character code:</span></p>
			<pre class="source-code">
const (
  checkMark = "\U00002705"
)</pre>
			<p>Then, we use it in the <span class="No-Break">following output:</span></p>
			<pre class="source-code">
fmt.Println(checkMark, " Successfully uploaded!")
fmt.Println(checkMark, " Audiofile ID: ", string(body))</pre>
			<p>Running the <a id="_idIndexMarker571"/>upload command after a new recompile and run shows the emoji next to the output, indicating a successful upload. The green checkmark assures the user that everything ran as expected and that there were <span class="No-Break">no errors:</span></p>
			<pre class="console">
<img src="image/021.png" alt=""/> Successfully uploaded!
<img src="image/021.png" alt=""/> Audiofile ID: b91a5155-76e9-4a70-90ea-d659c66d39e2</pre>
			<h3>Example 2 – Magnifying glass for search operations</h3>
			<p>We’ve also <a id="_idIndexMarker572"/>added a magnifying glass, <img src="image/013.png" alt=""/>, in a similar way when the user runs the search command without the <strong class="source-inline">--value</strong> flag. The new prompt looks <span class="No-Break">like this:</span></p>
			<pre class="console">
? <img src="image/013.png" alt=""/> What value are you searching for?</pre>
			<h3>Example 3 – Red for error messages</h3>
			<p>If there is an invalid <a id="_idIndexMarker573"/>operation or an error message, you could also add a red x to symbolize when something <span class="No-Break">goes wrong:</span></p>
			<pre class="console">
<img src="image/03.png" alt=""/> Error message!</pre>
			<p>Emojis not only add a fun element to your CLI but also a very valuable one. The little emoji is another way to increase information density and get important points across to <span class="No-Break">the user.</span></p>
			<h2 id="_idParaDest-172"><a id="_idTextAnchor178"/>Using color with intention</h2>
			<p>Adding <a id="_idIndexMarker574"/>color highlights important information for the end user. Don’t overdo it, though; if you end up with multiple different colors frequently used throughout, it’s hard for anything to jump out as important. So use it sparingly, but <span class="No-Break">also intentionally.</span></p>
			<p>An obvious color choice for errors is red, and success is green. Some packages make adding color to your CLI easy. One such package we will use in our examples <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">https://github.com/fatih/color</strong></span><span class="No-Break">.</span></p>
			<p>Within the audiofile, we look at a few examples where we could integrate colors. For example, the ID for the table that we just listed out. We import the library and then use it to change the color of the <span class="No-Break"><strong class="source-inline">ID</strong></span><span class="No-Break"> field:</span></p>
			<pre class="source-code">
var IdColor = color.New(color.FgGreen).SprintFunc()
func row(audio Audio) []string {
  return []string{
    IdColor(audio.Id),
    ...
  }
}</pre>
			<p>In the <strong class="source-inline">utils/ask.go</strong> file, we define an <strong class="source-inline">error</strong> function that can be used within the three <span class="No-Break">ask prompts:</span></p>
			<pre class="source-code">
var (
  missingRequiredArumentError =
    func(missingArg string) error {
    return fmt.Errorf(errorColor(fmt.Sprintf("missing
      required argument (%s)", missingArg)))
  }
)</pre>
			<p>The <strong class="source-inline">fmt.Errorf</strong> function receives the <strong class="source-inline">errorColor</strong> function, which is defined within a new <span class="No-Break"><strong class="source-inline">utils/errors.go</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
package utils
import "github.com/fatih/color"
var errorColor = color.New(color.BgRed,
  color.FgWhite).SprintFunc()</pre>
			<p>Together, we<a id="_idIndexMarker575"/> recompile code and try to run it again, purposely omitting required flags from commands. We see that the command errors out and prints the error with a red background and white foreground, defined by the <strong class="source-inline">color.BgRed</strong> and <strong class="source-inline">color.FgWhite</strong> values. There are many ways to add color. In the <strong class="source-inline">color</strong> package we’re using, the prefix <strong class="source-inline">Fg</strong> stands for foreground and the prefix <strong class="source-inline">Bg</strong> stands <span class="No-Break">for background.</span></p>
			<p>Use colors intentionally, and you will visually transfer the most important information easily to the <span class="No-Break">end user.</span></p>
			<h2 id="_idParaDest-173"><a id="_idTextAnchor179"/>Spinners and progress bars</h2>
			<p>Spinners and progress bars<a id="_idIndexMarker576"/> signify that the command is still processing; the only difference is that progress bars visually display progress. Since it is common to build concurrency into applications, you can also show multiple progress bars running simultaneously. Think about how the Docker CLI often shows multiple files being downloaded simultaneously. This helps the user understand that there’s something happening, progress is made, and nothing <span class="No-Break">is stalling.</span></p>
			<h3>Example 1 – Spinner while playing music</h3>
			<p>There are different ways<a id="_idIndexMarker577"/> that you can add spinners to your Golang project. In the audiofile project, we’ll show a quick way to add a spinner using the <strong class="source-inline">github.com/pterm/pterm</strong> package. In the audiofile project, for each play command distinct for each operating system, we add some code to start and stop the spinner. Let’s look at <strong class="source-inline">play_darwin.go</strong>, <span class="No-Break">for example:</span></p>
			<pre class="source-code">
func play(audiofilePath string) error {
    cmd := exec.Command("afplay", audiofilePath)
    if err := cmd.Start(); err != nil {
        return err
    }
    spinnerInfo := &amp;pterm.SpinnerPrinter{}
    if utils.IsaTTY() {
        spinnerInfo, _ = pterm.DefaultSpinner.Start("Enjoy the 
          music...")
    }
    err := cmd.Wait()
    if err != nil {
        return err
    }
    if utils.IsaTTY() {
        spinnerInfo.Stop()
    }
    return nil
}</pre>
			<p>Running <a id="_idIndexMarker578"/>the <strong class="source-inline">play</strong> command for any audio file shows the <span class="No-Break">following output:</span></p>
			<pre class="console">
▀ Enjoy the music... (3m54s)</pre>
			<p>It’s hard to capture<a id="_idIndexMarker579"/> the spinner in the previous line, but the black box spins around in a circle while the <span class="No-Break">music plays.</span></p>
			<h3>Example 2 – Progress bar when uploading a file</h3>
			<p>Next, within <a id="_idIndexMarker580"/>the <strong class="source-inline">upload</strong> command, we can show code to display the progress of uploading a file. Since the API only uses local flat file storage, the upload goes so quickly it’s hard to see the change in the progress bar, but you can add some <strong class="source-inline">time.Sleep</strong> calls in between each increment to see the progress appear more gradually. Within the <strong class="source-inline">cmd/upload.go</strong> file, we’ve added several statements to create the progress bar and then increment the progress along with <span class="No-Break">title updates:</span></p>
			<pre class="source-code">
p, _ := pterm.DefaultProgressbar.WithTotal(4).WithTitle("Initiating upload...").Start()</pre>
			<p>This first line initiates the progress bar, and then to update the progress bar, the following lines <span class="No-Break">are used:</span></p>
			<pre class="source-code">
pterm.Success.Println("Created multipart writer")
p.Increment()
p.UpdateTitle("Sending request...")</pre>
			<p>Notice that when we first define the progress bar, we call the <strong class="source-inline">WithTotal</strong> method, which takes the total number of steps. This means that for each step where <strong class="source-inline">p.Increment()</strong> is called, the progress bar progresses by 25 percent or 100 divided by the total <a id="_idIndexMarker581"/>number of steps. When running a spinner, it’s great to add the visualizer to let the user know that the application is currently running a command that might take <span class="No-Break">a while:</span></p>
			<pre class="console">
Process response... [4/4] ███████████             65% | 5s</pre>
			<p>The progress bar gives the user a quick visual of how quickly the command is progressing. It’s a great visual indicator for any command that will take a long time and can be clearly split into multiple steps for progression. Again, spinners and progress bars should not be displayed unless the output is being displayed to the terminal or TTY. Make sure you add a check for TTY before outputting the progress bar <span class="No-Break">or spinner.</span></p>
			<h2 id="_idParaDest-174"><a id="_idTextAnchor180"/>Disabling colors</h2>
			<p>There are different reasons<a id="_idIndexMarker582"/> why color may be disabled for a CLI. A few of these <span class="No-Break">things include:</span></p>
			<ul>
				<li>The standard out or standard error pipe is not connected to a TTY or interactive terminal. There is one exception to this. If the CLI is running within a CI environment, such as Jenkins, then color is usually supported, and it is recommended to keep <span class="No-Break">color on.</span></li>
				<li>The <strong class="source-inline">NO_COLOR</strong> or <strong class="source-inline">MYAPP_NO_COLOR</strong> environment variable is set to true. This can be defined and set to disable color for all programs that check it or specifically for <span class="No-Break">your program.</span></li>
				<li>The <strong class="source-inline">TERM</strong> environment variable is set <span class="No-Break">to dumb.</span></li>
				<li>The user passes in the <strong class="source-inline">–</strong><span class="No-Break"><strong class="source-inline">no-color</strong></span><span class="No-Break"> flag.</span></li>
			</ul>
			<p>Some percentage of your users may be colorblind. Allowing your users to swap out one color for another is a nice way to consider this specific part of your user base. This could be done within<a id="_idIndexMarker583"/> the configuration file or application. Allowing them to specify a color and then overwrite it with a preferred color will again allow the user to customize the CLI. This customization will provide users with an <span class="No-Break">improved experience.</span></p>
			<p>Including ASCII art within your application increases information density—a visual indicator that easily helps users to understand some important information. It adds clarity and conciseness. Now let’s discuss a way to make your CLI more intuitive <span class="No-Break">through consistency.</span></p>
			<h1 id="_idParaDest-175"><a id="_idTextAnchor181"/>Being consistent across CLIs</h1>
			<p>Learning about <a id="_idIndexMarker584"/>command-line syntax, flags, and environment variables requires an upfront cost that pays off in the long run with efficiency if programs are consistent across the board. For example, terminal conventions are ingrained into our fingertips. Reusing these conventions by following preexisting patterns helps to make a CLI more intuitive and guessable. This is what makes <span class="No-Break">users efficient.</span></p>
			<p>There are times when preexisting patterns break usability. As mentioned earlier, a lot of Unix commands don’t return any output by default, which can cause confusion for people who are new to using the terminal or CLI. In this case, it’s fine to break the pattern for the benefit of <span class="No-Break">increased usability.</span></p>
			<p>There are specific topics to consider when maintaining consistency with the larger community of CLIs, but also within the <span class="No-Break">application itself:</span></p>
			<ul>
				<li><span class="No-Break">Naming</span></li>
				<li>Positional versus <span class="No-Break">flag arguments</span></li>
				<li><span class="No-Break">Flag naming</span></li>
				<li><span class="No-Break">Usage</span></li>
			</ul>
			<h2 id="_idParaDest-176"><a id="_idTextAnchor182"/>Naming</h2>
			<p>Use<a id="_idIndexMarker585"/> consistent command, subcommand, and flag names to help users intuit your command-line application. Some modern command-line applications, such as the AWS command-line application, will use Unix commands to stay consistent. For example, look at this <span class="No-Break">AWS command:</span></p>
			<pre class="console">
aws s3 ls s3://mybucket --summarize</pre>
			<p>The previous command uses the <strong class="source-inline">ls</strong> command to list <strong class="source-inline">S3</strong> objects in the <strong class="source-inline">S3</strong> bucket. It’s important to use common, and non-ambiguous, command names outside of reusing shell commands in your CLI. Take the following as examples that can be logically grouped <span class="No-Break">by type:</span></p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="image/Table_8.1_B18883.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Figure">Table 8.1 – Example grouping commands by type</p>
			<p>These are common names across CLIs. You can also consider integrating some common <span class="No-Break">Unix commands:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="source-inline">cp</strong></span><span class="No-Break"> (copy)</span></li>
				<li><span class="No-Break"><strong class="source-inline">ls</strong></span><span class="No-Break"> (list)</span></li>
				<li><span class="No-Break"><strong class="source-inline">mv</strong></span><span class="No-Break"> (move)</span></li>
			</ul>
			<p>These common command names remove confusion from a long list of ambiguous or unique names. One common confusion is the difference between the update and upgrade commands. It’s best to use one or the other as keeping both will only confuse your users. Also, for the command names that are used often, follow the standard shorthand for these popular commands as well. <span class="No-Break">For example:</span></p>
			<ul>
				<li><strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">v</strong></span><span class="No-Break">, </span><span class="No-Break"><strong class="source-inline">--version</strong></span></li>
				<li><strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">h</strong></span><span class="No-Break">, </span><span class="No-Break"><strong class="source-inline">--help</strong></span></li>
				<li><strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">a</strong></span><span class="No-Break">, </span><span class="No-Break"><strong class="source-inline">--all</strong></span></li>
				<li><strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">p</strong></span><span class="No-Break">, </span><span class="No-Break"><strong class="source-inline">--port</strong></span></li>
			</ul>
			<p>Rather than<a id="_idIndexMarker586"/> listing all examples, just consider some of the most common command-line applications you use. Think about which command names make sense for consistency across the board. This will benefit not only your application but the community of command-line applications as a whole as further standards <span class="No-Break">are solidified.</span></p>
			<h2 id="_idParaDest-177"><a id="_idTextAnchor183"/>Positional versus flag arguments</h2>
			<p>It’s <a id="_idIndexMarker587"/>important to stay consistent with arguments and their position. For example, in the AWS CLI, the <strong class="source-inline">s3</strong> argument is consistently next to <span class="No-Break">its arguments:</span></p>
			<pre class="console">
aws s3 ls s3://&lt;target-bucket&gt;
aws s3 cp &lt;local-file&gt; &lt;s3-target-location&gt;/&lt;local-file&gt;</pre>
			<p>The consistent position of specific arguments will build a clear pattern that users will <span class="No-Break">follow intuitively.</span></p>
			<p>If flags, that we had mentioned before, are available with one command, they can be available for another command where they make sense. Rather than changing the flag name for each command, stay consistent between commands. Do the same with subcommands. Let’s look at some examples from the <span class="No-Break">GitHub CLI:</span></p>
			<pre class="console">
gh codespace list --json
gh issue list –json</pre>
			<p>The GitHub CLI keeps the list subcommand consistent across different commands and reuses the <strong class="source-inline">–json</strong> flag, which<a id="_idIndexMarker588"/> has the same behavior across <span class="No-Break">the application.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Required arguments are usually better as positional rather <span class="No-Break">than flags.</span></p>
			<h2 id="_idParaDest-178"><a id="_idTextAnchor184"/>Flag naming</h2>
			<p>Not <a id="_idIndexMarker589"/>only is it important to stay consistent on the position of arguments and the flag names across different commands, but it’s also important to be consistent within the naming. For example, there are flags that can be defined in camel case, <strong class="source-inline">–camelCase</strong>, snake case, <strong class="source-inline">--SnakeCase</strong>, or with dashes, <strong class="source-inline">--flag-with-dashes</strong>. Staying consistent with the way you are naming your flags in your application is <span class="No-Break">also important!</span></p>
			<h2 id="_idParaDest-179"><a id="_idTextAnchor185"/>Usage</h2>
			<p>In previous <a id="_idIndexMarker590"/>chapters, we discussed the grammar of a command and how applications can be defined with a consistent structure: <strong class="bold">noun-verb</strong> or <strong class="bold">verb-noun</strong>. Staying consistent with the structure also lends to a more <span class="No-Break">intuitive design.</span></p>
			<p>When building your command-line application, if you think about how to stay consistent across other programs and internal to your application, you will create a more intuitive and easier to learn command-line application where your users feel <span class="No-Break">naturally supported.</span></p>
			<h1 id="_idParaDest-180"><a id="_idTextAnchor186"/>Summary</h1>
			<p>In this chapter, you learned some specific points to consider when building for a machine versus a human. Machines like simple text and have certain expectations of the data that is returned from other applications. Machine output can sometimes break usability. Designing for humans first, we talked about how we can easily switch to machine-friendly output when needed with the use of some popular flags: <strong class="source-inline">--json</strong>, <strong class="source-inline">--plain</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">--silence</strong></span><span class="No-Break">.</span></p>
			<p>Much goes into a usable design, and we went over some of the ways you can increase the usability of your CLI—from using color with intention, outputting data in tables, paging through long text, and being consistent. All of the aforementioned elements will help the user feel more comfortable and guided when using your CLI, which is one of the main goals we want to achieve. We can summarize with a quick table what a good CLI design looks like versus a bad <span class="No-Break">CLI design:</span></p>
			<div>
				<div id="_idContainer061" class="IMG---Figure">
					<img src="image/Figure_8.5._B18883.jpg" alt="Figure 8.5 – Good versus bad CLI design"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – Good versus bad CLI design</p>
			<p>In the next chapter, <a href="B18883_09.xhtml#_idTextAnchor190"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>,<em class="italic"> Empathic Side of Development</em>, we will continue discussing how to develop for humans by incorporating <span class="No-Break">more empathy.</span></p>
			<h1 id="_idParaDest-181"><a id="_idTextAnchor187"/>Questions</h1>
			<ol>
				<li>What common flags in scripts can be used with a command-line application to keep the <span class="No-Break">output stable?</span></li>
				<li>What flag should you check to see if the end user does not want color set within the terminal? And what common flag can be used to disable color from <span class="No-Break">the output?</span></li>
				<li>Think about how there could be two commands with similar names and how this adds ambiguity. What ambiguous commands have you come across in your experience <span class="No-Break">of CLIs?</span></li>
			</ol>
			<h1 id="_idParaDest-182"><a id="_idTextAnchor188"/>Further reading</h1>
			<ul>
				<li><em class="italic">The Anti-Mac </em><span class="No-Break"><em class="italic">Interface</em></span><span class="No-Break">: </span><a href="https://www.nngroup.com/articles/anti-mac-interface/"><span class="No-Break">https://www.nngroup.com/articles/anti-mac-interface/</span></a></li>
				<li><em class="italic">The Humane Interface: New Directions for Designing Interactive Systems</em> by <span class="No-Break">Jef Raskin</span></li>
			</ul>
			<h1 id="_idParaDest-183"><a id="_idTextAnchor189"/>Answers</h1>
			<ol>
				<li value="1"><strong class="source-inline">--json</strong> and <strong class="source-inline">--plain</strong> flags keep data consistent and reduce the risk of <span class="No-Break">breaking scripts.</span></li>
				<li>Either the <strong class="source-inline">TERM=dumb</strong>, <strong class="source-inline">NO_COLOR</strong>, or <strong class="source-inline">MYAPP_NO_COLOR</strong> environment variables. The most common flag for disabling color is the <strong class="source-inline">–</strong><span class="No-Break"><strong class="source-inline">no-color</strong></span><span class="No-Break"> flag.</span></li>
				<li>Update versus upgrade are commonly confused, as well as name <span class="No-Break">and host.</span></li>
			</ol>
		</div>
		<div>
			<div id="_idContainer063" class="IMG---Figure">
			</div>
		</div>
	</body></html>