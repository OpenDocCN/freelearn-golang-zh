<html><head></head><body>
		<div id="_idContainer125">
			<h1 id="_idParaDest-256"><em class="italic"><a id="_idTextAnchor259"/>Appendix C</em>: Cross-Compiling</h1>
			<p>When building applications that need access to native APIs and graphics hardware, we can use <strong class="bold">CGo</strong>. Although not much harder to build for regular development, this does make cross compiling much more complicated. For every target platform you want to build for, there must be a <strong class="bold">C compiler</strong> that knows how to create native binary files. This appendix outlines the steps required to set up cross compilation targets for each combination referenced earlier in this book.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Please note that cross compiling is not required for day-to-day development. For most development, you won't require the cross-compiler setup. The Go compiler and standard tools discussed in <a href="B16820_11_Final_JM_ePub.xhtml#_idTextAnchor253"><em class="italic">Appendix A</em></a><em class="italic">:</em> <em class="italic">Developer Tool Installation</em>, are all that you require to develop for standard computers. This appendix is all about installing additional tools for creating compiled applications for a different operating system or architecture than your current computer.</p>
			<p>We will cover two possible approaches for compiling in this appendix:</p>
			<ul>
				<li>Manually installing the cross-compiler toolchain</li>
				<li>Using <strong class="source-inline">fyne-cross</strong> to handle the compilation automatically</li>
			</ul>
			<p>We will start with the manual process since it is useful to understand the compiling complexity before seeing how the process can be automated.</p>
			<h1 id="_idParaDest-257"><a id="_idTextAnchor260"/>Manually installing compilers</h1>
			<p>Installing<a id="_idIndexMarker654"/> compilers and toolchains is complex, but this appendix will attempt to guide you through the main steps. This approach is sometimes preferred by developers who want to manage every single detail of their computer. It may also be easier if your computer has previously been used for <strong class="bold">C</strong> development and creating native apps for multiple platforms.</p>
			<p>Preparing to build for a different target varies, depending on the system you want to compile for. We'll start by looking at <strong class="bold">macOS</strong>, before exploring <strong class="bold">Windows</strong> and <strong class="bold">Linux</strong> afterward. It is <a id="_idIndexMarker655"/>not necessary to follow these steps to build mobile apps since we installed these tools in <a href="B16820_12_Final_JM_ePub.xhtml#_idTextAnchor256"><em class="italic">Appendix B</em></a><em class="italic">:</em> <em class="italic">Installing Mobile Build Tools</em>.</p>
			<h2 id="_idParaDest-258"><a id="_idTextAnchor261"/>Cross compiling for macOS</h2>
			<p>When cross <a id="_idIndexMarker656"/>compiling for macOS, it's necessary to install the <strong class="bold">Software Development Kit</strong> (<strong class="bold">SDK</strong>) from <strong class="bold">Apple</strong>, as well as a suitable compiler. The instructions for <strong class="bold">Windows</strong> (using <strong class="bold">MSYS2</strong>, as described in <a href="B16820_11_Final_JM_ePub.xhtml#_idTextAnchor253"><em class="italic">Appendix A</em></a>, <em class="italic">Developer Tool Installation</em>) and Linux are almost identical; the main thing we need to do is install the macOS SDK.</p>
			<p>One thing you need to be aware of is that Apple have removed support for building 32-bit binaries. If you wish to support older devices that are not 64-bit, you will need to install older Xcode (9.4.1 or lower) and Go (1.13 or lower) versions.</p>
			<p>The easiest way to install the macOS SDK is by using the <strong class="source-inline">osxcross</strong> project. The following steps show you how to download and install the SDK and necessary tools for building a Fyne app for macOS, without using a Macintosh computer. Here, we're using Linux, but the process is the same for Windows developers using the MSYS2 command-line tools:</p>
			<ol>
				<li>We'll be using the <strong class="source-inline">clang</strong> compiler in place of <strong class="source-inline">gcc</strong> since it's more portable by design. For this process to work, you'll need to install <strong class="source-inline">clang</strong>, <strong class="source-inline">cmake</strong>, and <strong class="source-inline">libxml2-dev</strong> using your package manager:<ul><li>On Linux, use <strong class="source-inline">apt-get install clang cmake libxml2-dev</strong> (or the appropriate <strong class="source-inline">pacman</strong> or <strong class="source-inline">dnf</strong> commands, depending on your distribution)</li><li>On Windows, use <strong class="source-inline">pacman -S mingw-w64-x86_64-clang mingw-w64- x86_64-cmake mingw-w64-x86_64-libxml2</strong></li></ul></li>
				<li>Next, we need to download the macOS SDK, which is bundled with Xcode. If you don't already have an Apple developer account, you'll need to sign up and agree to their terms and conditions. Using this account, log into the download site at <a href="http://developer.apple.com/download/more/?name=Xcode%2010.2">developer.apple.com/download/more/?name=Xcode%2010.2</a> and download <strong class="source-inline">XCode.dmg</strong> (<strong class="bold">10.2</strong> is recommended for <strong class="bold">osxcross</strong> targeting 64-bit distributions, though you can download 9.4 if you want to support 32-bit computers as well).</li>
				<li>Then, we must install the <strong class="bold">osxcross</strong> tool. We'll start by downloading it with the following <strong class="source-inline">git</strong> command:<p class="source-code"><strong class="bold">$ git clone https://github.com/tpoechtrager/osxcross.git</strong></p></li>
				<li>Once downloaded, move into the new directory. Using the package tool in this repository, we <a id="_idIndexMarker657"/>must extract the macOS SDK from the downloaded <strong class="source-inline">Xcode.dmg</strong> file:<p class="source-code"><strong class="bold">$ ./tools/gen_sdk_package_darling_dmg.sh &lt;path to Xcode.dmg&gt;</strong></p><p>The resulting <strong class="source-inline">MacOSX10.11.sdk.tar.xz</strong> file should be copied into the <strong class="source-inline">tarballs/</strong> directory.</p></li>
				<li>Lastly, we must build the <strong class="bold">osxcross</strong> compiler extension by executing the provided build script:<p class="source-code"><strong class="bold">$ ./build.sh</strong></p></li>
				<li>Once we've done this, a new directory named <strong class="source-inline">target/bin/</strong> will appear, which you should add to your <strong class="source-inline">PATH</strong> environment variable. The compiler can now be used in <strong class="bold">CGo</strong> builds if we set the <strong class="source-inline">CC=o64-clang</strong> environment variable; for example:<p class="source-code"><strong class="bold">$ CC=o64-clang GOOS=darwin CGO_ENABLED=1 go build .</strong></p></li>
			</ol>
			<p>More details about this process and how to adapt it for other platforms are available on the <strong class="bold">osxcross</strong> project website at <a href="http://github.com/tpoechtrager/osxcross">github.com/tpoechtrager/osxcross</a>.</p>
			<h2 id="_idParaDest-259"><a id="_idTextAnchor262"/>Cross compiling for Windows</h2>
			<p>Building for Windows from<a id="_idIndexMarker658"/> another platform requires that we install the <strong class="source-inline">mingw</strong> toolchain (this is similar to what we installed on Windows to support CGo). This should be available in your package manager with a name similar to <strong class="source-inline">mingw-w64-clang</strong> or <strong class="source-inline">w64- mingw</strong>, but if not, you can install it directly using the<a id="_idIndexMarker659"/> instructions at <a href="http://github.com/tpoechtrager/wclang">github.com/tpoechtrager/wclang</a>.</p>
			<h3>Installing Windows tools on macOS</h3>
			<p>To install packages on<a id="_idIndexMarker660"/> macOS, it's recommended that you<a id="_idIndexMarker661"/> use the <strong class="bold">Homebrew package manager</strong>. If you have developed on macOS before, then you probably have this installed already, but if not, you can download it from their website, <strong class="source-inline">brew.sh</strong>. Once Homebrew is set up, the compiler package can be installed using the following command:</p>
			<p class="source-code">$ brew install mingw-w64</p>
			<p>Once installed, the compiler can be used by setting <strong class="source-inline">CC=x86_64-w64-mingw64-gcc</strong>, as follows:</p>
			<p class="source-code">$ CC= x86_64-w64-mingw64-gcc GOOS=windows CGO_ENABLED=1 go build .</p>
			<p>In the next section, we'll learn how to install Windows tools on Linux.</p>
			<h3>Installing Windows tools on Linux</h3>
			<p>Installing on Linux <a id="_idIndexMarker662"/>should just require finding the correct package in your<a id="_idIndexMarker663"/> distribution's listing. For example, for <strong class="bold">Debian</strong> or <strong class="bold">Ubuntu</strong>, you would execute the following command:</p>
			<p class="source-code">$ sudo apt-get install gcc-mingw-w64</p>
			<p>Once installed, the compiler can be used with CGo by setting <strong class="source-inline">CC=x86_64-w64-mingw64-gcc</strong>, as shown in the following command:</p>
			<p class="source-code">$ CC= x86_64-w64-mingw64-gcc GOOS=windows CGO_ENABLED=1 go build .</p>
			<p>Lastly, we will look at how to compile for Linux computers using a manual toolchain installation.</p>
			<h2 id="_idParaDest-260"><a id="_idTextAnchor263"/>Cross compiling for Linux</h2>
			<p>To cross <a id="_idIndexMarker664"/>compile for Linux, we need a <strong class="bold">GCC</strong> or compatible compiler that can build Linux binary files. On macOS, the easiest platform to use is <strong class="source-inline">musl-cross</strong> (<strong class="source-inline">musl</strong> has many other advantages, all of which you can read more about at <a href="http://www.etalabs.net/compare_libcs.html">www.etalabs.net/compare_libcs.html</a>). On Windows, the <strong class="source-inline">linux-gcc</strong> package is more than suitable. Let's work through the steps for each of these.</p>
			<h3>Installing a Linux compiler on macOS</h3>
			<p>To install the<a id="_idIndexMarker665"/> dependencies so that we can cross compile for Linux, we'll <a id="_idIndexMarker666"/>use the Homebrew package manager again – see the <em class="italic">Installing Windows tools on macOS</em> section or the <strong class="source-inline">brew.sh</strong> website for installation instructions.</p>
			<p>Using Homebrew, we can install the appropriate packages by opening a <strong class="bold">Terminal</strong> and executing the following commands (the <strong class="source-inline">HOMEBREW_BUILD_FROM_SOURCE</strong> variable works around an issue with <strong class="source-inline">musl-cross</strong>, depending on potentially old versions of libraries):</p>
			<p class="source-code">$ export HOMEBREW_BUILD_FROM_SOURCE=1</p>
			<p class="source-code">$ brew install FiloSottile/musl-cross/musl-cross</p>
			<p>Once the installation is complete (this may take some time as it's building a complete compiler toolchain from source), you should be able to build for Linux. To do so, you'll need to set the <strong class="source-inline">CC=x86_64-linux-musl-gcc</strong> environment variable, as follows:</p>
			<p class="source-code">$ CC=x86_64-linux-musl-gcc GOOS=linux CGO_ENABLED=1 go build</p>
			<p>The process is similar for Windows, as we'll see in the next section.</p>
			<h3>Installing a Linux compiler on Windows</h3>
			<p>Using MSYS2, just <a id="_idIndexMarker667"/>as we did in the <em class="italic">Cross compiling for macOS</em> section, we <a id="_idIndexMarker668"/>can install the <strong class="source-inline">gcc</strong> package to provide cross compilation for Linux:</p>
			<p class="source-code">$ pacman -S gcc</p>
			<p>Once the installation has completed, we can tell our Go compiler to use <strong class="source-inline">gcc</strong> by setting the <strong class="source-inline">CC=gcc</strong> Environment variable. Compilation should now succeed if you follow the instructions in your current example, as follows:</p>
			<p class="source-code">$ CC=gcc GOOS=linux CGO_ENABLED=1 go build</p>
			<p>At this point, you may see additional errors due to missing headers. To fix this, you'll need to search for, and install, the required libraries. This typically occurs because the compiler does not have built-in knowledge of how Linux desktop graphics work.</p>
			<p>If, for example, your error<a id="_idIndexMarker669"/> states that <strong class="source-inline">X11</strong> headers couldn't be found, then<a id="_idIndexMarker670"/> you would use <strong class="source-inline">pacman -Ss x11</strong> to search for the right package to install. In this instance, the desired package is <strong class="source-inline">mingw-w64-libxcb</strong> (a Windows version of the <strong class="source-inline">X11</strong> libraries), which can be installed like so:</p>
			<p class="source-code">$ pacman –S mingw-w64-libxcb</p>
			<p>If you can't find an appropriate package, you could try the Windows subsystem for Linux. More information is available at <a href="http://docs.microsoft.com/en-us/windows/wsl">docs.microsoft.com/en-us/windows/wsl</a> (this brings a full Linux distribution to your Windows desktop).</p>
			<h1 id="_idParaDest-261"><a id="_idTextAnchor264"/>Using fyne-cross</h1>
			<p>To make it easier to manage the various <a id="_idIndexMarker671"/>development environments and toolchains required for cross-compiling a project, we can use the <strong class="source-inline">fyne-cross</strong> command. This cross-compiling utility uses <strong class="bold">Docker</strong> containers to download and run the development tools of different operating systems, right from your favorite desktop computer.</p>
			<h2 id="_idParaDest-262"><a id="_idTextAnchor265"/>Installing fyne-cross</h2>
			<p>Before you can install <strong class="source-inline">fyne-cross</strong>, you will <a id="_idIndexMarker672"/>need a recent version of <strong class="bold">Go</strong> (at least <strong class="bold">1.13</strong>) and must have <strong class="bold">Docker</strong> installed. On macOS and Windows, there is a <strong class="bold">Docker Desktop</strong> application that can help you manage your Docker setup, while on Linux, most distributions have a <strong class="source-inline">docker</strong> package readily available. More information about working with Docker is available in <a href="B16820_09_Final_JM_ePub.xhtml#_idTextAnchor219"><em class="italic">Chapter 9</em></a>, <em class="italic">Bundling Resources and Preparing for Release</em>.</p>
			<p>Once Docker has been installed, you can use the standard Go tools to install <strong class="source-inline">fyne-cross</strong>. The following command will be sufficient:</p>
			<p class="source-code">$ go get github.com/fyne-io/fyne-cross</p>
			<p>The <strong class="source-inline">fyne-cross</strong> binary will be installed in <strong class="source-inline">$GOPATH/bin</strong>. If the commands provided in the following sections do<a id="_idIndexMarker673"/> not work, check that the binary is in your global <strong class="source-inline">$PATH</strong> environment.</p>
			<h2 id="_idParaDest-263"><a id="_idTextAnchor266"/>Using fyne-cross</h2>
			<p>Once<a id="_idIndexMarker674"/> installed, the <strong class="source-inline">fyne-cross</strong> command can be used to build apps for any target operating system and architecture. It has one required parameter: the target system. To build a Windows executable from a Linux computer, simply call the following command:</p>
			<p class="source-code">$ fyne-cross windows</p>
			<p>There are many options available (see <strong class="source-inline">fyne-cross help</strong> for more information). The most common two arguments are <strong class="source-inline">-arch</strong>, which allows you to specify a different architecture, and <strong class="source-inline">-release</strong>, which invokes the Fyne release pipeline to build apps that are ready to upload to marketplaces (you can find out more in <a href="B16820_10_Final_JM_ePub.xhtml#_idTextAnchor239"><em class="italic">Chapter 10</em></a>, <em class="italic">Distribution – App Stores and Beyond</em>. To create an application that will work on smaller Linux computers, such as <strong class="bold">Raspberry Pi</strong>, we can invoke the following command:</p>
			<p class="source-code">$ fyne-cross linux –arch arm64</p>
			<p>To build an Android app for release, you can use the following command:</p>
			<p class="source-code">$ fyne-cross android -release</p>
			<p>The preceding steps should enable you to build and distribute applications for any platform with minimal investment in hardware.</p>
			<p>Please note that if you're running <strong class="source-inline">fyne-cross</strong> to build apps for iOS, you must run it on a macOS host computer. This is a requirement of Apple's licensing.</p>
		</div>
	</body></html>