<html><head></head><body><div class="book" title="Package initialization" id="1CQAE1-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec43" class="calibre1"/>Package initialization</h1></div></div></div><p class="calibre10">When a package is imported, it goes through a series of initialization sequences before its members are ready to be used. Package-level variables are initialized using dependency analysis that relies on lexical scope resolution, meaning variables are initialized based on their declaration order and their resolved transitive references to each other. For instance, in the following snippet, the resolved variable declaration order in package <code class="email">foo</code> will be <code class="email">a</code>, <code class="email">y</code>, <code class="email">b</code>, and <code class="email">x</code>:</p><pre class="programlisting">package foo 
var x = a + b(a) 
var a = 2 
var b = func(i int) int {return y * i} 
var y = 3 
</pre><p class="calibre10">Go also makes use of a special function named <code class="email">init</code> that takes no arguments and returns no result values. It is used to encapsulate custom initialization logic that is invoked when the package is imported. For instance, the following source code shows an <code class="email">init</code> function used in the <code class="email">resistor</code> package to initialize function variable <code class="email">Rpi</code>:</p><pre class="programlisting">package resistor 
 
var Rpi func(float64, float64) float64 
 
func init() { 
   Rpi = func(p, i float64) float64 { 
         return p / (i * i) 
   } 
} 
 
func Rvp(v, p float64) float64 { 
   return (v * v) / p 
} 
</pre><p class="calibre10">golang.fyi/ch06/resistor/res_power.go</p><p class="calibre10">In the preceding code, the <code class="email">init</code> function is invoked after the package-level variables are initialized. Therefore, the code in the <code class="email">init</code> function can safely rely on the declared variable values to be in a stable state. The <code class="email">init</code> function is special in the following ways:</p><div class="book"><ul class="itemizedlist"><li class="listitem">A package can have more than one <code class="email">init</code> functions defined</li><li class="listitem">You cannot directly access declared <code class="email">init</code> functions at runtime</li><li class="listitem">They are executed in the lexical order they appear within each source file</li><li class="listitem">The <code class="email">init</code> function is a great way to inject logic into a package that gets executed prior to any other functions or methods.</li></ul></div></div></body></html>