<html><head></head><body>
<div class="book" title="Writing concurrent programs">
<div class="book" title="Streaming data"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch09lvl2sec157" class="calibre1"/>Streaming data</h2></div></div></div><p class="calibre10">A natural use of channels is to stream data from one goroutine to another. This pattern is quite common in Go code and for it to work, the followings must be done:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Continuously send data on a channel</li><li class="listitem">Continuously receive the incoming data from that channel</li><li class="listitem">Signal the end of the stream so the receiver may stop</li></ul></div><p class="calibre10">As you will see, all of this can be done using a single channel. The following code snippet is a rewrite of the previous example. It shows how to use a single channel to stream data from one goroutine to another. The same channel is also used as a signaling device to indicate the end of the stream:</p><pre class="programlisting">func main(){ 
... 
   histogram := make(map[string]int) 
   wordsCh := make(chan string) 
 
   // splits lines and sends words to channel 
   go func() { 
         defer close(wordsCh) // close channel when done 
         for _, line := range data { 
               words := strings.Split(line, " ") 
               for _, word := range words { 
                     word = strings.ToLower(word) 
                     wordsCh &lt;- word 
               } 
         } 
   }() 
 
   // process word stream and count words 
   // loop until wordsCh is closed 
   for { 
         word, opened := &lt;-wordsCh 
         if !opened { 
               break 
         } 
         histogram[word]++ 
   } 
 
   for k, v := range histogram { 
         fmt.Printf("%s\t(%d)\n", k, v) 
   } 
} 
</pre><p class="calibre10">golang.fyi/ch09/pattern2.go</p><p class="calibre10">This version of the code produces the word histogram as before, but introduces a different approach. This is accomplished using the highlighted portion of the code shown in the following table:</p><div class="informaltable"><table border="1" class="calibre17"><colgroup class="calibre18"><col class="calibre19"/><col class="calibre19"/></colgroup><tbody class="calibre20"><tr class="calibre21"><td class="calibre22">
<p class="calibre23"><span><strong class="calibre24">Code</strong></span></p>
</td><td class="calibre22">
<p class="calibre23"><span><strong class="calibre24">Description</strong></span></p>
</td></tr><tr class="calibre21"><td class="calibre22">
<pre class="programlisting1">wordsCh := make(chan string)   
</pre>
</td><td class="calibre22">
<p class="calibre23">The channel used to stream data.</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<pre class="programlisting1">wordsCh &lt;- word   
</pre>
</td><td class="calibre22">
<p class="calibre23">The sender goroutine loops through the text line and sends a word at a time. It then blocks until the word is received by the receiving (main) goroutine.</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<pre class="programlisting1">defer close(wordsCh)   
</pre>
</td><td class="calibre22">
<p class="calibre23">As the words are continuously received (see later), the sender goroutine closes the channel when it is done. This will be the signal to the receiver that it should also stop.</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<pre class="programlisting1">for {   
  word, opened := &lt;-wordsCh   
  if !opened {   
    break   
  }   
  histogram[word]++   
}   
</pre>
</td><td class="calibre22">
<p class="calibre23">This is the receiver code. It is placed in a loop since it is does not know ahead of time how much data to expect. With each iteration of the loop, the code does the following:
</p><div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">Pulls the data from the channel</li><li class="listitem1">Checks the open status of the channel</li><li class="listitem1">If closed, break out of the loop</li><li class="listitem1">Otherwise record histogram</li></ul></div>
</td></tr></tbody></table></div></div></div></body></html>