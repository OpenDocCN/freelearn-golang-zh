<html><head></head><body>
<div class="book" title="Writing concurrent programs">
<div class="book" title="Channel timeout"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch09lvl2sec161" class="calibre1"/>Channel timeout</h2></div></div></div><p class="calibre10">One popular idiom that is commonly encountered with Go concurrency is the use of the select statement, introduced previously, to implement timeouts. This works by using the select statement to wait for a channel operation to succeed within a given time duration using the API from the <code class="email">time</code> package (<a class="calibre1" href="https://golang.org/pkg/time/">https://golang.org/pkg/time/</a>).</p><p class="calibre10">The following code snippet shows a version of the word histogram example that times out if the program takes longer than 200 microseconds to count and print the words:</p><pre class="programlisting">func main() { 
   data := []string{...} 
   histogram := make(map[string]int) 
   done := make(chan struct{}) 
 
   go func() { 
         defer close(done) 
         words := words(data) // returns handle to channel 
         for word := range words { 
               histogram[word]++ 
         } 
         for k, v := range histogram { 
               fmt.Printf("%s\t(%d)\n", k, v) 
         } 
   }() 
 
   select { 
   case &lt;-done: 
         fmt.Println("Done counting words!!!!") 
   case &lt;-time.After(200 * time.Microsecond): 
         fmt.Println("Sorry, took too long to count.") 
   } 
} 
func words(data []string) &lt;-chan string {...} 
</pre><p class="calibre10">golang.fyi/ch09/pattern6.go</p><p class="calibre10">This version of the histogram example introduces the <code class="email">done</code> channel, which is used to signal when processing is done. In the <code class="email">select</code> statement, the receive operation <code class="email">case</code><code class="email">&lt;-done:</code> blocks until the goroutine closes the <code class="email">done</code> channel. Also in the <code class="email">select</code> statement, the <code class="email">time.After()</code>Â function returns a channel which will close after the indicated duration. If the 200 microseconds elapse before done is closed, the channel from <code class="email">time.After()</code> will close first, causing the timeout case to succeed first.</p></div></div></body></html>