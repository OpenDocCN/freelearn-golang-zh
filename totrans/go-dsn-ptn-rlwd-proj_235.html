<html><head></head><body><div class="book" title="Detecting race conditions" id="1TVKI1-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec61" class="calibre1"/>Detecting race conditions</h1></div></div></div><p class="calibre10">Debugging concurrent code with a race condition can be time consuming and frustrating. When a race condition occurs, it is usually inconsistent and displays little to no discernible pattern. Fortunately, since Version 1.1, Go has included a race detector as part of its command-line tool chain. When building, testing, installing, or running Go source code, simply add the <code class="email">-race</code> command flag to enable the race detector instrumentation of your code.</p><p class="calibre10">For instance, when the source file <code class="email">golang.fyi/ch09/sync1.go</code> (a code with a race condition) is executed with the <code class="email">-race</code> flag, the compiler's output shows the offending goroutine locations that caused the race condition, as shown in the following output:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$&gt; go run -race sync1.go</strong></span> 
================== 
WARNING: DATA RACE 
Read by main goroutine: 
  main.main() 
/github.com/vladimirvivien/learning-go/ch09/sync1.go:28 +0x8c 
 
Previous write by goroutine 5: 
  main.(*Service).Start.func1() 
/github.com/vladimirvivien/learning-go/ch09/sync1.go:13 +0x2e 
 
Goroutine 5 (running) created at: 
  main.(*Service).Start() 
/github.com/vladimirvivien/learning-go/ch09/sync1.go:15 +0x99 
  main.main() 
/github.com/vladimirvivien/learning-go/ch09/sync1.go:26 +0x6c 
================== 
Found 1 data race(s) 
exit status 66 
</pre><p class="calibre10">The race detector lists the line numbers where there is concurrent access to shared values. It lists the <span class="strong"><em class="calibre11">read</em></span> operations followed by the locations where <span class="strong"><em class="calibre11">write</em></span> operations may happen concurrently. Racy conditions in code can go unnoticed, even in well-tested code, until it manifests itself randomly. If you are writing concurrent code, it is highly recommended that you integrate the race detector as part of your testing suite.</p></div></body></html>