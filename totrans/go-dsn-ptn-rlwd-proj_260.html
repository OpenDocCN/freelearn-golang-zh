<html><head></head><body>
<div class="book" title="Encoding and decoding data">
<div class="book" title="Encoding data as JSON"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch10lvl2sec176" class="calibre1"/>Encoding data as JSON</h2></div></div></div><p class="calibre10">The encoding package also comes with a <span class="strong"><em class="calibre11">json</em></span> encoder sub-package (<a class="calibre1" href="https://golang.org/pkg/encoding/json/">https://golang.org/pkg/encoding/json/</a>) to support JSON-formatted data. This greatly broadens the number of languages with which Go programs can exchange complex data structures. JSON encoding works similarly as the encoder and decoder from the gob package. The difference is that the generated data takes the form of a clear text JSON-encoded format instead of a binary. The following code updates the previous example to encode the data as JSON:</p><pre class="programlisting">type Name struct { 
   First, Last string 
} 
 
type Book struct { 
   Title       string 
   PageCount   int 
   ISBN        string 
   Authors     []Name 
   Publisher   string 
   PublishDate time.Time 
} 
 
func main() { 
   books := []Book{ 
         Book{ 
               Title:       "Leaning Go", 
               PageCount:   375, 
               ISBN:        "9781784395438", 
               Authors:     []Name{{"Vladimir", "Vivien"}}, 
               Publisher:   "Packt", 
               PublishDate: time.Date( 
                     2016, time.July, 
                     0, 0, 0, 0, 0, time.UTC), 
         }, 
         ... 
   } 
 
   file, err := os.Create("book.dat") 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
   enc := json.NewEncoder(file) 
   if err := enc.Encode(books); err != nil { 
         fmt.Println(err) 
   } 
} 
</pre><p class="calibre10">golang.fyi/ch10/json0.go</p><p class="calibre10">The code is exactly the same as before. It uses the same slice of nested structs assigned to the <code class="email">books</code> variable. The only difference is the encoder is created with <code class="email">enc := json.NewEncoder(file)</code> which creates a JSON encoder that will use the <code class="email">file</code> variable as its <code class="email">io.Writer</code> destination. When <code class="email">enc.Encode(books)</code> is executed, the content of the variable <code class="email">books</code> is serialized as JSON to the local file <code class="email">books.dat</code>, shown in the following code (formatted for readability):</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">[     </strong></span>
<span class="strong"><strong class="calibre2">      {</strong></span>
<span class="strong"><strong class="calibre2">            "Title":"Leaning Go",</strong></span>
<span class="strong"><strong class="calibre2">            "PageCount":375,</strong></span>
<span class="strong"><strong class="calibre2">            "ISBN":"9781784395438",</strong></span>
<span class="strong"><strong class="calibre2">            "Authors":[{"First":"Vladimir","Last":"Vivien"}],</strong></span>
<span class="strong"><strong class="calibre2">            "Publisher":"Packt",</strong></span>
<span class="strong"><strong class="calibre2">            "PublishDate":"2016-06-30T00:00:00Z"</strong></span>
<span class="strong"><strong class="calibre2">      },</strong></span>
<span class="strong"><strong class="calibre2">      {</strong></span>
<span class="strong"><strong class="calibre2">            "Title":"The Go Programming Language",</strong></span>
<span class="strong"><strong class="calibre2">            "PageCount":380,</strong></span>
<span class="strong"><strong class="calibre2">            "ISBN":"9780134190440",</strong></span>
<span class="strong"><strong class="calibre2">            "Authors":[</strong></span>
<span class="strong"><strong class="calibre2">                  {"First":"Alan","Last":"Donavan"},
                      {"First":"Brian","Last":"Kernighan"}</strong></span>
<span class="strong"><strong class="calibre2">            ],</strong></span>
<span class="strong"><strong class="calibre2">            "Publisher":"Addison-Wesley",</strong></span>
<span class="strong"><strong class="calibre2">            "PublishDate":"2015-10-26T00:00:00Z"</strong></span>
<span class="strong"><strong class="calibre2">      },</strong></span>
<span class="strong"><strong class="calibre2">      ...</strong></span>
<span class="strong"><strong class="calibre2">]</strong></span>
</pre><p class="calibre10">File books.dat (formatted)</p><p class="calibre10">The generated JSON-encoded content uses the name of the struct fields as the name for the JSON object keys by default. This behavior can be controlled using struct tags (see the section, <span class="strong"><em class="calibre11">Controlling JSON mapping with struct tags</em></span>).</p><p class="calibre10">Consuming the JSON-encoded data in Go is done using a JSON decoder that streams its source from an <code class="email">io.Reader</code>. The following snippet decodes the JSON-encoded data, generated in the previous example, stored in the file <code class="email">book.dat</code>. Note that the data structure (not shown in the following code) is the same as before:</p><pre class="programlisting">func main() { 
   file, err := os.Open("book.dat") 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
 
   var books []Book 
   dec := json.NewDecoder(file) 
   if err := dec.Decode(&amp;books); err != nil { 
         fmt.Println(err) 
         return 
   } 
} 
</pre><p class="calibre10">golang.fyi/ch10/json1.go</p><p class="calibre10">The data in the books.dat file is stored as an array of JSON objects. Therefore, the code must declare a variable capable of storing an indexed collection of nested struct values. In the previous example, the <code class="email">books</code> variable, of the type <code class="email">[]Book</code> is declared as the destination of the decoded data. The actual decoding is done by invoking <code class="email">dec.Decode(&amp;books)</code>. Notice the <code class="email">Decode()</code> method takes the address of its target variable as an argument. Once decoded, the <code class="email">books</code> variable will contain the reconstituted data structure streamed from the file.</p></div></div></body></html>