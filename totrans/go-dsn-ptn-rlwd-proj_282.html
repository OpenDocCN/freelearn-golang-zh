<html><head></head><body>
<div class="book" title="A JSON API server">
<div class="book" title="An API server client in Go"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch11lvl2sec192" class="calibre1"/>An API server client in Go</h2></div></div></div><p class="calibre10">An HTTP client can also be built in Go to consume the service with minimal efforts. As is shown in the following code snippet, the client code uses the <code class="email">http.Client</code> type to communicate with the server. It also uses the <code class="email">encoding/json</code> sub-package to decode incoming data (note that the client also makes use of the <code class="email">curr1</code> package, shown earlier, which contains the types needed to communicate with the server):</p><pre class="programlisting">import ( 
   "bytes" 
   "encoding/json" 
   "fmt" 
   "net/http" 
 
   " github.com/vladimirvivien/learning-go/ch11/curr1" 
) 
 
func main() { 
   var param string 
   fmt.Print("Currency&gt; ") 
   _, err := fmt.Scanf("%s", &amp;param) 
 
   buf := new(bytes.Buffer) 
   currRequest := &amp;curr1.CurrencyRequest{Get: param} 
   err = json.NewEncoder(buf).Encode(currRequest) 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
 
   // send request 
   client := &amp;http.Client{} 
   req, err := http.NewRequest( 
         "POST", "http://127.0.0.1:4040/currency", buf) 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
 
   resp, err := client.Do(req) 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
   defer resp.Body.Close() 
 
   // decode response 
   var currencies []curr1.Currency 
   err = json.NewDecoder(resp.Body).Decode(&amp;currencies) 
   if err != nil { 
         fmt.Println(err) 
         return 
   } 
   fmt.Println(currencies) 
} 
</pre><p class="calibre10">golang.fyi/ch11/jsonclient0.go</p><p class="calibre10">In the previous code, an HTTP client is created to send JSON-encoded request values as <code class="email">currRequest := &amp;curr1.CurrencyRequest{Get: param}</code> where <code class="email">param</code> is the currency string to retrieve. The response from the server is a payload that represents an array of JSON-encoded objects (see the JSON array in the section, <span class="strong"><em class="calibre11">Testing the API Server with cURL</em></span>). The code then uses a JSON decoder, <code class="email">json.NewDecoder(resp.Body).Decode(&amp;currencies)</code>, to decode the payload from the response body into the slice, <code class="email">[]curr1.Currency</code>.</p></div></div></body></html>