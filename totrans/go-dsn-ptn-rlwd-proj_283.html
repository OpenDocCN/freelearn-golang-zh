<html><head></head><body>
<div class="book" title="A JSON API server">
<div class="book" title="A JavaScript API server client"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch11lvl2sec193" class="calibre1"/>A JavaScript API server client</h2></div></div></div><p class="calibre10">So far, we have seen how to use the API service using the <code class="email">cURL</code> command-line tool and a native Go client. This section shows the versatility of using HTTP to implement networked services by showcasing a web-based JavaScript client. In this approach, the client is a web-based GUI that uses modern HTML, CSS, and JavaScript to create an interface that interacts with the API server.</p><p class="calibre10">First, the server code is updated with an additional handler to serve the static HTML file that renders the GUI on the browser. This is illustrated in the following code:</p><pre class="programlisting">// serves HTML gui 
func gui(resp http.ResponseWriter, req *http.Request) { 
   file, err := os.Open("./currency.html") 
   if err != nil { 
         resp.WriteHeader(http.StatusInternalServerError) 
         fmt.Println(err) 
         return 
   } 
   io.Copy(resp, file) 
} 
 
func main() { 
   mux := http.NewServeMux() 
   mux.HandleFunc("/", gui) 
   mux.HandleFunc("/currency", currs) 
 
   if err := http.ListenAndServe(":4040", mux); err != nil { 
         fmt.Println(err) 
   } 
} 
</pre><p class="calibre10">golang.fyi/ch11/jsonserv1.go</p><p class="calibre10">The preceding code snippet shows the declaration of the <code class="email">gui</code> handler function responsible for serving a static HTML file that renders the GUI for the client. The root URL path is then mapped to the function with <code class="email">mux.HandleFunc("/", gui)</code>. So, in addition to the <code class="email">"/currency" </code>path, which hosts the API end-point the <code class="email">"/"</code> path will return the web page shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00027.jpeg" alt="A JavaScript API server client" class="calibre14"/></div><p class="calibre15"> </p><p class="calibre10">The next HTML page (<a class="calibre1" href="http://learning.golang.fyi/ch11/currency.html">golang.fyi/ch11/currency.html</a>) is responsible for displaying the result of a currency search. It uses JavaScritpt functions along with the <code class="email">jQuery.js</code> library (not covered here) to post JSON-encoded requests to the backend Go service as shown in the following abbreviated HTML and JavaScript snippets:</p><pre class="programlisting">&lt;body&gt; 
&lt;div class="container"&gt; 
  &lt;h2&gt;Global Currency Service&lt;/h2&gt; 
  &lt;p&gt;Enter currency search string: &lt;input id="in"&gt; 
     &lt;button type="button" class="btn btn-primary" onclick="doRequest()"&gt;Search&lt;/button&gt; 
  &lt;/p&gt;             
  &lt;table id="tbl" class="table table-striped"&gt; 
    &lt;thead&gt; 
      &lt;tr&gt; 
           &lt;th&gt;Code&lt;/th&gt; 
           &lt;th&gt;Name&lt;/th&gt; 
           &lt;th&gt;Number&lt;/th&gt; 
           &lt;th&gt;Country&lt;/th&gt; 
      &lt;/tr&gt; 
    &lt;/thead&gt; 
    &lt;tbody/&gt; 
  &lt;/table&gt; 
&lt;/div&gt; 
 
&lt;script&gt; 
 var tbl = document.getElementById("tbl"); 
   function addRow(code, name, number, country) { 
         var rowCount = tbl.rows.length; 
         var row = tbl.insertRow(rowCount); 
         row.insertCell(0).innerHTML = code; 
         row.insertCell(1).innerHTML = name; 
         row.insertCell(2).innerHTML = number; 
         row.insertCell(3).innerHTML = country; 
   } 
 
    function doRequest() { 
   param = document.getElementById("in").value 
        $.ajax('/currency', { 
            method: 'PUT', 
               contentType: 'application/json', 
               processData: false, 
               data: JSON.stringify({get:param}) 
         }).then( 
         function success(currencies) { 
               currs = JSON.parse(currencies) 
               for (i=0; i &lt; currs.length; i++) { 
                     addRow( 
                           currs[i].currency_code, 
                           currs[i].currency_name, 
                           currs[i].currency_number, 
                           currs[i].currency_country 
                     ); 
               } 
 
         }); 
   } 
&lt;/script&gt; 
</pre><p class="calibre10">golang.fyi/ch11/currency.html</p><p class="calibre10">A line-by-line analysis of the HTML and JavaScript code in this example is beyond the scope of the book; however, it is worth pointing out that the JavaScript <code class="email">doRequest</code> function is where the interaction between the client and the server happens. It uses the jQuery's <code class="email">$.ajax</code> function to build an HTTP request with a <code class="email">PUT</code>Â method and to specify a JSON-encoded currency request object, <code class="email">JSON.stringify({get:param})</code>, to send to the server. The <code class="email">then</code> method accepts the callback function, <code class="email">success(currencies)</code>, which handles the response from the server that parses displays in an HTML table.</p><p class="calibre10">When a search value is provided in the text box on the GUI, the page displays its results in the table dynamically as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00028.jpeg" alt="A JavaScript API server client" class="calibre14"/></div><p class="calibre15"> </p></div></div></body></html>