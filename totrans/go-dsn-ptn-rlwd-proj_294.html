<html><head></head><body>
<div class="book" title="Writing Go tests">
<div class="book" title="Skipping tests"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch12lvl2sec200" class="calibre1"/>Skipping tests</h2></div></div></div><p class="calibre10">It is sometimes necessary to skip test functions due to a number of factors such as environment constraints, resource availability, or inappropriate environment settings. The testing API makes it possible to skip a test function using the <code class="email">SkipNow</code> method from type <code class="email">testing.T</code>. The following source code snippet will only run the test function when the arbitrary operating system environment variable named <code class="email">RUN_ANGLE</code> is set. Otherwise, it will skip the test:</p><pre class="programlisting">func TestVectorAngle(t *testing.T) { 
   if os.Getenv("RUN_ANGLE") == "" { 
         t.Skipf("Env variable RUN_ANGLE not set, skipping:") 
   } 
   v1 := New(3.183, -7.627) 
   v2 := New(-2.668, 5.319) 
   actual := v1.Angle(v2) 
   expect := math.Acos(v1.DotProd(v2) / (v1.Mag() * v2.Mag())) 
   if actual != expect { 
         t.Logf("Vector angle failed, expecting %d, got %d", 
            expect, actual) 
         t.Fail() 
   } 
   t.Log("Angle between", v1, "and", v2, "=", actual) 
} 
</pre><p class="calibre10">Notice the code is using the <code class="email">Skipf</code> method, which is a combination of the methods <code class="email">SkipNow</code> and <code class="email">Logf</code> from type <code class="email">testing.T</code>. When the test is executed without the environment variable, it outputs the following:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$&gt; go test -run=Angle -v</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestVectorAngle</strong></span>
<span class="strong"><strong class="calibre2">--- SKIP: TestVectorAngle (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">      vec_test.go:128: Env variable RUN_ANGLE not set, skipping:</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok    github.com/vladimirvivien/learning-go/ch12/vector     0.006s </strong></span>
</pre><p class="calibre10">When the environment variable is provided, as is done with the following Linux/Unix command, the test executes as expected (consult your OS on how to set environment variables):</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; RUN_ANGLE=1 go test -run=Angle -v</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestVectorAngle</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestVectorAngle (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">      vec_test.go:138: Angle between [3.183,-7.627] and [-2.668,5.319] = 3.0720263098372476</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok    github.com/vladimirvivien/learning-go/ch12/vector     0.005s</strong></span>
</pre></div></div></body></html>