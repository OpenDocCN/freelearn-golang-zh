<html><head></head><body>
<div class="book" title="HTTP testing" id="2H1VQ1-9c484ed022e64a0fb0e1aebf8e05d4fd">
<div class="book" title="Testing HTTP server code"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch12lvl2sec202" class="calibre1"/>Testing HTTP server code</h2></div></div></div><p class="calibre10">When writing HTTP server code, you will undoubtedly run into the need to test your code, in a robust and repeatable manner, without having to set up some fragile code harness to simulate end-to-end testing. Type <code class="email">httptest.ResponseRecorder</code> is designed specifically to provide unit testing capabilities for exercising the HTTP handler methods by inspecting state changes to the http.ResponseWriter in the tested function. For instance, the following snippet uses <code class="email">httptest.ResponseRecorder</code> to test the server's <code class="email">add</code> method:</p><pre class="programlisting">import ( 
   "net/http" 
   "net/http/httptest" 
   "strconv" 
   "strings" 
   "testing" 
 
   "github.com/vladimirvivien/learning-go/ch12/vector" 
) 
 
func TestVectorAdd(t *testing.T) { 
   reqBody := "[[1,2],[3,4]]" 
   req, err := http.NewRequest( 
        "POST", "http://0.0.0.0/", strings.NewReader(reqBody)) 
   if err != nil { 
         t.Fatal(err) 
   } 
   actual := vector.New(1, 2).Add(vector.New(3, 4)) 
   w := httptest.NewRecorder() 
   add(w, req) 
   if actual.String() != strings.TrimSpace(w.Body.String()) { 
         t.Fatalf("Expecting actual %s, got %s",  
             actual.String(), w.Body.String(), 
         ) 
   } 
} 
 
</pre><p class="calibre10">The code uses <code class="email">reg, err := http.NewRequest("POST", "http://0.0.0.0/", strings.NewReader(reqBody))</code> to create a new <code class="email">*http.Request</code> value with a <code class="email">"POST"</code> method, a fake URL, and a request body, variable <code class="email">reqBody</code>, encoded as a JSON array. Later in the code, <code class="email">w := httptest.NewRecorder()</code> is used to create an <code class="email">httputil.ResponseRecorder</code> value, which is used to invoke the <code class="email">add(w, req)</code> function along with the created request. The value recorded in <code class="email">w</code>, during the execution of function <code class="email">add</code>, is compared with expected value stored in <code class="email">atual </code>with <code class="email">if actual.String() != strings.TrimSpace(w.Body.String()){...}.</code></p></div></div></body></html>