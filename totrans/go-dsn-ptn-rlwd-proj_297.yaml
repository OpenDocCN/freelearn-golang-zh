- en: Testing HTTP server code
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试 HTTP 服务器代码
- en: '[PRE0]'
  id: totrans-1
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[PRE1]'
  id: totrans-2
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The code uses `reg, err := http.NewRequest("POST", "http://0.0.0.0/", strings.NewReader(reqBody))`
    to create a new `*http.Request` value with a `"POST"` method, a fake URL, and
    a request body, variable `reqBody`, encoded as a JSON array. Later in the code,
    `w := httptest.NewRecorder()` is used to create an `httputil.ResponseRecorder`
    value, which is used to invoke the `add(w, req)` function along with the created
    request. The value recorded in `w`, during the execution of function `add`, is
    compared with expected value stored in `atual` with `if actual.String() != strings.TrimSpace(w.Body.String()){...}.`
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 代码使用 `reg, err := http.NewRequest("POST", "http://0.0.0.0/", strings.NewReader(reqBody))`
    来创建一个新的带有 `"POST"` 方法、一个假 URL 和请求体（变量 `reqBody`，编码为 JSON 数组）的 `*http.Request`
    值。在代码的后续部分，`w := httptest.NewRecorder()` 被用来创建一个 `httputil.ResponseRecorder` 值，该值用于调用与创建的请求一起的
    `add(w, req)` 函数。在 `add` 函数执行期间记录在 `w` 中的值与存储在 `atual` 中的预期值通过 `if actual.String()
    != strings.TrimSpace(w.Body.String()){...}` 进行比较。
