<html><head></head><body><div class="book" title="Libraries" id="344B21-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec022" class="calibre1"/>Libraries</h1></div></div></div><p class="calibre10">Until now, most of our examples were applications. An application is defined by its <code class="email">main</code> function and package. But with Go, you can also create pure libraries. In libraries, the package need not be called main nor do you need the <code class="email">main</code> function.</p><p class="calibre10">As libraries aren't applications, you cannot build a binary file with them and you need the <code class="email">main</code> package that is going to use them.</p><p class="calibre10">For example, let's create an arithmetic library to perform common operations on integers: sums, subtractions, multiplications, and divisions. We'll not get into many details about the implementation to focus on the particularities of Go's libraries:</p><pre class="programlisting">package arithmetic 
 
func Sum(args ...int) (res int) { 
    for _, v := range args { 
        res += v 
    } 
    return 
} 
</pre><p class="calibre10">First, we need a name for our library; we set this name by giving a name to the entire package. This means that every file in this folder must have this package name too and the entire group of files composes the library called <span class="strong"><strong class="calibre2">arithmetic</strong></span> too in this case (because it only contains one package). This way, we won't need to refer to the filenames for this library and to provide the library name and path will be enough to import and use it. We have defined a <code class="email">Sum</code> function that takes as many arguments as you need and that will return an integer that, during the scope of the function, is going to be called <code class="email">res</code>. This allows us to initialize to <code class="email">0</code> the value we're returning. We defined a package (not the <code class="email">main</code> package but a library one) and called it <code class="email">arithmetic</code>. As this is a library package, we can't run it from the command line directly so we'll have to create the <code class="email">main</code> function for it or a unit test file. For simplicity , we'll create a <code class="email">main</code> function that runs some of the operations now but let's finish the library first:</p><pre class="programlisting">func Subtract(args ...int) int { 
    if len(args) &lt; 2 { 
        return 0 
    } 
 
    res := args[0] 
    for i := 1; i &lt; len(args); i++ { 
        res -= args[i] 
    } 
    return res 
} 
</pre><p class="calibre10">The <code class="email">Subtraction</code> code will return <code class="email">0</code> if the number of arguments is less than zero and the subtraction of all its arguments if it has two arguments or more:</p><pre class="programlisting">func Multiply(args ...int) int { 
    if len(args) &lt; 2 { 
        return 0 
    } 
 
    res := 1 
    for i := 0; i &lt; len(args); i++ { 
        res *= args[i] 
    } 
    return res 
} 
</pre><p class="calibre10">The <code class="email">Multiply</code> function works in a similar fashion. It returns <code class="email">0</code> when arguments are less than two and the multiplication of all its arguments when it has two or more. Finally, the <code class="email">Division</code> code changes a bit because it will return an error if you ask it to divided by zero:</p><pre class="programlisting">func Divide(a, b int) (float64, error) { 
    if b == 0 { 
        return 0, errors.New("You cannot divide by zero") 
    }  
    return float64(a) / float64(b), nil 
} 
</pre><p class="calibre10">So now we have our library finished, but we need a <code class="email">main</code> function to use it as libraries cannot be converted to executable files directly. Our main function looks like the following:</p><pre class="programlisting">package main 
 
import ( 
"fmt" 
 
"bitbucket.org/mariocastro/go-design-patterns/introduction/libraries/arithmetic" 
) 
 
func main() { 
    sumRes := arithmetic.Sum(5, 6) 
    subRes := arithmetic.Subtract(10, 5) 
    multiplyRes := arithmetic.Multiply(8, 7) 
    divideRes, _ := arithmetic.Divide(10, 2) 
 
    fmt.Printf("5+6 is %d. 10-5 is %d, 8*7 is %d and 10/2 is %f\n", sumRes, subRes, multiplyRes, divideRes) 
} 
</pre><p class="calibre10">We are performing an operation over every function that we have defined. Take a closer look at the <code class="email">import</code> clause. It is taking the library we have written from its folder within <code class="email">$GOPATH</code> that matches its URL in <a class="calibre1" href="https://bitbucket.org/">
https://bitbucket.org/
</a>. Then, to use every one of the functions that are defined within a library, you have to name the package name that the library has before each method.</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre10">Have you realized that we called our functions with uppercase names? Because of the visibility rules we have seen before, exported functions in a package must have uppercase names or they won't be visible outside of the scope of the package. So, with this rule in mind, you cannot call a lowercase function or variable within a package and package calls will always be followed by uppercase names.</p></div><p class="calibre10">Let's recall, some naming conventions about libraries:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Each file in the same folder must contain the same package name. Files don't need to be named in any special way.</li><li class="listitem">A folder represents a package name within a library. The folder name will be used on import paths and it doesn't need to reflect the package name (although it's recommended for the parent package).</li><li class="listitem">A library is one or many packages representing a tree that you import by the parent of all packages folder.</li><li class="listitem">You call things within a library by their package name.</li></ul></div></div></body></html>