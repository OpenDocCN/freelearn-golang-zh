<html><head></head><body>
<div class="book" title="Chapter&#xA0;2.&#xA0;Creational Patterns - Singleton, Builder, Factory, Prototype, and Abstract Factory Design Patterns">
<div class="book" title="Singleton design pattern - having a unique instance of a type in the entire program">
<div class="book" title="Implementation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_7"><a id="ch02lvl2sec035" class="calibre1"/>Implementation</h2></div></div></div><p class="calibre10">Finally, we have to implement the Singleton pattern. As we mentioned earlier, we'll usually write a <code class="email">static</code> method and instance to retrieve the Singleton instance in languages such as Java or C++. In Go, we don't have the keyword <code class="email">static</code>, but we can achieve the same result by using the scope of the package. First, we create a <code class="email">struct</code> that contains the object which we want to guarantee to be a Singleton during the execution of the program:</p><pre class="programlisting">package creational 
 
type singleton struct{ 
    count int 
} 
 
var instance *singleton 
 
func GetInstance() *singleton { 
    if instance == nil { 
        instance = new(singleton) 
    }  
    return instance 
} 
 
func (s *singleton) AddOne() int { 
    s.count++ 
    return s.count 
} 
</pre><p class="calibre10">We must pay close attention to this piece of code. In languages such as Java or C++, the variable instance would be initialized to NULL at the beginning of the program. In Go, you can initialize a pointer to a struct as <code class="email">nil</code>, but you cannot initialize a structure to <code class="email">nil</code> (the equivalent of NULL). So the <code class="email">var instance *singleton</code> line defines a pointer to a struct of type Singleton as nil, and the variable called <code class="email">instance</code>.</p><p class="calibre10">We created a <code class="email">GetInstance</code> method that checks if the instance has not been initialized already (<code class="email">instance == nil</code>), and creates an instance in the space already allocated in the line <code class="email">instance = new(singleton)</code>. Remember, when we use the keyword <code class="email">new</code>, we are creating a pointer to an instance of the type between the parentheses.</p><p class="calibre10">The <code class="email">AddOne</code> method will take the count of the variable instance, raise it by 1, and return the current value of the counter.</p><p class="calibre10">Let's run now our unit tests again:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$ go test -v -run=GetInstance</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetInstance</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestGetInstance (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok</strong></span>
</pre></div></div></div></body></html>