<html><head></head><body>
<div class="book" title="Builder design pattern - reusing an algorithm to create many implementations of an interface">
<div class="book" title="Implementation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch02lvl2sec042" class="calibre1"/>Implementation</h2></div></div></div><p class="calibre10">We will start implementing the manufacturing. As we said earlier (and as we set in our unit tests), the <code class="email">Manufacturing</code> director must accept a builder and construct a vehicle using the provided builder. To recall, the <code class="email">BuildProcess</code> interface will define the common steps needed to construct any vehicle and the <code class="email">Manufacturing</code> director must accept builders and construct vehicles together with them:</p><pre class="programlisting">package creational 
 
type ManufacturingDirector struct { 
    builder BuildProcess 
} 
 
func (f *ManufacturingDirector) SetBuilder(b BuildProcess) { 
    f.builder = b 
} 
 
func (f *ManufacturingDirector) Construct() { 
    f.builder.SetSeats().SetStructure().SetWheels() 
} 
</pre><p class="calibre10">Our <code class="email">ManufacturingDirector</code> needs a field to store the builder in use; this field will be called <code class="email">builder</code>. The <code class="email">SetBuilder</code> method will replace the stored builder with the one provided in the arguments. Finally, take a closer look at the <code class="email">Construct</code> method. It takes the builder that has been stored and reproduces the <code class="email">BuildProcess</code> method that will create a full vehicle of some unknown type. As you can see, we have used all the setting calls in the same line thanks to returning the <code class="email">BuildProcess</code> interface on each of the calls. This way the code is more compact:</p><div class="informaltable" title="Note"><h3 class="title2"><a id="tip010" class="calibre1"/>Tip</h3><p class="calibre10">Have you realized that the director entity in the Builder pattern is a clear candidate for a Singleton pattern too? In some scenarios, it could be critical that just an instance of the Director is available, and that is where you'll create a Singleton pattern for the Director of the Builder only. Design patterns composition is a very common technique and a very powerful one!</p></div><pre class="programlisting">type CarBuilder struct { 
    v VehicleProduct 
} 
 
func (c *CarBuilder) SetWheels() BuildProcess { 
    c.v.Wheels = 4 
    return c 
} 
 
func (c *CarBuilder) SetSeats() BuildProcess { 
    c.v.Seats = 5 
    return c 
} 
 
func (c *CarBuilder) SetStructure() BuildProcess { 
    c.v.Structure = "Car" 
    return c 
} 
 
func (c *CarBuilder) GetVehicle() VehicleProduct { 
    return c.v 
} 
</pre><p class="calibre10">Here is our first builder, the <code class="email">car</code> builder. A builder will need to store a <code class="email">VehicleProduct</code> object, which here we have named <code class="email">v</code>. Then we set the specific needs that a car has in our business--four wheels, five seats, and a structure defined as <code class="email">Car</code>. In the <code class="email">GetVehicle </code>method, we just return the <code class="email">VehicleProduct</code> stored within the Builder that must be already constructed by the <code class="email">ManufacturingDirector</code> type.</p><pre class="programlisting">type BikeBuilder struct { 
    v VehicleProduct 
} 
 
func (b *BikeBuilder) SetWheels() BuildProcess { 
    b.v.Wheels = 2 
    return b 
} 
 
func (b *BikeBuilder) SetSeats() BuildProcess { 
    b.v.Seats = 2 
    return b 
} 
 
func (b *BikeBuilder) SetStructure() BuildProcess { 
    b.v.Structure = "Motorbike" 
    return b 
} 
 
func (b *BikeBuilder) GetVehicle() VehicleProduct { 
    return b.v 
} 
</pre><p class="calibre10">The <code class="email">Motorbike</code> Builder is the same as the <code class="email">car</code> builder. We defined a motorbike to have two wheels, two seats, and a structure called <code class="email">Motorbike</code>. It's very similar to the <code class="email">car</code> object, but imagine that you want to differentiate between a sports motorbike (with only one seat) and a cruise motorbike (with two seats). You could simply create a new structure for sports motorbikes that implements the build process.</p><p class="calibre10">You can see that it's a repetitive pattern, but within the scope of every method of the <code class="email">BuildProcess</code> interface, you could encapsulate as much complexity as you want such that the user need not know the details about the object creation.</p><p class="calibre10">With the definition of all the objects, let's run the tests again:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">=== RUN   TestBuilderPattern</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestBuilderPattern (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok  _/home/mcastro/pers/go-design-patterns/creational 0.001s</strong></span>
</pre><p class="calibre10">Well done! Think how easy it could be to add new vehicles to the <code class="email">ManufacturingDirector</code> director just create a new class encapsulating the data for the new vehicle. For example, let´s add a <code class="email">BusBuilder</code> struct:</p><pre class="programlisting">type BusBuilder struct { 
    v VehicleProduct 
} 
 
func (b *BusBuilder) SetWheels() BuildProcess { 
    b.v.Wheels = 4*2 
    return b 
} 
 
func (b *BusBuilder) SetSeats() BuildProcess { 
    b.v.Seats = 30 
    return b 
} 
 
func (b *BusBuilder) SetStructure() BuildProcess { 
    b.v.Structure = "Bus" 
    return b 
} 
 
func (b *BusBuilder) GetVehicle() VehicleProduct { 
    return b.v 
} 
</pre><p class="calibre10">That's all; your <code class="email">ManufacturingDirector</code> would be ready to use the new product by following the Builder design pattern.</p></div></div></body></html>