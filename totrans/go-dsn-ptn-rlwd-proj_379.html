<html><head></head><body>
<div class="book" title="Factory method - delegating the creation of different types of payments">
<div class="book" title="Implementation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch02lvl2sec049" class="calibre1"/>Implementation</h2></div></div></div><p class="calibre10">We will start with the <code class="email">GetPaymentMethod</code> method. It must receive an integer that matches with one of the defined constants of the same file to know which implementation it should return.</p><pre class="programlisting">package creational 
 
import ( 
    "errors" 
    "fmt" 
) 
 
type PaymentMethod interface { 
    Pay(amount float32) string 
} 
 
const ( 
    Cash      = 1 
    DebitCard = 2 
) 

type CashPM struct{} 
type DebitCardPM struct{} 
 
func GetPaymentMethod(m int) (PaymentMethod, error) { 
    switch m { 
        case Cash: 
        return new(CashPM), nil 
        case DebitCard: 
        return new(DebitCardPM), nil 
        default: 
        return nil, errors.New(fmt.Sprintf("Payment method %d not recognized\n", m)) 
    } 
} 
</pre><p class="calibre10">We use a plain switch to check the contents of the argument <code class="email">m</code> (method). If it matches any of the known methods--cash or debit card, it returns a new instance of them. Otherwise, it will return a nil and an error indicating that the payment method has not been recognized. Now we can run our tests again to check the second part of the unit tests:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$go test -v -run=GetPaymentMethod .</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodCash</strong></span>
<span class="strong"><strong class="calibre2">--- FAIL: TestGetPaymentMethodCash (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:16: The cash payment method message wasn't correct</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:18: LOG:</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodDebitCard</strong></span>
<span class="strong"><strong class="calibre2">--- FAIL: TestGetPaymentMethodDebitCard (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:28: The debit card payment method message wasn't correct</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:30: LOG:</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodNonExistent</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestGetPaymentMethodNonExistent (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:38: LOG: Payment method 20 not recognized</strong></span>
<span class="strong"><strong class="calibre2">FAIL</strong></span>
<span class="strong"><strong class="calibre2">exit status 1</strong></span>
<span class="strong"><strong class="calibre2">FAIL</strong></span>
</pre><p class="calibre10">Now we do not get the errors saying it couldn't find the type of payment methods. Instead, we receive a <code class="email">message not correct</code> error when it tries to use any of the methods that it covers. We also got rid of the <code class="email">Not implemented</code> message that was being returned when we asked for an unknown payment method. Let's implement the structs now:</p><pre class="programlisting">type CashPM struct{} 
type DebitCardPM struct{} 
 
func (c *CashPM) Pay(amount float32) string { 
     return fmt.Sprintf("%0.2f paid using cash\n", amount) 
} 
 
func (c *DebitCardPM) Pay(amount float32) string { 
     return fmt.Sprintf("%#0.2f paid using debit card\n", amount) 
} 
</pre><p class="calibre10">We just get the amount, printing it in a nicely formatted message. With this implementation, the tests will all be passing now:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$ go test -v -run=GetPaymentMethod .</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodCash</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestGetPaymentMethodCash (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:18: LOG: 10.30 paid using cash</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodDebitCard</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestGetPaymentMethodDebitCard (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:30: LOG: 22.30 paid using debit card</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestGetPaymentMethodNonExistent</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestGetPaymentMethodNonExistent (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">        factory_test.go:38: LOG: Payment method 20 not recognized</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok</strong></span>
</pre><p class="calibre10">Do you see the <code class="email">LOG</code>: messages? They aren't errors, we just print some information that we receive when using the package under test. These messages can be omitted unless you pass the <code class="email">-v</code> flag to the test command:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$ go test -run=GetPaymentMethod .</strong></span>
<span class="strong"><strong class="calibre2">ok</strong></span>
</pre></div></div></body></html>