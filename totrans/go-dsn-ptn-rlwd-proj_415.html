<html><head></head><body>
<div class="book" title="Adapter design pattern">
<div class="book" title="Implementation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch03lvl2sec079" class="calibre1"/>Implementation</h2></div></div></div><p class="calibre10">To make our single test pass, we must reuse the old <code class="email">MyLegacyPrinter</code> that is stored in <code class="email">PrinterAdapter</code> struct:</p><pre class="programlisting">type PrinterAdapter struct{ 
  OldPrinter LegacyPrinter 
  Msg        string 
} 
 
func(p *PrinterAdapter) PrintStored() (newMsg string) { 
  if p.OldPrinter != nil { 
    newMsg = fmt.Sprintf("Adapter: %s", p.Msg) 
    newMsg = p.OldPrinter.Print(newMsg) 
  } 
  else { 
    newMsg = p.Msg 
  } 
return 
} 
</pre><p class="calibre10">In the <code class="email">PrintStored</code> method, we check whetherÂ we actually have an instance of a <code class="email">LegacyPrinter</code>. In this case, we compose a new string with the stored message and the<code class="email"> Adapter</code> prefix to store it in the returning variable (called <code class="email">newMsg</code>). Then we use the pointer to the <code class="email">MyLegacyPrinter</code> struct to print the composed message using the <code class="email">LegacyPrinter</code> interface.</p><p class="calibre10">In case there is no <code class="email">LegacyPrinter</code> instance stored in the <code class="email">OldPrinter</code> field, we simply assign the stored message to the returning variable <code class="email">newMsg</code> and return the method. This should be enough to pass our tests:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">$ go test -v .</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestAdapter</strong></span>
<span class="strong"><strong class="calibre2">Legacy Printer: Adapter: Hello World!</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestAdapter (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok</strong></span>
</pre><p class="calibre10">Perfect! Now we can still use the old <code class="email">LegacyPrinter</code> interface by using this <code class="email">Adapter</code> while we use the <code class="email">ModernPrinter</code> interface for future implementations. Just keep in mind that the Adapter pattern must ideally just provide the way to use the old <code class="email">LegacyPrinter</code> and nothing else. This way, its scope will be more encapsulated and more maintainable in the future.</p></div></div></body></html>