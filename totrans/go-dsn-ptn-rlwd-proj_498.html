<html><head></head><body>
<div class="book" title="Chapter&#xA0;6.&#xA0;Behavioral Patterns - Template, Memento, and Interpreter Design Patterns">
<div class="book" title="Template design pattern">
<div class="book" title="Anonymous functions"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_8"><a id="ch06lvl2sec0147" class="calibre1"/>Anonymous functions</h2></div></div></div><p class="calibre10">This is not the only way to achieve the Template design pattern. We can also use an anonymous function to give our implementation to the <code class="email">ExecuteAlgorithm</code> method.</p><p class="calibre10">Let's write a test in the same method that was used previously just after the test (marked in bold):</p><pre class="programlisting">func TestTemplate_ExecuteAlgorithm(t *testing.T) { 
  t.Run("Using interfaces", func(t *testing.T){ 
    s := &amp;TestStruct{} 
    res := s.ExecuteAlgorithm(s) 
 
    expectedOrError(res, " world ", t) 
  }) 
 
<span class="strong"><strong class="calibre2">  t.Run("Using anonymous functions", func(t *testing.T)
  {</strong></span>
<span class="strong"><strong class="calibre2">    
     m := new(AnonymousTemplate)</strong></span>
<span class="strong"><strong class="calibre2">    
     res := m.ExecuteAlgorithm(func() string {</strong></span>
<span class="strong"><strong class="calibre2">      
       return "world"</strong></span>
<span class="strong"><strong class="calibre2">    
     })</strong></span>
<span class="strong"><strong class="calibre2">    
     expectedOrError(res, " world ", t)</strong></span>
<span class="strong"><strong class="calibre2">  
   })</strong></span> 
} 
 
func expectedOrError(res string, expected string, t *testing.T){ 
  if !strings.Contains(res, expected) { 
    t.Errorf("Expected string '%s' was not found on returned string\n", expected) 
  } 
} 
</pre><p class="calibre10">Our new test is called <span class="strong"><em class="calibre11">Using anonymous functions</em></span>. We have also extracted the checking on the test to an external function to reuse it in this test. We have called this function <code class="email">expectedOrError</code> because it will fail with an error if the expected value isn't received.</p><p class="calibre10">In our test, we will create a type called <code class="email">AnonymousTemplate</code> that replaces the previous <code class="email">Template</code> type. The <code class="email">ExecuteAlgorithm</code> method of this new type accepts the <code class="email">func() </code>method <code class="email">string</code> type that we can implement directly in the test to return the string <code class="email">world</code>.</p><p class="calibre10">The <code class="email">AnonymousTemplate</code> type will have the following structure:</p><pre class="programlisting">type AnonymousTemplate struct{} 
 
func (a *AnonymousTemplate) first() string { 
  return "" 
} 
 
func (a *AnonymousTemplate) third() string { 
  return "" 
} 
 
func (a *AnonymousTemplate) ExecuteAlgorithm(f func() string) string { 
  return "" 
} 
</pre><p class="calibre10">The only difference with the <code class="email">Template</code> type is that the <code class="email">ExecuteAlgorithm</code> method accepts a function that returns a string instead of a <code class="email">MessageRetriever</code> interface. Let's run the new test:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go test -v .</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm/Using_interfaces</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm/Using_anonymous_functions</strong></span>
<span class="strong"><strong class="calibre2">--- FAIL: TestTemplate_ExecuteAlgorithm (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">    --- PASS: TestTemplate_ExecuteAlgorithm/Using_interfaces (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">    --- FAIL: TestTemplate_ExecuteAlgorithm/Using_anonymous_functions (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">      template_test.go:47: Expected string ' world ' was not found on returned string</strong></span>
<span class="strong"><strong class="calibre2">FAIL</strong></span>
<span class="strong"><strong class="calibre2">exit status 1</strong></span>
<span class="strong"><strong class="calibre2">FAIL</strong></span>
</pre><p class="calibre10">As you can read in the output of the test execution, the error is thrown on the <span class="strong"><em class="calibre11">Using anonymous functions</em></span> test, which is what we were expecting. Now we will write the implementation as follows:</p><pre class="programlisting">type AnonymousTemplate struct{} 
 
func (a *AnonymousTemplate) first() string { 
  return "hello" 
} 
 
func (a *AnonymousTemplate) third() string { 
  return "template" 
} 
 
func (a *AnonymousTemplate) ExecuteAlgorithm(f func() string) string { 
  return strings.Join([]string{a.first(), f(), a.third()}, " ") 
} 
</pre><p class="calibre10">The implementation is quite similar to the one in the <code class="email">Template</code> type. However, now we have passed a function called <code class="email">f</code> that we will use as the second item in the string array we used on <code class="email">Join</code> function. As <code class="email">f</code> is simply a function that returns a string, the only thing we need to do with it is to execute it in the proper place (the second position in the array).</p><p class="calibre10">Run the tests again:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go test -v .</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm/Using_interfaces</strong></span>
<span class="strong"><strong class="calibre2">=== RUN   TestTemplate_ExecuteAlgorithm/Using_anonymous_functions</strong></span>
<span class="strong"><strong class="calibre2">--- PASS: TestTemplate_ExecuteAlgorithm (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">    --- PASS: TestTemplate_ExecuteAlgorithm/Using_interfaces (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">    --- PASS: TestTemplate_ExecuteAlgorithm/Using_anonymous_functions (0.00s)</strong></span>
<span class="strong"><strong class="calibre2">PASS</strong></span>
<span class="strong"><strong class="calibre2">ok</strong></span>
</pre><p class="calibre10">Awesome! Now we know two ways to implement the Template design pattern.</p></div></div></div></body></html>