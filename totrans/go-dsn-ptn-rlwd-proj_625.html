<html><head></head><body>
<div class="book" title="Chapter&#xA0;1.&#xA0; Chat Application with Web Sockets">
<div class="book" title="A simple web server"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec007" class="calibre1"/>A simple web server</h1></div></div></div><p class="calibre10">The first thing our chat application needs is a web server that has two main responsibilities:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Serving the HTML and JavaScript chat clients that run in the user's browser</li><li class="listitem">Accepting web socket connections to allow the clients to communicate</li></ul></div><div class="informaltable" title="Note"><h3 class="title2"><a id="note004" class="calibre1"/>Note</h3><p class="calibre10">The <code class="email">GOPATH</code> environment variable is covered in detail in <a class="calibre1" title="Appendix Appendix. Good Practices for a Stable Go Environment" href="part0227_split_000.html#6OFFM1-9c484ed022e64a0fb0e1aebf8e05d4fd">Appendix</a>, <span class="strong"><em class="calibre11">Good Practices for a Stable Go environment</em></span>. Be sure to read that first if you need help getting set up.</p></div><p class="calibre10">Create a <code class="email">main.go</code> file inside a new folder called <code class="email">chat</code> in your <code class="email">GOPATH</code> and add the following code:</p><pre class="programlisting">package main 
import ( 
  "log" 
  "net/http" 
) 
func main() { 
  http.HandleFunc("/", func(w http.ResponseWriter, r  *http.Request) { 
    w.Write([]byte(`)) 
      &lt;html&gt; 
        &lt;head&gt; 
          &lt;title&gt;Chat&lt;/title&gt; 
        &lt;/head&gt; 
        &lt;body&gt; 
          Let's chat! 
        &lt;/body&gt; 
      &lt;/html&gt; 
    )) 
  }) 
  // start the web server 
  if err := http.ListenAndServe(":8080", nil); err != nil { 
    log.Fatal("ListenAndServe:", err) 
  } 
} 
</pre><p class="calibre10">This is a complete, albeit simple, Go program that will:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Listen to the root path using the <code class="email">net/http</code> package</li><li class="listitem">Write out the hardcoded HTML when a request is made</li><li class="listitem">Start a web server on port <code class="email">:8080</code> using the <code class="email">ListenAndServe</code> method</li></ul></div><p class="calibre10">The <code class="email">http.HandleFunc</code> function maps the path pattern <code class="email">/</code> to the function we pass as the second argument, so when the user hits <code class="email">http://localhost:8080/</code>, the function will be executed. The function signature of <code class="email">func(w http.ResponseWriter, r *http.Request)</code> is a common way of handling HTTP requests throughout the Go standard library.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip5" class="calibre1"/>Tip</h3><p class="calibre10">We are using <code class="email">package main</code> because we want to build and run our program from the command line. However, if we were building a reusable chatting package, we might choose to use something different, such as <code class="email">package chat</code>.</p></div><p class="calibre10">In a terminal, run the program by navigating to the <code class="email">main.go</code> file you just created and execute the following command:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go run main.go</strong></span>
</pre><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip6" class="calibre1"/>Tip</h3><p class="calibre10">The <code class="email">go run</code> command is a helpful shortcut for running simple Go programs. It builds and executes a binary in one go. In the real world, you usually use <code class="email">go build</code> yourself to create and distribute binaries. We will explore this later.</p></div><p class="calibre10">Open the browser and type <code class="email">http://localhost:8080</code> to see the <span class="strong"><strong class="calibre2">Let's chat!</strong></span> message.</p><p class="calibre10">Having the HTML code embedded within our Go code like this works, but it is pretty ugly and will only get worse as our projects grow. Next, we will see how templates can help us clean this up.</p></div></div></body></html>