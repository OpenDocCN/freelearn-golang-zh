<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Building an HTML and JavaScript chat client" id="4JQ761-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec009" class="calibre1"/>Building an HTML and JavaScript chat client</h1></div></div></div><p class="calibre10">In order for the users of our chat application to interact with the server and therefore other users, we need to write some client-side code that makes use of the web sockets found in modern browsers. We are already delivering HTML content via the template when users hit the root of our application, so we can enhance that.</p><p class="calibre10">Update the <code class="email">chat.html</code> file in the <code class="email">templates</code> folder with the following markup:</p><pre class="programlisting">&lt;html&gt; 
  &lt;head&gt; 
    &lt;title&gt;Chat&lt;/title&gt; 
    &lt;style&gt; 
      input { display: block; } 
      ul    { list-style: none; } 
    &lt;/style&gt; 
  &lt;/head&gt; 
  &lt;body&gt; 
    &lt;ul id="messages"&gt;&lt;/ul&gt; 
    &lt;form id="chatbox"&gt; 
      &lt;textarea&gt;&lt;/textarea&gt; 
      &lt;input type="submit" value="Send" /&gt; 
       &lt;/form&gt;  &lt;/body&gt; 
&lt;/html&gt; 
</pre><p class="calibre10">The preceding HTML will render a simple web form on the page containing a text area and a <span class="strong"><strong class="calibre2">Send</strong></span> button this is how our users will submit messages to the server. The <code class="email">messages</code> element in the preceding code will contain the text of the chat messages so that all the users can see what is being said. Next, we need to add some JavaScript to add some functionality to our page. Underneath the <code class="email">form</code> tag, above the closing <code class="email">&lt;/body&gt;</code> tag, insert the following code:</p><pre class="programlisting">&lt;script  src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"&gt; &lt;/script&gt; 
    &lt;script&gt; 
      $(function(){ 
        var socket = null; 
        var msgBox = $("#chatbox textarea"); 
        var messages = $("#messages"); 
        $("#chatbox").submit(function(){ 
          if (!msgBox.val()) return false; 
          if (!socket) { 
            alert("Error: There is no socket connection."); 
            return false; 
          } 
          socket.send(msgBox.val()); 
          msgBox.val(""); 
          return false; 
        }); 
        if (!window["WebSocket"]) { 
          alert("Error: Your browser does not support web  sockets.") 
        } else { 
          socket = new WebSocket("ws://localhost:8080/room"); 
          socket.onclose = function() { 
            alert("Connection has been closed."); 
          } 
          socket.onmessage = function(e) { 
            messages.append($("&lt;li&gt;").text(e.data)); 
          } 
        } 
      }); 
    &lt;/script&gt; 
</pre><p class="calibre10">The <code class="email">socket = new WebSocket("ws://localhost:8080/room")</code> line is where we open the socket and add event handlers for two key events: <code class="email">onclose</code> and <code class="email">onmessage</code>. When the socket receives a message, we use jQuery to append the message to the list element and thus present it to the user.</p><p class="calibre10">Submitting the HTML form triggers a call to <code class="email">socket.send</code>, which is how we send messages to the server.</p><p class="calibre10">Build and run the program again to ensure the templates recompile so these changes are represented.</p><p class="calibre10">Navigate to <code class="email">http://localhost:8080/</code> in two separate browsers (or two tabs of the same browser) and play with the application. You will notice that messages sent from one client appear instantly in the other clients:</p><p class="calibre10">
</p><div class="mediaobject"><img src="../images/00044.jpeg" alt="Building an HTML and JavaScript chat client" class="calibre14"/></div><p class="calibre15"> </p><p class="calibre10">
</p></div></body></html>