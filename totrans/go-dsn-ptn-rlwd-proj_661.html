<html><head></head><body>
<div class="book" title="Chapter&#xA0;3.&#xA0;Three Ways to Implement Profile Pictures">
<div class="book" title="Avatars from the OAuth2 server">
<div class="book" title="Getting the avatar URL"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec0028" class="calibre1"/>Getting the avatar URL</h2></div></div></div><p class="calibre10">The schema for user or profile resources is not part of the OAuth2 spec, which means that each provider is responsible for deciding how to represent that data. Indeed, providers do things differently; for example, the avatar URL in a GitHub user resource is stored in a field called <code class="email">avatar_url</code>, whereas in Google, the same field is called <code class="email">picture</code>. Facebook goes even further by nesting the avatar URL value in a <code class="email">url</code> field inside an object called <code class="email">picture</code>. Luckily, Gomniauth abstracts this for us; its <code class="email">GetUser</code> call on a provider standardizes the interface to get common fields.</p><p class="calibre10">In order to make use of the avatar URL field, we need to go back and store that information in our cookie. In <code class="email">auth.go</code>, look inside the <code class="email">callback</code> action switch case and update the code that creates the <code class="email">authCookieValue</code> object, as follows:</p><pre class="programlisting">authCookieValue := objx.New(map[string]interface{}{ 
  "name":       user.Name(), 
  "avatar_url":  user.AvatarURL(), 
}).MustBase64() 
</pre><p class="calibre10">The <code class="email">AvatarURL</code> field called in the preceding code will return the appropriate URL value and store it in our <code class="email">avatar_url</code> field, which we then put into the cookie.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip37" class="calibre1"/>Tip</h3><p class="calibre10">Gomniauth defines a <code class="email">User</code> type of interface and each provider implements their own version. The generic <code class="email">map[string]interface{}</code> data returned from the auth server is stored inside each object, and the method calls access the appropriate value using the right field name for that provider. This approach describing the way information is accessed without being strict about implementation detailsâ€“is a great use of interfaces in Go.</p></div></div></div></div></body></html>