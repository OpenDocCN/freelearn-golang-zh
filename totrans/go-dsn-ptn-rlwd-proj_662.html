<html><head></head><body>
<div class="book" title="Chapter&#xA0;3.&#xA0;Three Ways to Implement Profile Pictures">
<div class="book" title="Avatars from the OAuth2 server">
<div class="book" title="Transmitting the avatar URL"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec0029" class="calibre1"/>Transmitting the avatar URL</h2></div></div></div><p class="calibre10">We need to update our <code class="email">message</code> type so that it can also carry the avatar URL with it. In <code class="email">message.go</code>, add the <code class="email">AvatarURL</code> string field:</p><pre class="programlisting">type message struct { 
  Name      string 
  Message   string 
  When      time.Time 
  AvatarURL string 
} 
</pre><p class="calibre10">So far, we have not actually assigned a value to <code class="email">AvatarURL</code> like we do for the <code class="email">Name</code> field; so, we must update our <code class="email">read</code> method in <code class="email">client.go</code>:</p><pre class="programlisting">func (c *client) read() { 
  defer c.socket.Close() 
  for { 
    var msg *message 
    err := c.socket.ReadJSON(&amp;msg) 
    if err != nil { 
      return 
    } 
    msg.When = time.Now() 
    msg.Name = c.userData["name"].(string) 
    if avatarURL, ok := c.userData["avatar_url"]; ok { 
      msg.AvatarURL = avatarURL.(string) 
    } 
    c.room.forward &lt;- msg 
  } 
} 
</pre><p class="calibre10">All we have done here is take the value from the <code class="email">userData</code> field that represents what we put into the cookie and assigned it to the appropriate field in <code class="email">message</code> if the value was present in the map. We now take the additional step of checking whether the value is present because we cannot guarantee that the auth service would provide a value for this field. And since it could be <code class="email">nil</code>, it might cause panic to assign it to a <code class="email">string</code> type if it's actually missing.</p></div></div></div></body></html>