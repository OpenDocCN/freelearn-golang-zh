<html><head></head><body>
<div class="book" title="Chapter&#xA0;3.&#xA0;Three Ways to Implement Profile Pictures">
<div class="book" title="Avatars from the OAuth2 server">
<div class="book" title="Adding the avatar to the user interface"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec0030" class="calibre1"/>Adding the avatar to the user interface</h2></div></div></div><p class="calibre10">Now that our JavaScript client gets an avatar URL value via the socket, we can use it to display the image alongside the messages. We do this by updating the <code class="email">socket.onmessage</code> code in <code class="email">chat.html</code>:</p><pre class="programlisting">socket.onmessage = function(e) { 
  var msg = JSON.parse(e.data); 
  messages.append( 
    $("&lt;li&gt;").append( 
      $("&lt;img&gt;").css({ 
        width:50, 
        verticalAlign:"middle" 
      }).attr("src", msg.AvatarURL), 
      $("&lt;strong&gt;").text(msg.Name + ": "), 
      $("&lt;span&gt;").text(msg.Message) 
    ) 
  ); 
} 
</pre><p class="calibre10">When we receive a message, we will insert an <code class="email">img</code> tag with the source set to the <code class="email">AvatarURL</code> field. We will use jQuery's <code class="email">css</code> method to force a width of <code class="email">50</code> pixels. This protects us from massive pictures spoiling our interface and allows us to align the image to the middle of the surrounding text.</p><p class="calibre10">If we build and run our application having logged in with a previous version, you will find that the <code class="email">auth</code> cookie that doesn't contain the avatar URL is still there. We are not asked to authenticate again (since we are already logged in), and the code that adds the <code class="email">avatar_url</code> field never gets a chance to run. We could delete our cookie and refresh the page, but we would have to keep doing this whenever we make changes during development. Let's solve this problem properly by adding a logout feature.</p></div></div></div></body></html>