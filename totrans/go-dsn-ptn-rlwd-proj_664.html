<html><head></head><body>
<div class="book" title="Chapter&#xA0;3.&#xA0;Three Ways to Implement Profile Pictures">
<div class="book" title="Avatars from the OAuth2 server">
<div class="book" title="Logging out"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec0031" class="calibre1"/>Logging out</h2></div></div></div><p class="calibre10">The simplest way to log out a user is to get rid of the <code class="email">auth</code> cookie and redirect the user to the chat page, which will in turn cause a redirect to the login page (since we just removed the cookie). We do this by adding a new <code class="email">HandleFunc</code> call to <code class="email">main.go</code>:</p><pre class="programlisting">http.HandleFunc("/logout", func(w http.ResponseWriter, r  *http.Request) { 
  http.SetCookie(w, &amp;http.Cookie{ 
    Name:   "auth", 
    Value:  "", 
    Path:   "/", 
    MaxAge: -1, 
  }) 
  w.Header().Set("Location", "/chat") 
  w.WriteHeader(http.StatusTemporaryRedirect) 
}) 
</pre><p class="calibre10">The preceding handler function uses <code class="email">http.SetCookie</code> to update the cookie setting <code class="email">MaxAge</code> to <code class="email">-1</code>, which indicates that it should be deleted immediately by the browser. Not all browsers are forced to delete the cookie, which is why we also provide a new <code class="email">Value</code> setting of an empty string, thus removing the user data that would previously have been stored.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip38" class="calibre1"/>Tip</h3><p class="calibre10">As an additional assignment, you can bulletproof your app a little by updating the first line in <code class="email">ServeHTTP</code> for your <code class="email">authHandler</code> method in <code class="email">auth.go</code> to make it cope with the empty value case as well as the missing cookie case:</p><p class="calibre10"><code class="email">if cookie, err := r.Cookie("auth"); err == http.ErrNoCookie || cookie.Value == ""</code></p><p class="calibre10">Instead of ignoring the return of <code class="email">r.Cookie</code>, we keep a reference to the returned cookie (if there was actually one) and also add an additional check to see whether the <code class="email">Value</code> string of the cookie is empty or not.</p></div><p class="calibre10">Before we continue, let's add a <code class="email">Sign Out</code> link to make it even easier to get rid of the cookie and also allow our end users to log out. In <code class="email">chat.html</code>, update the <code class="email">chatbox</code> form to insert a simple HTML link to the new <code class="email">/logout</code> handler:</p><pre class="programlisting">&lt;form id="chatbox"&gt; 
  {{.UserData.name}}:&lt;br/&gt; 
  &lt;textarea&gt;&lt;/textarea&gt; 
  &lt;input type="submit" value="Send" /&gt; 
  or &lt;a href="/logout"&gt;sign out&lt;/a&gt; 
&lt;/form&gt; 
</pre><p class="calibre10">Now build and run the application and open a browser to <code class="email">localhost:8080/chat</code>:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go build -o chat</strong></span>
<span class="strong"><strong class="calibre2">./chat -host=:8080</strong></span>
</pre><p class="calibre10">Log out if you need to and log back in. When you click on <span class="strong"><strong class="calibre2">Send</strong></span>, you will see your avatar picture appear next to your messages:</p><p class="calibre10">
</p><div class="mediaobject"><img src="../images/00051.jpeg" alt="Logging out" class="calibre14"/></div><p class="calibre15"> </p><p class="calibre10">
</p></div></div></div></body></html>