- en: Logging out
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 注销登录
- en: 'The simplest way to log out a user is to get rid of the `auth` cookie and redirect
    the user to the chat page, which will in turn cause a redirect to the login page
    (since we just removed the cookie). We do this by adding a new `HandleFunc` call
    to `main.go`:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 退出用户的最简单方法就是删除`auth`cookie并将用户重定向到聊天页面，这反过来又会导致重定向到登录页面（因为我们刚刚删除了cookie）。我们通过在`main.go`中添加一个新的`HandleFunc`调用来实现这一点：
- en: '[PRE0]'
  id: totrans-2
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The preceding handler function uses `http.SetCookie` to update the cookie setting
    `MaxAge` to `-1`, which indicates that it should be deleted immediately by the
    browser. Not all browsers are forced to delete the cookie, which is why we also
    provide a new `Value` setting of an empty string, thus removing the user data
    that would previously have been stored.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的处理器函数使用`http.SetCookie`将cookie设置的`MaxAge`更新为`-1`，这表示它应该立即被浏览器删除。并不是所有浏览器都会强制删除cookie，这就是为什么我们还提供了一个新的空字符串`Value`设置，从而删除之前存储的用户数据。
- en: Tip
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'As an additional assignment, you can bulletproof your app a little by updating
    the first line in `ServeHTTP` for your `authHandler` method in `auth.go` to make
    it cope with the empty value case as well as the missing cookie case:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 作为额外的作业，你可以通过更新`auth.go`中`authHandler`方法的`ServeHTTP`的第一个行来给你的应用程序增加一些防护措施，使其能够处理空值情况以及缺失cookie的情况：
- en: '`if cookie, err := r.Cookie("auth"); err == http.ErrNoCookie || cookie.Value
    == ""`'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '`if cookie, err := r.Cookie("auth"); err == http.ErrNoCookie || cookie.Value
    == ""`'
- en: Instead of ignoring the return of `r.Cookie`, we keep a reference to the returned
    cookie (if there was actually one) and also add an additional check to see whether
    the `Value` string of the cookie is empty or not.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不是忽略`r.Cookie`的返回值，而是保留返回的cookie（如果实际上有一个的话）的引用，并添加一个额外的检查来查看cookie的`Value`字符串是否为空。
- en: 'Before we continue, let''s add a `Sign Out` link to make it even easier to
    get rid of the cookie and also allow our end users to log out. In `chat.html`,
    update the `chatbox` form to insert a simple HTML link to the new `/logout` handler:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续之前，让我们添加一个“注销”链接，使其更容易删除cookie，并允许我们的最终用户注销。在`chat.html`中，更新`chatbox`表单以插入一个简单的HTML链接到新的`/logout`处理器：
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now build and run the application and open a browser to `localhost:8080/chat`:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 现在构建并运行应用程序，并在浏览器中打开`localhost:8080/chat`：
- en: '[PRE2]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Log out if you need to and log back in. When you click on **Send**, you will
    see your avatar picture appear next to your messages:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，请退出并重新登录。当你点击**发送**时，你会看到你的头像图片出现在你的消息旁边：
- en: '![Logging out](img/00051.jpeg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![退出登录](img/00051.jpeg)'
