<html><head></head><body>
<div class="book" title="Uploading an avatar picture">
<div class="book" title="Serving the images"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec0037" class="calibre1"/>Serving the images</h2></div></div></div><p class="calibre10">Now that we have a place to keep our user's avatar images on the server, we need a way to make them accessible to the browser. We do this using the <code class="email">net/http</code> package's built-in file server. In <code class="email">main.go</code>, add the following code:</p><pre class="programlisting">http.Handle("/avatars/", 
  http.StripPrefix("/avatars/", 
    http.FileServer(http.Dir("./avatars")))) 
</pre><p class="calibre10">This is actually a single line of code that has been broken up to improve readability. The <code class="email">http.Handle</code> call should feel familiar, as we are specifying that we want to map the <code class="email">/avatars/</code> path with the specified handler this is where things get interesting. Both <code class="email">http.StripPrefix</code> and <code class="email">http.FileServer</code> return <code class="email">http.Handler</code>, and they make use of the wrapping pattern we learned about in the previous chapter. The <code class="email">StripPrefix</code> function takes <code class="email">http.Handler</code> in, modifies the path by removing the specified prefix, and passes the functionality onto an inner handler. In our case, the inner handler is an <code class="email">http.FileServer</code> handler that will simply serve static files, provide index listings, and generate the <code class="email">404 Not Found</code> error if it cannot find the file. The <code class="email">http.Dir</code> function allows us to specify which folder we want to expose publicly.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip47" class="calibre1"/>Tip</h3><p class="calibre10">If we didn't strip the <code class="email">/avatars/</code> prefix from the requests with <code class="email">http.StripPrefix</code>, the file server would look for another folder called <code class="email">avatars</code> inside the actual <code class="email">avatars</code> folder, that is, <code class="email">/avatars/avatars/filename</code> instead of <code class="email">/avatars/filename</code>.</p></div><p class="calibre10">Let's build the program and run it before opening <code class="email">http://localhost:8080/avatars/</code> in a browser. You'll notice that the file server has generated a listing of the files inside our <code class="email">avatars</code> folder. Clicking on a file will either download the file, or in the case of an image, simply display it. If you haven't done this already, go to <code class="email">http://localhost:8080/upload</code> and upload a picture, and then head back to the listing page and click on it to see it in the browser.</p></div></div></body></html>