- en: Combining all three implementations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结合所有三个实现
- en: To close this chapter with a bang, we will implement a mechanism in which each
    `Avatar` implementation takes a turn in trying to get a URL for a user. If the
    first implementation returns the `ErrNoAvatarURL` error, we will try the next
    and so on until we find a useable value.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让这一章节有一个完美的结尾，我们将实现一个机制，其中每个`Avatar`实现轮流尝试获取用户的URL。如果第一个实现返回`ErrNoAvatarURL`错误，我们将尝试下一个，依此类推，直到找到可用的值。
- en: 'In `avatar.go`, underneath the `Avatar` type, add the following type definition:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在`avatar.go`文件中，在`Avatar`类型下方添加以下类型定义：
- en: '[PRE0]'
  id: totrans-3
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The `TryAvatars` type is simply a slice of `Avatar` objects that we are free
    to add methods to. Let''s add the following `GetAvatarURL` method:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '`TryAvatars`类型只是一个`Avatar`对象的切片，我们可以自由地向其中添加方法。让我们添加以下`GetAvatarURL`方法：'
- en: '[PRE1]'
  id: totrans-5
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This means that `TryAvatars` is now a valid `Avatar` implementation and can
    be used in place of any specific implementation. In the preceding method, we iterated
    over the slice of `Avatar` objects in an order, calling `GetAvatarURL` for each
    one. If no error is returned, we return the URL; otherwise, we carry on looking.
    Finally, if we are unable to find a value, we just return `ErrNoAvatarURL` as
    per the interface design.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着`TryAvatars`现在是一个有效的`Avatar`实现，可以替代任何特定的实现。在先前的方法中，我们按照顺序遍历了`Avatar`对象的切片，为每个对象调用`GetAvatarURL`。如果没有返回错误，我们返回URL；否则，我们继续寻找。最后，如果我们无法找到值，我们根据接口设计只返回`ErrNoAvatarURL`。
- en: 'Update the `avatars` global variable in `main.go` to use our new implementation:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 将`main.go`中的`avatars`全局变量更新为使用我们的新实现：
- en: '[PRE2]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Here, we created a new instance of our `TryAvatars` slice type while putting
    the other `Avatar` implementations inside it. The order matters since it iterates
    over the objects in the order in which they appear in the slice. So, first our
    code will check whether the user has uploaded a picture; if they haven't, the
    code will check whether the auth service has a picture for us to use. If the approaches
    fail, a Gravatar URL will be generated, which in the worst case (for example,
    if the user hasn't added a Gravatar picture) will render a default placeholder
    image.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们创建了一个新的`TryAvatars`切片类型的实例，同时将其他`Avatar`实现放入其中。顺序很重要，因为它按照切片中对象出现的顺序迭代。因此，首先我们的代码将检查用户是否上传了图片；如果没有，代码将检查认证服务是否有我们可以使用的图片。如果这些方法都失败了，将生成一个Gravatar
    URL，在最坏的情况下（例如，如果用户没有添加Gravatar图片），将渲染一个默认的占位符图片。
- en: 'To see our new functionality in action, perform the following steps:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看我们的新功能如何工作，请执行以下步骤：
- en: 'Build and rerun the application:'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建并重新运行应用程序：
- en: '[PRE3]'
  id: totrans-12
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Log out by visiting `http://localhost:8080/logout`.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过访问`http://localhost:8080/logout`注销。
- en: Delete all the pictures from the `avatars` folder.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`avatars`文件夹中删除所有图片。
- en: Log back in by navigating to `http://localhost:8080/chat`.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过导航到`http://localhost:8080/chat`重新登录。
- en: Send some messages and take note of your profile picture.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发送一些消息并注意您的个人资料图片。
- en: Visit `http://localhost:8080/upload` and upload a new profile picture.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问`http://localhost:8080/upload`并上传新的个人资料图片。
- en: Log out again and log back in as you did earlier.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次注销并按照之前的方式重新登录。
- en: Send some more messages and note that your profile picture has been updated.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发送更多消息并注意您的个人资料图片已经更新。
