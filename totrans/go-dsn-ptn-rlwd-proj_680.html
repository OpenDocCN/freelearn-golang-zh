<html><head></head><body>
<div class="book" title="Five simple programs">
<div class="book" title="Sprinkle"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec0040" class="calibre1"/>Sprinkle</h2></div></div></div><p class="calibre10">Our first program augments the incoming words with some sugar terms in order to improve the odds of finding names that are available. Many companies use this approach to keep the core messaging consistent while being able to afford the <code class="email">.com</code> domain. For example, if we pass in the word <code class="email">chat</code>, it might pass out <code class="email">chatapp</code>; alternatively, if we pass in <code class="email">talk</code>, we may get back <code class="email">talk time</code>.</p><p class="calibre10">Go's <code class="email">math/rand</code> package allows us to break away from the predictability of computers. It gives our program the appearance of intelligence by introducing elements of chance into its decision making.</p><p class="calibre10">To make our Sprinkle program work, we will:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Define an array of transformations, using a special constant to indicate where the original word will appear</li><li class="listitem">Use the <code class="email">bufio</code> package to scan the input from <code class="email">stdin</code> and <code class="email">fmt.Println</code> in order to write the output to <code class="email">stdout</code></li><li class="listitem">Use the <code class="email">math/rand</code> package to randomly select a transformation to apply</li></ul></div><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip57" class="calibre1"/>Tip</h3><p class="calibre10">All our programs will reside in the <code class="email">$GOPATH/src</code> directory. For example, if your GOPATH is <code class="email">~/Work/projects/go</code>, you would create your program folders in the <code class="email">~/Work/projects/go/src</code> folder.</p></div><p class="calibre10">In the <code class="email">$GOPATH/src</code> directory, create a new folder called <code class="email">sprinkle</code> and add a <code class="email">main.go</code> file containing the following code:</p><pre class="programlisting">package main 
import ( 
  "bufio" 
  "fmt" 
  "math/rand" 
  "os" 
  "strings" 
  "time" 
) 
const otherWord = "*" 
var transforms = []string{  
otherWord, 
  otherWord + "app", 
  otherWord + "site", 
  otherWord + "time", 
  "get" + otherWord, 
  "go" + otherWord, 
  "lets " + otherWord, 
  otherWord + "hq", 
} 
func main() { 
  rand.Seed(time.Now().UTC().UnixNano()) 
  s := bufio.NewScanner(os.Stdin) 
  for s.Scan() { 
    t := transforms[rand.Intn(len(transforms))] 
    fmt.Println(strings.Replace(t, otherWord, s.Text(), -1)) 
  } 
} 
</pre><p class="calibre10">From now on, it is assumed that you will sort out the appropriate <code class="email">import</code> statements yourself. If you need assistance, refer to the tips provided in <a class="calibre1" title="Appendix Appendix. Good Practices for a Stable Go Environment" href="part0227_split_000.html#6OFFM1-9c484ed022e64a0fb0e1aebf8e05d4fd">Appendix</a>, <span class="strong"><em class="calibre11">Good Practices for a Stable Go Environment</em></span>.</p><p class="calibre10">The preceding code represents our complete Sprinkle program. It defines three things: a constant, a variable, and the obligatory <code class="email">main</code> function, which serves as the entry point to Sprinkle. The <code class="email">otherWord</code> constant string is a helpful token that allows us to specify where the original word should occur in each of our possible transformations. It lets us write code, such as <code class="email">otherWord+"extra"</code>, which makes it clear that in this particular case, we want to add the word "extra" to the end of the original word.</p><p class="calibre10">The possible transformations are stored in the <code class="email">transforms</code> variable that we declare as a slice of strings. In the preceding code, we defined a few different transformations, such as adding <code class="email">app</code> to the end of a word or <code class="email">lets</code> before it. Feel free to add some more; the more creative, the better.</p><p class="calibre10">In the <code class="email">main</code> function, the first thing we do is use the current time as a random seed. Computers can't actually generate random numbers, but changing the seed number of random algorithms gives the illusion that it can. We use the current time in nanoseconds because it's different each time the program is run (provided the system clock isn't being reset before each run). If we skip this step, the numbers generated by the <code class="email">math/rand</code> package would be deterministic; they'd be the same every time we run the program.</p><p class="calibre10">We then create a <code class="email">bufio.Scanner</code> object (by calling <code class="email">bufio.NewScanner</code>) and tell it to read the input from <code class="email">os.Stdin</code>, which represents the standard input stream. This will be a common pattern in our five programs since we are always going to read from the standard <span class="strong"><em class="calibre11">in</em></span> and write to the standard <span class="strong"><em class="calibre11">out</em></span>.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip58" class="calibre1"/>Tip</h3><p class="calibre10">The <code class="email">bufio.Scanner</code> object actually takes <code class="email">io.Reader</code> as its input source, so there is a wide range of types that we could use here. If you were writing unit tests for this code, you could specify your own <code class="email">io.Reader</code> for the scanner to read from, removing the need for you to worry about simulating the standard input stream.</p></div><p class="calibre10">As the default case, the scanner allows us to read blocks of bytes separated by defined delimiters, such as carriage return and linefeed characters. We can specify our own split function for the scanner or use one of the options built in the standard library. For example, there is <code class="email">bufio.ScanWords</code>, which scans individual words by breaking on whitespace rather than linefeeds. Since our design specifies that each line must contain a word (or a short phrase), the default line-by-line setting is ideal.</p><p class="calibre10">A call to the <code class="email">Scan</code> method tells the scanner to read the next block of bytes (the next line) from the input, and then it returns a <code class="email">bool</code> value indicating whether it found anything or not. This is how we are able to use it as the condition for the <code class="email">for</code> loop. While there is content to work on, <code class="email">Scan</code> returns <code class="email">true</code> and the body of the <code class="email">for</code> loop is executed; when <code class="email">Scan</code> reaches the end of the input, it returns <code class="email">false</code>, and the loop is broken. The bytes that are selected are stored in the <code class="email">Bytes</code> method of the scanner, and the handy <code class="email">Text</code> method that we use converts the <code class="email">[]byte</code> slice into a string for us.</p><p class="calibre10">Inside the <code class="email">for</code> loop (so for each line of input), we use <code class="email">rand.Intn</code> to select a random item from the <code class="email">transforms</code> slice and use <code class="email">strings.Replace</code> to insert the original word where the <code class="email">otherWord</code> string appears. Finally, we use <code class="email">fmt.Println</code> to print the output to the default standard output stream.</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note0059" class="calibre1"/>Note</h3><p class="calibre10">The <code class="email">math/rand</code> package provides insecure random numbers. If you want to write code that utilizes random numbers for security purposes, you must use the <code class="email">crypto/rand</code> package instead.</p></div><p class="calibre10">Let's build our program and play with it:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go build -o sprinkle</strong></span>
<span class="strong"><strong class="calibre2">./sprinkle</strong></span>
</pre><p class="calibre10">Once the program starts running, it will use the default behavior to read the user input from the terminal. It uses the default behavior because we haven't piped in any content or specified a source for it to read from. Type <code class="email">chat</code> and hit return. The scanner in our code notices the linefeed character at the end of the word and runs the code that transforms it, outputting the result. For example, if you type <code class="email">chat</code> a few times, you would see the following output:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">chat</strong></span>
<span class="strong"><strong class="calibre2">go chat</strong></span>
<span class="strong"><strong class="calibre2">chat</strong></span>
<span class="strong"><strong class="calibre2">lets chat</strong></span>
<span class="strong"><strong class="calibre2">chat</strong></span>
<span class="strong"><strong class="calibre2">chat app</strong></span>
</pre><p class="calibre10">Sprinkle never exits (meaning the <code class="email">Scan</code> method never returns <code class="email">false</code> to break the loop) because the terminal is still running; in normal execution, the in pipe will be closed by whatever program is generating the input. To stop the program, hit <span class="strong"><em class="calibre11">Ctrl + C</em></span>.</p><p class="calibre10">Before we move on, let's try to run Sprinkle, specifying a different input source. We are going to use the <code class="email">echo</code> command to generate some content and pipe it to our Sprinkle program using the pipe character:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">echo "chat" | ./sprinkle</strong></span>
</pre><p class="calibre10">The program will randomly transform the word, print it out, and exit since the <code class="email">echo</code> command generates only one line of input before terminating and closing the pipe.</p><p class="calibre10">We have successfully completed our first program, which has a very simple but useful function, as we will see.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip60" class="calibre1"/>Tip</h3><p class="calibre10">As an extra assignment, rather than hardcoding the <code class="email">transformations</code> array as we have done, see whether you can externalize it via flags or store them in a text file or database.</p></div></div></div></body></html>