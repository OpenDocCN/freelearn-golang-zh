- en: Reading votes from Twitter
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从Twitter读取投票
- en: 'In your `$GOPATH/src` folder, alongside other projects, create a new folder
    called `socialpoll` for this chapter. This folder won''t be a Go package or a
    program by itself, but it will contain our three component programs. Inside `socialpoll`,
    create a new folder called `twittervotes` and add the obligatory `main.go` template
    (this is important as `main` packages without a `main` function won''t compile):'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的`$GOPATH/src`文件夹中，与其他项目并列，为这一章节创建一个名为`socialpoll`的新文件夹。这个文件夹不会是一个Go包或一个程序本身，但它将包含我们的三个组件程序。在`socialpoll`内部，创建一个名为`twittervotes`的新文件夹，并添加必要的`main.go`模板（这很重要，因为没有`main`函数的`main`包无法编译）：
- en: '[PRE0]'
  id: totrans-2
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Our `twittervotes` program is going to:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的`twittervotes`程序将：
- en: Load all polls from the MongoDB database using `mgo` and collect all options
    from the `options` array in each document
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`mgo`从MongoDB数据库中加载所有投票，并从每个文档的`options`数组中收集所有选项
- en: Open and maintain a connection to Twitter's streaming APIs looking for any mention
    of the options
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打开并维护与Twitter流式API的连接，寻找任何关于期权的提及
- en: Figure out which option is mentioned and push that option through to NSQ for
    each tweet that matches the filter
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定哪个选项被提及，并将该选项推送到与过滤器匹配的每条推文的NSQ
- en: If the connection to Twitter is dropped (which is common in long-running connections
    that are actually part of Twitter's streaming API specification) after a short
    delay (so that we do not bombard Twitter with connection requests), reconnect
    and continue
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果与Twitter的连接断开（这在Twitter流式API规范中实际上是长运行连接的常见情况），在短暂的延迟后（这样我们不会向Twitter发送过多的连接请求），重新连接并继续
- en: Periodically re-query MongoDB for the latest polls and refresh the connection
    to Twitter to make sure we are always looking out for the right options
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期重新查询MongoDB以获取最新的投票并刷新与Twitter的连接，以确保我们始终在寻找正确的期权
- en: Gracefully stop itself when the user terminates the program by hitting *Ctrl
    + C*
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当用户通过按*Ctrl + C*终止程序时，程序将优雅地停止
