<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Sharing data between handlers" id="5CJLQ1-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec0035" class="calibre1"/>Sharing data between handlers</h1></div></div></div><p class="calibre10">Occasionally, we need to share a state between our middleware and handlers. Go 1.7 brought the <code class="email">context</code> package into the standard library, which gives us, among other things, a way to share basic request-scoped data.</p><p class="calibre10">Every <code class="email">http.Request</code> method comes with a <code class="email">context.Context</code> object accessible via the <code class="email">request.Context()</code> method, from which we can create new context objects. We can then call <code class="email">request.WithContext()</code> to get a (cheap) shallow copied <code class="email">http.Request</code> method that uses our new <code class="email">Context</code> object.</p><p class="calibre10">To add a value, we can create a new context (based on the existing one from the request) via the <code class="email">context.WithValue</code> method:</p><pre class="programlisting">ctx := context.WithValue(r.Context(), "key", "value") 
</pre><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip95" class="calibre1"/>Tip</h3><p class="calibre10">While you can technically store any type of data using this approach, it is only recommended that you store simple primitive types such as Strings and Integers and do not use it to inject dependencies or pointers to other objects that your handlers might need. Later in this chapter, we will explore patterns to access dependencies, such as a database connection.</p></div><p class="calibre10">In middleware code, we can then use our new <code class="email">ctx</code> object when we pass execution to the wrapped handler:</p><pre class="programlisting">Handler.ServeHTTP(w, r.WithContext(ctx)) 
</pre><p class="calibre10">It is worth exploring the documentation for the context package at <a class="calibre1" href="https://golang.org/pkg/context/">https://golang.org/pkg/context/</a> in order to find out what other features it provides.</p><p class="calibre10">We are going to use this technique to allow our handlers to have access to an API key that is extracted and validated elsewhere.</p></div></body></html>