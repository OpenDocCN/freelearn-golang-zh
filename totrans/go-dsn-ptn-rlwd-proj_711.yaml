- en: Sharing data between handlers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在处理者之间共享数据
- en: Occasionally, we need to share a state between our middleware and handlers.
    Go 1.7 brought the `context` package into the standard library, which gives us,
    among other things, a way to share basic request-scoped data.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，我们需要在中间件和处理者之间共享状态。Go 1.7将`context`包引入了标准库，它为我们提供了分享基本请求作用域数据的方法。
- en: Every `http.Request` method comes with a `context.Context` object accessible
    via the `request.Context()` method, from which we can create new context objects.
    We can then call `request.WithContext()` to get a (cheap) shallow copied `http.Request`
    method that uses our new `Context` object.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 每个`http.Request`方法都附带一个可通过`request.Context()`方法访问的`context.Context`对象，我们可以从中创建新的上下文对象。然后我们可以调用`request.WithContext()`来获取一个（便宜）浅拷贝的`http.Request`方法，它使用我们的新`Context`对象。
- en: 'To add a value, we can create a new context (based on the existing one from
    the request) via the `context.WithValue` method:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加一个值，我们可以通过`context.WithValue`方法创建一个新的上下文（基于请求中现有的上下文）：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Tip
  id: totrans-5
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: While you can technically store any type of data using this approach, it is
    only recommended that you store simple primitive types such as Strings and Integers
    and do not use it to inject dependencies or pointers to other objects that your
    handlers might need. Later in this chapter, we will explore patterns to access
    dependencies, such as a database connection.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然技术上可以使用这种方法存储任何类型的数据，但建议只存储简单的原始类型，如字符串和整数，并且不要用它来注入依赖项或指向其他对象（处理者可能需要）。在本章的后面部分，我们将探讨访问依赖项的模式，例如数据库连接。
- en: 'In middleware code, we can then use our new `ctx` object when we pass execution
    to the wrapped handler:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在中间件代码中，当我们传递执行到包装处理者时，我们可以使用我们的新`ctx`对象：
- en: '[PRE1]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: It is worth exploring the documentation for the context package at [https://golang.org/pkg/context/](https://golang.org/pkg/context/)
    in order to find out what other features it provides.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 值得探索[https://golang.org/pkg/context/](https://golang.org/pkg/context/)上下文包的文档，以了解它提供了哪些其他功能。
- en: We are going to use this technique to allow our handlers to have access to an
    API key that is extracted and validated elsewhere.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用这项技术来允许我们的处理者访问一个在其他地方提取和验证的API密钥。
