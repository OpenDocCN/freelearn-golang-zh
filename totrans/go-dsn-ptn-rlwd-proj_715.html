<html><head></head><body>
<div class="book" title="Wrapping handler functions" id="5DI6C1-9c484ed022e64a0fb0e1aebf8e05d4fd">
<div class="book" title="Cross-origin resource sharing"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec0062" class="calibre1"/>Cross-origin resource sharing</h2></div></div></div><p class="calibre10">The same-origin security policy mandates that AJAX requests in web browsers be allowed only for services hosted on the same domain, which would make our API fairly limited since we won't necessarily be hosting all of the websites that use our web service. The <span class="strong"><strong class="calibre2">CORS</strong></span> (<span class="strong"><strong class="calibre2">Cross-origin resource sharing</strong></span>) technique circumnavigates the same-origin policy, allowing us to build a service capable of serving websites hosted on other domains. To do this, we simply have to set the <code class="email">Access-Control-Allow-Origin</code> header in response to <code class="email">*</code>. While we're at it, since we're going to use the <code class="email">Location</code> header in our create poll call – we'll allow this header to be accessible by the client too, which can be done by listing it in the <code class="email">Access-Control-Expose-Headers</code> header. Add the following code to <code class="email">main.go</code>:</p><pre class="programlisting">func withCORS(fn http.HandlerFunc) http.HandlerFunc { 
  return func(w http.ResponseWriter, r *http.Request) { 
    w.Header().Set("Access-Control-Allow-Origin", "*") 
    w.Header().Set("Access-Control-Expose-Headers",
     "Location") 
    fn(w, r) 
  } 
} 
</pre><p class="calibre10">This is the simplest wrapper function yet; it just sets the appropriate header on the <code class="email">ResponseWriter</code> type and calls the specified <code class="email">http.HandlerFunc</code> type.</p><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip96" class="calibre1"/>Tip</h3><p class="calibre10">In this chapter, we are handling CORS explicitly so we can understand exactly what is going on; for real production code, you should consider employing an open source solution, such as <a class="calibre1" href="https://github.com/fasterness/cors">https://github.com/fasterness/cors</a>.</p></div></div></div></body></html>