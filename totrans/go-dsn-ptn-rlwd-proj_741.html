<html><head></head><body>
<div class="book" title="Generating random recommendations">
<div class="book" title="Handlers that use query parameters"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec0076" class="calibre1"/>Handlers that use query parameters</h2></div></div></div><p class="calibre10">Now we need to wire up our <code class="email">/recommendations</code> call, so head back to <code class="email">main.go</code> in the <code class="email">cmd/meander</code> folder and add the following code inside the <code class="email">main</code> function:</p><pre class="programlisting">http.HandleFunc("/recommendations", cors(func(w 
http.ResponseWriter, r *http.Request) { 
  q := &amp;meander.Query{ 
    Journey: strings.Split(r.URL.Query().Get("journey"), "|"), 
  } 
  var err error 
  q.Lat, err = strconv.ParseFloat(r.URL.Query().Get("lat"), 64) 
  if err != nil { 
    http.Error(w, err.Error(), http.StatusBadRequest) 
    return 
  } 
  q.Lng, err = strconv.ParseFloat(r.URL.Query().Get("lng"), 64) 
  if err != nil { 
    http.Error(w, err.Error(), http.StatusBadRequest) 
    return 
  } 
  q.Radius, err = strconv.Atoi(r.URL.Query().Get("radius")) 
  if err != nil { 
    http.Error(w, err.Error(), http.StatusBadRequest) 
    return 
  } 
  q.CostRangeStr = r.URL.Query().Get("cost") 
  places := q.Run() 
  respond(w, r, places) 
})) 
</pre><p class="calibre10">This handler is responsible for preparing the <code class="email">meander.Query</code> object and calling its <code class="email">Run</code> method before responding with the results. The <code class="email">http.Request</code> type's URL value exposes the <code class="email">Query</code> data that provides a <code class="email">Get</code> method which, in turn, looks up a value for a given key.</p><p class="calibre10">The journey string is translated from the <code class="email">bar|cafe|movie_theater</code> format to a slice of strings by splitting on the pipe character. Then, a few calls to functions in the <code class="email">strconv</code> package turn the string latitude, longitude, and radius values into numerical types. If the values are in an incorrect format, we will get an error, which we will then write out to the client using the <code class="email">http.Error</code> helper with an <code class="email">http.StatusBadRequest</code> status.</p></div></div></body></html>