<html><head></head><body>
<div class="book" title="The daemon backup tool">
<div class="book" title="Caching data"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec0088" class="calibre1"/>Caching data</h2></div></div></div><p class="calibre10">We can now query all existing paths and update the <code class="email">Paths</code> map, which is a useful technique to increase the speed of a program, especially given slow or disconnected data stores. By loading the data into a cache (in our case, the <code class="email">Paths</code> map), we can access it at lightning speed without having to consult the files each time we need information.</p><p class="calibre10">Add the following code to the body of the <code class="email">main</code> function:</p><pre class="programlisting">var path path 
col.ForEach(func(_ int, data []byte) bool { 
  if err := json.Unmarshal(data, &amp;path); err != nil { 
    fatalErr = err 
    return true 
  } 
  m.Paths[path.Path] = path.Hash 
  return false // carry on 
}) 
if fatalErr != nil { 
  return 
} 
if len(m.Paths) &lt; 1 { 
  fatalErr = errors.New("no paths - use backup tool to add at least one") 
  return 
} 
</pre><p class="calibre10">Using the <code class="email">ForEach</code> method again allows us to iterate over all the paths in the database. We unmarshal the JSON bytes into the same <code class="email">path</code> structure as we used in our other program and set the values in the <code class="email">Paths</code> map. Assuming that nothing goes wrong, we do a final check to make sure there is at least one path, and if not, we return with an error.</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note00131" class="calibre1"/>Note</h3><p class="calibre10">One limitation to our program is that it will not dynamically add paths once it has started. The daemon would need to be restarted. If this bothers you, you can always build in a mechanism that updates the <code class="email">Paths</code> map periodically or uses some other kind of configuration management.</p></div></div></div></body></html>