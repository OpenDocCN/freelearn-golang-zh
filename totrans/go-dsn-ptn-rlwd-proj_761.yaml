- en: Updating filedb records
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更新文件数据库记录
- en: All that is left is for us is implement the `check` function that should call
    the `Now` method on the `Monitor` type and update the database with new hashes
    if there are any.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 剩下的工作就是实现 `check` 函数，该函数应调用 `Monitor` 类型的 `Now` 方法，并在有新哈希值的情况下更新数据库。
- en: 'Underneath the `main` function, add the following code:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `main` 函数下方，添加以下代码：
- en: '[PRE0]'
  id: totrans-3
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `check` function first tells the user that a check is happening before immediately
    calling `Now`. If the `Monitor` type did any work for us, which is to ask whether
    it archived any files, we output them to the user and go on to update the database
    with the new values. The `SelectEach` method allows us to change each record in
    the collection if we so wish by returning the replacement bytes. So we unmarshal
    the bytes to get the path structure, update the hash value, and return the marshaled
    bytes. This ensures that the next time we start a `backupd` process, it will do
    so with the correct hash values.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '`check` 函数首先告知用户正在执行检查操作，然后立即调用 `Now`。如果 `Monitor` 类型为我们做了任何工作，即询问是否归档了任何文件，我们将它们输出给用户，并继续使用新值更新数据库。`SelectEach`
    方法允许我们通过返回替换字节来更改集合中的每个记录。因此，我们解包字节以获取路径结构，更新哈希值，并返回打包的字节。这确保了下次我们启动 `backupd`
    进程时，它将使用正确的哈希值。'
