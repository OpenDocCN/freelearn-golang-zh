<html><head></head><body>
<div class="book" title="Chapter&#xA0;9.&#xA0; Building a Q&amp;A Application for Google App Engine">
<div class="book" title="The Google App Engine SDK for Go">
<div class="book" title="Modules in Google App Engine"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_7"><a id="ch09lvl2sec0096" class="calibre1"/>Modules in Google App Engine</h2></div></div></div><p class="calibre10">A module is a Go package that can be versioned, updated, and managed independently. An app might have a single module, or it can be made up of many modules, each distinct but part of the same application with access to the same data and services. An application must have a default module even if it doesn't do much.</p><p class="calibre10">Our application will be made up of the following modules:</p><div class="informaltable"><table border="1" class="calibre17"><colgroup class="calibre18"><col class="calibre19"/><col class="calibre19"/></colgroup><tbody class="calibre20"><tr class="calibre21"><td class="calibre22">
<p class="calibre23">
<span><strong class="calibre24">Description</strong></span>
</p>
</td><td class="calibre22">
<p class="calibre23">
<span><strong class="calibre24">The module name</strong></span>
</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">The obligatory default module</p>
</td><td class="calibre22">
<p class="calibre23">default</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">An API package delivering RESTful JSON</p>
</td><td class="calibre22">
<p class="calibre23">api</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">A static website serving HTML, CSS, and JavaScript that makes AJAX calls to the API module</p>
</td><td class="calibre22">
<p class="calibre23">web</p>
</td></tr></tbody></table></div><p class="calibre10">Each module will be a Go package and will, therefore, live inside its own folder.</p><p class="calibre10">Let's reorganize our project into modules by creating a new folder alongside the <code class="email">api</code> folder called <code class="email">default</code>.</p><p class="calibre10">We are not going to make our default module do anything other than use it for configuration, as we want our other modules to do all the meaningful work. But if we leave this folder empty, the Google App Engine SDK will complain that it has nothing to build.</p><p class="calibre10">Inside the <code class="email">default</code> folder, add the following placeholder <code class="email">main.go</code> file:</p><pre class="programlisting">package defaultmodule 
func init() {} 
</pre><p class="calibre10">This file does nothing except allow our <code class="email">default</code> module to exist</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note00136" class="calibre1"/>Note</h3><p class="calibre10">It would have been nice for our package names to match the folders, but <code class="email">default</code> is a reserved keyword in Go, so we have a good reason to break that rule.</p></div><p class="calibre10">The other module in our application will be called <code class="email">web</code>, so create another folder alongside the <code class="email">api</code> and <code class="email">default</code> folders called <code class="email">web</code>. In this chapter, we are only going to build the API for our application and cheat by downloading the web module.</p><p class="calibre10">Head over to the project home page at <a class="calibre1" href="https://github.com/matryer/goblueprints">https://github.com/matryer/goblueprints</a>, access the content for <span class="strong"><strong class="calibre2">Second Edition</strong></span>, and look for the download link for the <span class="strong"><em class="calibre11">web components for </em></span>
<a class="calibre1" title="Chapter 9.  Building a Q&amp;A Application for Google App Engine" href="part0201_split_000.html#5VM122-9c484ed022e64a0fb0e1aebf8e05d4fd">Chapter 9</a>, <span class="strong"><em class="calibre11">Building a Q&amp;A Application for Google App Engine</em></span> in the Downloads section of the <code class="email">README</code> file. The ZIP file contains the source files for the web component, which should be unzipped and placed inside the <code class="email">web</code> folder.</p><p class="calibre10">Now, our application structure should look like this:</p><pre class="programlisting">/answersapp/api 
/answersapp/default 
/answersapp/web 
</pre><div class="book" title="Specifying modules"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec0032" class="calibre1"/>Specifying modules</h3></div></div></div><p class="calibre10">To specify which module our <code class="email">api</code> package will become, we must add a property to the <code class="email">app.yaml</code> inside our <span class="strong"><strong class="calibre2">api</strong></span> folder. Update it to include the <code class="email">module</code> property:</p><pre class="programlisting">application: YOUR_APPLICATION_ID_HERE 
version: 1 
runtime: go 
module: api 
api_version: go1 
handlers: 
- url: /.* 
  script: _go_app 
</pre><p class="calibre10">Since our default module will need to be deployed as well, we also need to add an <code class="email">app.yaml</code> configuration file to it. Duplicate the <code class="email">api/app.yaml</code> file inside <code class="email">default/app.yaml</code>, changing the module to <code class="email">default</code>:</p><pre class="programlisting">application: YOUR_APPLICATION_ID_HERE 
version: 1 
runtime: go 
module: default 
api_version: go1 
handlers: 
- url: /.* 
  script: _go_app 
</pre></div><div class="book" title="Routing to modules with dispatch.yaml"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec0033" class="calibre1"/>Routing to modules with dispatch.yaml</h3></div></div></div><p class="calibre10">In order to route traffic appropriately to our modules, we will create another configuration file called <code class="email">dispatch.yaml</code>, which will let us map URL patterns to the modules.</p><p class="calibre10">We want all traffic beginning with the <code class="email">/api/</code> path to be routed to the <code class="email">api</code> module and everything else to the <code class="email">web</code> module. As mentioned earlier, we won't expect our <code class="email">default</code> module to handle any traffic, but it will have more utility later.</p><p class="calibre10">In the <code class="email">answersapp</code> folder (alongside our module folders not inside any of the module folders), create a new file called <code class="email">dispatch.yaml</code> with the following contents:</p><pre class="programlisting">application: YOUR_APPLICATION_ID_HERE 
dispatch: 
  - url: "*/api/*" 
    module: api 
  - url: "*/*" 
    module: web 
</pre><p class="calibre10">The same <code class="email">application</code> property tells the Google App Engine SDK for Go which application we are referring to, and the <code class="email">dispatch</code> section routes URLs to modules.</p></div></div></div></div></body></html>