<html><head></head><body>
<div class="book" title="Votes" id="65D4E1-9c484ed022e64a0fb0e1aebf8e05d4fd">
<div class="book" title="Indexing"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec00104" class="calibre1"/>Indexing</h2></div></div></div><p class="calibre10">Reads from Google Cloud Datastore are extremely fast due to the extensive use of indexes. By default, every field in our structure is indexed. Queries that attempt to filter on fields that aren't indexed will fail (the method will return an error); the data store doesn't fall back to scanning like some other technologies do because it's considered too slow. If one query filters two or more fields, an additional index must be added that is composed of all fields.</p><p class="calibre10">A structure with 10 fields would perform multiple write operations when you put it: one for the entity itself and one for each index that needs to be updated. So it is sensible to turn off indexing for fields that are you not planning to query on.</p><p class="calibre10">In <code class="email">questions.go</code>, add the <code class="email">datastore</code> field tags to the <code class="email">Question</code> structure:</p><pre class="programlisting">type Question struct { 
  Key *datastore.Key `json:"id" datastore:"-"` 
  CTime time.Time `json:"created" datastore:",noindex"` 
  Question string `json:"question" datastore:",noindex"` 
  User UserCard `json:"user"` 
  AnswersCount int `json:"answers_count"` 
} 
</pre><p class="calibre10">The addition of the <code class="email">datastore:",noindex"</code> field tags will tell the data store not to index these fields.</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note00150" class="calibre1"/>Note</h3><p class="calibre10">The <code class="email">,noindex</code> value beginning with a comma is a little confusing. The value is essentially a list of comma-separated arguments, the first being the name we want the data store to use when storing each field (just like it does for the <code class="email">json</code> tag). Since we don't want to say anything about the name we want the data store to use the real field name we are omitting it; so the first argument is empty, and the second argument is <code class="email">noindex</code>.</p></div><p class="calibre10">Do this for fields that we do not want indexed in the <code class="email">Answer</code> structure:</p><pre class="programlisting">type Answer struct { 
  Key *datastore.Key `json:"id" datastore:"-"` 
  Answer string `json:"answer" datastore:",noindex"` 
  CTime time.Time `json:"created"` 
  User UserCard `json:"user" datastore:",noindex"` 
  Score int `json:"score"` 
} 
</pre><p class="calibre10">And for the <code class="email">Vote</code> structure, do this:</p><pre class="programlisting">type Vote struct { 
  Key *datastore.Key `json:"id" datastore:"-"` 
  MTime time.Time `json:"last_modified" datastore:",noindex"` 
  Question QuestionCard `json:"question" datastore:",noindex"` 
  Answer AnswerCard `json:"answer" datastore:",noindex"` 
  User UserCard `json:"user" datastore:",noindex"` 
  Score int `json:"score" datastore:",noindex"` 
} 
</pre><p class="calibre10">You can also add a <code class="email">noindex</code> declaration to all fields inside our card types: <code class="email">AnswerCard</code>, <code class="email">UserCard</code>, and <code class="email">QuestionCard</code>.</p><div class="informaltable" title="Note"><h3 class="title2"><a id="note00151" class="calibre1"/>Note</h3><p class="calibre10">The fields we have left without <code class="email">noindex</code> will be used in queries, and we need to make sure Google Cloud Datastore does indeed maintain indexes on these fields.</p></div></div></div></body></html>