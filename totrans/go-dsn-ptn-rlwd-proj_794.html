<html><head></head><body>
<div class="book" title="Exposing data operations over HTTP">
<div class="book" title="Exposing functionality via an HTTP API"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch09lvl2sec00111" class="calibre1"/>Exposing functionality via an HTTP API</h2></div></div></div><p class="calibre10">Now we have all the tools we need in order to put together our API: helper functions to encode and decode data payloads in JSON, path parsing functions, and all the entities and data access functionality to persist and query data in Google Cloud Datastore.</p><div class="book" title="HTTP routing in Go"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec0034" class="calibre1"/>HTTP routing in Go</h3></div></div></div><p class="calibre10">The three endpoints we are going to add in order to handle questions are outlined in the following table:</p><div class="informaltable"><table border="1" class="calibre17"><colgroup class="calibre18"><col class="calibre19"/><col class="calibre19"/></colgroup><tbody class="calibre20"><tr class="calibre21"><td class="calibre22">
<p class="calibre23">
<span><strong class="calibre24">HTTP request</strong></span>
</p>
</td><td class="calibre22">
<p class="calibre23">
<span><strong class="calibre24">Description</strong></span>
</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">
<code class="literal">POST /questions</code>
</p>
</td><td class="calibre22">
<p class="calibre23">Ask a new question</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">
<code class="literal">GET /questions/{id}</code>
</p>
</td><td class="calibre22">
<p class="calibre23">Get the question with the specific ID</p>
</td></tr><tr class="calibre21"><td class="calibre22">
<p class="calibre23">
<code class="literal">GET /questions</code>
</p>
</td><td class="calibre22">
<p class="calibre23">Get the top questions</p>
</td></tr></tbody></table></div><p class="calibre10">Since our API design is relatively simple, there is no need to bloat out our project with an additional dependency to solve routing for us. Instead, we'll roll our own very simple adhoc routing using normal Go code. We can use a simple <code class="email">switch</code> statement to detect which HTTP method was used and our <code class="email">pathParams</code> helper function to see whether an ID was specified before passing execution to the appropriate place.</p><p class="calibre10">Create a new file called <code class="email">handle_questions.go</code> and add the following <code class="email">http.HandlerFunc</code> function:</p><pre class="programlisting">func handleQuestions(w http.ResponseWriter, r *http.Request) { 
  switch r.Method { 
  case "POST": 
    handleQuestionCreate(w, r) 
  case "GET": 
    params := pathParams(r, "/api/questions/:id") 
    questionID, ok := params[":id"] 
    if ok { // GET /api/questions/ID 
      handleQuestionGet(w, r, questionID) 
      return 
    } 
    handleTopQuestions(w, r) // GET /api/questions/ 
  default: 
    http.NotFound(w, r) 
  } 
} 
</pre><p class="calibre10">If the HTTP method is <code class="email">POST</code>, then we'll call <code class="email">handleQuestionCreate</code>. If it's <code class="email">GET</code>, then we'll see whether we can extract the ID from the path and call <code class="email">handleQuestionGet</code> if we can, or <code class="email">handleTopQuestions</code> if we cannot.</p></div></div></div></body></html>