- en: Exposing functionality via an HTTP API
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过HTTP API公开功能
- en: 'Now we have all the tools we need in order to put together our API: helper
    functions to encode and decode data payloads in JSON, path parsing functions,
    and all the entities and data access functionality to persist and query data in
    Google Cloud Datastore.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经拥有了构建API所需的所有工具：用于在JSON中编码和解码数据负载的辅助函数、路径解析函数，以及所有实体和数据访问功能，用于在Google
    Cloud Datastore中持久化和查询数据。
- en: HTTP routing in Go
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Go中的HTTP路由
- en: 'The three endpoints we are going to add in order to handle questions are outlined
    in the following table:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将添加以下三个端点来处理问题，具体如下表所示：
- en: '| **HTTP request** | **Description** |'
  id: totrans-4
  prefs: []
  type: TYPE_TB
  zh: '| **HTTP请求** | **描述** |'
- en: '| `POST /questions` | Ask a new question |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| `POST /questions` | 提出一个新问题 |'
- en: '| `GET /questions/{id}` | Get the question with the specific ID |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '| `GET /questions/{id}` | 获取具有特定ID的问题 |'
- en: '| `GET /questions` | Get the top questions |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| `GET /questions` | 获取顶级问题 |'
- en: Since our API design is relatively simple, there is no need to bloat out our
    project with an additional dependency to solve routing for us. Instead, we'll
    roll our own very simple adhoc routing using normal Go code. We can use a simple
    `switch` statement to detect which HTTP method was used and our `pathParams` helper
    function to see whether an ID was specified before passing execution to the appropriate
    place.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的API设计相对简单，没有必要通过添加额外的依赖来膨胀我们的项目以解决路由问题。相反，我们将使用正常的Go代码自行实现一个非常简单的临时路由。我们可以使用一个简单的`switch`语句来检测使用了哪种HTTP方法，并使用我们的`pathParams`辅助函数来查看在传递执行到适当位置之前是否指定了ID。
- en: 'Create a new file called `handle_questions.go` and add the following `http.HandlerFunc`
    function:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个名为`handle_questions.go`的新文件，并添加以下`http.HandlerFunc`函数：
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If the HTTP method is `POST`, then we'll call `handleQuestionCreate`. If it's
    `GET`, then we'll see whether we can extract the ID from the path and call `handleQuestionGet`
    if we can, or `handleTopQuestions` if we cannot.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果HTTP方法是`POST`，则我们将调用`handleQuestionCreate`。如果是`GET`，则我们将查看是否可以从路径中提取ID，如果可以，则调用`handleQuestionGet`，否则调用`handleTopQuestions`。
