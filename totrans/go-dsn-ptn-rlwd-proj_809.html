<html><head></head><body>
<div class="book" title="Building the service" id="6D18U1-9c484ed022e64a0fb0e1aebf8e05d4fd">
<div class="book" title="Starting with tests"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch10lvl2sec00119" class="calibre1"/>Starting with tests</h2></div></div></div><p class="calibre10">Where possible, starting by writing test code has many advantages that usually end up increasing the quality and maintainability of your code. We are going to write a unit test that will use our new service to hash and then validate a password.</p><p class="calibre10">Create a new file called <code class="email">service_test.go</code> and add the following code:</p><pre class="programlisting">package vault 
import ( 
  "testing" 
  "golang.org/x/net/context" 
) 
func TestHasherService(t *testing.T) { 
  srv := NewService() 
  ctx := context.Background() 
  h, err := srv.Hash(ctx, "password") 
  if err != nil { 
    t.Errorf("Hash: %s", err) 
  } 
  ok, err := srv.Validate(ctx, "password", h) 
  if err != nil { 
    t.Errorf("Valid: %s", err) 
  } 
  if !ok { 
    t.Error("expected true from Valid") 
  } 
  ok, err = srv.Validate(ctx, "wrong password", h) 
  if err != nil { 
    t.Errorf("Valid: %s", err) 
  } 
  if ok { 
    t.Error("expected false from Valid") 
  } 
} 
</pre><p class="calibre10">We will create a new service via the <code class="email">NewService</code> method and then use it to call the <code class="email">Hash</code> and <code class="email">Validate</code> methods. We even test an unhappy case, where we get the password wrong and ensure that <code class="email">Validate</code> returns <code class="email">false</code>â€“otherwise, it wouldn't be very secure at all.</p></div></div></body></html>