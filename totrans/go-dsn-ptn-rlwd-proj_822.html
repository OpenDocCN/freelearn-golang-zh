<html><head></head><body>
<div class="book" title="Creating a server command">
<div class="book" title="Consuming the service over HTTP"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch10lvl2sec00128" class="calibre1"/>Consuming the service over HTTP</h2></div></div></div><p class="calibre10">Now that we have wired everything up, we can test the HTTP server using the <code class="email">curl</code> command–or any tool that lets us make JSON/HTTP requests.</p><p class="calibre10">In a terminal, let's start by running our servers. Head over to the <code class="email">vault/cmd/vaultd</code> folder and start the program:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go run main.go</strong></span>
</pre><p class="calibre10">Once the server is running, you'll see something like this:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">http: :8080</strong></span>
<span class="strong"><strong class="calibre2">grpc: :8081</strong></span>
</pre><p class="calibre10">Now, open another terminal and issue the following HTTP request using <code class="email">curl</code>:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">curl -XPOST -d '{"password":"hernandez"}'
    http://localhost:8080/hash</strong></span>
</pre><p class="calibre10">We are making a POST request to the hash endpoint with a JSON body that contains the password we want for hashing. Then, we get something like this:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">    {"hash":"$2a$10$IXYT10DuK3Hu.
      NZQsyNafF1tyxe5QkYZKM5by/5Ren"}
</strong></span>
</pre><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip175" class="calibre1"/>Tip</h3><p class="calibre10">The hash in this example won't match yours–there are many acceptable hashes and there's no way to know which one you'll get. Ensure that you copy and paste your actual hash (everything inside the double quotes).</p></div><p class="calibre10">The resulting hash is what we would store in our data store given the specified password. Then, when the user tries to log in again, we will make a request with the password they entered, along with this hash, to the validate endpoint:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">curl -XPOST -d
     '{"password":"hernandez",
       "hash":"PASTE_YOUR_HASH_HERE"}'
     http://localhost:8080/validate</strong></span>
</pre><p class="calibre10">Make this request by copying and pasting the correct hash and entering the same <code class="email">hernandez</code> password, and you will see this result:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">{"valid":true}</strong></span>
</pre><p class="calibre10">Now, change the password (this is equivalent to the user getting it wrong) and you will see this:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">{"valid":false}</strong></span>
</pre><p class="calibre10">You can see that the JSON/HTTP micro-service exposure for our vault service is complete and working.</p><p class="calibre10">Next, we will look at how we can consume the gRPC version.</p></div></div></body></html>