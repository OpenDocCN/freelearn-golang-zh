<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Building a gRPC client"><div class="book" id="6HPRO2-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch10lvl1sec0074" class="calibre1"/>Building a gRPC client</h1></div></div></div><p class="calibre10">Unlike JSON/HTTP services, gRPC services aren't easy for humans to interact with. They're really intended as machine-to-machine protocols, and so we must write a program if we wish to use them.</p><p class="calibre10">To help us do this, we are first going to add a new package inside our vault service called <code class="email">vault/client/grpc</code>. It will, given a gRPC client connection object that we get from Google's <code class="email">grpc</code> package, provide an object that performs the appropriate calls, encoding and decoding, for us, all hidden behind our own <code class="email">vault.Service</code> interface. So, we will be able to use the object as though it is just another implementation of our interface.</p><p class="calibre10">Create new folders inside vault so that you have the path of <code class="email">vault/client/grpc</code>. You can imagine adding other clients if you so wish, so this seems a good pattern to establish.</p><p class="calibre10">Add the following code to a new <code class="email">client.go</code> file:</p><pre class="programlisting">func New(conn *grpc.ClientConn) vault.Service { 
  var hashEndpoint = grpctransport.NewClient( 
    conn, "Vault", "Hash", 
    vault.EncodeGRPCHashRequest, 
    vault.DecodeGRPCHashResponse, 
    pb.HashResponse{}, 
  ).Endpoint() 
  var validateEndpoint = grpctransport.NewClient( 
    conn, "Vault", "Validate", 
    vault.EncodeGRPCValidateRequest, 
    vault.DecodeGRPCValidateResponse, 
    pb.ValidateResponse{}, 
  ).Endpoint() 
  return vault.Endpoints{ 
    HashEndpoint:     hashEndpoint, 
    ValidateEndpoint: validateEndpoint, 
  } 
} 
</pre><p class="calibre10">The <code class="email">grpctransport</code> package is referring to <code class="email">github.com/go-kit/kit/transport/grpc</code>. This might feel familiar by now; we are making two new endpoints based on the specified connection, this time being explicit about the <code class="email">Vault</code> service name and the endpoint names <code class="email">Hash</code> and <code class="email">Validate</code>. We pass in appropriate encoders and decoders from our vault package and empty response objects before wrapping them both in our <code class="email">vault.Endpoints</code> structure that we added-the one that implements the <code class="email">vault.Service</code> interface that just triggers the specified endpoints for us.</p></div></body></html>