<html><head></head><body>
<div class="book" title="Chapter&#xA0;11.&#xA0;Deploying Go Applications Using Docker">
<div class="book" title="Using Docker locally">
<div class="book" title="Running a Docker image locally"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch11lvl2sec00140" class="calibre1"/>Running a Docker image locally</h2></div></div></div><p class="calibre10">Now that our image is built, we can test it by running it with the following command:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">docker run -p 6060:8080 -p 6061:8081 --name localtest --rm vaultd</strong></span>
</pre><p class="calibre10">The <code class="email">docker run</code> command will spin up an instance of the <code class="email">vaultd</code> image.</p><p class="calibre10">The <code class="email">-p</code> flags specify a pair of ports to be exposed, the first value is the host port and the second value (following the colon) is the port within the image. In our case, we are saying that we want port <code class="email">8080</code> to be exposed onto port <code class="email">6060</code> and port <code class="email">8081</code> exposed via port <code class="email">6061</code>.</p><p class="calibre10">We are giving the running instance a name of <code class="email">localtest</code> with the <code class="email">--name</code> flag, which will help us to identify it when inspecting and stopping it. The <code class="email">--rm</code> flag indicates that we want the image to be removed once we have stopped it.</p><p class="calibre10">If this is successful, you will notice that the Vault service has indeed begun because it is telling us the ports to which it is bound:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">2016/09/20 15:56:17 grpc: :8081</strong></span>
<span class="strong"><strong class="calibre2">2016/09/20 15:56:17 http: :8080</strong></span>
</pre><div class="informaltable" title="Tip"><h3 class="title2"><a id="tip180" class="calibre1"/>Tip</h3><p class="calibre10">These are the internal ports; remember that we have mapped these to different external ports instead. This seems confusing but ends up being very powerful, since the person responsible for spinning up the instances of the service gets to decide which ports are right for their environment, and the Vault service itself doesn't have to worry about it.</p></div><p class="calibre10">To see this running, open another terminal and use the <code class="email">curl</code> command to access the JSON endpoint of our password hashing service:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">curl -XPOST -d '{"password":"monkey"}' localhost:6060/hash</strong></span>
</pre><p class="calibre10">You will see something that resembles the output from the running service:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">{"hash":"$2a$0$wk4qc74ougOkbkt/TWuRQHSg03i1ataNupbDADBwpe"}</strong></span>
</pre></div></div></div></body></html>