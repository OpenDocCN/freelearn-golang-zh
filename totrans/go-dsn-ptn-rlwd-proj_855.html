<html><head></head><body><div class="book" title="Go tools" id="6QCGQ1-9c484ed022e64a0fb0e1aebf8e05d4fd"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="app01lvl1sec0083" class="calibre1"/>Go tools</h1></div></div></div><p class="calibre10">An early decision made by the Go core team was that all Go code should look familiar and obvious to everybody who speaks Go rather than each code base requiring additional learning in order for new programmers to understand it or work on it. This is an especially sensible approach when you consider open source projects, some of which have hundreds of contributors coming and going all the time.</p><p class="calibre10">There is a range of tools that can assist us in achieving the high standards set by the Go core team, and we will look at some of the tools in action in this section.</p><p class="calibre10">In your <code class="email">GOPATH</code> location, create a new folder called <code class="email">tooling</code> and create a new <code class="email">main.go</code> file containing the following code verbatim:</p><pre class="programlisting">package main 
import ( 
  "fmt" 
) 
func main() { 
  return 
  var name string 
  name = "Mat" 
  fmt.Println("Hello ", name) 
} 
</pre><p class="calibre10">The tight spaces and lack of indentation are deliberate as we are going to look at a very cool utility that comes with Go.</p><p class="calibre10">In a terminal, navigate to your new folder and run this:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go fmt -w</strong></span>
</pre><div class="informaltable" title="Note"><h3 class="title2"><a id="note00188" class="calibre1"/>Note</h3><p class="calibre10">At Gophercon 2014 in Denver, Colorado, most people learned that rather than pronouncing this little triad as <span class="strong"><em class="calibre11">format</em></span> or <span class="strong"><em class="calibre11">f, m, t</em></span>, it is actually pronounced as a word. Try saying it to yourself now: <span class="strong"><em class="calibre11">fhumt</em></span>; it seems that computer programmers aren't weird enough without speaking an alien language to each other too!</p></div><p class="calibre10">You will notice that this little tool has actually tweaked our code file to ensure that the layout (or format) of our program matches Go standards. The new version is much easier to read:</p><pre class="programlisting">package main  
import ( 
  "fmt" 
)  
func main() { 
  return 
  var name string 
  name = "Mat" 
  fmt.Println("Hello ", name) 
} 
</pre><p class="calibre10">The <code class="email">go fmt</code> command cares about indentation, code blocks, unnecessary whitespace, unnecessary extra line feeds, and more. Formatting your code in this way is a great practice to ensure that your Go code looks like all other Go code.</p><p class="calibre10">Next, we are going to vet our program to make sure that we haven't made any mistakes or decisions that might be confusing to our users; we can do this automatically with another great tool that we get for free:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go vet</strong></span>
</pre><p class="calibre10">The output for our little program points out an obvious and glaring mistake:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">main.go:10: unreachable code</strong></span>
<span class="strong"><strong class="calibre2">exit status 1</strong></span>
</pre><p class="calibre10">We are calling <code class="email">return</code> at the top of our function and then trying to do other things. The <code class="email">go vet</code> tool has noticed this and points out that we have unreachable code in our file.</p><p class="calibre10">It isn't just silly mistakes like this that <code class="email">go vet</code> will catch; it will also look for subtler aspects of your program that will guide you toward writing the best Go code you can. For an up-to-date list of what the vet tool will report on, check out the documentation at <a class="calibre1" href="https://golang.org/cmd/vet/">https://golang.org/cmd/vet/</a>.</p><p class="calibre10">The final tool we will play with is called <code class="email">goimports</code>, and it was written by Brad Fitzpatrick to automatically fix (add or remove) <code class="email">import</code> statements for Go files. It is an error in Go to import a package and not use it, and obviously, trying to use a package without importing it won't work either. The <code class="email">goimports</code> tool will automatically rewrite our <code class="email">import</code> statement based on the contents of our code file. First, let's install <code class="email">goimports</code> with this familiar command:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">go get golang.org/x/tools/cmd/goimports</strong></span>
</pre><p class="calibre10">Update your program to import some packages that we are not going to use and remove the <code class="email">fmt</code> package:</p><pre class="programlisting">import ( 
  "net/http" 
  "sync" 
) 
</pre><p class="calibre10">When we try to run our program by calling <code class="email">go run main.go</code>, we will see that we get some errors:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">./main.go:4: imported and not used: "net/http"</strong></span>
<span class="strong"><strong class="calibre2">./main.go:5: imported and not used: "sync"</strong></span>
<span class="strong"><strong class="calibre2">./main.go:13: undefined: fmt</strong></span>
</pre><p class="calibre10">These errors tell us that we have imported packages that we are not using and missing the <code class="email">fmt</code> package and that in order to continue, we need to make corrections. This is where <code class="email">goimports</code> comes in:</p><pre class="programlisting">
<span class="strong"><strong class="calibre2">goimports -w *.go</strong></span>
</pre><p class="calibre10">We are calling the <code class="email">goimports</code> command with the <code class="email">-w</code> write flag, which will save us the task of making corrections to all files ending with <code class="email">.go</code>.</p><p class="calibre10">Have a look at your <code class="email">main.go</code> file now, and note that the <code class="email">net/http</code> and <code class="email">sync</code> packages have been removed and the <code class="email">fmt</code> package has been put back in.</p><p class="calibre10">You could argue that switching to a terminal to run these commands takes more time than just doing it manually, and you would probably be right in most cases, which is why it is highly recommended that you integrate the Go tools with your text editor.</p></div></body></html>