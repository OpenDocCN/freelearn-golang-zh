- en: '17'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '17'
- en: Using the Go HTTP Client
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Go HTTP 客户端
- en: Overview
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 概述
- en: This chapter will equip you to use the Go HTTP Client to talk to other systems
    over the Internet.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将使您能够使用 Go HTTP 客户端通过互联网与其他系统进行通信。
- en: You will start by learning to use the HTTP client to get data from a web server
    and to send data to a web server. By the end of the chapter, you will be able
    to upload a file to a web server and experiment with a custom Go HTTP Client to
    interact with web servers.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 您将首先学习如何使用 HTTP 客户端从 Web 服务器获取数据并向 Web 服务器发送数据。到本章结束时，您将能够将文件上传到 Web 服务器，并使用自定义的
    Go HTTP 客户端与 Web 服务器进行交互。
- en: Technical requirements
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter, you’ll require Go version 1.21 or higher. The code for this
    chapter can be found at: [https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17).'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，您需要 Go 版本 1.21 或更高版本。本章的代码可以在以下位置找到：[https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17)。
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: In the previous chapter, you looked at web APIs with REST. You learned what
    REST is, how to think about API design, resources, and errors in REST, as well
    as the problems with REST and some of its alternatives.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，您学习了使用 REST 的 Web API。您了解了 REST 是什么，如何考虑 API 设计、REST 中的资源以及错误，以及 REST
    的问题和它的某些替代方案。
- en: In this chapter, you will learn about the Go HTTP Client and how to use it.
    An HTTP client is something that is used to get data from or send data to a web
    server. Probably the most well-known example of an HTTP client is a web browser
    (such as Firefox, Chrome, and Microsoft Edge). When you enter a web address into
    a web browser, it will have an HTTP client built in that sends a request to the
    server for data. The server will gather the data and send it back to the HTTP
    client, which will then display the web page in the browser. Similarly, when you
    fill out a form in a web browser, for example, when you log in to a website, the
    browser will use its HTTP client to send that form data to the server and then
    take appropriate action, depending on the response.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将了解 Go HTTP 客户端及其使用方法。HTTP 客户端是用来从 Web 服务器获取数据或向 Web 服务器发送数据的东西。最著名的 HTTP
    客户端例子可能是网络浏览器（如 Firefox、Chrome 和 Microsoft Edge）。当您在浏览器中输入网址时，它将内置一个 HTTP 客户端，向服务器发送请求以获取数据。服务器将收集数据并发送回
    HTTP 客户端，然后 HTTP 客户端将在浏览器中显示网页。同样，当您在浏览器中填写表单时，例如登录网站时，浏览器将使用其 HTTP 客户端将表单数据发送到服务器，并根据响应采取适当的行动。
- en: This chapter looks at how you can use the Go HTTP Client to request data from
    a web server and send data to a server. You will examine the different ways you
    can use the HTTP client to interact with a web server and the various use cases
    for those interactions. The web browser example will be useful in explaining the
    different interactions. As part of this chapter, you will create your own Go programs
    that make use of the Go HTTP Client to send and receive data from a web server.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将探讨您如何使用 Go HTTP 客户端从 Web 服务器请求数据并向服务器发送数据。您将检查您可以使用 HTTP 客户端与 Web 服务器交互的不同方式以及这些交互的各种用例。Web
    浏览器示例将有助于解释不同的交互。作为本章的一部分，您将创建自己的 Go 程序，利用 Go HTTP 客户端从 Web 服务器发送和接收数据。
- en: The Go HTTP Client and its uses
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Go HTTP 客户端及其用途
- en: The Go HTTP Client is part of the Go standard library, specifically the `net/http`
    package. There are two main ways to use it. The first is to use the default HTTP
    client that is included in the `net/http` package. It’s simple to use and allows
    you to get up and running quickly. The second way is to create your own HTTP client
    based on the default HTTP client. This allows you to customize the requests and
    various other things. It takes longer to configure, but it gives you much more
    freedom and control over the requests you send.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: Go HTTP 客户端是 Go 标准库的一部分，具体是 `net/http` 包。使用它主要有两种方式。第一种是使用 `net/http` 包中包含的默认
    HTTP 客户端。它使用简单，让您能够快速启动并运行。第二种方式是基于默认 HTTP 客户端创建自己的 HTTP 客户端。这允许您自定义请求和各种其他事情。配置起来需要更长的时间，但它为您提供了对发送的请求的更多自由和控制。
- en: 'When using an HTTP client, you can send different types of requests. While
    there are many types of requests, we will discuss the two main ones: the GET request
    and the POST request. For instance, if you wanted to retrieve data from a server,
    you would send a GET request. When you enter a web address in your web browser,
    it will send a GET request to the server at that address and then display the
    data it returns. If you wanted to send data to the server, you would send a POST
    request. If you wanted to log into a website, you would POST your login details
    to the server.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用HTTP客户端时，您可以发送不同类型的请求。虽然有许多类型的请求，但我们将讨论两种主要的请求：GET请求和POST请求。例如，如果您想从服务器检索数据，您将发送一个GET请求。当您在网页浏览器中输入网址时，它将向该地址的服务器发送GET请求，然后显示它返回的数据。如果您想向服务器发送数据，您将发送一个POST请求。如果您想登录到网站，您将把您的登录详情POST到服务器。
- en: In this chapter, there are a few exercises to teach you about the Go HTTP Client.
    They will teach you how to request data from a server in various formats using
    GET requests. They will also teach you how to POST form data to a web server,
    similar to how a web browser would send a POST request when you log in to a website.
    These exercises will also show you how to upload a file to a web server and how
    to use a customized HTTP client to have more control over the requests you send.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，有一些练习旨在向您介绍Go HTTP客户端。它们将教会您如何使用GET请求从服务器以各种格式请求数据。它们还将教会您如何将表单数据POST到Web服务器，类似于当您登录到网站时，网络浏览器如何发送POST请求。这些练习还将向您展示如何将文件上传到Web服务器，以及如何使用自定义的HTTP客户端来对您发送的请求有更多的控制。
- en: Sending a request to a server
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向服务器发送请求
- en: 'When you want to retrieve data from a web server, you send a GET request to
    the server. When sending a request, the URL will contain information on the resource
    from which you want data. The URL can be broken down into a few key parts. These
    include the protocol, the hostname, the URI, and the query parameters. The format
    of it looks like this:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 当您想从Web服务器检索数据时，您会向服务器发送GET请求。在发送请求时，URL将包含您想要数据的资源信息。URL可以分解为几个关键部分。这包括协议、主机名、URI和查询参数。它的格式看起来像这样：
- en: '![Figure 17.1: URL format breakdown](img/B18621_17_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![图17.1：URL格式分解](img/B18621_17_01.jpg)'
- en: 'Figure 17.1: URL format breakdown'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.1：URL格式分解
- en: 'We can see the following in this example:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们可以看到以下内容：
- en: '`Protocol` tells the client how to connect to the server. The two most common
    protocols are HTTP and HTTPS. In this example, we have used `https`.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Protocol`告诉客户端如何连接到服务器。最常用的两种协议是HTTP和HTTPS。在这个例子中，我们使用了`https`。'
- en: '`Hostname` is the address of the server we want to connect to. In this example,
    it is `example.com`.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Hostname`是我们想要连接的服务器的地址。在这个例子中，它是`example.com`。'
- en: '`URI` is the `/downloads`.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`URI`是`/downloads`。'
- en: '`Query Parameters` tells the server about any additional information it needs.
    In this example, we have two query parameters. These are `filter=latest` and `os=windows`.
    You will notice they are separated from the URI by `?`. This is so the server
    can parse them from the request. We join any additional parameters to the end
    of the URI with the `&` symbol, as seen with the `os` parameter.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Query Parameters`告诉服务器它需要任何额外的信息。在这个例子中，我们有两个查询参数。这些是`filter=latest`和`os=windows`。您会注意到它们与URI由`?`分隔。这样，服务器就可以从请求中解析它们。我们将任何额外的参数与URI的末尾通过`&`符号连接，就像`os`参数中看到的那样。'
- en: Exercise 17.01 – sending a GET request to a web server using the Go HTTP Client
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习17.01 – 使用Go HTTP客户端向Web服务器发送GET请求
- en: 'In this exercise, you will be getting data from a web server and printing out
    that data. You will send a GET request to [https://www.google.com](https://www.google.com)
    and display the data the web server returns:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将从Web服务器获取数据并打印出这些数据。您将向[https://www.google.com](https://www.google.com)发送GET请求并显示Web服务器返回的数据：
- en: Create a new directory, `Exercise17.01`. Within that directory, create a new
    Go file called `main.go`.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的目录，`Exercise17.01`。在该目录中，创建一个新的Go文件，名为`main.go`。
- en: 'As this is a new program, you will want to set the package of the file to the
    `main()` function. Import the `net/http` package, the `log` package, and the `io`
    package. Type the following code:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于这是一个新的程序，您将想要将文件的包设置为`main()`函数。导入`net/http`包、`log`包和`io`包。输入以下代码：
- en: '[PRE0]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Now that you have the package set up and the imports you need, you can start
    creating a function to get data from a web server. The function you are going
    to create will request data from a web server.
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在您已经设置了所需的包和导入，您可以从创建一个从网络服务器获取数据的函数开始。您将要创建的函数将从网络服务器请求数据。
- en: 'Create a function that returns a string:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个返回字符串的函数：
- en: '[PRE1]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Within that function, you can then use the default Go HTTP Client to request
    data from a server. In this exercise, you will request data from [https://www.google.com](https://www.google.com).
    To request data from the web server, you use the `Get` function in the `http`
    package, which looks as follows:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在那个函数中，您可以使用默认的 Go HTTP 客户端从服务器请求数据。在这个练习中，您将请求 [https://www.google.com](https://www.google.com)
    的数据。要从网络服务器请求数据，您使用 `http` 包中的 `Get` 函数，它看起来如下：
- en: '[PRE2]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The data the server sends back is contained within `r.Body`, so you just need
    to read that data. To read the data within `r.Body`, you can use the `ReadAll`
    function within the `io` package. The two together would look like this:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器发送回的数据包含在 `r.Body` 中，所以您只需读取该数据。要读取 `r.Body` 中的数据，您可以使用 `io` 包中的 `ReadAll`
    函数。这两个函数放在一起将如下所示：
- en: '[PRE3]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'After you have received the response from the server and read the data, you
    just need to return that data as a string, which looks like this:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您从服务器收到响应并读取数据后，您只需将数据作为字符串返回，如下所示：
- en: '[PRE4]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The function you have now created will now look like this:'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您现在创建的函数将看起来如下：
- en: '[PRE5]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Create a `main` function. Within the `main` function, call the `getDataAndReturnResponse`
    function and log the string it returns:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 `main` 函数。在 `main` 函数中，调用 `getDataAndReturnResponse` 函数并记录它返回的字符串：
- en: '[PRE6]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: To run the program, open your terminal and navigate to the directory that you
    created the `main.go` file in.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行程序，请打开您的终端，并导航到您创建 `main.go` 文件的目录。
- en: 'Run `go run main.go` to compile and execute the file:'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 `go run main.go` 来编译和执行文件：
- en: '[PRE7]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The program will issue a GET request to [https://www.google.com](https://www.google.com)
    and log the response in your terminal.
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 程序将向 [https://www.google.com](https://www.google.com) 发送 GET 请求，并在您的终端中记录响应。
- en: 'While it may look like gibberish, if you were to save that data to a file called
    `response.html` and open it in your web browser, it would resemble the Google
    home page. This is what your web browser will do under the hood when you open
    a web page. It will send a GET request to the server and then display the data
    it returns. If we do this manually, it will look as follows:'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 虽然它看起来像是乱码，但如果您将那些数据保存到名为 `response.html` 的文件中，并在您的网页浏览器中打开它，它将类似于谷歌首页。这就是当您打开网页时，您的网页浏览器在底层会做什么。它会向服务器发送一个
    GET 请求，然后显示它返回的数据。如果我们手动这样做，它将如下所示：
- en: '![Figure 17.2: Request HTML response when viewed in Chrome](img/B18621_17_02.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.2：在 Chrome 中查看请求的 HTML 响应](img/B18621_17_02.jpg)'
- en: 'Figure 17.2: Request HTML response when viewed in Chrome'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.2：在 Chrome 中查看请求的 HTML 响应
- en: In this exercise, we saw how to send a GET request to a web server and get data
    back. You created a Go program that sent a request to [https://www.google.com](https://www.google.com)
    and got back the HTML data for the Google home page.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们看到了如何向网络服务器发送 GET 请求并获取数据。您创建了一个 Go 程序，向 [https://www.google.com](https://www.google.com)
    发送请求，并获取了谷歌首页的 HTML 数据。
- en: Structured data
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结构化数据
- en: Once you have requested data from a server, the data returned can come in various
    formats. For example, if you send a request to `packtpub.com`, it will return
    HTML data for the Packt website. While HTML data is useful for displaying websites,
    it isn’t ideal for sending machine-readable data. A common data type used in web
    APIs is JSON. JSON provides a good structure for data that is both machine-readable
    and human-readable. Later, you will learn how to parse JSON and make use of it
    using Go.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您从服务器请求数据，返回的数据可以以各种格式出现。例如，如果您向 `packtpub.com` 发送请求，它将返回 Packt 网站的 HTML 数据。虽然
    HTML 数据对于显示网站很有用，但它并不适合发送机器可读数据。在 Web API 中常用的数据类型是 JSON。JSON 为机器可读和人类可读的数据提供了良好的结构。稍后，您将学习如何使用
    Go 解析 JSON 并利用它。
- en: Exercise 17.02 – using the HTTP Client with structured data
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习 17.02 – 使用结构化数据与 HTTP 客户端
- en: 'In this exercise, you will parse structured JSON data in Go. The server will
    return JSON data, and you will use the `json.Unmarshal` function to parse the
    data and put them into a struct:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将使用 Go 解析结构化 JSON 数据。服务器将返回 JSON 数据，您将使用 `json.Unmarshal` 函数来解析数据并将它们放入结构体中：
- en: 'Create a new directory, `Exercise17.02`. Within that directory, create two
    more directories, `server` and `client`. Then, within the `server` directory,
    create a file called `server.go` and write the following code:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的目录，`Exercise17.02`。在该目录内，再创建两个子目录，`server`和`client`。然后，在`server`目录内，创建一个名为`server.go`的文件，并写入以下代码：
- en: '[PRE8]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This creates a very basic web server that sends back JSON data. For now, we
    will just use it as an example.
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这创建了一个非常基本的网络服务器，它会发送回JSON数据。目前，我们只是将其用作示例。
- en: 'Once you have created the server, navigate to the client directory and create
    a file called `client.go`. Add `package main`, and import the packages needed
    for the file:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你创建了服务器，导航到客户端目录并创建一个名为`client.go`的文件。添加`package main`，并导入文件所需的包：
- en: '[PRE9]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Then, create a struct with a string parameter that can accept the response
    from the server. You must use the exported field to encode or decode JSON. Fields
    must start with capital letters to be exported. Then, add a struct tag to customize
    the encoded JSON key name. If the name of the JSON field is different from the
    field name in the Go struct, it allows us to link that JSON field to the field
    in the struct. In our case, the names are the same. We can omit the struct tag,
    but it is the best practice to use JSON tags explicitly to make it more clear:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，创建一个带有字符串参数的结构体，它可以接受来自服务器的响应。你必须使用导出字段来编码或解码JSON。字段必须以大写字母开头才能被导出。然后，添加一个结构体标签来自定义编码的JSON键名。如果JSON字段的名称与Go结构体中的字段名称不同，这允许我们将该JSON字段链接到结构体中的字段。在我们的例子中，名称是相同的。我们可以省略结构体标签，但最好显式使用JSON标签以使其更清晰：
- en: '[PRE10]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, create a function that you can call to get and parse the data from the
    server. Use the struct you just created as the return value:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，创建一个你可以调用的函数来获取和解析来自服务器的数据。使用你刚刚创建的结构体作为返回值：
- en: '[PRE11]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'When you run the web server, it will listen on `http://localhost:8080`. So,
    you need to send a GET request to that URL and then read the response body:'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当你运行网络服务器时，它将监听`http://localhost:8080`。因此，你需要向该URL发送一个GET请求，然后读取响应体：
- en: '[PRE12]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This time, however, you will parse the response instead of simply returning
    it. To do that, you create an instance of the struct you created and then pass
    it along with the response data to `json.Unmarshal`:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然而，这次你将解析响应而不是简单地返回它。为此，你创建了一个你创建的结构体实例，然后将它连同响应数据一起传递给`json.Unmarshal`：
- en: '[PRE13]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This will populate the `message` variable with the data returned from the server.
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将使用来自服务器的数据填充`message`变量。
- en: 'You then need to return the struct to complete the function:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后你需要返回结构体以完成函数：
- en: '[PRE14]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Finally, call the function you just created from the `main()` function and
    log the message from the server:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，从`main()`函数中调用你刚刚创建的函数并记录来自服务器的消息：
- en: '[PRE15]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'To run this, you need to do two steps. The first is to navigate to the `server`
    directory in your terminal and run the following command. This will start the
    web server:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行此代码，你需要进行两个步骤。第一步是在你的终端中导航到`server`目录并运行以下命令。这将启动网络服务器：
- en: '[PRE16]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'In a second terminal window, navigate to the `client` directory and run `go
    run main.go`. This will start the client and connect to the server. It should
    output the following message from the server:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二个终端窗口中，导航到`client`目录并运行`go run main.go`。这将启动客户端并连接到服务器。它应该输出以下来自服务器的消息：
- en: '![Figure 17.3: Expected output](img/B18621_17_03.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图17.3：预期输出](img/B18621_17_03.jpg)'
- en: 'Figure 17.3: Expected output'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.3：预期输出
- en: In this exercise, you sent a GET request to the server and received structured
    data in the JSON format. You then parsed that JSON data to get the message from
    it.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你向服务器发送了一个GET请求，并收到了以JSON格式结构化的数据。然后你解析了这些JSON数据以获取其中的消息。
- en: Activity 17.01 – requesting data from a web server and processing the response
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动17.01 – 从网络服务器请求数据并处理响应
- en: 'Imagine you are interacting with a web API. You send a GET request for data
    and get back an array of names. You need to count those names to find out how
    many of each you have. In this activity, you will do just that. You will send
    a GET request to the server, get back structured JSON data, parse the data, and
    count how many of each name you got back in the response:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 想象你正在与一个Web API交互。你发送一个GET请求以获取数据，并返回一个包含名称的数组。你需要计数这些名称以找出你有多少个每种名称。在这个活动中，你将做这件事。你将向服务器发送一个GET请求，获取结构化的JSON数据，解析数据，并计算在响应中返回了多少个每种名称：
- en: Create a directory called `Activity17.01`.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`Activity17.01`的目录。
- en: Create two subdirectories, one called `client` and another called `server`.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建两个子目录，一个名为`client`，另一个名为`server`。
- en: In the `server` directory, create a file called `server.go`.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `server` 目录中创建一个名为 `server.go` 的文件。
- en: Add the server code in `server.go`.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `server.go` 中添加服务器代码。
- en: Start the server by calling `go run server.go` in the server directory.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在服务器目录中通过调用 `go run server.go` 来启动服务器。
- en: In the `client` directory, create a file called `client.go`.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `client` 目录中创建一个名为 `client.go` 的文件。
- en: In `client.go`, add the necessary imports.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `client.go` 中添加必要的导入。
- en: Create structs to parse the response data.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建用于解析响应数据的结构体。
- en: Create a function called `getDataAndParseResponse` that returns two integers.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为 `getDataAndParseResponse` 的函数，它返回两个整数。
- en: Send a `GET` request to the server.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向服务器发送一个 `GET` 请求。
- en: 'Parse the response into a struct. Here is an example of what the data will
    look like:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将响应解析到结构体中。以下是一个数据将呈现的示例：
- en: '[PRE17]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Loop through the struct and count the occurrences of the names `Electric` and
    `Boogaloo`.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 遍历结构体并计算 `Electric` 和 `Boogaloo` 名称的出现次数。
- en: Return the counts.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回计数。
- en: Print the counts.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打印计数。
- en: 'The expected output is as follows:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 预期的输出如下：
- en: '![Figure 17.4: Possible output](img/B18621_17_04.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![图17.4：可能的输出](img/B18621_17_04.jpg)'
- en: 'Figure 17.4: Possible output'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.4：可能的输出
- en: Important note
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'The solution for this activity can be found in the GitHub repository at: [https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.01](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.01).'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 该活动的解决方案可以在GitHub仓库中找到：[https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.01](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.01)。
- en: In this activity, we requested data from a web server and processed the data
    it returned using the Go HTTP Client.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个活动中，我们从一个Web服务器请求数据，并使用Go HTTP客户端处理它返回的数据。
- en: Sending data to a server
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向服务器发送数据
- en: 'In addition to requesting data from a server, you will also want to send data
    to a server. The most common way of doing this is via a POST request. A POST request
    comes in two main parts: the URL and the body. The body of a POST request is where
    you put the data you want to send to the server. A common example of this is a
    login form. When we send a login request, we POST the body to the URL. The web
    server then checks that the login details within the body are correct and updates
    our login status. It responds to the request by telling the client whether it
    succeeded or not. In this section, you will learn how to send data to a server
    using a POST request.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 除了从服务器请求数据外，你还会想向服务器发送数据。最常见的方法是通过POST请求。POST请求有两个主要部分：URL和主体。POST请求的主体是你放置要发送到服务器的数据的地方。一个常见的例子是登录表单。当我们发送登录请求时，我们将主体POST到URL。Web服务器将检查主体中的登录详情是否正确，并更新我们的登录状态。它通过告诉客户端是否成功来响应请求。在本节中，你将学习如何使用POST请求向服务器发送数据。
- en: Exercise 17.03 – sending a POST request to a web server using the Go HTTP Client
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习17.03 – 使用Go HTTP客户端向Web服务器发送POST请求
- en: 'In this exercise, you will send a POST request to a web server containing a
    message. The web server will then respond with the same message so you can confirm
    that it received it:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你将向一个包含消息的Web服务器发送一个POST请求。Web服务器将回送相同的消息，这样你就可以确认它已经接收到了：
- en: 'Create a new directory, `Exercise17.03`. Within that directory, create two
    more directories, `server` and `client`. Then, within the `server` directory,
    create a file called `server.go` and write the following code. We will ignore
    error handling to keep in mind brevity for the exercise code, but in real-world
    applications, be sure to handle errors:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的目录，`Exercise17.03`。在该目录中，创建两个额外的目录，`server` 和 `client`。然后在 `server` 目录中创建一个名为
    `server.go` 的文件，并编写以下代码。我们将忽略错误处理以保持练习代码的简洁性，但在实际应用中，请确保处理错误：
- en: '[PRE18]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: This creates a very basic web server that receives a JSON POST request and returs
    the message sent to it back to the client.
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这创建了一个非常基础的Web服务器，它接收一个JSON POST请求并将发送给它的消息返回给客户端。
- en: 'Once you have the server created. Navigate to the client directory and create
    a file called `client.go`. Add `package main` and the imports needed for the file:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦创建了服务器。导航到客户端目录并创建一个名为 `client.go` 的文件。添加 `package main` 和文件所需的导入：
- en: '[PRE19]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Next, you need to create a struct for the data we want to send and receive.
    This will be the same as the struct used by the server to parse the request:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你需要创建一个结构体来发送和接收我们想要的数据。这将与服务器用于解析请求的结构体相同：
- en: '[PRE20]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You then need to create the function to POST the data to the server. It should
    accept a `messageData` struct parameter as well as return a `messageData` struct:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要创建一个函数来将数据POST到服务器。它应该接受一个`messageData`结构体参数，并返回一个`messageData`结构体：
- en: '[PRE21]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'To post the data to the server, you need to marshal the struct into bytes that
    the client can send to the server. To do this, you can use the `json.Marshal`
    function. Note, we are intentionally ommitting error handling here, but normally
    you will handle errors:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将数据发送到服务器，你需要将结构体序列化为客户端可以发送给服务器的字节。为此，你可以使用`json.Marshal`函数。注意，我们在这里故意省略了错误处理，但通常你将处理错误：
- en: '[PRE22]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Now that you have the bytes, you can use the `http.Post` function to send the
    POST request. Within the request, you just need to tell the function what URL
    to post to, what kind of data you are sending, and the data you want to send.
    In this case, the URL is `http://localhost:8080`. The content you are sending
    is `application/json`, and the data are the `jsonBytes` variable you just created.
    Together, it looks like this:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你有了字节，你可以使用`http.Post`函数发送POST请求。在请求中，你只需要告诉函数要发送到哪个URL，你发送的数据类型，以及你想要发送的数据。在这种情况下，URL是`http://localhost:8080`。你发送的内容是`application/json`，数据是刚刚创建的`jsonBytes`变量。组合起来，看起来是这样的：
- en: '[PRE23]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'After that, the rest of the function is the same as in the previous exercise.
    You read the response, parse out the data, and then return the data, which looks
    like this:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，函数的其余部分与上一个练习相同。你读取响应，解析数据，然后返回数据，看起来是这样的：
- en: '[PRE24]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Then, you need to call the `postDataAndReturnResponse` function from your `main`
    function. This time, however, you need to pass the message you want to send to
    the function. You just need to create an instance of the `messageData` struct
    and pass that to the function when you call it, which looks like this:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要从你的`main`函数中调用`postDataAndReturnResponse`函数。然而，这次你需要将你想要发送的消息传递给函数。你只需要创建一个`messageData`结构体的实例，并在调用函数时将其传递，如下所示：
- en: '[PRE25]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'To run this exercise, you need to carry out two steps. The first is to navigate
    to the `server` directory in your terminal and run `go run server.go`. This will
    start the web server. In a second terminal window, navigate to the `client` directory
    and run `go run main.go`. This will start the client and connect to the server.
    It should output the following message from the server:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行这个练习，你需要执行两个步骤。第一步是在你的终端中导航到`server`目录并运行`go run server.go`。这将启动Web服务器。在第二个终端窗口中，导航到`client`目录并运行`go
    run main.go`。这将启动客户端并连接到服务器。它应该从服务器输出以下消息：
- en: '![Figure 17.5: Expected output](img/B18621_17_05.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图17.5：预期输出](img/B18621_17_05.jpg)'
- en: 'Figure 17.5: Expected output'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.5：预期输出
- en: In this exercise, you sent a POST request to the server. The server parsed the
    request and sent the same message back to you. If you change the message sent
    to the server, you should see the response from the server sending back the new
    message.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你向服务器发送了一个POST请求。服务器解析了请求，并将相同的信息发送回你。如果你更改发送给服务器的消息，你应该看到服务器发送回的新消息的响应。
- en: Uploading files in a POST request
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在POST请求中上传文件
- en: Another common example of data you might want to post to a web server is a file
    from your local computer. This is how websites allow users to upload their photos
    and so on. As you can imagine, this is more complex than sending simple form data.
    To achieve this, the file needs to be read first and then wrapped in a format
    that the server can understand. It can then be sent in a POST request to the server
    in what’s called a multipart form. You will learn how to read a file and upload
    it to a server using Go.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能想要发送到Web服务器的数据的另一个常见例子是从你的本地计算机上的文件。这就是网站允许用户上传他们的照片等的方式。正如你可以想象的那样，这比发送简单的表单数据要复杂得多。为了实现这一点，首先需要读取文件，然后将其包装成服务器可以理解的形式。然后，它可以在所谓的多部分表单中作为POST请求发送到服务器。你将学习如何使用Go读取文件并将其上传到服务器。
- en: Exercise 17.04 – uploading a file to a web server via a POST request
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习17.04 – 通过POST请求将文件上传到Web服务器
- en: 'In this exercise, you will read in a local file and then upload it to a web
    server. You can then check that the web server saved the file you uploaded:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你将读取本地文件并将其上传到Web服务器。然后你可以检查Web服务器是否保存了你上传的文件：
- en: 'Create a new directory, `Exercise17.04`. Within that directory, create two
    more directories, `server` and `client`. Then, within the `server` directory,
    create a file called `server.go` and write the following code:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个新的目录，`Exercise17.04`。在该目录内，创建两个额外的目录，`server`和`client`。然后，在`server`目录内，创建一个名为`server.go`的文件并写入以下代码：
- en: '[PRE26]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The full code for this step is available at:[https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17)
    .
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此步骤的完整代码可在以下位置找到：[https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17)。
- en: This creates a very basic web server that receives a multipart form POST request
    and saves the file within the form. A multipart form is a content type used for
    encoding files or binary data along with textual key-value pairs in HTTP requests.
    We are using this encoding to include files as part of the form data, as this
    is the standard way to handle file uploads in HTML forms.
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这创建了一个非常基本的Web服务器，它可以接收多部分表单POST请求并在表单中保存文件。多部分表单是一种用于在HTTP请求中编码文件或二进制数据以及文本键值对的MIME类型。我们使用这种编码将文件作为表单数据的一部分，因为这是处理HTML表单中文件上传的标准方式。
- en: 'Once you have created the server, navigate to the client directory and create
    a file called `client.go`. Add `package main` and the imports needed for the file:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您创建了服务器，导航到客户端目录并创建一个名为`client.go`的文件。添加`package main`和文件所需的导入：
- en: '[PRE27]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'You then need to create a function to call that you will give a filename to.
    The function will read in the file, upload it to the server, and return the server’s
    response:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后您需要创建一个函数来调用，并将文件名提供给该函数。该函数将读取文件，将其上传到服务器，并返回服务器的响应：
- en: '[PRE28]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'You need to create a buffer that you can write the file bytes to and then create
    a writer to allow bytes to write into it:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要创建一个缓冲区，可以将文件字节写入其中，然后创建一个写入器，以便允许字节写入：
- en: '[PRE29]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Open the file from your local computer using the following command:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令从您的本地计算机打开文件：
- en: '[PRE30]'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Once you have opened the local file, you need to create `formFile`. This wraps
    the file data in the right format to upload it to the server:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您打开了本地文件，您需要创建`formFile`。这会将文件数据包装在正确的格式中，以便上传到服务器：
- en: '[PRE31]'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Copy the bytes from the local file into the form file and then close the form
    file writer so that it knows no more data will be added:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将本地文件的字节复制到表单文件中，然后关闭表单文件写入器，以便它知道不会再添加更多数据：
- en: '[PRE32]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Next, you need to create the POST request that you want to send to the server.
    In the previous exercises, we used shortcut functions such as `http.Post`. However,
    in this exercise, we need more control over the data being sent. That means we’ll
    need to create `http.Request`. In this case, you’re creating a POST request that
    you will send to `http://localhost:8080`. As we are uploading a file, the bytes
    buffer also needs to be included in the request; this looks like the following:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您需要创建要发送到服务器的POST请求。在前面的练习中，我们使用了如`http.Post`之类的快捷函数。然而，在这个练习中，我们需要对发送的数据有更多的控制。这意味着我们需要创建`http.Request`。在这种情况下，您正在创建一个将发送到`http://localhost:8080`的POST请求。由于我们正在上传文件，字节缓冲区也需要包含在请求中；它看起来如下所示：
- en: '[PRE33]'
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'You then need to set the `Content-Type` request header. This tells the server
    about the content of the file so it knows how to handle the upload:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后您需要设置`Content-Type`请求头。这会告诉服务器关于文件内容的信息，以便它知道如何处理上传：
- en: '[PRE34]'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Send the request as follows:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下方式发送请求：
- en: '[PRE35]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'After you have sent the request, we can read in the response and return the
    data within it:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您发送请求后，我们可以读取响应并返回其中的数据：
- en: '[PRE36]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Finally, you just need to call the `postFileAndReturnResponse` function and
    tell it what file to upload:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，您只需调用`postFileAndReturnResponse`函数并告诉它要上传哪个文件：
- en: '[PRE37]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'To run this, you need to carry out two steps. The first is to navigate to the
    `server` directory in your terminal and run `go run server.go`. This will start
    the web server:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行此操作，您需要执行两个步骤。第一步是在您的终端中导航到`server`目录并运行`go run server.go`。这将启动Web服务器：
- en: '[PRE38]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Next, in the `client` directory, create a file named `test.txt` and put a few
    lines of text in it.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在`client`目录中创建一个名为`test.txt`的文件，并在其中放入几行文本。
- en: 'In a second terminal window, navigate to the `client` directory and run `go
    run client.go`. This will start the client and connect to the server:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二个终端窗口中，导航到`client`目录并运行`go run client.go`。这将启动客户端并连接到服务器：
- en: '[PRE39]'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The client will then read in `test.txt` and upload it to the server. The client
    should give the following output:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，客户端将读取`test.txt`并将其上传到服务器。客户端应给出以下输出：
- en: '![Figure 17.6: Expected client output](img/B18621_17_06.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![图17.6：期望的客户端输出](img/B18621_17_06.jpg)'
- en: 'Figure 17.6: Expected client output'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.6：期望的客户端输出
- en: 'Then, if you navigate to the `server` directory, you should see that the `test.txt`
    file has now appeared:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，如果你导航到`server`目录，你应该会看到`test.txt`文件已经出现：
- en: '![Figure 17.7: Expected text file present](img/B18621_17_07.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![图17.7：期望的文本文件存在](img/B18621_17_07.jpg)'
- en: 'Figure 17.7: Expected text file present'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.7：期望的文本文件存在
- en: In this exercise, you sent a file to a web server using the Go HTTP Client.
    This approach works well with small files but can lead to memory overflow in the
    case of big files. Therefore, you may have to adapt the code if using large files
    to use alternative methods, such as `os.Pipe()`. In this example, with a small
    file, you had the file read in from the disk, formatted it into a POST request,
    and sent the data to the server. You saw the use of multipart form file uploading.
    We also saw the use of Go `http.DefaultClient`. `DefaultClient` works great; however,
    it should never be used in a production environment as it does not set a default
    timeout for HTTP requests. When making HTTP requests, it is crucial to set timeouts
    to ensure that your application does not hang indefinitely in the case of network
    issues or unresponsive servers.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你使用Go HTTP客户端向Web服务器发送了一个文件。这种方法对小文件效果很好，但在处理大文件时可能会导致内存溢出。因此，如果你使用大文件，可能需要修改代码以使用替代方法，例如`os.Pipe()`。在这个例子中，对于小文件，你从磁盘读取文件，将其格式化为POST请求，并将数据发送到服务器。你看到了多部分表单文件上传的使用。我们还看到了Go
    `http.DefaultClient`的使用。`DefaultClient`效果很好；然而，它永远不应该在生产环境中使用，因为它没有为HTTP请求设置默认超时。在发起HTTP请求时，设置超时至关重要，以确保在出现网络问题或服务器无响应的情况下，你的应用程序不会无限期地挂起。
- en: Custom request headers
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义请求头
- en: Sometimes there is more to a request than simply requesting or sending data.
    This information is stored within the request headers. A very common example of
    this is authorization headers. When you log into a server, it will respond with
    an authorization token. In all future requests sent to the server, you would include
    this token in the request’s headers so the server knows you are the one making
    the requests. You will learn how to add an authorization token to requests later.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 请求有时不仅仅是请求或发送数据。这些信息存储在请求头中。一个非常常见的例子是授权头。当你登录到服务器时，它将响应一个授权令牌。在所有未来发送到服务器的请求中，你都会在请求头中包含这个令牌，以便服务器知道是你发起的请求。你将在稍后学习如何将授权令牌添加到请求中。
- en: Exercise 17.05 – using custom headers and options with the Go HTTP Client
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习17.05 – 使用Go HTTP客户端的自定义头和选项
- en: 'In this exercise, you will create your own HTTP client and set custom options
    on it. You will also set an authorization token in the request headers so the
    server knows it is you requesting the data:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你将创建自己的HTTP客户端并为其设置自定义选项。你还需要在请求头中设置一个授权令牌，以便服务器知道是你请求的数据：
- en: 'Create a new directory, `Exercise17.05`. Within that directory, create two
    more directories, `server` and `client`. Then, within the `server` directory,
    create a file called `server.go` and write the following code:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的目录，`Exercise17.05`。在该目录中，创建另外两个目录，`server`和`client`。然后，在`server`目录中，创建一个名为`server.go`的文件，并编写以下代码：
- en: '[PRE40]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: This creates a very basic web server that receives a request, checks the authorization
    header is correct, waits 10 seconds, and then sends back data.
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这创建了一个非常基本的Web服务器，它接收请求，检查授权头是否正确，等待10秒，然后发送回数据。
- en: 'Once you have created the server, navigate to the client directory and create
    a file called `client.go`. Add `package main` and the imports needed for the file:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦创建了服务器，导航到客户端目录并创建一个名为`client.go`的文件。添加`package main`和文件所需的导入：
- en: '[PRE41]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Then, you need to create a function that will create an HTTP client, set the
    timeout limitations, and set the authorization header:'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要创建一个函数，该函数将创建HTTP客户端，设置超时限制，并设置授权头：
- en: '[PRE42]'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'You need to create your own HTTP client and set the timeout to 11 seconds:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你需要创建自己的HTTP客户端并将超时设置为11秒：
- en: '[PRE43]'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You also need to create a request to send it to the server. You should create
    a GET request with the URL `http://localhost:8080`. No data will be sent in this
    request, so the data can be set to nil. You can use the `http.NewRequest` function
    to do this:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你还需要创建一个请求以将其发送到服务器。你应该创建一个带有URL `http://localhost:8080` 的GET请求。在这个请求中不会发送任何数据，因此数据可以设置为nil。你可以使用`http.NewRequest`函数来完成此操作：
- en: '[PRE44]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'If you look at the server code again, you will notice that it checks for the
    `Authorization` request header, and it expects its value to be `superSecretToken`.
    So, you need to set the `Authorization` header in your request as well:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你再次查看服务器代码，你会注意到它检查`Authorization`请求头，并期望其值为`superSecretToken`。因此，你需要在你的请求中设置`Authorization`头：
- en: '[PRE45]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'You then get the client you created to enact the request:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后你让创建的客户端执行请求：
- en: '[PRE46]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Then, you need to read in the response from the server and return the data:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要读取来自服务器的响应并返回数据：
- en: '[PRE47]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Finally, you need to call the function you just created from the `main` function
    and log the data it returns:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，你需要从`main`函数中调用你刚刚创建的函数并记录它返回的数据：
- en: '[PRE48]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: To run this exercise, you need to carry out two steps. The first is to navigate
    to the `server` directory in your terminal and run `go run server.go`. This will
    start the web server.
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行此练习，你需要执行两个步骤。第一步是在你的终端中导航到`server`目录并运行`go run server.go`。这将启动Web服务器。
- en: In a second terminal window, navigate to the directory you created `client`
    in.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二个终端窗口中，导航到你创建的`client`目录。
- en: 'To execute the client, run the following command:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要执行客户端，请运行以下命令：
- en: '[PRE49]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'This will start the client and connect to the server. The client will send
    the request to the server, and after 10 seconds, it should output the following:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启动客户端并连接到服务器。客户端将向服务器发送请求，并在10秒后输出以下内容：
- en: '![Figure 17.8: Expected output](img/B18621_17_08.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![图17.8：预期输出](img/B18621_17_08.jpg)'
- en: 'Figure 17.8: Expected output'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.8：预期输出
- en: Important note
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Change the timeout settings in the client to under 10 seconds and see what happens.
    You can also change or remove the authorization header on the request and see
    what happens.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 将客户端的超时设置改为10秒以下，看看会发生什么。你还可以更改或删除请求上的授权头，看看会发生什么。
- en: In this exercise, you learned how to add custom headers to a request. You learned
    about the common example of adding an authorization header, which is required
    by many APIs when you want to interact with them.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你学习了如何向请求中添加自定义头。你了解了添加授权头的一个常见例子，这在你想与许多API交互时是必需的。
- en: Activity 17.02 – sending data to a web server and checking whether the data
    was received using POST and GET
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动17.02 – 使用POST和GET向Web服务器发送数据并检查数据是否接收
- en: Imagine you are interacting with a web API, and you wish to send data to a web
    server. You then want to check whether the data was added. In this activity, you
    will do just that. You will send a POST request to the server and then request
    the data back using a GET request, parse the data, and print it out.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 想象你正在与一个Web API交互，并且你希望向Web服务器发送数据。然后你想检查数据是否已添加。在这个活动中，你将做这件事。你将向服务器发送一个POST请求，然后使用GET请求请求数据，解析数据，并将其打印出来。
- en: 'Follow these steps to get the desired outcome:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤获取所需的结果：
- en: Create a directory called `Activity17.02`.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`Activity17.02`的目录。
- en: Create two subdirectories, one called `client` and one called `server`.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建两个子目录，一个名为`client`，另一个名为`server`。
- en: In the `server` directory, create a file called `server.go`.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`server`目录下，创建一个名为`server.go`的文件。
- en: Add the server code to the `server.go` file.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将服务器代码添加到`server.go`文件中。
- en: Start the server by calling `go run server.go` in the server directory.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过在服务器目录中调用`go run server.go`来启动服务器。
- en: In the `client` directory, create a file called `client.go`.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`client`目录中，创建一个名为`client.go`的文件。
- en: In `client.go`, add the necessary imports.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`client.go`中添加必要的导入。
- en: 'Create structs to host the request data, which looks like the following: `{"name":"Electric"}`.'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建结构体来存储请求数据，如下所示：`{"name":"Electric"}`。
- en: 'Create structs to parse the response data, which looks like the following:
    `{"ok":true}.`'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建结构体来解析响应数据，如下所示：`{"ok":true}.`
- en: Create an `addNameAndParseResponse` function that posts a name to the server.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个`addNameAndParseResponse`函数来向服务器发送一个名称。
- en: Create a `getDataAndParseResponse` function that parses the server response.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个`getDataAndParseResponse`函数来解析服务器响应。
- en: Send a POST request to the server to add names.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向服务器发送POST请求以添加名称。
- en: Send a GET request to the server.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向服务器发送GET请求。
- en: Parse the response into a struct.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将响应解析到结构体中。
- en: Loop through the struct and print the names.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 遍历结构体并打印名称。
- en: 'This is the expected output:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 这是预期的输出：
- en: '![Figure 17.9: Possible output](img/B18621_17_09.jpg)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![图17.9：可能的输出](img/B18621_17_09.jpg)'
- en: 'Figure 17.9: Possible output'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.9：可能的输出
- en: Important note
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The solution for this activity can be found at [https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.02](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.02).
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 本活动的解决方案可以在[https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.02](https://github.com/PacktPublishing/Go-Programming-From-Beginner-to-Professional-Second-Edition-/tree/main/Chapter17/Activity17.02)找到。
- en: In this activity, you saw how to send data to a web server using a POST request
    and then how to request data from the server to ensure it was updated using a
    GET request. Interacting with a server in this way is very common when programming
    professionally.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个活动中，您看到了如何使用POST请求向Web服务器发送数据，然后如何使用GET请求从服务器请求数据以确保它已更新。在专业编程中，以这种方式与服务器交互是非常常见的。
- en: Summary
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: HTTP clients are used to interact with web servers. They are used to send different
    types of requests to a server (for example, GET or POST requests) and then react
    to the response returned by the server. A web browser is a type of HTTP client
    that will send a GET request to a web server and display the HTML data it returns.
    In Go, you created your own HTTP client and did the same thing, sending a GET
    request to [https://www.google.com](https://www.google.com) and then logging the
    response returned by the server. You also learned about the components of a URL
    and that you can control what you request from a server by changing the URL.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP客户端用于与Web服务器交互。它们用于向服务器发送不同类型的请求（例如，GET或POST请求），然后对服务器返回的响应做出反应。Web浏览器是一种HTTP客户端，它将向Web服务器发送GET请求并显示它返回的HTML数据。在Go中，您创建了您自己的HTTP客户端并执行了相同的事情，向[https://www.google.com](https://www.google.com)发送GET请求，然后记录服务器返回的响应。您还了解了URL的组成部分，以及您可以通过更改URL来控制您从服务器请求的内容。
- en: 'There is also more to web servers than simply requesting HTML data. You learned
    that they can return structured data in the form of JSON, which can be parsed
    and used in your code. Data can also be sent to a server using POST requests,
    allowing you to send form data to a server. However, the data sent to a server
    isn’t limited to just form data: you can also upload files to a server using a
    POST request.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务器不仅仅是请求HTML数据。您了解到它们可以以JSON形式返回结构化数据，这些数据可以被解析并在您的代码中使用。数据也可以通过POST请求发送到服务器，允许您将表单数据发送到服务器。然而，发送到服务器的数据并不仅限于表单数据：您还可以使用POST请求上传文件到服务器。
- en: There are also ways to customize the requests you send. You learned about the
    common example of authorization, where you add a token to the header of HTTP requests
    so that a server can tell who is making that request.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 还有方法可以自定义您发送的请求。您了解到常见的授权示例，其中您将令牌添加到HTTP请求的头部，以便服务器可以知道是谁发起的那个请求。
- en: 'Part 6: Professional'
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6部分：专业
- en: Having gained proficiency in utilizing Go for real-world tasks, it’s time to
    equip you with the tools and techniques essential for professional programming
    in Go.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 在熟练使用Go处理实际任务后，现在是时候为您提供Go专业编程所必需的工具和技术了。
- en: This section encompasses advanced topics and best practices aimed at elevating
    your programming skills to a professional level.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 本节涵盖了旨在提升您编程技能至专业水平的高级主题和最佳实践。
- en: 'This section includes the following chapters:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 本节包括以下章节：
- en: '[*Chapter 18*](B18621_18.xhtml#_idTextAnchor1862), *Concurrent Work*'
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第18章*](B18621_18.xhtml#_idTextAnchor1862)，*并发工作*'
- en: '[*Chapter 19*](B18621_19.xhtml#_idTextAnchor2002), *Testing*'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第19章*](B18621_19.xhtml#_idTextAnchor2002)，*测试*'
- en: '[*Chapter 20*](B18621_20.xhtml#_idTextAnchor2072), *Using Go Tools*'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第20章*](B18621_20.xhtml#_idTextAnchor2072)，*使用Go工具*'
- en: '[*Chapter 21*](B18621_21.xhtml#_idTextAnchor2172), *Go in the Cloud*'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第21章*](B18621_21.xhtml#_idTextAnchor2172)，*云中的Go*'
