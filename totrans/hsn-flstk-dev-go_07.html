<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Building a Frontend for GoMusic</h1>
                </header>
            
            <article>
                
<p>It's now time to build the first major piece of the project of this book. As mentioned in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>, we'll be building an online store for musical instruments, which we will name GoMusic. In this chapter, we'll build most of the frontend of the online store by utilizing the impressive power of the React framework. Our GoMusic store will support the fundamental features of any online store:</p>
<ul>
<li>Users should be able to buy any product they like.</li>
<li>Users should have access to a promotional page, which provides current sales and promotions.</li>
<li>Users should be able to create their own accounts, and sign into them for a more personalized experience.</li>
</ul>
<p>The following are the three main components of our frontend that we will be learning about in this chapter:</p>
<ul>
<li>Main pages, which all users of our web application should see</li>
<li>Modal dialog windows, which help with buying products, accounts creation, and signing in</li>
<li>User pages, which show a personalized page for the logged-in user</li>
</ul>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Writing non-trivial React applications</li>
<li>Integrating credit card services with our frontend with Stripe</li>
<li>Writing modal windows in our code</li>
<li>Designing routes in our code</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Prerequisites and technical requirements</h1>
                </header>
            
            <article>
                
<p>In <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>, we covered the foundations of how to build a React.js application, so read it before attempting to follow along with this chapter. </p>
<p>The requirements are the same for this chapter. Here is a quick recap of the required knowledge and tools:</p>
<ul>
<li>npm.</li>
<li>The React framework.</li>
<li>The Create React App tool, which you can simply install using the following command:</li>
</ul>
<pre style="padding-left: 60px"><strong>npm<span> </span><span class="token function">install</span><span> -g create-react-app</span></strong></pre>
<ul>
<li>The Bootstrap framework.</li>
<li>Knowledge of ES6, HTML, and CSS. In this chapter, we will use HTML forms in more than one component.</li>
</ul>
<p>The code and files for this chapter can be found in GitHub: <a href="https://github.com/PacktPublishing/Hands-On-Full-Stack-Development-with-Go/tree/master/Chapter05">https://github.com/PacktPublishing/Hands-On-Full-Stack-Development-with-Go/tree/master/Chapter05</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Building GoMusic</h1>
                </header>
            
            <article>
                
<p>Now it's time to build our online store. Our first step is to use the Create React App tool to create a new React application. Open your Terminal, navigate to the folder where you would like the GoMusic application to live, then run the following command:</p>
<pre class="p1"><strong><span class="s1">create-react-app gomusic</span></strong></pre>
<p>This command will create a new folder, called <kbd>gomusic</kbd>, which will contain a skeleton React application waiting to be constructed.</p>
<p>Now navigate to your <kbd>gomusic</kbd> folder using the following command:</p>
<pre><strong>cd gomusic</strong></pre>
<p>Inside, you'll find three folders: <kbd>node_modules</kbd>, <kbd>public</kbd>, and <kbd>src</kbd>. Before we start writing our application, we'll need to remove some files from the <kbd>src</kbd> folder.</p>
<p><span>Delete the following files f</span>rom the <kbd>src</kbd> folder:</p>
<ul>
<li><kbd>app.css</kbd></li>
<li><kbd>index.css</kbd></li>
<li><kbd>logo.svg</kbd></li>
</ul>
<p>Next, we'll need to go the <kbd>public</kbd> folder. To make things simpler, replace the contents of your<span> </span><kbd>public</kbd><span> </span>folder with those found at our project's GitHub page: <a href="https://github.com/PacktPublishing/Hands-On-Full-Stack-Development-with-Go/tree/master/Chapter05/public">https://github.com/PacktPublishing/Hands-On-Full-Stack-Development-with-Go/tree/master/Chapter05/public</a>.</p>
<p>The contents of the GitHub page contain images that we'll be using in our project, the JSON files that will describe our data, as well as the modified HTML file, which will include support for jQuery and the Bootstrap frameworks.</p>
<p>In the next section, we'll take a look at the main pages in our application. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Main pages</h1>
                </header>
            
            <article>
                
<p>The main pages of our GoMusic application are the pages that all users should see, whether they are logged into their GoMusic accounts or not. There are three main pages:</p>
<ul>
<li>The products page, which is our <span class="packt_screen">Home</span> page</li>
<li>The <span class="packt_screen">Promotions</span> page</li>
<li>The <span class="packt_screen">About</span> page</li>
</ul>
<p>The first page is the products page. Here is how it looks:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fb61c556-8d60-44ee-8a41-d2795df9169f.png" style="width:87.25em;height:58.50em;"/></p>
<p>As shown in the preceding screenshot, we will support a navigational menu that will allow us to navigate between the three main pages. The <span class="packt_screen">Home</span> option will host the products page, which all users should see.</p>
<p>The second page is our <span class="packt_screen">Promotions</span> page, which should look very similar to the <span class="packt_screen">Home</span> page, except that it will show less products with lower prices. The prices in this page should show up in red to emphasize the sale:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6e20430b-b2e4-4116-bf7a-8b7bf3f1a330.png"/></p>
<p>The third page is our <span class="packt_screen">About</span> page, which should just show some information about the GoMusic store:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a4c77508-5609-4b60-8292-8a46ff6ff9b7.png"/></p>
<p>You probably also noticed the <span class="packt_screen">Sign in</span> option at the rightmost edge of our navigational menu; this option will open up a modal dialog window, which will allow our users to create accounts and sign in. We'll be covering the modal dialog windows in the <em>Modal dialog windows and handling credit cards</em> section. For each of our main pages, we'll create a React component to represent it.</p>
<p><span>Create the following files</span> in the <kbd>src</kbd> folder:</p>
<ul>
<li><kbd>Navigations.js</kbd>: This file will host the code for the navigational menu component.</li>
<li><kbd>ProductCards.js</kbd>: This file will host the code for the <span class="packt_screen">Home</span> and <span class="packt_screen">Promotions</span> page components.</li>
<li><kbd>About.js</kbd>: This file will host the code for the <span class="packt_screen">About</span> page component.</li>
</ul>
<p>Now, let's start with the navigational menu component.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The navigational menu</h1>
                </header>
            
            <article>
                
<p>The first component that we need to build to connect all our main pages together would be the navigational menu:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4508412b-cda0-4f01-ae30-ff0e00e0766d.png" style="width:48.92em;height:3.17em;"/></p>
<p>In the React framework, in order to build a functioning navigational menu with ease, we need to make use of the power of a package called<span> </span><kbd>react-router-dom</kbd>. To install this package, open your Terminal, then run the following command:</p>
<pre><strong>npm install --save react-router-dom</strong></pre>
<p>Once the package is installed, we can make use of it in our code. Now, let's open up the<span> </span><kbd>Navigation.js</kbd><span> </span>file and start writing some code.</p>
<p>The first thing we need to do is to import the packages that we need to build our menu. We'll utilize two packages:</p>
<ul>
<li>The<span> </span><kbd>react</kbd><span> </span>package</li>
<li>The<span> </span><kbd>react-router-dom</kbd><span> </span>package</li>
</ul>
<p>We will need to export a class called<span> </span><kbd>NavLink</kbd><span> </span>from<span> </span><kbd>react-router-dom</kbd>. The<span> </span><kbd>NavLink</kbd><span> </span>class is a React component that we can use in our code in order to create links that can navigate to other React components:</p>
<pre>import React from 'react';<br/>import {NavLink} from 'react-router-dom';</pre>
<div>
<p>Next, we need to create a new React component called<span> </span><kbd>Navigation</kbd>. Here's how it looks:</p>
<pre>export default class Navigation extends React.Component{<br/>}</pre>
<p>Inside our new component, we'll need to override the<span> </span><kbd>render()</kbd><span> </span>method, as mentioned in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml"/><a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>, in order to write the view of the component:</p>
<pre>export default class Navigation extends React.Component{<br/>    render(){<br/>        //The code to describe how our menu would look like<br/>    }<br/>}</pre>
<p>Inside our<span> </span><kbd>render()</kbd><span> </span>method, we'll make use of the Bootstrap framework in combination with the<span> </span><kbd>NavLink</kbd><span> </span>component that we imported, in order to build our navigational menu. Here is how the code inside the<span> </span><kbd>render()</kbd><span> </span>method should look:</p>
<pre>export default class Navigation extends React.Component{<br/>    render(){<br/>        //The code to describe how our menu would look like<br/>         return (<br/>            &lt;div&gt;<br/>                &lt;nav className="navbar navbar-expand-lg navbar-dark bg-success fixed-top"&gt;<br/>                    &lt;div className="container"&gt;<br/>                       &lt;button type="button" className="navbar-brand order-1 btn btn-success"  onClick={() =&gt; { this.props.showModalWindow();}}&gt;Sign in&lt;/button&gt;<br/>                        &lt;div className="navbar-collapse" id="navbarNavAltMarkup"&gt;<br/>                            &lt;div className="navbar-nav"&gt;<br/>                                &lt;NavLink className="nav-item nav-link" to="/"&gt;Home&lt;/NavLink&gt;<br/>                                &lt;NavLink className="nav-item nav-link" to="/promos"&gt;Promotions&lt;/NavLink&gt;                             <br/>                                &lt;NavLink className="nav-item nav-link" to="/about"&gt;About&lt;/NavLink&gt;<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/nav&gt;<br/>            &lt;/div&gt;<br/>        );<br/>  }<br/>}</pre>
<p>The code makes use of the Bootstrap framework to style and build the navigation bar. Also, when the <strong><span class="packt_screen">Sign in</span></strong> button gets clicked, we invoke a function called <kbd>showModalWindow()</kbd>, which is expected to get passed to us as a React prop. The job of this function is to show the <span class="packt_screen">Sign in</span> modal window:</p>
<pre>&lt;button type="button" className="navbar-brand order-1 btn btn-success" onClick={() =&gt; { <strong>this.props.showModalWindow()</strong>;}}&gt;Sign in&lt;/button&gt;</pre>
<p>Perfect: with the preceding code out of the way, we now have a functional component that can be utilized to show the navigational menu. <span> We will explore this function in the </span><em>The user page navigational menu</em><span> section.</span></p>
<p>Let's take a look at the Products and Promotions page in the next section.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Products and Promotions pages</h1>
                </header>
            
            <article>
                
<p>Now let's move to writing the product's page component. The code is similar to the products page that we wrote in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a><span>, </span><em>Frontend with React.js</em>. Let's open the <kbd>ProductsCards.js</kbd> file, then write the following code:</p>
<pre>import React from 'react';<br/><br/>class Card extends React.Component {<br/>    render() {<br/>        const priceColor = (this.props.promo)? "text-danger" : "text-dark";<br/>        const sellPrice = (this.props.promo)?this.props.promotion:this.props.price;<br/>        return (<br/>            &lt;div className="col-md-6 col-lg-4 d-flex align-items-stretch"&gt;<br/>                &lt;div className="card mb-3"&gt;<br/>                    &lt;img className="card-img-top" src={this.props.img} alt={this.props.imgalt} /&gt;<br/>                    &lt;div className="card-body"&gt;<br/>                        &lt;h4 className="card-title"&gt;{this.props.productname}&lt;/h4&gt;<br/>                        Price: &lt;strong className={priceColor}&gt;{sellprice}&lt;/strong&gt;<br/>                        &lt;p className="card-text"&gt;{this.props.desc}&lt;/p&gt;<br/>                        &lt;a className="btn btn-success text-white"  onClick={()=&gt;{this.props.showBuyModal(this.props.ID,sellPrice)}}&gt;Buy&lt;/a&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</pre>
<p>The preceding code represents a single product card component. It makes use of Bootstrap to style our card.</p>
<p>The code is almost the same as the product cards we built in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a><span>, </span><em>Frontend with React.js</em>, except for few differences:</p>
<ul>
<li>We changed the <span class="packt_screen">Buy</span> button color to green by making use of Bootstrap's <kbd>.btn-success</kbd> class.</li>
<li>We added an option to change the <span class="packt_screen">Price</span> color through a variable called <kbd>priceColor</kbd>; the variable looks at a prop called <kbd>promo</kbd>. If <kbd>promo</kbd> is true, we'll use a red color; if the <kbd>promo</kbd> prop is false, we'll use the black color.</li>
<li>The <span class="packt_screen">Buy</span> button here opens up a modal window by calling the <kbd>showBuyModal()</kbd> function. We will discuss the modal windows in more detail in the <em>Modal dialog windows and handling credit cards</em> section.</li>
</ul>
<p><span>The code will produce two flavors of a product card based on the value of the </span><kbd>promo</kbd><span> prop. If the </span><kbd>promo</kbd><span> prop is false, the product card will look like this:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4cdf3f6f-514c-4f0b-88ed-66ddf67c6dc5.png" style="width:19.50em;height:27.58em;"/></p>
<p class="mce-root">If the <kbd>promo</kbd> prop is true, the product card will look like this:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e85115e3-357f-40f8-9cf1-f2123ce54c91.png" style="width:18.00em;height:35.67em;"/></p>
<p>The next thing we need to write in the <kbd>ProductsCards.js</kbd> file is the <kbd>CardContainer</kbd> component. This component will be responsible for showing the product cards together in one page. Here is our card container in action:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/64afa655-7a21-4362-b87a-36f8f5f0f608.png" style="width:53.08em;height:55.33em;"/></p>
<p>Let's create the component:</p>
<pre>export default class CardContainer extends React.Component{<br/>    //our code<br/>}</pre>
<p>The component should look very similar to the one we wrote in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a><span>, </span><em>Frontend with React.js</em>. The next step is to write the constructor of our component. This component will rely on a <kbd>state</kbd> object where the card's information is stored. Here is how the constructor should look:</p>
<pre>export default class CardContainer extends React.Component{<br/>    constructor(props) {<br/>        super(props);<br/>        this.state = {<br/>            cards: []<br/>        };<br/>    }<br/>}</pre>
<p>As per <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>, we put the card's information in a file called <kbd>cards.json</kbd>, which should now exist in our <kbd>public</kbd> folder. The file contains a JSON array of objects, where each object contains data about one card, such as ID, image, description, prices, and product name. Here is sample data from the file:</p>
<pre>[{<br/>    "id" : 1,<br/>    "img" : "img/strings.png",<br/>    "imgalt":"string",<br/>    "desc":"A very authentic and beautiful instrument!!",<br/>    "price" : 100.0,<br/>    "productname" : "Strings"<br/>}, {<br/>    "id" : 2,<br/>    "img" : "img/redguitar.jpeg",<br/>    "imgalt":"redg",<br/>    "desc":"A really cool red guitar that can produce super cool music!!",<br/>    "price" : 299.0,<br/>    "productname" : "Red Guitar"<br/>},{<br/>    "id" : 3,<br/>    "img" : "img/drums.jpg",<br/>    "imgalt":"drums",<br/>    "desc":"A set of super awesome drums, combined with a guitar, they can product more than amazing music!!",</pre>
<pre>"price" : 17000.0,<br/>    "productname" : "Drums"<br/>}]</pre>
<p>In the <kbd>public</kbd> folder of GoMusic, we also added a file called <kbd>promos.json</kbd>, which hosts data about sales and promotions. The data in <kbd>promos.json</kbd> is in the same data format as <kbd>cards.json</kbd>. </p>
<p><span>Now, with the <kbd>CardContainer</kbd> constructor out of the way, we need to override the </span><kbd>componentDidMount()</kbd><span> method, in order to write the code to obtain the card data from either </span><kbd>cards.json</kbd><span>, or</span> <kbd>promos.json</kbd><span>. When showing the main products page, we'll obtain our product card's data from</span> <kbd>cards.json</kbd><span>. Whereas, when showing the promos and sales page, we'll obtain our product card's data from</span> <kbd>promos.json</kbd><span>. Since the source of the card data is not unique, we'll use a</span> prop <span>for this purpose. Let's call the</span> prop<span> <kbd>location</kbd>. Here is how the code will look:</span></p>
<pre>componentDidMount() {<br/> fetch(this.props.location)<br/> .then(res =&gt; res.json())<br/> .then((result) =&gt; {<br/> this.setState({<br/> cards: result<br/> });<br/> });<br/>}</pre>
<p>In the preceding code, we utilized the popular <kbd>fetch()</kbd> method to retrieve data from the address stored in <kbd>this.props.location</kbd>. If we are viewing the main products page, the value of location will be <kbd>cards.json</kbd>. If we are viewing the <span class="packt_screen">Promotions</span> page, the value of location will be <kbd>promos.json</kbd>. Once we retrieve the card data, we'll store it in the <kbd>state</kbd> object of our <kbd>CardContainer</kbd> component.</p>
<p>Finally, let's write the <kbd>render()</kbd> method of our <kbd>CardContainer</kbd> method. We will get the product cards from our component's <kbd>state</kbd> object, then feed the product cards' data as props to our <kbd>Card</kbd> components. Here is how the code will look:</p>
<pre>render(){<br/>        const cards = this.state.cards;<br/>        let items = cards.map(<br/>            card =&gt; &lt;Card key={card.id} {...card} promo={this.props.promo} showBuyModal={this.props.showBuyModal}  /&gt;<br/>        );<br/>        return (<br/>            &lt;div&gt;<br/>                &lt;div className="mt-5 row"&gt;<br/>                    {items}<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        );<br/>}</pre>
<p>We also pass the <kbd>showBuyModal</kbd> prop to the card component; this prop represents the function that we will implement in the <em>Creating a parent StripeProvider component</em> section to open the buy modal window. The <kbd>showBuyModal</kbd> function will be expected to take the product ID represented as the card, as well as the selling price of the product, as input. </p>
<p>The preceding code is very similar to the <kbd>CardContainer</kbd> code we wrote in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>. The only addition is that we now also pass a <kbd>promo</kbd> prop to the <kbd>Card</kbd> component. The <kbd>promo</kbd> prop lets us know whether the product card in question is a promotion. </p>
<p>Let's take a look at the <span class="packt_screen">About</span> page in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The About page</h1>
                </header>
            
            <article>
                
<p>Now let's add an <span class="packt_screen">About</span> page. Here's how it will look:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/94e17a90-408f-4205-85a1-e1aa85de6785.png" style="width:48.50em;height:12.58em;"/></p>
<p>Let's navigate to the <kbd>src</kbd> folder in our project. Create a new file called <kbd>About.js</kbd>. We'll start by importing the <kbd>react</kbd> package:</p>
<pre>import React from 'react';</pre>
<p>Next, we need to write a React component. Typically, we'd create a new class that would inherit from <kbd>React.Component</kbd>. However, we'll explore a different coding style that would be better suited to the <span class="packt_screen">About</span> page.</p>
<p>For simpler components, where a full class is not needed, we simply use what is known as <em>functional components</em>.  Here is how the <kbd>About</kbd> component would look when written as a functional component:</p>
<pre>export default function About(props){<br/>    return (<br/>        &lt;div className="row mt-5"&gt;<br/>            &lt;div className="col-12 order-lg-1"&gt;<br/>                &lt;h3 className="mb-4"&gt;About the Go Music Store&lt;/h3&gt;<br/>                &lt;p&gt;Go music is a modern online musical instruments store&lt;/p&gt;<br/>                &lt;p&gt;Explore how you can combine the power of React and Go, to build a fast and beautiful looking online store.&lt;/p&gt;<br/>                &lt;p&gt;We will cover how to build this website step by step.&lt;/p&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;);<br/>}</pre>
<p>A functional component is just a function that takes a props object as an argument. The function returns a JSX object that represents the view that we would like the component to show. The preceding code is equivalent to writing a class that inherits from <kbd>React.Component</kbd>, then overriding the <kbd>render()</kbd> method to return our view. </p>
<p>In more recent versions of React, a functional component can support a <kbd>state</kbd> object, through a feature known as React <em>Hooks</em>. A React Hook gives you the ability to initialize and utilize a state in a functional component. Here is a simple example of a <kbd>state</kbd> counter from the React documentation:</p>
<pre> import React, { useState } from 'react';<br/><br/>function Example() {<br/>  // Declare a new state variable, which we'll call "count"<br/>  const [count, setCount] = useState(0);<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;p&gt;You clicked {count} times&lt;/p&gt;<br/>      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;<br/>        Click me<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</pre>
<p>We do not use React Hooks in our code here. However, if you are curious about the feature, you can explore it by visiting <a href="https://reactjs.org/docs/hooks-intro.html">https://reactjs.org/docs/hooks-intro.html</a>.</p>
<p>Before we move to the next section, it's worth mentioning that the <kbd>Card</kbd> component could have been written as a functional component as well, since it was relatively simple, and didn't need a constructor or any special logic beyond the <kbd>render()</kbd> method. </p>
<p>Now, let's talk about how to build dialog windows in our React app.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Modal dialog windows and handling credit cards</h1>
                </header>
            
            <article>
                
<p>Now it's time to cover the modal windows in our website. A modal window is a small temporary window that is overlaid on your main website. There are two main modal windows that we need to build:</p>
<ul>
<li><span>The <span class="packt_screen">Buy</span> <span class="packt_screen">Item</span> modal window</span></li>
<li>The <span class="packt_screen">Sign in</span> modal window</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Buy Item modal window outline</h1>
                </header>
            
            <article>
                
<p>Let's start with the <span class="packt_screen">Buy Item</span> modal window. This modal window should show up when a user clicks on the <span class="packt_screen">Buy</span> button of a product card; in other words, when you click on the <span class="packt_screen">Buy</span><em> </em>button:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6cb99759-1151-4091-a709-4d76298a110d.png" style="width:15.42em;height:22.75em;"/></p>
<p>Once the <span class="packt_screen">Buy</span> button is clicked, the following modal window should appear:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/00abbfb0-a09d-4210-860b-a2e95e38c0c6.png" style="width:48.67em;height:25.83em;"/></p>
<p>As you can see, the modal is basically a smaller window that showed up over our main website. It allows the user to input some important data before going back to the main website. Modal windows are very powerful tools in any modern website, so let's start writing one. The modal window we are building today needs to be capable of taking credit card information.</p>
<p>Before we start writing code, we'll need to install an important package called <kbd>reactstrap</kbd>. This package exposes features offered by the bootstrap framework through React components; it has a very handy <kbd>Modal</kbd> component that we can use to build reactive modal windows. Let's run the following command from our favorite Terminal. The command can be executed from the project's main folder:</p>
<pre><strong>npm install --save reactstrap</strong> </pre>
<p>The first step is to go to the <kbd>src</kbd> folder, then create a new file called <kbd>modalwindows.js</kbd>. This file is where we will write all of our modal windows. Next, let's import the React library:</p>
<pre>import React from 'react';</pre>
<p>We then import the modal-related components from the <kbd>reactstrap</kbd> package:</p>
<pre>import { Modal, ModalHeader, ModalBody } from 'reactstrap';</pre>
<p>Since we are starting with the <span class="packt_screen">Buy Item</span> modal window, let's write a React component called <kbd>BuyModalWindow</kbd>: </p>
<pre>export class BuyModalWindow extends React.Component{<br/>}</pre>
<p>We use the <kbd>export</kbd> keyword here, because this class will need to be exported to other files. Again, we will make use of the power of the Bootstrap frontend framework to build our modal window. When we wrote our <kbd>Card</kbd> component, we designed our <kbd>Buy</kbd> button to open a modal window with the <kbd>#buy</kbd> ID. So, here is our <kbd>#buy</kbd> modal window:</p>
<pre>export class BuyModalWindow extends React.Component{<br/>    render() {<br/>        return (<br/>         &lt;Modal id="buy" tabIndex="-1" role="dialog" isOpen={props.showModal} toggle={props.toggle}&gt;<br/>            &lt;div role="document"&gt;<br/>                &lt;ModalHeader toggle={props.toggle} className="bg-success text-white"&gt;<br/>                    Buy Item<br/>                &lt;/ModalHeader&gt;<br/>                &lt;ModalBody&gt;<br/>                      {/*Credit card form*/}<br/>                &lt;/ModalBody&gt;<br/>            &lt;/div&gt;<br/>        &lt;/Modal&gt;<br/>        );<br/>    }<br/>}</pre>
<p>In the preceding code, we built a React component that encapsulates a nice modal window with a green header, a Close button, and an empty body. The <kbd>Credit card form</kbd> code is not included yet; we'll get to that in the <em>Credit card handling with React and Stripe</em> section. The code makes use of the <kbd>Modal</kbd> component, which is provided by the <kbd>reactstrap</kbd> package. The <kbd>reactstrap</kbd> package also provides a <kbd>ModalHeader</kbd> component for us to specify how the modal header will look, as well as a <kbd>ModalBody</kbd> component to define the body of our modal window.</p>
<p>The <kbd>Modal</kbd> component hosts two very important React props that we need to address:</p>
<ul>
<li><strong>The</strong> <kbd>isOpen</kbd> <strong>prop</strong>: A Boolean that needs to be set to true when we need the modal to show up, otherwise the value is false</li>
<li><strong>The</strong> <kbd>toggle</kbd> <strong>prop</strong>: A callback function that is used to toggle the value of <kbd>isOpen</kbd> when needed</li>
</ul>
<p>Let's do a quick tweak to our code first. Since the <kbd>BuyModalWindow</kbd> component doesn't include any other methods besides the <kbd>render()</kbd> method, we can write it as a functional component:</p>
<pre>export function BuyModalWindow(props){<br/>  return (<br/>         &lt;Modal id="buy" tabIndex="-1" role="dialog" isOpen={props.showModal} toggle={props.toggle}&gt;<br/>            &lt;div role="document"&gt;<br/>                &lt;ModalHeader toggle={props.toggle} className="bg-success text-white"&gt;<br/>                    Buy Item<br/>                &lt;/ModalHeader&gt;<br/>                &lt;ModalBody&gt;<br/>                      {/*Credit card form*/}<br/>                &lt;/ModalBody&gt;<br/>            &lt;/div&gt;<br/>         &lt;/Modal&gt;<br/>        );<br/>}</pre>
<p>Perfect, now let's fill the empty body of our modal window. We need to write a <kbd>Credit card form</kbd> to be the body of our modal window. </p>
<p>In the next section we'll take a look at credit card handling for our application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Credit card handling with React and Stripe</h1>
                </header>
            
            <article>
                
<p>The idea of building a form that just takes credit card information might sound simple at first. However, the process involves more than just building a bunch of text boxes. In production environments, we need to be able to validate the information being entered to the credit card, and we need to figure out a secure way to handle credit card data. Since credit card information is extremely sensitive, we cannot treat it simply like any other piece of data. </p>
<p>Luckily, there are several services out there that you can use to handle credit cards in your frontend code. In this chapter, we'll make use of Stripe (<a href="https://stripe.com/">https://stripe.com/</a>), which is one of the most popular services for handling payments with credit cards. Like almost any other web service in a production environment, you would need to visit its website, create an account, and get an API key to use in your product code. With Stripe, the registration also involves providing your business bank account so that they can deposit money into your account. </p>
<p>However, they also provide some test API keys that we can utilize for development and initial testing, which is what we'll be utilizing today. </p>
<p>Stripe helps with every step involved in charging credit cards in your application. Stripe validates credit cards, charges them with the approved amounts you provide, and then puts that money in your business bank account.</p>
<p>In order to fully integrate Stripe or almost any other payment service with your code, you need to write code at the frontend and the backend. In this chapter, we'll be covering most of the code needed at the frontend. We'll be visiting this topic again at a later chapter when working on the backend, in order to write the full integration. Let's get started.</p>
<p>Due to the huge popularity of the React frontend framework, Stripe provides special React libraries and APIs that we can use to design visual elements that can take credit card data. These visual elements are known as React Stripe elements (<a href="https://github.com/stripe/react-stripe-elements">https://github.com/stripe/react-stripe-elements</a>). </p>
<p>React Stripe elements provide the following functionalities:</p>
<ul>
<li>They provide some UI elements that can take credit card data, such as credit card numbers, expiry dates, CVC numbers, and ZIP codes.</li>
<li>They can do advanced validation on the data entered. For example, for credit card fields, they can tell whether a Master Card or Visa is being entered.</li>
<li>After Stripe elements accept the data provided to them, they give you a token ID that represents the credit card in question and you can then enter this token ID in the backend to use the card in your application.</li>
</ul>
<p>Perfect. So, now that we have enough background about Stripe, let's start writing some code.</p>
<p>There are a number of steps that you must cover in your code in order to properly integrate credit card handling with your frontend code:</p>
<ol>
<li>Create a React component to host your <kbd>Credit card form</kbd> code. Let's call it the <kbd>child</kbd><em> </em>React component; you'll see very shortly why it's a <kbd>child</kbd> component.</li>
<li>Inside that component, make use of the Stripe elements, which are just some React components provided by Stripe in order to build the credit card input fields. These fields are simply the text boxes that take credit card information, such as the credit card number and expiry date.</li>
<li>Inside this <kbd>child</kbd> component, write the code to submit the validated credit card token to the backend.</li>
<li>Create another React component. This component will act as a parent to the React component that hosted the Stripe elements. The parent React component will need to do the following:
<ul>
<li>Host a stripe component that processes Stripe's API key, also known as <kbd>StripeProvider</kbd>.</li>
<li>Inside the <kbd>StripeProvider</kbd> component, you need to host the <kbd>child</kbd> React component.</li>
<li>Before you can host the <kbd>child</kbd> React component, you need to inject it<em> </em>with special Stripe code that wraps it with Stripe props and functions. The method to inject a component with Stripe code is called <kbd>injectStripe</kbd>.</li>
</ul>
</li>
</ol>
<p>Let's implement the preceding steps one by one.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a child React component to host Stripe elements</h1>
                </header>
            
            <article>
                
<p>First, we need to install the Stripe react packages. In the Terminal, we need to navigate to our <kbd>gomusic</kbd> project folder, then run the following command:</p>
<pre><strong>npm install --save react-stripe-elements</strong></pre>
<p>Next, let's visit the <kbd>index.html</kbd> file located at <kbd>frontend/public/index.html</kbd>. Then, right before the HTML closing tag, which is the line right before <kbd>&lt;/head&gt;</kbd>, type <kbd>&lt;script src="https://js.stripe.com/v3/"&gt;&lt;/script&gt;</kbd>. This will ensure the Stripe code will be loaded when the end user loads our GoMusic application in their browser.</p>
<p>Now let's write some code. Inside our <kbd>src</kbd> folder, let's create new file called <kbd>CreditCards.js</kbd>. We start by importing the packages that we need for our incoming code to work:</p>
<pre>import React from 'react';<br/>import { injectStripe, StripeProvider, Elements, CardElement } from 'react-stripe-elements';</pre>
<p>Time to write our <kbd>child</kbd> React component, which will host our credit card form:</p>
<pre>class CreditCardForm extends React.Component{<br/>    constructor(props){<br/>        super(props);<br/>    }<br/>}</pre>
<p>In order for our code to be as realistic as possible, we need to adhere to the three states associated with processing a credit card:</p>
<ul>
<li><strong>Initial status</strong>: No cards have been processed yet.</li>
<li><strong>Success status</strong>: Card has been processed and succeeded.</li>
<li><strong>Failed status</strong>: Card has been processed but failed.</li>
</ul>
<p>Here is the code to represent these three states:</p>
<pre>const INITIALSTATE = "INITIAL", SUCCESSSTATE = "COMPLETE", FAILEDSTATE = "FAILED";<br/>class CreditCardForm extends React.Component{<br/>    constructor(props){<br/>        super(props);<br/>    }<br/>}</pre>
<p>Next, let's write three methods to represent the three states:</p>
<pre>const INITIALSTATE = "INITIAL", SUCCESSSTATE = "COMPLETE", FAILEDSTATE = "FAILED";<br/>class CreditCardForm extends React.Component{<br/>    constructor(props){<br/>        super(props);<br/>    }<br/>    renderCreditCardInformation() {}<br/>    renderSuccess() {}<br/>    renderFailure(){}   <br/>}</pre>
<p>These three methods will be called based on our current status. We need to save our current state in our React <kbd>state</kbd> object so that we can retrieve it at any time inside our component:</p>
<pre>const INITIALSTATE = "INITIAL", SUCCESSSTATE = "COMPLETE", FAILEDSTATE = "FAILED";<br/>class CreditCardForm extends React.Component{<br/>    constructor(props){<br/>        super(props);<br/>        this.state = {<br/>            status: INITIALSTATE<br/>        };<br/>    }<br/>    renderCreditCardInformation() {}<br/>    renderSuccess() {}<br/>    renderFailure(){}   <br/>}</pre>
<p>The status will change based on the success or failure of the credit card transaction. It's time to write the <kbd>render()</kbd> method of our React component. Our <kbd>render()</kbd> method will simply look at our current status by inspecting <kbd>this.state.status</kbd>, then based on the status, it will render the appropriate view:</p>
<pre>const INITIALSTATE = "INITIAL", SUCCESSSTATE = "COMPLETE", FAILEDSTATE = "FAILED";<br/>class CreditCardForm extends React.Component{<br/>    constructor(props){<br/>        super(props);<br/>        this.state = {<br/>            status: INITIALSTATE<br/>        };<br/>    }<br/>    renderCreditCardInformation() {}<br/>    renderSuccess() {}<br/>    renderFailure(){}   <br/>    <br/>    render() {<br/>        let body = null;<br/>        switch (this.state.status) {<br/>            case SUCCESSSTATE:<br/>                body = this.renderSuccess();<br/>                break;<br/>            case FAILEDSTATE:<br/>                body = this.renderFailure();<br/>                break;<br/>            default:<br/>                body = this.renderCreditCardInformation();<br/>        }<br/><br/>        return (<br/>            &lt;div&gt;<br/>                {body}<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</pre>
<p>What's left is to write the code for the three render methods. Let's start with the most complex, which is <kbd>renderCreditCardInformation()</kbd>. This is where we'll use the Stripe element components. Here is the view that this method needs to produce:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d3426980-6d5b-4a93-b980-63684bfd9f9b.png" style="width:22.92em;height:22.25em;"/></p>
<p>We'll start by writing the JSX elements that represent the <strong><span class="packt_screen">Use Saved Card?</span></strong> button at the beginning as well as the <strong><span class="packt_screen">Remember Card?</span></strong> checkbox close to the end. We'll write those elements separately because later we'll need to hide them from users who are not logged in:</p>
<pre>renderCreditCardInformation() {<br/>        const usersavedcard = &lt;div&gt;<br/>            &lt;div className="form-row text-center"&gt;<br/>                &lt;button type="button" className="btn btn-outline-success text-center mx-auto"&gt;Use saved card?&lt;/button&gt;<br/>            &lt;/div&gt;<br/>            &lt;hr /&gt;<br/>        &lt;/div&gt;<br/><br/>        const remembercardcheck = &lt;div className="form-row form-check text-center"&gt;<br/>            &lt;input className="form-check-input" type="checkbox" value="" id="remembercardcheck" /&gt;<br/>            &lt;label className="form-check-label" htmlFor="remembercardcheck"&gt;<br/>                Remember Card?<br/>            &lt;/label&gt;<br/>        &lt;/div&gt;;<br/>        //return the view<br/>    }</pre>
<p>In the preceding code, we again used the Bootstrap framework to design the button and the checkbox. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making use of Stripe elements to handle credit card information</h1>
                </header>
            
            <article>
                
<p>Now it's time to design the user interface for the credit card payment information. Here is the piece that we need to build:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1501a47b-6104-4012-ab65-a2d5ccd7c68d.png" style="width:26.50em;height:12.67em;"/></p>
<p>The most interesting part is the <span class="packt_screen">Card Information</span> field:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4fd4e940-f530-4ad4-8d1b-d760a3aa288d.png" style="width:23.75em;height:2.83em;"/></p>
<p>This is where we'll make use of the Stripe elements components, in order to integrate Stripe's UI and validation with our user interface. If you recall, there is a package called <kbd>CardElement</kbd> that we imported at the beginning of our <kbd>CreditCards.js</kbd> file. <kbd>CardElement</kbd> is nothing but a React component that is provided by Stripe in order to build credit card field UIs in your React applications. This is our Stripe element that we'll be using in our code. We can simply utilize it through JSX like any other component:</p>
<pre>&lt;CardElement\&gt;</pre>
<p>Stripe elements components support a prop called <kbd>style</kbd>, which allows you to define how the style of the element should look. The <kbd>style</kbd> prop takes a JavaScript object that defines how the style should look for the Stripe element. The following code shows a <kbd>style</kbd> object that looks right at home with the Bootstrap framework visually:</p>
<pre>const style = {<br/>     base: {<br/>         'fontSize': '20px',<br/>         'color': '#495057',<br/>         'fontFamily': 'apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif'<br/>     }<br/> };</pre>
<p>For our card's Stripe element to take the preceding <kbd>style</kbd> object, we just need to do this:</p>
<pre>&lt;CardElement style={style}/&gt;</pre>
<p>Perfect. Now let's build the rest of our <kbd>renderCreditCardInformation()</kbd> method. With the Stripe card element out of the way, we need to build the HTML form that will host the Stripe card element along with the <span class="packt_screen">Name On Card</span> field in our credit card pay modal window. Here is the JSX code for the UI:</p>
<pre>&lt;div&gt;<br/>               <br/>                &lt;h5 className="mb-4"&gt;Payment Info&lt;/h5&gt;<br/>                &lt;form&gt;<br/>                    &lt;div className="form-row"&gt;<br/>                        &lt;div className="col-lg-12 form-group"&gt;<br/>                            &lt;label htmlFor="cc-name"&gt;Name On Card:&lt;/label&gt;<br/>                            &lt;input id="cc-name" name='cc-name' className="form-control" placeholder='Name on Card' onChange={this.handleInputChange} type='text' /&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-row"&gt;<br/>                        &lt;div className="col-lg-12 form-group"&gt;<br/>                            &lt;label htmlFor="card"&gt;Card Information:&lt;/label&gt;<br/>                            &lt;CardElement id="card" className="form-control" style={style} /&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>             <br/>                &lt;/form&gt;<br/>&lt;/div&gt;</pre>
<p>The preceding code only shows an HTML form that hosts the <span><span class="packt_screen">Name On Card</span></span> as well as the card element visual component. We also made use of a method called <kbd>handleInputChange()</kbd>, which triggers when we input the <span><span class="packt_screen">Name On Card</span></span> field. This method changes the <kbd>state</kbd> object of our component based on the new <span><span class="packt_screen">Name On Card</span></span> value of our HTML form. This is the recommended React way to handle forms—create state to correspond to your HTML form values:</p>
<pre>handleInputChange(event) {<br/>     this.setState({<br/>         value: event.target.value<br/>     });<br/> }</pre>
<p>It's time to write the full code for the credit card information window, including the <strong><span class="packt_screen">Remember Card?</span></strong> and <strong><span class="packt_screen">Use Saved Card?</span></strong> options. Here's how the full <kbd>renderCreditCardInformation()</kbd> method should look:</p>
<pre>renderCreditCardInformation(){<br/>      const style = {<br/>            base: {<br/>                'fontSize': '20px',<br/>                'color': '#495057',<br/>                'fontFamily': 'apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif'<br/>            }<br/>        };<br/>        const usersavedcard = &lt;div&gt;<br/>            &lt;div className="form-row text-center"&gt;<br/>                &lt;button type="button" className="btn btn-outline-success text-center mx-auto"&gt;Use saved card?&lt;/button&gt;<br/>            &lt;/div&gt;<br/>            &lt;hr /&gt;<br/>        &lt;/div&gt;<br/><br/>        const remembercardcheck = &lt;div className="form-row form-check text-center"&gt;<br/>            &lt;input className="form-check-input" type="checkbox" value="" id="remembercardcheck" /&gt;<br/>            &lt;label className="form-check-label" htmlFor="remembercardcheck"&gt;<br/>                Remember Card?<br/>            &lt;/label&gt;<br/>        &lt;/div&gt;;<br/>        return (<br/>            &lt;div&gt;<br/>                {usersavedcard}<br/>                &lt;h5 className="mb-4"&gt;Payment Info&lt;/h5&gt;<br/>                &lt;form onSubmit={this.handleSubmit}&gt;<br/>                    &lt;div className="form-row"&gt;<br/>                        &lt;div className="col-lg-12 form-group"&gt;<br/>                            &lt;label htmlFor="cc-name"&gt;Name On Card:&lt;/label&gt;<br/>                            &lt;input id="cc-name" name='cc-name' className="form-control" placeholder='Name on Card' onChange={this.handleInputChange} type='text' /&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-row"&gt;<br/>                        &lt;div className="col-lg-12 form-group"&gt;<br/>                            &lt;label htmlFor="card"&gt;Card Information:&lt;/label&gt;<br/>                            &lt;CardElement id="card" className="form-control" style={style} /&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                    {remembercardcheck}<br/>                    &lt;hr className="mb-4" /&gt;<br/>                    &lt;button type="submit" className="btn btn-success btn-large" &gt;{this.props.operation}&lt;/button&gt;<br/>                &lt;/form&gt;<br/>            &lt;/div&gt;<br/>        );  <br/>}</pre>
<p><span>The preceding code makes use of our </span><kbd>remembercardcheck</kbd><span> and </span><kbd>usersavedcard</kbd><span> elements. We also assume that there is a method called </span><kbd>handleSubmit</kbd><span>, which will get triggered when our HTML form gets submitted. The <kbd>handleSubmit</kbd> method will be discussed in the <em>Submitting a credit card token to the backend</em> section.</span></p>
<p>Perfect. Now let's write up the remaining methods in our <kbd>CreditCardForm</kbd> component: <kbd>renderSuccess()</kbd> and <kbd>renderFailure()</kbd>. We'll start with <kbd>renderSuccess()</kbd>:</p>
<p> </p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/34404de7-ddde-47be-81c1-2f6c07ae7e22.png" style="width:25.08em;height:8.58em;"/></p>
<p>The code is simple:</p>
<pre>renderSuccess(){<br/>        return (<br/>            &lt;div&gt;<br/>                &lt;h5 className="mb-4 text-success"&gt;Request Successfull....&lt;/h5&gt;<br/>                &lt;button type="submit" className="btn btn-success btn-large" onClick={() =&gt; { this.props.toggle() }}&gt;Ok&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        );<br/>}</pre>
<p>The preceding code is linked to the <span class="packt_screen">Buy</span> modal window through the <kbd>toggle</kbd> method, which will get passed to our component here as a prop. As mentioned, the <kbd>toggle</kbd> method can be used to open or close a modal window. Since the modal window will be open when this code gets executed, the modal window will close once the <strong>Ok</strong> button is pressed. The full syntax for the <kbd>toggle</kbd> method will be defined later in our code, specifically when we cover the main code in the <kbd>App.js</kbd> file. </p>
<p>Here's how the <kbd>renderFailure()</kbd> method looks:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a1b2f258-b9f6-4ef1-b8ed-2118438c0208.png" style="width:23.58em;height:25.17em;"/></p>
<p>The code for the preceding UI looks like this:</p>
<pre>renderFailure(){<br/>        return (<br/>            &lt;div&gt;<br/>                &lt;h5 className="mb-4 text-danger"&gt; Credit card information invalid, try again or exit&lt;/h5&gt;<br/>                {this.renderCreditCardInformation()}<br/>            &lt;/div&gt;<br/>        );<br/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Submitting a credit card token to the backend</h1>
                </header>
            
            <article>
                
<p>Now let's go back to the <kbd>handleSubmit()</kbd> method, which should trigger whenever the credit card HTML form submits. When you make use of a Stripe element component, it not only validates the credit card information, but it also returns a <kbd>token</kbd> object that represents the credit card entered. This <kbd>token</kbd> object is what you'll use in the backend to charge this card.</p>
<p>The <kbd>handleSubmit()</kbd> method code needs to take care of a number of things:</p>
<ol>
<li>Retrieve the token that corresponds to the credit card entered</li>
<li>Send the token to our backend server</li>
<li>Render a success or a failure state based on the outcome</li>
</ol>
<p>Here's how the code will look:</p>
<pre>async handleSubmit(event){<br/>        event.preventDefault();<br/>        console.log("Handle submit called, with name: " + this.state.value);<br/>        //retrieve the token via Stripe's API<br/> let { token } = await this.props.stripe.createToken({ name: this.state.value });<br/>        if (token == null) {<br/>            console.log("invalid token");<br/>            this.setState({ status: FAILEDSTATE });<br/>            return;<br/>        }<br/><br/>        let response = await fetch("/charge", {<br/>            method: "POST",<br/>            headers: { "Content-Type": "text/plain" },<br/>            body: JSON.stringify({<br/>                token: token.id,<br/>                operation: this.props.operation,<br/>            })<br/>        });<br/>        console.log(response.ok);<br/>        if (response.ok) {<br/>            console.log("Purchase Complete!");<br/>            this.setState({ status: SUCCESSSTATE });<br/>        }<br/>}</pre>
<p>If you look closely at the preceding code, you will notice that we made use of a method called <kbd>this.props.stripe.createToken()</kbd>, which we assumed is embedded in our props, in order to retrieve the credit card token:</p>
<pre>let { token } = await this.props.stripe.createToken({ name: this.state.value });</pre>
<p>The method is called <kbd>createToken()</kbd>. We passed the <span><span class="packt_screen">Name On Card</span></span> value as an argument (which was stored in our <kbd>state</kbd> object). The <kbd>createToken()</kbd> method can only be available if we inject our React component with Stripe code. We will see how to do that in the next section.</p>
<p>We also made use of JavaScript's <kbd>fetch()</kbd> method, in order to send an HTTP <kbd>POST</kbd> request to relative URL. The <kbd>POST</kbd> request will include our Stripe token ID as well as the type of operation of the request. We pass an operation type here because I would like to use this request in the future to either take money from a card or save a card for later use. We'll be talking more about the other end of the <kbd>POST</kbd> request when it's time to cover the backend code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a parent StripeProvider component</h1>
                </header>
            
            <article>
                
<p>The next step is to create a parent component to host our <kbd>CreditCardForm</kbd> component.  Here is what we need to do:</p>
<ol>
<li>Inject our <kbd>CreditCardForm</kbd> component with the Stripe API code. This is done using the <kbd>injectStripe()</kbd>method.</li>
<li>Provide our Stripe API key to our component. This is done using the <kbd>StripeProvider</kbd> React component, which is provided by Stripe.</li>
<li>Host the <kbd>CreditCardForm</kbd> component inside our parent component. This is done using the <kbd>Elements</kbd> component.</li>
</ol>
<p>This will make much more sense when we see the code:</p>
<pre>export default function CreditCardInformation(props){<br/>    if (!props.show) {<br/>        return &lt;div/&gt;;<br/>    }<br/>   //inject our CreditCardForm component with stripe code in order to be able to make use of the createToken() method<br/>    const CCFormWithStripe = injectStripe(CreditCardForm);<br/>    return (<br/>        &lt;div&gt;<br/>            {/*stripe provider*/}<br/>            &lt;StripeProvider apiKey="pk_test_LwL4RUtinpP3PXzYirX2jNfR"&gt;<br/>                &lt;Elements&gt;<br/>                    {/*embed our credit card form*/}<br/>                    &lt;CCFormWithStripe operation={props.operation} /&gt;<br/>                &lt;/Elements&gt;<br/>            &lt;/StripeProvider&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</pre>
<p>The preceding code should exist in our <kbd>CreditCards.js</kbd> file, which also contained our <kbd>CreditCardForm</kbd> component code. We also passed the operation as a prop, which we then later used when we submitted the credit card request to our backend. Also notice <kbd>export default</kbd> at the beginning of our <kbd>CreditCardInformation</kbd> component definition. This is because we will be importing and using this component in other files. </p>
<p>Now that we've followed all the steps to write a credit card form that can integrate with Stripe, it's time to go back to our buy modal window to embed the credit card form in it. Our buy modal window existed in the <kbd>modalwindows.js</kbd> file. As a reminder, here is the code that we covered earlier for the buy modal window:</p>
<pre>export function BuyModalWindow(props) {<br/>    return (<br/>        &lt;Modal id="buy" tabIndex="-1" role="dialog" isOpen={props.showModal} toggle={props.toggle}&gt;<br/>            &lt;div role="document"&gt;<br/>                    &lt;ModalHeader toggle={props.toggle} className="bg-success text-white"&gt;<br/>                        Buy Item<br/>                    &lt;/ModalHeader&gt;<br/>                    &lt;ModalBody&gt;<br/>                            {/*Credit card form*/}<br/>                    &lt;/ModalBody&gt;<br/>                &lt;/div&gt;<br/>                      <br/>        &lt;/Modal&gt;<br/>    );<br/>} </pre>
<p>First we need to import the <span><kbd>CreditCardInformation</kbd> component to our</span> <kbd>modalwindows.js</kbd><span>. So, we need to add this line to the file:</span></p>
<pre>import CreditCardInformation from './CreditCards';</pre>
<p>All that we need to do now is to embed our <kbd>CreditCardInformation</kbd> component in the modal body:</p>
<pre>export function BuyModalWindow(props) {<br/>    return (<br/>        &lt;Modal id="buy" tabIndex="-1" role="dialog" isOpen={props.showModal} toggle={props.toggle}&gt;<br/>            &lt;div role="document"&gt;<br/>                    &lt;ModalHeader toggle={props.toggle} className="bg-success text-white"&gt;<br/>                        Buy Item<br/>                    &lt;/ModalHeader&gt;<br/>                    &lt;ModalBody&gt;<br/><strong>                      &lt;CreditCardInformation show={true} operation="Charge" toggle={props.toggle} /&gt;</strong><br/>                    &lt;/ModalBody&gt;<br/>                &lt;/div&gt;<br/>                      <br/>        &lt;/Modal&gt;<br/>    );<br/>} <br/><br/></pre>
<p>And with that, we are done with the <span class="packt_screen">Buy</span> modal window. Now let's move to the <span class="packt_screen">Sign in</span> window.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Sign in and Register modal windows</h1>
                </header>
            
            <article>
                
<p>Before we jump into the code, let's first explore how the <span class="packt_screen">Sign in</span> and <span class="packt_screen">Register</span> modal windows should look. Click on the <span class="packt_screen">Sign in</span> button in our navigation bar:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d54c8e8-b16c-4608-8d7a-99789cee34bf.png" style="width:42.75em;height:22.75em;"/></p>
<p>The following modal window should appear:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4b24d1a4-8e05-477c-9980-a887c6689b72.png" style="width:31.58em;height:26.83em;"/></p>
<p class="mce-root"/>
<p>If we click on the <strong><span class="packt_screen">New User? Register</span></strong> link, the modal window should expand to show the registration form for new users:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e291409c-aadb-47df-8973-3e5b5a8e081c.png" style="width:29.58em;height:31.67em;"/></p>
<p>In order to build those modal windows correctly, we need to cover how to properly handle forms with multiple inputs in the React framework.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Handling forms in the React framework</h1>
                </header>
            
            <article>
                
<p>Since the React framework relies on being in control of your frontend state, forms represent a challenge to this vision. This is because, in HTML forms, each input field handles its own state based on the user input. Let's say we have a text box and the user makes some changes to it; the text box will change its state based on what the user enters. In React however, it is preferred that any state change should be handled in the <kbd>state</kbd> object using the <kbd>setState()</kbd> method. There are multiple ways to handle forms in React.</p>
<p>We'll make use of various ways of handling HTML forms. React encourages what is known as the <em>controlled components</em> approach, which simply means that you design your component in a way such that your <kbd>state</kbd> object becomes the single source of truth.</p>
<p>But how? The answer is simple: </p>
<ol>
<li>You monitor your HTML form input fields inside your component.</li>
<li>Whenever a form input field changes, you change your <kbd>state</kbd> object to hold the new value of the form input field.</li>
<li>Your <kbd>state</kbd> object now will hold the latest values of your form input.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Sign in page</h1>
                </header>
            
            <article>
                
<p>Let's start with the <span class="packt_screen">Sign in</span> page. As a reminder, here's how it looks:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/17659113-d417-44df-b35f-ddbf96456bf6.png" style="width:24.42em;height:20.17em;"/></p>
<p>This is basically a form with two text input fields, a button, a link, and some labels. The first step is to create a React component to host the <span class="packt_screen">Sign in</span> form. In the <kbd>modalwindows.js</kbd> file, let's create a new component called <kbd>SignInForm</kbd>: </p>
<pre>class SignInForm extends React.Component{<br/>    constructor(){<br/>       super(props);<br/>    }<br/>}</pre>
<p>Next, we need to create a <kbd>state</kbd> object in our component:</p>
<pre>class SignInForm extends React.Component{<br/>    constructor(){<br/>       super(props);<br/>       this.state = {<br/>            errormessage = ''<br/>        };<br/>    }<br/>}</pre>
<p>Our <kbd>state</kbd> object currently hosts a single field called <kbd>errormessage</kbd>. Whenever the sign-in process fails, we'll fill up the <kbd>errormessage</kbd> field with the error message that occurred. </p>
<p>After that, we need to bind two methods: one to handle form submission and one to handle form input change:</p>
<pre>class SignInForm extends React.Component{<br/>    constructor(){<br/>       super(props);<br/>       //this method will get called whenever a user input data into our form<br/>       this.handleChange = this.handleChange.bind(this);<br/>       //this method will get called whenever the HTML form gets submitted<br/>       this.handleSubmit = this.handleSubmit.bind(this);<br/>       this.state = {<br/>            errormessage = ''<br/>        };<br/>    }<br/>}</pre>
<p>Now it's time to write our <kbd>render()</kbd> method. The <kbd>render()</kbd> method will need to perform the following tasks:</p>
<ul>
<li>Show the <span class="packt_screen">Sign in</span> form, collect the user input, then submit the form</li>
<li>Show an error message if the sign in failed, then enable the user to sign in again</li>
</ul>
<p>Here is how the code will look:</p>
<pre>render(){<br/>        //error message<br/>        let message = null;<br/>        //if the state contains an error message, show an error<br/>        if (this.state.errormessage.length !== 0) {<br/>            message = &lt;h5 className="mb-4 text-danger"&gt;{this.state.errormessage}&lt;/h5&gt;;<br/>        }<br/><br/>        return (<br/>            &lt;div&gt;<br/>                {message}<br/>                &lt;form onSubmit={this.handleSubmit}&gt;<br/>                    &lt;h5 className="mb-4"&gt;Basic Info&lt;/h5&gt;<br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="email"&gt;Email:&lt;/label&gt;<br/>                        &lt;input <strong>name="email"</strong> type="email" className="form-control" id="email" <strong>onChange</strong>={this.handleChange}/&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="pass"&gt;Password:&lt;/label&gt;<br/>                        &lt;input <strong>name="password"</strong> type="password" className="form-control" id="pass" <strong>onChange</strong>={this.handleChange} /&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-row text-center"&gt;<br/>                        &lt;div className="col-12 mt-2"&gt;<br/>                            &lt;button type="submit" className="btn btn-success btn-large"&gt;Sign In&lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                        &lt;div className="col-12 mt-2"&gt;<br/>                            &lt;button type="submit" className="btn btn-link text-info" onClick={() =&gt; this.props.<strong>handleNewUser()</strong>}&gt; New User? Register&lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/form&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</pre>
<p>There are some important points that we need to cover from the preceding code:</p>
<ul>
<li>For each input element, there is an attribute called <kbd>name</kbd>. This attribute is used to identify each input element. This is important because when we set our <kbd>state</kbd> object to reflect the value on each input, we need to identify the input name.</li>
<li>Also for each input element, there is an attribute called <kbd>onChange</kbd>. This attribute is how we call our <kbd>handleChange()</kbd> method whenever a user inputs data on our HTML form.</li>
<li>At the end of our form, if the user decides to click on the <span class="packt_screen">New user? Register</span> link, we call a method called <kbd>handleNewUser()</kbd>, which is passed to us by the component props. We'll cover this method in the next section.</li>
</ul>
<p>Let's talk about the <kbd>handleChange()</kbd> method, which will populate our <kbd>state</kbd> object with the data that the user inputs into the HTML <span class="packt_screen">Sign in</span> form. For that, we'll use a modern JavaScript feature called <em>computed property name</em>. Here is how the code looks:</p>
<pre>handleChange(event){<br/>   const name = event.target.name;<br/>   const value = event.target.value;<br/>   this.setState({<br/>        <strong> [name]: value</strong><br/>   });<br/>}</pre>
<p>In the preceding code, we made use of the <kbd>name</kbd> property of the event target, which corresponds to the name attributes that we assigned in the HTML form. After the user inputs the username and the password, our <kbd>state</kbd> object will end up looking like this:</p>
<pre>state = {<br/>    'email': 'joe@email.com',<br/>    'password': 'pass'<br/>}</pre>
<p>The last piece in our <span><kbd>SignInForm</kbd> would be the <kbd>handleSubmit()</kbd> method. We'll cover this method in more detail when it's time to cover the backend in <a href="d2dd4c31-a063-4318-bf78-9657870c6582.xhtml">Chapter 6</a>, <em>RESTful Web APIs in Go with the Gin Framework</em>. So, for now, here's a filler for the <kbd>handleSubmit()</kbd> method:</span></p>
<pre>handleSubmit(event){<br/>    event.preventDefault();<br/>    console.log(JSON.stringify(this.state));<br/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Registration form</h1>
                </header>
            
            <article>
                
<p>The next form we need to cover is the <span class="packt_screen">Registration</span> form. As a reminder, here is how it looks: </p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d343d0df-f59f-47a5-84d4-9edbd66f584c.png" style="width:25.17em;height:27.33em;"/></p>
<p>This form will be in the same file as the <span class="packt_screen">Sign in</span> form, which was <kbd>modalwindows.js</kbd>. The code for the <span class="packt_screen">Registration</span> form will be very similar to the code we just covered for the <span class="packt_screen">Sign in</span> form. The difference is that the form for <span class="packt_screen">Registration</span> has some more fields than the <span class="packt_screen">Sign In</span> form, otherwise the code is very similar. Here is the code for the <span class="packt_screen">Registration</span> form:</p>
<pre>class Registeration extends React.Component{<br/>    constructor(props) {<br/>        super(props);<br/>        this.handleSubmit = this.handleSubmit.bind(this);<br/>        this.state = {<br/>            errormessage: ''<br/>        };<br/>        this.handleChange = this.handleChange.bind(this);<br/>        this.handleSubmit = this.handleSubmit.bind(this);<br/>    }<br/><br/>    handleChange(event) {<br/>        event.preventDefault();<br/>        const name = event.target.name;<br/>        const value = event.target.value;<br/>        this.setState({<br/>            [name]: value<br/>        });<br/>    }<br/><br/>    handleSubmit(event) {<br/>        event.preventDefault();<br/>        console.log(this.state);<br/>    }<br/><br/>    render() {<br/>        let message = null;<br/>        if (this.state.errormessage.length !== 0) {<br/>            message = &lt;h5 className="mb-4 text-danger"&gt;{this.state.errormessage}&lt;/h5&gt;;<br/><br/>        }<br/>        return (<br/>            &lt;div&gt;<br/>                {message}<br/>                &lt;form onSubmit={this.handleSubmit}&gt;<br/>                    &lt;h5 className="mb-4"&gt;Registeration&lt;/h5&gt;<br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="username"&gt;User Name:&lt;/label&gt;<br/>                        &lt;input id="username" name='username' className="form-control" placeholder='John Doe' type='text' onChange={this.handleChange} /&gt;<br/>                    &lt;/div&gt;<br/><br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="email"&gt;Email:&lt;/label&gt;<br/>                        &lt;input type="email" name='email' className="form-control" id="email" onChange={this.handleChange} /&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="pass"&gt;Password:&lt;/label&gt;<br/>                        &lt;input type="password" name='pass1' className="form-control" id="pass1" onChange={this.handleChange} /&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-group"&gt;<br/>                        &lt;label htmlFor="pass"&gt;Confirm password:&lt;/label&gt;<br/>                        &lt;input type="password" name='pass2' className="form-control" id="pass2" onChange={this.handleChange} /&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div className="form-row text-center"&gt;<br/>                        &lt;div className="col-12 mt-2"&gt;<br/>                            &lt;button type="submit" className="btn btn-success btn-large"&gt;Register&lt;/button&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/form&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</pre>
<p>Perfect! With this out of the way, we have finished the <span class="packt_screen">Sign in</span> form as well as the <span class="packt_screen">Registration</span> form. We just need to write the containing modal window code that will host either the <span class="packt_screen">Sign in</span> form or the <span class="packt_screen">Registration</span> form. The modal window will need to achieve the following tasks:</p>
<ul>
<li>Show the <span class="packt_screen">Sign in</span> form</li>
<li>If the user clicks on the <span class="packt_screen">New User? Register</span> option, the <span class="packt_screen">Registration</span> form should appear</li>
</ul>
<p>Let's create a new React component in the <kbd>modalwindows.js</kbd> file and call it <kbd>SignInModalWindow</kbd>:</p>
<pre>export class SignInModalWindow extends React.Component{<br/><br/>}</pre>
<p>To design this component properly, we need to think about the fact that this component has two modes—specifically, whether it should show the <span class="packt_screen">Sign in</span> page for existing users, or show the new <span class="packt_screen">Registration</span> page for new users. In the world of React, we need to make use of our <kbd>state</kbd> object, in order to keep track of whether we are showing the <span class="packt_screen">Sign in</span> page or the <span class="packt_screen">Registration</span> page. The initial state would be to show the <span class="packt_screen">Sign in</span> page, then if the user clicks on the <span class="packt_screen">New User? Register</span> link, we change our state to the <span class="packt_screen">Registration</span> page:</p>
<pre>export class SignInModalWindow extends React.Component{  <br/> constructor(props) {<br/>     super(props);<br/>     this.state = {<br/>     showRegistrationForm: false<br/>     };<br/>     this.handleNewUser = this.handleNewUser.bind(this);<br/> }</pre>
<p>In the preceding code, besides initializing our <kbd>state</kbd> object, we also bounded a method called <kbd>handleNewUser()</kbd>. This method is what we'll call when a user clicks on the <span><span class="packt_screen">New User? Register</span></span> link to load the <span class="packt_screen">Registration</span> form instead of the <span class="packt_screen">Sign in</span> page. This method should change the value of our <kbd>state</kbd> object to reflect the fact that we need to now load the <span class="packt_screen">Registration</span> form:</p>
<pre>handleNewUser() {<br/>     this.setState({<br/>         showRegistrationForm: true<br/>     });<br/> }</pre>
<p>This sounds good. However, the <span><span class="packt_screen">New User? Register</span></span> link existed in the <kbd>SignInForm</kbd> React component, so how do we call the <kbd>handleNewUser()</kbd> method here from our <kbd>SignInForm</kbd> component?</p>
<p>The answer is simple: we pass the method as a prop to <kbd>SignInForm</kbd>, and then <kbd>SignInForm</kbd> calls the method whenever the <span><span class="packt_screen">New User? Register</span></span> link is clicked. If you go back a few pages, you will find that we did indeed link the <span><span class="packt_screen">New User? Register</span></span> link in the <kbd>SignInForm</kbd> React component to a function prop called <kbd>handleNewUser()</kbd>, which gets called whenever the link is clicked. At the time, we said that we'll cover this prop in a little bit, and here we are.</p>
<p>Now the remaining piece of the <kbd>SignInModalWindow</kbd> component is the required <kbd>render()</kbd> method, which will sum up what we need to do. Here is what the <kbd>render()</kbd> method needs to do:</p>
<ul>
<li>Check the <kbd>state</kbd> object. If it shows that we need to show the <span class="packt_screen">Registration</span> form, load the <span class="packt_screen">Registration</span> form component, <kbd>RegistrationForm</kbd>, otherwise keep <kbd>SignInForm</kbd>.</li>
<li>For the <kbd>SignInForm</kbd>, pass the <kbd>handleNewUser()</kbd> method as a prop. This is a common design pattern in the React world.</li>
<li>Load the modal window code. As usual, we'll make use of the powerful Bootstrap framework to style our form.</li>
<li>Include either <kbd>SignInForm</kbd> or <kbd>RegistrationForm</kbd> in the modal window, based on what our <kbd>state</kbd> object dictates:</li>
</ul>
<pre>render(){<br/>        let modalBody = &lt;SignInForm handleNewUser={this.handleNewUser} /&gt;<br/>        if (this.state.showRegistrationForm === true) {<br/>            modalBody = &lt;RegisterationForm /&gt;<br/>        }<br/><br/>     return (<br/>            &lt;Modal id="register" tabIndex="-1" role="dialog" isOpen={this.props.showModal} toggle={this.props.toggle}&gt;<br/>            &lt;div role="document"&gt;<br/>                &lt;ModalHeader toggle={this.props.toggle} className="bg-success text-white"&gt;<br/>                    Sign in<br/>                    {/*&lt;button className="close"&gt;<br/>                        &lt;span aria-hidden="true"&gt;&amp;times;&lt;/span&gt;<br/>                     &lt;/button&gt;*/}<br/>                &lt;/ModalHeader&gt;<br/>                &lt;ModalBody&gt;<br/>                    {modalBody}<br/>                &lt;/ModalBody&gt;<br/>            &lt;/div&gt;<br/>        &lt;/Modal&gt;<br/>        );<br/>    }<br/>}</pre>
<p class="mce-root"><span>In the next section, we'll take a look at the user pages in our application. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">User pages</h1>
                </header>
            
            <article>
                
<p>It's now time to discuss the user page—what should the user see once they sign into our application? Here is what they should see:</p>
<ul>
<li>Their name in the navigation menu, with an option to <span class="packt_screen">Sign out</span></li>
<li>A list of their existing orders</li>
</ul>
<p>Let's explore how this looks.</p>
<p>The navigation menu should change to look like this:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/719e047f-ed89-4239-90e0-23152f243adc.png" style="width:46.00em;height:3.08em;"/></p>
<p>It now allows to navigate to a page called <span class="packt_screen">My Orders</span>, which will show the user's previous orders. The other difference is that instead of a <span class="packt_screen">Sign In</span> button, we now see a <span class="packt_screen">Welcome &lt;username&gt;</span> drop-down button. When you click on it, the following option should appear:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/32e2bae0-adc6-4bb4-92a4-5c66f2a8c691.png" style="width:12.17em;height:6.83em;"/></p>
<p>This is the <span class="packt_screen">Sign Out</span> button, which the user will need to click on to sign out of their session.</p>
<p>Next, let's have a look at the <span class="packt_screen">My Orders</span> page:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a09e6c10-70e1-4a3f-8c54-37d621e7cb11.png"/></p>
<p>It's a relatively simple page that shows a list of the user's existing orders.</p>
<p>Now, let's write some code for the orders page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The orders page</h1>
                </header>
            
            <article>
                
<p>Let's start with writing the React component that represent the <span class="packt_screen">My Orders</span> page. There are two components involved with the <span class="packt_screen">My Orders</span> page:</p>
<ul>
<li>A single order card component</li>
<li>A parent container component that hosts all the order card components</li>
</ul>
<p class="mce-root"/>
<p>Let's begin with the single order card component. Here is how it looks:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/661e5576-7fa9-4548-90e1-69390398b78c.png"/></p>
<p>Create a new file called <kbd>orders.js</kbd> inside the <kbd>src</kbd> folder. In there, we'll write our new components. At the top of the file, we need to import React:</p>
<pre>import React from 'react';</pre>
<p>For the single order card component, let's call it simply <kbd>Order</kbd>. This component will be simple. Since it will be contained within a parent container component, we can assume that all the order information is passed as props. Also, since we don't need to create any special methods, let's make it a functional component:</p>
<pre>function Order(props){<br/>    return (<br/>        &lt;div className="col-12"&gt;<br/>            &lt;div className="card text-center"&gt;<br/>                &lt;div className="card-header"&gt;&lt;h5&gt;{props.productname}&lt;/h5&gt;&lt;/div&gt;<br/>                &lt;div className="card-body"&gt;<br/>                    &lt;div className="row"&gt;<br/>                        &lt;div className="mx-auto col-6"&gt;<br/>                            &lt;img src={props.img} alt={props.imgalt} className="img-thumbnail float-left" /&gt;<br/>                        &lt;/div&gt;<br/>                        &lt;div className="col-6"&gt;<br/>                            &lt;p className="card-text"&gt;{props.desc}&lt;/p&gt;<br/>                            &lt;div className="mt-4"&gt;<br/>                                Price: &lt;strong&gt;{props.price}&lt;/strong&gt;<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>                &lt;div className="card-footer text-muted"&gt;<br/>                    Purchased {props.days} days ago<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="mt-3" /&gt;<br/>        &lt;/div&gt;<br/>    );   <br/>}</pre>
<p>As always, the Bootstrap framework makes styling our component a breeze.</p>
<p>Now let's move to the orders container parent component. This one will be a bit more complex because we need to store our orders in the <kbd>state</kbd> object of the component:</p>
<pre>export default class OrderContainer extends React.Component{<br/>    constructor(props) {<br/>        super(props);<br/>        this.state = {<br/>            orders: []<br/>        };<br/>    }<br/>}</pre>
<p>The orders list needs to come from the backend part of our application. Because of that, the <kbd>state</kbd> object should change based on the interaction with the backend of our application. Let's not worry about that part for now because we'll have to cover it when designing the backend of our application in <a href="d2dd4c31-a063-4318-bf78-9657870c6582.xhtml">Chapter 6</a>, <em>RESTful Web APIs in Go with the Gin Framework</em>. For now, let's jump into the <kbd>render()</kbd> method:</p>
<pre>render(){<br/>        return (<br/>            &lt;div className="row mt-5"&gt;<br/>                {this.state.orders.map(order =&gt; &lt;Order key={order.id} {...order} /&gt;)}<br/>            &lt;/div&gt;<br/>        );<br/>}</pre>
<p>The preceding code is simple. We go through the orders in our <kbd>state</kbd> object, then load an <kbd>Order</kbd> component for each order object that we have. Remember here that when we are dealing with lists, we should use the <kbd>key</kbd> prop for the React framework to properly handle changes in the list, as mentioned in <a href="e875a3eb-c517-4246-8233-cc681f6c3356.xhtml">Chapter 4</a>, <em>Frontend with React.js</em>. </p>
<p>If you look at the GitHub code for this chapter, you'll notice that I actually fetch the orders data from a static file, in order to update the <kbd>orders</kbd> list in the <kbd>state</kbd> object. This is temporary, since I need some data to show how the visuals will look. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The user page navigational menu</h1>
                </header>
            
            <article>
                
<p>Let's go back to the <kbd>navigation.js</kbd> file that was in our <kbd>src</kbd> folder. We already wrote a <kbd>Navigation</kbd> React component there in the <em>The navigational menu</em> section, which included the default navigation menu if the user is not logged in. We now need to add the pieces that should show up when a user is logged in. The first step is to write a new method, called <span><kbd>buildLoggedInMenu()</kbd>, which will show the <span class="packt_screen">Welcome &lt;user&gt;</span> drop-down button, as well as the sign out option. </span></p>
<p>Inside the <kbd>Navigation</kbd> React component, let's add the new method:</p>
<pre>buildLoggedInMenu(){<br/>        return (<br/>            &lt;div className="navbar-brand order-1 text-white my-auto"&gt;<br/>                &lt;div className="btn-group"&gt;<br/>                    &lt;button type="button" className="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"&gt;<br/>                        Welcome {this.props.user.name}<br/>                    &lt;/button&gt;<br/>                    &lt;div className="dropdown-menu"&gt;<br/>                        &lt;a className="btn dropdown-item" role="button"&gt;Sign Out&lt;/a&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        );<br/>}</pre>
<p>The method makes use of JSX with Bootstrap in order to build our drop-down button and sign out option. We assume that the username is passed to us as a prop.</p>
<p>Now, we'll need to modify the <kbd>render()</kbd> method in order to change the navigation menu when a user is logged in. We'll assume a prop is passed to us that specifies whether the user is logged in. The modified <kbd>render()</kbd> method also needs a new navigational link to point to the <span class="packt_screen">My Orders</span> page:</p>
<pre>render(){<br/>        return (<br/>            &lt;div&gt;<br/>                &lt;nav className="navbar navbar-expand-lg navbar-dark bg-success fixed-top"&gt;<br/>                    &lt;div className="container"&gt;<br/>                        {<br/>                           <strong>this.props.user.loggedin ?</strong><br/><strong>                                this.buildLoggedInMenu()</strong><br/><strong>                                : &lt;button type="button" className="navbar-brand order-1 btn btn-success" onClick={() =&gt; { this.props.showModalWindow();}}&gt;Sign in&lt;/button&gt;</strong><br/>                        }<br/>                        &lt;div className="navbar-collapse" id="navbarNavAltMarkup"&gt;<br/>                            &lt;div className="navbar-nav"&gt;<br/>                                &lt;NavLink className="nav-item nav-link" to="/"&gt;Home&lt;/NavLink&gt;<br/>                                &lt;NavLink className="nav-item nav-link" to="/promos"&gt;Promotions&lt;/NavLink&gt;<br/>                              <strong>  {this.props.user.loggedin ? &lt;NavLink className="nav-item nav-link" to="/myorders"&gt;My Orders&lt;/NavLink&gt; : null}</strong><br/>                                &lt;NavLink className="nav-item nav-link" to="/about"&gt;About&lt;/NavLink&gt;<br/>                            &lt;/div&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/nav&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</pre>
<p>In the preceding code, we assumed a prop had been passed to us that tells us whether the user is logged in (<kbd>this.props.user.loggedin</kbd>). If the user is logged in, we do two things:</p>
<ol>
<li>Call the <kbd>buildLoggedInMenu()</kbd> method to load the user drop-down button at the end of the navigation menu.</li>
<li>Add a link to a path called <kbd>/myorders</kbd>. This link will connect to the <kbd>OrderContainer</kbd> component. We'll cover how to connect this link to a React component in the next section.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Putting it all together – routes</h1>
                </header>
            
            <article>
                
<p>We now need to write the React component that connects all the preceding components together. You are probably thinking that we already wrote the navigation menu—shouldn't that link everything together? The simple answer is: not yet. In the navigation menu component, we made use of links to point to other pages. However, we did not connect those links to actual react components; the <kbd>/about</kbd> link needs to connect to the <kbd>About</kbd> React component, the <kbd>/myorders</kbd> link needs to connect to the <kbd>OrderContainer</kbd> React component, and so on.</p>
<p>We used a React component called <kbd>NavLink</kbd> in order to create our links. <kbd>NavLink</kbd> was obtained from the <kbd>react-router-dom</kbd> package, which we installed in the <em>The navigational menu</em> section. The <kbd>NavLink</kbd> component is the first step to connect links to React components, while the second step is another type called <kbd>BrowserRouter</kbd>. Let's see that in action.</p>
<p>Create a new file called <kbd>App.js</kbd>; it should exist in our <kbd>src</kbd> folder. This file will host a component that will act as the entry point for all our other components. Because of that, we need to import all the major components that we have created so far in here:</p>
<pre>import React from 'react';<br/>import CardContainer from './ProductCards';<br/>import Nav from './Navigation';<br/>import { SignInModalWindow, BuyModalWindow } from './modalwindows';<br/>import About from './About';<br/>import Orders from './orders';</pre>
<p>Next, we need to import a few components from the <kbd>react-router-dom</kbd> package:</p>
<pre><span>import</span><span> { </span><span>BrowserRouter</span><span> </span><span>as</span><span> </span><span>Router</span><span>, </span><span>Route</span><span> } </span><span>from</span><span> </span><span>"react-router-dom"</span><span>;</span></pre>
<p>Now let's write our new component:</p>
<pre>class App extends React.Component{<br/>    <br/>}</pre>
<p>Since this component will have access to all the other components, we need to store global information here. One of the most important pieces of information for our application is whether the user is signed in, because this effects how our application pages look. Because of that, the <kbd>state</kbd> object of this component needs to reflect whether a user is logged in:</p>
<pre>class App extends React.Component{<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      user: {<br/>        loggedin: false,<br/>        name: ""<br/>      }<br/>    };<br/>  }    <br/>}</pre>
<p>Let's not worry about how this state is populated for now, because this will need to be covered when we write the backend part of our application. For the time being, let's focus on how to connect each <kbd>NavLink</kbd> to a React component. </p>
<p>There are three steps involved:</p>
<ol>
<li>Add a component of the <kbd>BrowserRouter</kbd> type. In our case, we just named it <kbd>Router</kbd> for simplicity.</li>
<li>Inside <kbd>BrowserRouter</kbd>, put all the instances <kbd>NavLink</kbd>. In our case, all of our <kbd>NavLink</kbd> instances are in the <kbd>Navigation</kbd> component; we imported the <kbd>Navigation</kbd> component here as <kbd>Nav</kbd> for simplicity.</li>
<li>Inside <kbd>BrowserRouter</kbd>, use the <kbd>Route</kbd> component that we imported from the <kbd>react-router-dom</kbd> package to link a URL path to the React component. Each URL path will correspond to a <kbd>NavLink</kbd> path.</li>
</ol>
<p>The preceding steps can be hosted in our <kbd>render()</kbd> method. Here is how this code looks:</p>
<pre>render(){<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;<strong>Router</strong>&gt;<br/>          &lt;div&gt;<br/>            <strong>&lt;Nav user={this.state.user} /&gt;</strong><br/>            &lt;div className='container pt-4 mt-4'&gt;<br/>              <strong>&lt;Route exact path="/" render={() =&gt; &lt;CardContainer location='cards.json' /&gt;} /&gt;</strong><br/><strong>              &lt;Route path="/promos" render={() =&gt; &lt;CardContainer location='promos.json' promo={true}/&gt;} /&gt;</strong><br/><strong>              {this.state.user.loggedin ? &lt;Route path="/myorders" render={()=&gt;&lt;Orders location='user.json'/&gt;}/&gt; : null}</strong><br/><strong>              &lt;Route path="/about" component={About} /&gt;</strong><br/>            &lt;/div&gt;<br/>            &lt;SignInModalWindow /&gt;<br/>            &lt;BuyModalWindow /&gt;<br/>          &lt;/div&gt;<br/>        &lt;/Router&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</pre>
<p>The preceding code implements the three steps that we covered earlier. It also includes <kbd>SignInModalWindow</kbd> and <kbd>BuyModalWindow</kbd>. Either modal window will only show up if the user activates them.</p>
<p>We used two different ways to connect a <kbd>NavLink</kbd> instance to a React component:</p>
<ul>
<li>If a component needs a prop as an input, we use <kbd>render</kbd>:</li>
</ul>
<pre style="padding-left: 60px">&lt;Route path="/promos" render={() =&gt; &lt;CardContainer location='promos.json' promo={true}/&gt;} /&gt;</pre>
<ul>
<li>If a component does not need a prop as an input, we can use the <kbd>Route</kbd> component:</li>
</ul>
<pre style="padding-left: 60px">&lt;Route path="/about" component={About} /&gt;</pre>
<p>In order for the routing concepts to sync, let's look at what happened with the <kbd>About</kbd> React component:</p>
<ul>
<li>In our navigational menu component (<kbd>Navigation</kbd> at <kbd>Navigation.js</kbd>), we used the <kbd>NavLink</kbd> type that we obtained from <kbd>react-router-dom</kbd> to create a path called <kbd>/about:&lt;<span>NavLink</span> <span>className</span><span>=</span><span>"nav-item nav-link"</span> <span>to</span><span>=</span><span>"/about"</span><span>&gt;</span><span>About</span><span>&lt;/</span><span>NavLink</span><span>&gt;</span></kbd><span>.</span></li>
<li>In our <kbd>App</kbd> component, we linked the <kbd>/about</kbd> path to the <kbd>About</kbd> React component:</li>
</ul>
<pre style="padding-left: 60px">&lt;Router&gt;<br/><br/>&lt;div&gt;<br/>&lt;Nav user={this.state.user} /&gt; <br/>&lt;div className='container pt-4 mt-4'&gt;<br/>{/*other routes*/}<br/>&lt;Route path="/about" component={About} /&gt;<br/>&lt;/div&gt;<br/>{/*rest of the App component*/}<br/>&lt;/div&gt;<br/>&lt;/Router&gt;</pre>
<p>Now, we need to define the <kbd>toggle</kbd> methods and show methods for the buy and the sign-in modal windows. The <kbd>show</kbd> methods are basically the methods to call in order to show the buy or sign-in modal windows. The most straightforward way to do this is to use a <kbd>state</kbd> object of our component to specify whether the modal windows should be on or off. Our application is designed so that only one modal window should be open at a time, which is why we'll control their open/closed state from our <kbd>App</kbd> component. </p>
<p>Let's start by exploring the <kbd>show</kbd> methods for the buy and sign-in modal windows:</p>
<pre>  showSignInModalWindow(){<br/>    const state = this.state;<br/>    const newState = Object.assign({},state,{showSignInModal:true});<br/>    this.setState(newState);<br/>  }<br/><br/>  showBuyModalWindow(id,price){<br/>    const state = this.state;<br/>    const newState = Object.assign({},state,{showBuyModal:true,productid:id,price:price});<br/>    this.setState(newState);<br/>  }</pre>
<p>The code, in both cases, will clone our <kbd>state</kbd> object, while adding and setting a Boolean field that indicates that the target modal window should be on. In case of the sign-in modal window, the Boolean field will be called <kbd>showSignInModal</kbd>, whereas, in the case of the buy modal window, the Boolean field will be called <kbd>showBuyModal</kbd>. </p>
<p>Now, let's look at the <kbd>toggle</kbd> methods for the sign in and the buy modal windows. As mentioned, the <kbd>toggle</kbd> method is used to toggle the state of the modal window. In our case, we just need to reverse the value of the <kbd>state</kbd> Boolean fields that represent whether our modal windows are open:</p>
<pre>  toggleSignInModalWindow() {<br/>    const state = this.state;<br/>    const newState = Object.assign({},state,{showSignInModal:!state.showSignInModal});<br/>    this.setState(newState);<br/>  }<br/><br/>  toggleBuyModalWindow(){<br/>    const state = this.state;<br/>    const newState = Object.assign({},state,{showBuyModal:!state.showBuyModal});<br/>    this.setState(newState); <br/>  }</pre>
<p>The constructor for our <kbd>App</kbd> component needs to bind the new methods that we added for them to be used in our code:</p>
<pre>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      user: {<br/>        loggedin: false,<br/>        name: ""<br/>      }<br/>    };<br/>    this.showSignInModalWindow = this.showSignInModalWindow.bind(this);<br/>    this.toggleSignInModalWindow = this.toggleSignInModalWindow.bind(this);<br/>    this.showBuyModalWindow = this.showBuyModalWindow.bind(this);<br/>    this.toggleBuyModalWindow = this.toggleBuyModalWindow.bind(this);<br/>  }</pre>
<p>Next, we need to pass the new methods to the components that need them as prop objects. We also need to pass the <kbd>state.showSignInModal</kbd> and <kbd>state.showBuyModal</kbd> flags, because that's how our modal window components will know whether a modal window should be visible:</p>
<pre> render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;Router&gt;<br/>          &lt;div&gt;<br/>            &lt;Nav user={this.state.user} <strong>showModalWindow={this.showSignInModalWindow}</strong>/&gt;<br/>            &lt;div className='container pt-4 mt-4'&gt;<br/>              &lt;Route exact path="/" render={() =&gt; &lt;CardContainer location='cards.json' <strong>showBuyModal={this.showBuyModalWindow}</strong> /&gt;} /&gt;<br/>              &lt;Route path="/promos" render={() =&gt; &lt;CardContainer location='promos.json' promo={true} <strong>showBuyModal={this.showBuyModalWindow}</strong>/&gt;} /&gt;<br/>              {this.state.user.loggedin ? &lt;Route path="/myorders" render={()=&gt;&lt;Orders location='user.json'/&gt;}/&gt; : null}<br/>              &lt;Route path="/about" component={About} /&gt;<br/>            &lt;/div&gt;<br/>            &lt;SignInModalWindow <strong>showModal={this.state.showSignInModal} toggle={this.toggleSignInModalWindow}</strong>/&gt;<br/>            &lt;BuyModalWindow <strong>showModal={this.state.showBuyModal} toggle={this.toggleBuyModalWindow} </strong> productid={this.state.productid} price={this.state.price}/&gt;<br/>          &lt;/div&gt;<br/>        &lt;/Router&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</pre>
<p>There are two remaining code pieces to be covered in this chapter.</p>
<p>The first piece is to make the <kbd>App</kbd> component exportable because this component will become the entry point for all our other components. At the end of the <kbd>App.js</kbd> file, let's add this line:</p>
<div>
<div>
<pre><span>export</span><span> </span><span>default</span><span> </span><span>App</span><span>;</span></pre>
<p>The second piece of code we need to write is to link the <kbd>App</kbd> React component to the <kbd>root</kbd> element of our template HTML code. Create a file called <kbd>index.js</kbd>, where we add this code:</p>
<pre>import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';<br/>import registerServiceWorker from './registerServiceWorker';<br/><br/>ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));<br/>registerServiceWorker();</pre>
<p>This code makes use of the tools that are loaded with the Create React App tool. </p>
<p>Perfect! With this last piece of code out of the way, our chapter is done.</p>
</div>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>This chapter took a practical deep dive into how to build a proper frontend application using the React framework. We covered several topics as we built our application, such as routing, handling credit cards and forms, and typical React framework design approaches. You should have enough knowledge at this point to build non-trivial applications in the React framework.</p>
<p>In the next chapter, we'll switch topics and revisit Go. We'll start to cover how to build the backend for our GoMusic application, by introducing the Go open source framework, Gin.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What is <kbd>react-router-dom</kbd>?</li>
<li>What is <kbd>NavLink</kbd>?</li>
<li>What is Stripe?</li>
<li>How do we handle credit cards in React?</li>
<li>What is a controlled component?</li>
<li>What is <kbd>BrowserRouter</kbd>?</li>
<li>What are Stripe elements?</li>
<li>What is the <kbd>injectStripe()</kbd> method?</li>
<li>How do we handle routing in React?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>For more information on the topics covered in this chapter, check out the following links:</p>
<ul>
<li><strong>React router package</strong>: <a href="https://reacttraining.com/react-router/" target="_blank">https://reacttraining.com/react-router/ </a></li>
<li><strong>Stripe</strong>: <a href="https://stripe.com/" target="_blank">https://stripe.com/</a></li>
<li><strong>Stripe React elements</strong>: <a href="https://stripe.com/docs/recipes/elements-react" target="_blank">https://stripe.com/docs/recipes/elements-react</a></li>
<li><strong>Handling forms in React</strong>: <a href="https://reactjs.org/docs/forms.html" target="_blank">https://reactjs.org/docs/forms.html</a></li>
</ul>


            </article>

            
        </section>
    </body></html>