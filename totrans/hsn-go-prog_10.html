<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Web Programming</h1>
                </header>
            
            <article>
                
<p class="mce-root">In this chapter, we're going to see effective recipes that will involve interactions with the internet, such as downloading a web page, creating our own sample web servers, and handling HTTP requests. The following topics will be covered in this chapter:</p>
<ul>
<li>Downloading a web page from the internet</li>
<li>Downloading files from the internet</li>
<li>Creating a simple web server</li>
<li>Creating a simple file server</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading a web page from the internet</h1>
                </header>
            
            <article>
                
<p class="mce-root">Let's start with how to download a web page from the internet. We are going to start with defining our URL, which will be <kbd>golang.org</kbd>, and we're going to use the <kbd>net/http</kbd> package to get the content of this URL. This will return two things: <kbd>response</kbd> and <kbd>error</kbd>.</p>
<p class="mce-root">If you quickly look at the documentation here, you see that it issues a <kbd>get</kbd> request to specify the URL and it also returns some of the HTTP code based on the response:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-999 image-border" src="assets/d909cb08-295c-439b-af79-f3866d0cb9ab.png" style="width:39.42em;height:22.42em;"/></p>
<p class="mce-root">Check the following code:</p>
<pre>package main<br/>import (<br/>  "net/http"<br/>  "io/ioutil"<br/>  "fmt"<br/>)<br/>func main(){<br/>  url := "http://golang.org"<br/>  response, err := http.Get(url)<br/>  if err != nil{<br/>   panic(err)<br/>  }<br/>  defer response.Body.Close()<br/>  html, err2 := ioutil.ReadAll(response.Body)<br/>  if err2 != nil{<br/>    panic(err)<br/>  }<br/>  fmt.Println(html)<br/>}</pre>
<p class="mce-root">If an <kbd>err</kbd> happens, we're going to call <kbd>panic</kbd>, and hence we type <kbd>panic (err)</kbd>, in which we provide <kbd>err</kbd> as its parameter. When everything is done, we will have to close the body. Let's proceed and run this code in our terminal to get the following:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1000 image-border" src="assets/e8a36631-cf93-440a-8db9-b78e26e097f9.png" style="width:101.33em;height:37.33em;"/></p>
<p class="mce-root">As you can, it is a byte array and we're going to change it to <kbd>string</kbd>:</p>
<pre>package main<br/>import (<br/>  "net/http"<br/>  "io/ioutil"<br/>  "fmt"<br/>)<br/>func main(){<br/>  url := "http://golang.org"<br/>  response, err := http.Get(url)<br/>  if err != nil{<br/>    panic(err)<br/>  }<br/>  defer response.Body.Close()<br/>  html, err2 := ioutil.ReadAll(response.Body)<br/>  if err2 != nil{<br/>    panic(err)<br/>  }<br/>  fmt.Println(string(html))<br/>}</pre>
<p class="mce-root">If we now run the code, we obtain the following output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1001 image-border" src="assets/c6ab87be-0d78-4cac-8e38-616190c03278.png" style="width:73.75em;height:53.25em;"/></p>
<p class="mce-root">Now we have this HTML source code printing out to our console, and that is how you can simply download a web page from the internet using Go. In the next section, we're going to see how to download files from the internet.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading files from the internet</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to see how to download files from the internet. For this, we are going to take an example of downloading an image. We are going to type the URL of the image, which the logo of Go. Check the following code:</p>
<pre>package main<br/>import (<br/>  "net/http"<br/>  "os"<br/>  "io"<br/>  "fmt"<br/>)<br/>func main(){<br/>  imageUrl := "https://golang.org/doc/gopher/doc.png"<br/>  response, err := http.Get(imageUrl)<br/>  if err != nil{<br/>    panic(err)<br/>  }<br/>  defer response.Body.Close()<br/>  file, err2 := os.Create("gopher.png")<br/>  if err2 != nil{<br/>    panic(err2)<br/>  }<br/>  _, err3 := io.Copy(file, response.Body)<br/>  if err3 != nil{<br/>    panic(err3)<br/>  }<br/>  file.Close()<br/>  fmt.Println("Image downloading is successful.")<br/>}</pre>
<p>As you can see, we've used the <kbd>http.Get()</kbd> method here. If our <kbd>err</kbd> is not <kbd>nil</kbd>, we've typed <kbd>panic(err)</kbd> and we are going to exit the <kbd>defer response.Body.Close()</kbd> function. Before our function exits, we're going to close the body of the <kbd>out</kbd> response. So, the first thing we have to do is create a new file so that we can copy the content of the image to the file. If the error is not <kbd>nil</kbd> again, we're going to panic and will be using <kbd>io.Copy()</kbd>. We're just going to write that image downloading to the console <span>is successful</span>.</p>
<p>Let's proceed and run the code to check the output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1002 image-border" src="assets/94973b74-b647-4d5c-86f1-caf0685edd5e.png" style="width:66.58em;height:35.83em;"/></p>
<p>Voilà! The download is successful. That's how you can download images or any type of files from the internet using Golang. In our next section, we're going to see how to create a simple web server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a simple web server</h1>
                </header>
            
            <article>
                
<p>In this section, we're going to see how to create a simple web server in Go. It is really easy to create a simple web server in Go due to the <span>built-in API. To begin, we are going</span> to use the <kbd>net/http</kbd> package. A <kbd>net/http</kbd> package has the <kbd>HandleFunc()</kbd> method, which means that it will accept two things. The first is the path of the URL, and the second is the function that you want to handle incoming requests with. Check the following code:</p>
<pre>package main<br/>import "net/http"<br/>func sayHello(w http.ResponseWriter, r *http.Request){<br/>  w.Write([]byte("Hello, world"))<br/>}<br/>func main(){<br/>  http.HandleFunc("/", sayHello)<br/>  err := http.ListenAndServe(":5050", nil)<br/>  if(err != nil){<br/>    panic(err)<br/>  }<br/>}</pre>
<p>As long as your method signature satisfies the <kbd>func sayHello(w http.ResponseWriter, r *http.Request){}</kbd> type of method, it will be accepted by our <kbd>HandleFunc()</kbd>. We will use <kbd>sayHello</kbd> as our function and it'll return two things, firstly, <kbd>http.ResponseWriter</kbd>, while the second thing is the request itself as the pointer. Since it's going to be a hello server, we're just going to write some data back to our response and, for that, we will be using our response writer. Since we have to listen to a specific port, we are going to use <kbd>http.ListenAndServe.</kbd> Moreover, we have used <kbd>5050</kbd>; you can choose any port as long as it is available. We have also added <kbd>nil</kbd> to the function, which returns an error if something unexpected happens, and, if the error is not <kbd>nil</kbd>, we're going to panic. So let's go ahead and run the code and try to access the path using our browser. We will have to run our <kbd>main.go</kbd> file first and <span class="packt_screen">Allow</span> it so that we can access it:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1003 image-border" src="assets/eed6ce6f-ab3a-4e7e-a584-3c92e775e1f3.png" style="width:29.00em;height:11.58em;"/></p>
<p>Once this is done, we will have to open up a browser tab and try to access <kbd>http://localhost:5050/</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1004 image-border" src="assets/dc59fd06-831f-46e1-a02a-adf91ec78b5d.png" style="width:17.17em;height:6.92em;"/></p>
<p>You will clearly see <kbd>Hello, world</kbd>. Now, let's do one more quick sample with a query string or URL parameters. We are going to modify the method so we can decide which planet we want to say "hello" to. Check the following code:</p>
<pre>package main<br/>import "net/http"<br/>func sayHello(w http.ResponseWriter, r *http.Request){<br/>  planet := r.URL.Query().Get("planet")<br/>  w.Write([]byte("Hello, " + planet))<br/>}<br/>func main(){<br/>  http.HandleFunc("/", sayHello)<br/>  err := http.ListenAndServe(":5050", nil)<br/>  if(err != nil){<br/>    panic(err)<br/>  }<br/>}</pre>
<p>We have this URL that has a query function. We are going to read the query string, also known as a URL parameter called <kbd>planet</kbd>, and we'll assign its value to a variable. We have to stop our current server and run it again. Upon opening <kbd>http://localhost:5050/</kbd>, we don't see the name of any planet:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1005 image-border" src="assets/461d784c-b1ac-4d40-8e1a-0664640afe10.png" style="width:17.08em;height:6.83em;"/></p>
<p>Thus, you can change the URL to <kbd>http://localhost:5050/?planet=World</kbd> and try again:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1006 image-border" src="assets/67a486bf-1522-4966-b843-27ec0350b526.png" style="width:22.25em;height:7.25em;"/></p>
<p>Voilà! Now let's try the same with the planet <kbd>Jupiter</kbd><span>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1007 image-border" src="assets/27f1716d-9d3e-48be-b596-e38d5c0b9b67.png" style="width:22.33em;height:8.50em;"/></p>
<p>This is how we can quickly create your own web server in Go.</p>
<p>In our next section, we're going to see how to create a simple file server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a simple file server</h1>
                </header>
            
            <article>
                
<p>In this section, we're going to see how to create a simple file server. The main idea behind a file server is to serve static files, such as images, or CSS files, or JavaScript files, and, in our code, we're going to see how to do this. Check the following code:</p>
<pre>package main<br/><br/>import "net/http"<br/><br/>func main() {<br/>  http.Handle("/", http.FileServer(http.Dir("./images")))<br/>  http.ListenAndServe(":5050", nil)<br/>}</pre>
<p>As you can see, we have used the HTTP handle, and this <kbd>Handle</kbd> is different from <kbd>handleFunc</kbd> and accepts a handler interface as a second parameter; the first parameter is <kbd>pattern</kbd>. We are going to use a special API called <kbd>FileServer</kbd> and it will work as a file server here; we will add a location (image directory, <kbd>./images</kbd>) in the server to serve the static files.</p>
<p>So, what's going to happen is that when the request hits the route path, a file server will serve the requests and it will give static files under the location <kbd>http.Dir("./images"</kbd>). We are going to use <kbd>http.ListenAndServe(":5050", nil)</kbd>, as in the previous section. Furthermore, as mentioned in the previous section, we are going to run the server, allow permissions, and type <kbd>localhost:5050</kbd> in the browser:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1008 image-border" src="assets/9c575d28-4f9a-40a2-9864-88e9dfd401fa.png" style="width:17.92em;height:10.33em;"/></p>
<p>You can see the list of our files on the location and, if we click <span class="packt_screen">gopher_aviator.png</span>, it gives us the image from that location:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1009 image-border" src="assets/c22b7ec3-826f-4255-a72c-9fcfb0f2b318.png" style="width:47.00em;height:42.75em;"/></p>
<p>If we go back and click the other one (<span class="packt_screen">gopher.png</span>), it'll display the following image:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1010 image-border" src="assets/c3328254-7f79-4b7a-bcab-d50ddc07141b.png" style="width:50.08em;height:32.17em;"/></p>
<p>Alternatively, you can comment out <kbd>http.Handle("/", http.FileServer(http.Dir("./images")))</kbd> from the preceding code and replace <kbd>nil</kbd> with the location. If you follow the same procedure, as we did previously, and check the browser, it will still give us those two images properly, and this is how you can create a simple file server in Go.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, you learned about downloading a web page from the internet, downloading files from the internet, creating a simple web server, and creating a simple file server. The next chapter will take you through recipes explaining how to <span>read, update, delete, and create data on relational databases with Go.</span></p>


            </article>

            
        </section>
    </body></html>