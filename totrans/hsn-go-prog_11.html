<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Relational Databases</h1>
                </header>
            
            <article>
                
<p class="mce-root">Go can work with various relational databases, including SQL Server, MySQL, Postgres SQL, and SQLite. In this chapter, we are going to use SQLite. SQLite might be slightly more limited compared to other more advanced database engines, but for our examples it is pretty much sufficient. In this section, you will learn how to read, update, delete, and create data in relational databases with Go.</p>
<p class="mce-root">The following topics will be covered in this chapter:</p>
<ul>
<li>Reading data from databases</li>
<li>Inserting data into databases</li>
<li>Updating data in databases</li>
<li>Deleting data from databases</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reading data from databases</h1>
                </header>
            
            <article>
                
<p class="mce-root">Let's begin with learning how to read data from SQL databases. Before we begin, we will have to create a database called <kbd>personal.db</kbd>. We are going to use a DB browser for SQLite that allows us to create new SQLite databases, edit them, add new records, and so on. You can find more information about the tool and download it from <a href="http://sqlitebrowser.org/">http://sqlitebrowser.org/</a>. It is a free tool and it works with Windows, macOS, and Linux. <span>Let's begin with an example.</span> Check out the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1011 image-border" src="assets/4804cbdd-9529-4acd-8415-238e5a1e039e.png" style="width:86.17em;height:44.25em;"/></p>
<p class="mce-root">Here, we have just one table, called <kbd>profile</kbd>. Working on this table will be sufficient for us to learn how to interact with the SQLite database, and then you can use the same techniques to interact with MySQL or SQL Server. If you check the screenshot, you can see that we have three records and four columns: <kbd>ProfileId</kbd>, <kbd>FirstName</kbd>, <kbd>LastName</kbd>, and <kbd>Age</kbd>. The <kbd>FirstName</kbd> and <kbd>LastName</kbd> columns are a string, or text, the <kbd>Age</kbd> column is a number, and the <kbd>ProfileId</kbd> is our primary key; it <span>is</span> <span>also an integer column. So, let's go ahead and create our own struct and the code:</span></p>
<pre>package main<br/>import (_ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/><br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p class="mce-root">Now, let's go through the explanation of the code. We've used the struct type to map data that comes from the SQL database to our in-memory objects. We need to import two packages: the first one is the SQL <span>database,</span> <span>and the second one is</span> <kbd>go-sqlite3</kbd><span>. We're going to do an empty or blank import, which will automatically remove the</span> <span>SQL</span> <span>database import, but that's alright since we're going to import it again later. The reason why we are doing a blank import is that if there's initialization code in this package, it will still be executed. This package registers itself as the underlying SQL driver, so we will still be using the SQL database package as our API, but that API will be using the</span> <kbd>go-sqlite3</kbd> <span>package behind the scenes to interact with our database, and, as you will see, database interaction in Go is pretty straightforward. So, the first thing we're going to do is open the database. When we use the SQL package, you'll see that it automatically imports our SQL database.</span></p>
<p class="mce-root">Furthermore, we are going to use a SQLite driver, which is SQLite version 3, and we will also specify where our database is located. The data source name may change, based on what type of database you use; it might be a URL, but in our case, it's a file, since SQLite works with data files. So, we will type <kbd>./personal.db</kbd>. We have also added the error <span>check</span> <span>utility function so that we don't have to keep checking for errors all the time. We can just say <kbd>checkError</kbd> and the error will be checked. We're going to use a DB query to query our database and that returns two things: one of them is rows and the other one is an error. The database query basically accepts a SQL query here. We are also going to use a <kbd>for</kbd> loop,</span> <kbd>rows.next</kbd><span>, to iterate each row and rows.scan to get the value out of each row. It is important to respect the order of your columns as they come from the profile database; if you need a different order, you can specify it at the</span> <kbd>*</kbd> <span>shown here:</span> <kbd>"select * from Profile"</kbd><span>. I usually recommend to explicitly specify each of the rows instead of using a wildcard (</span><kbd>*</kbd><span>).</span></p>
<p class="mce-root">You will get the following output when you run this code:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1012 image-border" src="assets/112ced21-a8bd-430d-ba41-14272b0e6d12.png" style="width:21.67em;height:8.67em;"/></p>
<p class="mce-root">As you can see, we were able to capture our database records (<kbd>ProfileId</kbd>, <kbd>FirstName</kbd>, <kbd>LastName</kbd>, and <kbd>Age</kbd>) in the table.</p>
<p class="mce-root">Now, let's quickly look at how we can carry out filtering. So, we're going to be using the <kbd>where</kbd> clause, and, if you know SQL, the <kbd>where</kbd> clause is used for filtering. We are going to filter by <kbd>ProfileId</kbd>. Take a look at the signature of this method:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1013 image-border" src="assets/f67969c6-7a82-4a01-8f9d-0c64c60dea4d.png" style="width:36.58em;height:30.33em;"/></p>
<p class="mce-root">The second parameter in the signature is the arguments for the placeholders, and since it is a very attic function, you can provide as many arguments as possible as long as you have matching placeholders. We are going to add <kbd>2</kbd>, as you can see in the following code snippet; you can also use a variable name:</p>
<pre>var profile Profile<br/>rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile where ProfileID = ?", 2)<br/>checkError(err)</pre>
<p class="mce-root">Now, let's go ahead and run the modified code:</p>
<pre>package main<br/>import (_ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile where ProfileID = ?", 2)<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p class="mce-root">On running the preceding code, you'll obtain the following output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1014 image-border" src="assets/a3411988-482a-453b-aa9b-b445f4cc9296.png" style="width:21.25em;height:8.67em;"/></p>
<p class="mce-root">So, we get our second record from the database. You can also do multiple <kbd>where</kbd> clauses, as shown in the following code:</p>
<pre>package main<br/>import (_ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile where FirstName = ? and LastName = ?","Tarik", "Guney")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId,   &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p class="mce-root">You will obtain the following output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1015 image-border" src="assets/c4af8c54-aa5e-4c4d-80c3-1fd5ed25d560.png" style="width:19.92em;height:9.33em;"/></p>
<p class="mce-root">Perfect! That is the record that we were expecting. That's how you can easily query a SQL database in Go.</p>
<p class="mce-root">In the next section, we're going to see how to insert data into a SQLite database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Inserting data into databases</h1>
                </header>
            
            <article>
                
<p>In this section, we're going to see how to insert data into a database. We will be using the code that we developed in our previous section, and adding a new piece of code that will insert data into our <kbd>personal.db</kbd> database. We are going to add <kbd>statement</kbd> and <kbd>err</kbd>, and use <kbd>insert</kbd>Â statement to add names to our <kbd>Profile</kbd> <span>table</span><span>. We are going to specify which columns we want to insert the data into, but we are not going to specify</span> <kbd>ProfileId</kbd> <span>since it is the primary key of the table. We will type</span> <kbd>FirstName</kbd><span>,</span> <kbd>LastName</kbd><span>, and</span> <kbd>Age</kbd>, <span>and the values will</span> <span>just</span> <span>be placeholders. We will also use</span> <kbd>statement.Exec</kbd> <span>and provide the values for the placeholders, for example,</span> <kbd>Jessica</kbd><span>,</span> <kbd>McArthur</kbd><span>,</span> <span>and</span> <kbd>30</kbd><span>. Here is the code:</span></p>
<pre><br/>package main<br/>import (_ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  statement, err := db.Prepare("insert into Profile (FirstName, LastName, Age) values(?,?,?)")<br/>  checkError(err)<br/>  statement.Exec("Jessica", "McArthur", 30)<br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/><br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p>Here is the output for the preceding code:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1016 image-border" src="assets/f0584f29-c29b-4bdc-9d43-c929eae10005.png" style="width:20.50em;height:9.33em;"/></p>
<p>As you can see, our ID is <kbd>5</kbd>, the first name is <kbd>Jessica</kbd>, the last name is <kbd>McArthur</kbd>, and the age is <kbd>30</kbd>. That's how you can simply insert data into a database using Go.</p>
<p>In our next section, we're going to see how to update existing data in a database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating data in databases</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to see how to update existing data in a database. We're going to use the same code that we developed in the previous section, but we will be changing a few fields.</p>
<p>We'll use an <kbd>update</kbd> statement in SQL. So, the following fields will be changed:</p>
<pre>statement, err := db.Prepare("update Profile set FirstName = ? where ProfileId = ?")<br/>checkError(err)<br/><br/>statement.Exec("Martha", 5)</pre>
<p>Once we update our profile record, we're going to list all the records in our <kbd>profile</kbd> table. If you remember our previous section, the last record has the profile ID <kbd>5</kbd>, and we're going to change that. The last line of the output in the previous section was <kbd>{5 Jessica McArthur 30}</kbd>, and we are now going to change the first name for our updated code:</p>
<pre>package main<br/>import (_ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  statement, err := db.Prepare("update Profile set FirstName = ? where ProfileId = ?")<br/>  checkError(err)<br/>  statement.Exec("Martha", 5)<br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p>If you run the code, you'll find the following output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1017 image-border" src="assets/b9727fa1-5b6d-4862-a433-6f60dd117e5a.png" style="width:21.17em;height:9.42em;"/></p>
<p>You can see that we've successfully changed the name <kbd>Jessica</kbd> to <kbd>Martha</kbd>. That's how you can simply do an update in Go.</p>
<p>In our next section, we're going to see how to delete data from a database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting data from databases</h1>
                </header>
            
            <article>
                
<p>In this section, we're going to see how to delete data from a database. We'll still use the old code that we developed in the previous section and make some minor changes to it. <span>Check out the following code:</span></p>
<pre>package main<br/>import (<br/>  _ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/><br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p>The output of the preceding code will be as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1018 image-border" src="assets/4237cc24-17c1-4c5e-a800-341420149aca.png" style="width:29.17em;height:9.50em;"/></p>
<p>Now, to delete data, say row <kbd>3</kbd> in this case, you will have to make certain changes to the code. We will make <span>minor modifications in the code with</span> <kbd>statement</kbd>, <kbd>err</kbd><span>, and</span> <kbd>statement.Exec</kbd>.</p>
<p>Thus, to achieve what we want, we are going to use the following modified code:</p>
<pre>package main<br/>import (<br/>  _ "github.com/mattn/go-sqlite3"<br/>  "database/sql"<br/>  "fmt"<br/>)<br/>type Profile struct{<br/>  ProfileId int<br/>  FirstName string<br/>  LastName string<br/>  Age int<br/>}<br/>func main(){<br/>  db, err := sql.Open("sqlite3", "./personal.db")<br/>  checkError(err)<br/>  statement ,err := db.Prepare("delete from Profile where  ProfileId = ?")<br/>  checkError(err)<br/>  statement.Exec(3)<br/><br/>  var profile Profile<br/>  rows, err := db.Query("select ProfileId, FirstName, LastName, Age from Profile")<br/>  checkError(err)<br/>  for rows.Next(){<br/>    err := rows.Scan(&amp;profile.ProfileId, &amp;profile.FirstName, &amp;profile.LastName, &amp;profile.Age)<br/>    checkError(err)<br/>    fmt.Println(profile)<br/>  }<br/>  rows.Close()<br/>  db.Close()<br/>}<br/>func checkError(err error) {<br/>  if (err != nil) {<br/>    panic(err)<br/>  }<br/>}</pre>
<p>You can see that we've used <kbd>db.Prepareand</kbd>. We've provided the lead from <kbd>profile</kbd>, where <kbd>ProfileId</kbd> is a placeholder. We have also used <kbd>statement.Exec</kbd> and that will execute with the arguments; it's important that the number of arguments matches the number of placeholders that you put in your code. Let's run the code and check the output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1019 image-border" src="assets/50f32c0e-51e7-4e18-bfba-d73f8d292e7a.png" style="width:34.67em;height:9.67em;"/></p>
<p>Thus, if you compare the two outputs, you can see that we have successfully deleted the third entry and now we have only <kbd>4</kbd> entries, with the third entry having been deleted. That's how you can simply delete data from a database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>That pretty much concludes our book. You will have learned quite a lot about Go, and now you can effectively use this knowledge in various scenarios. You can now overcome the most common challenges faced by developers by following the concise and easy recipes included in this book. All the best!</p>


            </article>

            
        </section>
    </body></html>