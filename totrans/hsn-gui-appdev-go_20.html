<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross Compiler Setup</h1>
                </header>
            
            <article>
                
<p class="mce-root">When building applications that need access to native APIs, we can use CGo. Although not much harder for regular development, this does make cross compiling much more complicated. For every target platform you want to build for, there must be a C compiler that knows how to create native binary files. This appendix outlines the steps required to set up cross compilation targets for each combination referenced earlier in this book.</p>
<div class="packt_infobox">Most Go applications don't require this setup for cross compiling as the Go compiler is designed to build for all supported platforms. Additional steps, such as those following, will be required if the resulting applications (or the toolkits they use) are linking to operating system libraries through CGo.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross compiling for macOS with CGo</h1>
                </header>
            
            <article>
                
<p>When cross compiling for macOS, it's necessary to install the SDK (Software Development Kit) from Apple as well as a suitable compiler. The instructions for Windows (using MSYS2—<span>described in the previous <a href="a0605c81-4926-45d1-b90c-63047f1e2b76.xhtml">Appendix</a>, </span><em>Installation Details</em>) and Linux are almost identical; the main work is to install the macOS SDK.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To macOS from Linux or Windows</h1>
                </header>
            
            <article>
                
<p>To prepare for cross compilation to Darwin, we must install the macOS SDK and a build toolchain that can use it. The easiest way to do this is with the <em>osxcross</em> project. This example shows how to download and install the SDK and tools to build for macOS without using a Macintosh computer. This illustration uses Linux but the process is the same for Windows developers using MSYS2 or Cygwin Command Prompts.</p>
<p class="mce-root"/>
<p>We'll be using <kbd>clang</kbd> rather than <kbd>gcc</kbd> as it's more portable by design. For this process to work, you'll need to have <kbd>clang</kbd>, <kbd>cmake</kbd>, and <kbd>libxml2-dev</kbd> installed using your package manager:</p>
<ul>
<li>On Linux use: <kbd>pacman -S clang cmake libxml2-dev</kbd> (or <kbd>apt-get</kbd> or <kbd>yum</kbd>, depending on your distribution)</li>
<li>On Windows use: <kbd>pacman -S mingw-w64-x86_64-clang mingw-w64<span>-x86_64</span>-cmake mingw-w64<span>-x86_64</span>-libxml2</kbd></li>
</ul>
<p>Next, we need to download the macOS SDK, which is bundled with Xcode. If you don't already have an Apple developer account, you'll need to sign up and agree to their terms and conditions. Using this account, log in to the download site at <a href="https://developer.apple.com/download/more/?name=Xcode%207.3">https://developer.apple.com/download/more/?name=Xcode%207.3</a><span> </span>and download <kbd>XCode.dmg</kbd> (7.3.1 is recommended for osxcross).</p>
<p>Then, we can install the osxcross tool—start by downloading it with <kbd>git clone https://github.com/tpoechtrager/osxcross.git</kbd> and then change into the downloaded directory. Using these tools, we extract the macOS SDK from the downloaded <kbd>Xcode.dmg</kbd> file using the package tool <span>provided</span>, <span><kbd>./tools/gen_sdk_package_darling_dmg.sh &lt;path to Xcode.dmg&gt;</kbd>. The resulting <kbd>MacOSX10.11.sdk.tar.xz</kbd> file should be copied into the <kbd>tarballs/</kbd> directory.</span></p>
<p>Lastly, we build the osxcross compiler extension by executing<span> </span><kbd>./build.sh</kbd>. Following this, there should be a new directory named<span> </span><kbd>target/bin/</kbd><span>, </span>which you should add to your <kbd>PATH</kbd> environment variable. The compiler can now be used in CGo builds by setting the environment variable, <kbd>CC=o32-clang</kbd>. More details about this process and how to adapt it for other platforms are available on the osxcross project website at<span> </span><a href="https://github.com/tpoechtrager/osxcross">https://github.com/tpoechtrager/osxcross</a>.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross compiling for Windows with CGo</h1>
                </header>
            
            <article>
                
<p>Building for Windows from another platform requires an installation of the <kbd>mingw</kbd> toolchain (similar to that which we installed on Windows to support CGo). This should be available in your package manager with a name similar to <kbd>mingw-w64-clang</kbd> or <kbd>w64-mingw</kbd>, but if not, you can install directly using the instructions at<span> </span><a href="https://github.com/tpoechtrager/wclang">https://github.com/tpoechtrager/wclang</a>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To Windows from macOS</h1>
                </header>
            
            <article>
                
<p>To install the packages on macOS, it's recommended to use the Homebrew package manager. You probably already have this installed from earlier chapters in this book (for example, when setting up the GTK+ library), but if not, you can download it from <a href="https://brew.sh">https://brew.sh</a>. Once Homebrew is set up, the compiler package is installed using <kbd>brew install mingw-w64</kbd>.</p>
<p>Once installed, the compiler can be used with CGo by setting <kbd><span>CC=x86_64-w64-mingw32-gcc</span></kbd> (for the C toolchain) and<span> </span><kbd>CXX=x86_64-w64-mingw32-g++</kbd> (for C++ requirements).</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To Windows from Linux</h1>
                </header>
            
            <article>
                
<p>Installing on Linux should just require finding the correct package in your distribution's listing. For example, for Debian or Ubuntu, you would execute <kbd>sudo apt-get install gcc-mingw-w64</kbd>.</p>
<p><span>Once installed, the compiler can be used with CGo by setting </span><kbd><span>CC=x86_64-w64-mingw32-gcc</span></kbd><span> (for the C toolchain) and</span><span> </span><kbd>CXX=x86_64-w64-mingw32-g++</kbd><span> (for C++ requirements).</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross compiling for Linux with CGo</h1>
                </header>
            
            <article>
                
<p>To cross compile for Linux, we'll need a GCC or compatible compiler that can build Linux binary files. On macOS, the easiest platform to use is musl-cross (musl has many other advantages that you can read more about at <a href="http://www.etalabs.net/compare_libcs.html">www.etalabs.net/compare_libcs.html</a>). On Windows, the <kbd>linux-gcc</kbd> package will be suitable. Let's work through the steps for each of these.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To Linux from macOS</h1>
                </header>
            
            <article>
                
<p>To install the dependencies for cross compiling for Linux, we'll use the Homebrew package manager again—see the previous sections or <a href="https://brew.sh/">https://brew.sh/</a> for installation instructions. Using Homebrew, we'll install the appropriate packages by opening a Terminal and executing the following commands (the<span> </span><kbd>HOMEBREW_BUILD_FROM_SOURCE</kbd> variable works around an issue with musl-cross depending on potentially old versions of libraries):</p>
<ul>
<li><kbd>export<span> HOMEBREW_BUILD_FROM_SOURCE=1</span></kbd></li>
<li><kbd>brew install <span>FiloSottile/musl-cross/musl-cross</span></kbd></li>
</ul>
<p>Once the installation is complete (this may take some time as it's building a complete compiler toolchain from source), you should be able to build for Linux. To do so, you'll need to set the environment variables,<span> <kbd>CC=x86_64-linux-musl-gcc</kbd> and <kbd>CXX=x86_64-linux-musl-g++</kbd></span><span>.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">To Linux from Windows</h1>
                </header>
            
            <article>
                
<p><span>Using MSYS2 as earlier, we can install the <kbd>gcc</kbd> package to provide cross compilation for Linux:</span></p>
<pre><strong>pacman -S gcc</strong></pre>
<p>After the installation has completed, we can tell our Go compiler to use <kbd>gcc</kbd> by setting the environment variable <kbd>CC=gcc</kbd>. Compilation should now succeed following the instructions in your current example, such as the following:</p>
<pre><strong>GOOS=linux CGO_ENABLED=1 CC=gcc go build</strong></pre>
<p>It's possible, at this point, that you may see additional errors due to missing headers. To fix this, you'll need to search for, and install, the required libraries. If, for example, your error stated that SDL couldn't be found then you would use <kbd>pacman -Ss sdl</kbd> to search for the right package to install. If you can't find an appropriate package, you may need to install Cygwin <a href="https://www.cygwin.com/">www.cygwin.com/</a> (as it has a larger package library) or Windows subsystem for Linux <a href="https://docs.microsoft.com/en-us/windows/wsl/">docs.microsoft.com/en-us/windows/wsl/</a> (as that brings a full Linux distribution to your Windows desktop).</p>


            </article>

            
        </section>
    </div>



  </body></html>