<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer110">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 class="chapterTitle" id="_idParaDest-148"><span class="koboSpan" id="kobo.2.1">Go Packages and Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">The focus of this chapter is on Go packages, which are the Go way of organizing, delivering, and using code. </span><span class="koboSpan" id="kobo.3.2">Packages are used to organize related functionality in your code. </span><span class="koboSpan" id="kobo.3.3">As the package author, you design the package, including the public API consisting of exported constants, variables, types, and functions. </span><span class="koboSpan" id="kobo.3.4">Go also supports modules, which contain one or more packages. </span><span class="koboSpan" id="kobo.3.5">Modules are versioned following SemVer, allowing the module author to release updates and even breaking changes using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.4.1">major.minor.patch</span></code><span class="koboSpan" id="kobo.5.1"> versioning scheme. </span><span class="koboSpan" id="kobo.5.2">This chapter will also explain the operation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.6.1">defer</span></code><span class="koboSpan" id="kobo.7.1">, which is typically used for cleaning up and releasing resources.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">Regarding the visibility of package elements, Go follows a simple rule which states that functions, variables, data types, structure fields, and so forth that begin with an uppercase letter are public, whereas functions, variables, types, and so forth that begin with a lowercase letter are private. </span><span class="koboSpan" id="kobo.8.2">This is the reason why </span><code class="inlineCode"><span class="koboSpan" id="kobo.9.1">fmt.Println()</span></code><span class="koboSpan" id="kobo.10.1"> is named </span><code class="inlineCode"><span class="koboSpan" id="kobo.11.1">Println()</span></code><span class="koboSpan" id="kobo.12.1"> instead of just </span><code class="inlineCode"><span class="koboSpan" id="kobo.13.1">println()</span></code><span class="koboSpan" id="kobo.14.1">. </span><span class="koboSpan" id="kobo.14.2">The same rule applies not only to the name of a struct variable but to the fields of a struct variableâ€”in practice, this means that you can have a struct variable with both private and public fields. </span><span class="koboSpan" id="kobo.14.3">However, this rule does not affect package names, which are allowed to begin with either uppercase or lowercase letters. </span><span class="koboSpan" id="kobo.14.4">In fact, the names of packages, including </span><code class="inlineCode"><span class="koboSpan" id="kobo.15.1">main</span></code><span class="koboSpan" id="kobo.16.1">, are in lowercase.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.17.1">There is a simple guideline that governs Go: </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.18.1">Do not use any of its features prematurely</span></strong><span class="koboSpan" id="kobo.19.1">. </span><span class="koboSpan" id="kobo.19.2">This guideline applies to generics, interfaces, and packages. </span><span class="koboSpan" id="kobo.19.3">Put simply, do not create a package just because you can. </span><span class="koboSpan" id="kobo.19.4">Start developing your application in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.20.1">main</span></code><span class="koboSpan" id="kobo.21.1"> package and write your functions in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.22.1">main</span></code><span class="koboSpan" id="kobo.23.1"> package until you find out that the same code needs to be used from other Go applications or that you are writing too many functions that can be grouped in packages. </span><span class="koboSpan" id="kobo.23.2">In that case, grouping and putting related functionality in a separate package makes perfect sense. </span><span class="koboSpan" id="kobo.23.3">Other reasons for developing code in separate packages include the encapsulation, testing, and security of exposed functionality.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.24.1">In summary, this chapter covers:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.25.1">Go packages</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.26.1">Functions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.27.1">Big O complexity</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.28.1">Developing your own packages</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.29.1">Using GitHub to store Go packages</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.30.1">Modules</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.31.1">Creating better packages</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.32.1">Creating documentation</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.33.1">Workspaces</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.34.1">Versioning utilities</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-149"><span class="koboSpan" id="kobo.35.1">Go packages</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.36.1">Everything in Go is </span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.37.1">delivered in the form of packages. </span><span class="koboSpan" id="kobo.37.2">A Go package is a Go source file that begins with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.38.1">package</span></code><span class="koboSpan" id="kobo.39.1"> keyword, followed by the name of the package.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.40.1">Note that packages can have structure. </span><span class="koboSpan" id="kobo.40.2">For example, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">net</span></code><span class="koboSpan" id="kobo.42.1"> package has several subdirectories, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">http</span></code><span class="koboSpan" id="kobo.44.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1">mail</span></code><span class="koboSpan" id="kobo.46.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">rpc</span></code><span class="koboSpan" id="kobo.48.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.49.1">smtp</span></code><span class="koboSpan" id="kobo.50.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">textproto</span></code><span class="koboSpan" id="kobo.52.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">url</span></code><span class="koboSpan" id="kobo.54.1">, which should be imported as </span><code class="inlineCode"><span class="koboSpan" id="kobo.55.1">net/http</span></code><span class="koboSpan" id="kobo.56.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">net/mail</span></code><span class="koboSpan" id="kobo.58.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.59.1">net/rpc</span></code><span class="koboSpan" id="kobo.60.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">net/smtp</span></code><span class="koboSpan" id="kobo.62.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.63.1">net/textproto</span></code><span class="koboSpan" id="kobo.64.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">net/url</span></code><span class="koboSpan" id="kobo.66.1">, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.67.1">Apart from the packages of the Go standard library, there are external packages that are imported using their full address and that should be downloaded on the local machine, before their first use. </span><span class="koboSpan" id="kobo.67.2">One such example is </span><a href="https://github.com/spf13/cobra"><span class="url"><span class="koboSpan" id="kobo.68.1">https://github.com/spf13/cobra</span></span></a><span class="koboSpan" id="kobo.69.1">, which is stored in GitHub.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.70.1">Packages are mainly used for grouping </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.71.1">related</span></strong><span class="koboSpan" id="kobo.72.1"> functions, variables, and constants so that you can transfer them easily and use them in your own Go programs. </span><span class="koboSpan" id="kobo.72.2">Note that apart from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">main</span></code><span class="koboSpan" id="kobo.74.1"> package, Go packages are not autonomous programs and cannot be compiled into executable files on their own. </span><span class="koboSpan" id="kobo.74.2">As a result, if you try to execute a Go package as if it were an autonomous program, you are going to be disappointed:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.75.1">$ </span></span><span class="koboSpan" id="kobo.76.1">go run aPackage.go
go run: cannot run non-main package
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.77.1">Instead, packages need to be called directly or indirectly from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">main</span></code><span class="koboSpan" id="kobo.79.1"> package in order to be used, as we</span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.80.1"> have shown in previous chapters.</span></p>
<h2 class="heading-2" id="_idParaDest-150"><span class="koboSpan" id="kobo.81.1">About go get and go install</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.82.1">In this subsection, you </span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.83.1">will learn how to download external Go packages using </span><a href="https://github.com/spf13/cobra"><span class="url"><span class="koboSpan" id="kobo.84.1">https://github.com/spf13/cobra</span></span></a><span class="koboSpan" id="kobo.85.1"> as an example. </span><span class="koboSpan" id="kobo.85.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">go get</span></code><span class="koboSpan" id="kobo.87.1"> command for downloading the </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">cobra</span></code><span class="koboSpan" id="kobo.89.1"> package is as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.90.1">$ </span></span><span class="koboSpan" id="kobo.91.1">go get github.com/spf13/cobra
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.92.1">However, as we are going to learn in a while, with all recent Go versions, the recommended way to download a package is with </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">go install</span></code><span class="koboSpan" id="kobo.94.1">. </span><span class="koboSpan" id="kobo.94.2">You can learn more about that change at </span><a href="https://go.dev/doc/go-get-install-deprecation"><span class="url"><span class="koboSpan" id="kobo.95.1">https://go.dev/doc/go-get-install-deprecation</span></span></a><span class="koboSpan" id="kobo.96.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.97.1">Note that you can download the package without using </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1">https://</span></code><span class="koboSpan" id="kobo.99.1"> in its address. </span><span class="koboSpan" id="kobo.99.2">The results can be found inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.100.1">~/go</span></code><span class="koboSpan" id="kobo.101.1"> directoryâ€”the full path is </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">~/go/src/github.com/spf13/cobra</span></code><span class="koboSpan" id="kobo.103.1">. </span><span class="koboSpan" id="kobo.103.2">As the </span><code class="inlineCode"><span class="koboSpan" id="kobo.104.1">cobra</span></code><span class="koboSpan" id="kobo.105.1"> package comes with a binary file that helps you structure and create command line utilities, you can find that binary file inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1">~/go/bin</span></code><span class="koboSpan" id="kobo.107.1"> as </span><code class="inlineCode"><span class="koboSpan" id="kobo.108.1">cobra</span></code><span class="koboSpan" id="kobo.109.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.110.1">The following output, which was created with the help of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.111.1">tree(1)</span></code><span class="koboSpan" id="kobo.112.1"> utility, shows a high-level view with 3 levels of detail of the structure of </span><code class="inlineCode"><span class="koboSpan" id="kobo.113.1">~/go</span></code><span class="koboSpan" id="kobo.114.1"> on my machine:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.115.1">$ </span></span><span class="koboSpan" id="kobo.116.1">tree ~/go -L 3
/Users/mtsouk/go
â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ benchstat
â”‚   â”œâ”€â”€ client
â”‚   â”œâ”€â”€ cobra
â”‚   â”œâ”€â”€ dlv
â”‚   â”œâ”€â”€ dlv-dap
â”‚   â”œâ”€â”€ fillstruct
â”‚   â”œâ”€â”€ go-outline
â”‚   â”œâ”€â”€ go-symbols
â”‚   â”œâ”€â”€ gocode
â”‚   â”œâ”€â”€ gocode-gomod
â”‚   â”œâ”€â”€ godef
â”‚   â”œâ”€â”€ godoc
â”‚   â”œâ”€â”€ godoctor
â”‚   â”œâ”€â”€ golint
â”‚   â”œâ”€â”€ gomodifytags
â”‚   â”œâ”€â”€ gopkgs
â”‚   â”œâ”€â”€ goplay
â”‚   â”œâ”€â”€ gopls
â”‚   â”œâ”€â”€ gorename
â”‚   â”œâ”€â”€ goreturns
â”‚   â”œâ”€â”€ gotests
â”‚   â”œâ”€â”€ guru
â”‚   â”œâ”€â”€ impl
â”‚   â””â”€â”€ staticcheck
â”œâ”€â”€ pkg
â”‚   â”œâ”€â”€ darwin_amd64
â”‚   â”‚   â””â”€â”€ github.com
â”‚   â””â”€â”€ sumdb
â”‚       â””â”€â”€ sum.golang.org
â””â”€â”€ src
    â”œâ”€â”€ document
    â”‚   â””â”€â”€ document.go
    â”œâ”€â”€ github.com
    â”‚   â”œâ”€â”€ agext
    â”‚   â”œâ”€â”€ apparentlymart
    â”‚   â”œâ”€â”€ fsnotify
    â”‚   â”œâ”€â”€ hashicorp
    â”‚   â”œâ”€â”€ mactsouk
    â”‚   â”œâ”€â”€ magiconair
    â”‚   â”œâ”€â”€ mitchellh
    â”‚   â”œâ”€â”€ pelletier
    â”‚   â”œâ”€â”€ spf13
    â”‚   â”œâ”€â”€ subosito
    â”‚   â””â”€â”€ zclconf
    â”œâ”€â”€ golang.org
    â”‚   â””â”€â”€ x
    â””â”€â”€ gopkg.in
        â”œâ”€â”€ ini.v1
        â””â”€â”€ yaml.v2
26 directories, 25 files
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.117.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.118.1">x</span></code><span class="koboSpan" id="kobo.119.1"> path, which is </span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.120.1">displayed near the end of the output, is used by the Go team for storing experiment packages that might become part of the standard Go library in the future.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.121.1">Basically, there are three main directories under </span><code class="inlineCode"><span class="koboSpan" id="kobo.122.1">~/go</span></code><span class="koboSpan" id="kobo.123.1">, with the following properties:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.124.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">bin</span></code><span class="koboSpan" id="kobo.126.1"> directory: This is where binary tools are placed.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.127.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.128.1">pkg</span></code><span class="koboSpan" id="kobo.129.1"> directory: This is where reusable packages are put. </span><span class="koboSpan" id="kobo.129.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.130.1">darwin_amd64</span></code><span class="koboSpan" id="kobo.131.1"> directory, which can be found on macOS machines only, contains compiled versions of the installed packages. </span><span class="koboSpan" id="kobo.131.2">On a Linux machine, you can find a </span><code class="inlineCode"><span class="koboSpan" id="kobo.132.1">linux_amd64</span></code><span class="koboSpan" id="kobo.133.1"> directory instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">darwin_amd64</span></code><span class="koboSpan" id="kobo.135.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.136.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.137.1">src</span></code><span class="koboSpan" id="kobo.138.1"> directory: This is where the source code of the packages is located. </span><span class="koboSpan" id="kobo.138.2">The underlying structure is based on the URL of the package you are looking for. </span><span class="koboSpan" id="kobo.138.3">So, the URL for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1">github.com/spf13/vipe</span></code><span class="koboSpan" id="kobo.140.1">r package is </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">~/go/src/github.com/spf13/viper</span></code><span class="koboSpan" id="kobo.142.1">. </span><span class="koboSpan" id="kobo.142.2">If a package is downloaded as a module, then it will be located under </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1">~/go/pkg/mod</span></code><span class="koboSpan" id="kobo.144.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.145.1">Starting with Go 1.16, </span><code class="inlineCode"><span class="koboSpan" id="kobo.146.1">go install</span></code><span class="koboSpan" id="kobo.147.1"> is the recommended way of building and installing packages in module mode and you should only use that way. </span><span class="koboSpan" id="kobo.147.2">The use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.148.1">go get</span></code><span class="koboSpan" id="kobo.149.1"> is deprecated, but this chapter uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.150.1">go get</span></code><span class="koboSpan" id="kobo.151.1"> because it is commonly used online and is worth knowing about. </span><span class="koboSpan" id="kobo.151.2">However, most of the chapters in this book use </span><code class="inlineCode"><span class="koboSpan" id="kobo.152.1">go mod</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.153.1">init</span></code><span class="koboSpan" id="kobo.154.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1">go mod tidy</span></code><span class="koboSpan" id="kobo.156.1"> for downloading external dependencies for your own source files, which is the recommended way.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.157.1">If you want to upgrade an existing package, you should execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">go get</span></code><span class="koboSpan" id="kobo.159.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.160.1">-u</span></code><span class="koboSpan" id="kobo.161.1"> option. </span><span class="koboSpan" id="kobo.161.2">Additionally, if you want to see what is happening behind the scenes, add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.162.1">-v</span></code><span class="koboSpan" id="kobo.163.1"> option to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.164.1">go get</span></code><span class="koboSpan" id="kobo.165.1"> commandâ€”in this case, we are using the Viper package as an example, but we </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.166.1">abbreviate the output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.167.1">$ </span></span><span class="koboSpan" id="kobo.168.1">go get -v github.com/spf13/viper
github.com/spf13/viper (download)
...
</span><span class="koboSpan" id="kobo.168.2">github.com/spf13/afero (download)
get "golang.org/x/text/transform": found meta tag get.metaImport{Prefix:"golang.org/x/text", VCS:"git", RepoRoot:"https://go.googlesource.com/text"} at //golang.org/x/text/transform?go-get=1
get "golang.org/x/text/transform": verifying non-authoritative meta tag
...
</span><span class="koboSpan" id="kobo.168.3">github.com/fsnotify/fsnotify
github.com/spf13/viper
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.169.1">What you can basically see in the output is the dependencies of the initial package being downloaded before the desired packageâ€”most of the time, you do not want to know that.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.170.1">We will continue this</span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.171.1"> chapter by looking at the most important package element: functions.</span></p>
<h1 class="heading-1" id="_idParaDest-151"><span class="koboSpan" id="kobo.172.1">Functions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.173.1">The main elements </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.174.1">of packages are functions, which are the subject of this section.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.175.1">Type methods and functions are implemented in the same way and, sometimes, the terms functions and type methods are used interchangeably.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.176.1">A piece of advice: functions must be as independent of each other as possible and must do one job (and only one job) well. </span><span class="koboSpan" id="kobo.176.2">So, if you find yourself writing functions that do multiple things, you might want to consider replacing them with multiple functions instead.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.177.1">You should already know that all function definitions begin with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.178.1">func</span></code><span class="koboSpan" id="kobo.179.1"> keyword, followed by the functionâ€™s signature and its implementation, and that functions accept none, one, or multiple arguments and return none, one, or multiple values back. </span><span class="koboSpan" id="kobo.179.2">The single most popular Go function is </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">main()</span></code><span class="koboSpan" id="kobo.181.1">, which is used in every executable Go programâ€”the </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">main()</span></code><span class="koboSpan" id="kobo.183.1"> function accepts no parameters and returns nothing, but it is the starting point of every Go program. </span><span class="koboSpan" id="kobo.183.2">Additionally, when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.184.1">main()</span></code><span class="koboSpan" id="kobo.185.1"> function ends along with the goroutine that executes it, the entire program ends as well.</span></p>
<h2 class="heading-2" id="_idParaDest-152"><span class="koboSpan" id="kobo.186.1">Anonymous functions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.187.1">Anonymous functions </span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.188.1">can be defined inline without the need for </span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.189.1">a name, and they are usually used for implementing things that require a small amount of code. </span><span class="koboSpan" id="kobo.189.2">In Go, a function can return an anonymous function or take an anonymous function as one of its arguments. </span><span class="koboSpan" id="kobo.189.3">Additionally, anonymous functions can be attached to Go variables. </span><span class="koboSpan" id="kobo.189.4">Note that anonymous functions are called </span><em class="italic"><span class="koboSpan" id="kobo.190.1">lambdas</span></em><span class="koboSpan" id="kobo.191.1"> in functional programming terminology. </span><span class="koboSpan" id="kobo.191.2">Similarly, a </span><em class="italic"><span class="koboSpan" id="kobo.192.1">closure</span></em><span class="koboSpan" id="kobo.193.1"> is a specific type of anonymous function that carries or closes over variables that are in the same lexical scope as the anonymous function that was defined.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.194.1">It is considered a good practice for anonymous functions to have a small implementation and a local focus. </span><span class="koboSpan" id="kobo.194.2">If an anonymous function does not have a local focus, then you might need to consider making it a regular function. </span><span class="koboSpan" id="kobo.194.3">When an anonymous function is suitable for a job, it is extremely convenient and makes your life easier; just do not use too many anonymous functions in your programs without having a good reason. </span><span class="koboSpan" id="kobo.194.4">We will look at </span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.195.1">anonymous functions in action in a </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.196.1">while.</span></p>
<h2 class="heading-2" id="_idParaDest-153"><span class="koboSpan" id="kobo.197.1">Functions that return multiple values</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.198.1">As you already</span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.199.1"> know from functions such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.200.1">strconv.Atoi()</span></code><span class="koboSpan" id="kobo.201.1">, functions can return multiple distinct values, which saves you from having to create a dedicated structure for returning and receiving multiple values from a function. </span><span class="koboSpan" id="kobo.201.2">However, if you have a function that returns more than 3 values, you should reconsider that decision and maybe redesign it to use a single structure or slice for grouping and returning the desired values as a single entityâ€”this makes handling the returned values simpler and easier. </span><span class="koboSpan" id="kobo.201.3">Functions, anonymous functions, and functions that return multiple values are all illustrated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">functions.go</span></code><span class="koboSpan" id="kobo.203.1">, as shown in the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.204.1">package</span></span><span class="koboSpan" id="kobo.205.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.206.1">import</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.207.1">"fmt"</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.208.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.209.1">doubleSquare</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.210.1">(x </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.211.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.212.1">)</span></span><span class="koboSpan" id="kobo.213.1"> (</span><span class="hljs-type"><span class="koboSpan" id="kobo.214.1">int</span></span><span class="koboSpan" id="kobo.215.1">, </span><span class="hljs-type"><span class="koboSpan" id="kobo.216.1">int</span></span><span class="koboSpan" id="kobo.217.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.218.1">return</span></span><span class="koboSpan" id="kobo.219.1"> x * </span><span class="hljs-number"><span class="koboSpan" id="kobo.220.1">2</span></span><span class="koboSpan" id="kobo.221.1">, x * x
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.222.1">This function returns two </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">int</span></code><span class="koboSpan" id="kobo.224.1"> values, without the need for having separate variables to keep themâ€”the returned values are created on the fly. </span><span class="koboSpan" id="kobo.224.2">Note the compulsory use of parentheses when a function returns more than one value.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.225.1">// Sorting from smaller to bigger value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.226.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.227.1">sortTwo</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.228.1">(x, y </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.229.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.230.1">)</span></span><span class="koboSpan" id="kobo.231.1"> (</span><span class="hljs-type"><span class="koboSpan" id="kobo.232.1">int</span></span><span class="koboSpan" id="kobo.233.1">, </span><span class="hljs-type"><span class="koboSpan" id="kobo.234.1">int</span></span><span class="koboSpan" id="kobo.235.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.236.1">if</span></span><span class="koboSpan" id="kobo.237.1"> x &gt; y {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.238.1">return</span></span><span class="koboSpan" id="kobo.239.1"> y, x
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.240.1">return</span></span><span class="koboSpan" id="kobo.241.1"> x, y
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.242.1">The preceding function returns two </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">int</span></code><span class="koboSpan" id="kobo.244.1"> values as well.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.245.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.246.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.247.1">()</span></span><span class="koboSpan" id="kobo.248.1"> {
    n := </span><span class="hljs-number"><span class="koboSpan" id="kobo.249.1">10</span></span><span class="koboSpan" id="kobo.250.1">
    d, s := doubleSquare(n)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.251.1">The previous statement reads the two return values of </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">doubleSquare()</span></code><span class="koboSpan" id="kobo.253.1"> and saves them in </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">d</span></code><span class="koboSpan" id="kobo.255.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">s</span></code><span class="koboSpan" id="kobo.257.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.258.1">    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.259.1">"Double of"</span></span><span class="koboSpan" id="kobo.260.1">, n, </span><span class="hljs-string"><span class="koboSpan" id="kobo.261.1">"is"</span></span><span class="koboSpan" id="kobo.262.1">, d)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.263.1">"Square of"</span></span><span class="koboSpan" id="kobo.264.1">, n, </span><span class="hljs-string"><span class="koboSpan" id="kobo.265.1">"is"</span></span><span class="koboSpan" id="kobo.266.1">, s)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.267.1">// An anonymous function</span></span><span class="koboSpan" id="kobo.268.1">
    anF := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.269.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.270.1">(param </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.271.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.272.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.273.1">int</span></span><span class="koboSpan" id="kobo.274.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.275.1">return</span></span><span class="koboSpan" id="kobo.276.1"> param * param
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.277.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">anF</span></code><span class="koboSpan" id="kobo.279.1"> variable holds an anonymous function that requires a single parameter as input and returns a single value. </span><span class="koboSpan" id="kobo.279.2">The only difference between an anonymous function and a regular one is that the name of the anonymous function is </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">func()</span></code><span class="koboSpan" id="kobo.281.1"> and that there is no </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">func</span></code><span class="koboSpan" id="kobo.283.1"> keyword.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.284.1">    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.285.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.286.1">anF of"</span></span><span class="koboSpan" id="kobo.287.1">, n, </span><span class="hljs-string"><span class="koboSpan" id="kobo.288.1">"is"</span></span><span class="koboSpan" id="kobo.289.1">, anF(n))
    fmt.Println(sortTwo(</span><span class="hljs-number"><span class="koboSpan" id="kobo.290.1">1</span></span><span class="koboSpan" id="kobo.291.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.292.1">-3</span></span><span class="koboSpan" id="kobo.293.1">))
    fmt.Println(sortTwo(</span><span class="hljs-number"><span class="koboSpan" id="kobo.294.1">-1</span></span><span class="koboSpan" id="kobo.295.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.296.1">0</span></span><span class="koboSpan" id="kobo.297.1">))
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.298.1">The last two statements print the return values of </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">sortTwo()</span></code><span class="koboSpan" id="kobo.300.1">. </span><span class="koboSpan" id="kobo.300.2">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">functions.go</span></code><span class="koboSpan" id="kobo.302.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.303.1">Double of 10 is 20
Square of 10 is 100
anF of 10 is 100
-3 1
-1 0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.304.1">The subsection</span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.305.1"> that follows illustrates functions that have named return values.</span></p>
<h2 class="heading-2" id="_idParaDest-154"><span class="koboSpan" id="kobo.306.1">The return values of a function can be named</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.307.1">Unlike C, Go allows</span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.308.1"> you to name the return values of a Go function. </span><span class="koboSpan" id="kobo.308.2">Additionally, when such a function has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.309.1">return</span></code><span class="koboSpan" id="kobo.310.1"> statement without any arguments, the function automatically returns the current value of each named return value, in the order in which they were declared in the function signature.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.311.1">The following function is included in </span><code class="inlineCode"><span class="koboSpan" id="kobo.312.1">namedReturn.go</span></code><span class="koboSpan" id="kobo.313.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.314.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.315.1">minMax</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.316.1">(x, y </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.317.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.318.1">)</span></span><span class="koboSpan" id="kobo.319.1"> (min, max </span><span class="hljs-type"><span class="koboSpan" id="kobo.320.1">int</span></span><span class="koboSpan" id="kobo.321.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.322.1">if</span></span><span class="koboSpan" id="kobo.323.1"> x &gt; y {
        min = y
        max = x
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.324.1">return</span></span><span class="koboSpan" id="kobo.325.1"> min, max
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.326.1">This </span><code class="inlineCode"><span class="koboSpan" id="kobo.327.1">return</span></code><span class="koboSpan" id="kobo.328.1"> statement returns the values stored in the min and max variablesâ€”both </span><code class="inlineCode"><span class="koboSpan" id="kobo.329.1">min</span></code><span class="koboSpan" id="kobo.330.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">max</span></code><span class="koboSpan" id="kobo.332.1"> are defined in the function signature and not in the function body.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.333.1">    }
    min = x
    max = y
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.334.1">return</span></span><span class="koboSpan" id="kobo.335.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.336.1">This </span><code class="inlineCode"><span class="koboSpan" id="kobo.337.1">return</span></code><span class="koboSpan" id="kobo.338.1"> statement is equivalent to </span><code class="inlineCode"><span class="koboSpan" id="kobo.339.1">return min, max</span></code><span class="koboSpan" id="kobo.340.1">, which is based on the function signature and the use of named return values.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.341.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.342.1">namedReturn.go</span></code><span class="koboSpan" id="kobo.343.1"> produces</span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.344.1"> the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.345.1">$ </span></span><span class="koboSpan" id="kobo.346.1">go run namedReturn.go 1 -2
-2 1
-2 1
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-155"><span class="koboSpan" id="kobo.347.1">Functions that accept other functions as parameters</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.348.1">Functions can</span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.349.1"> accept other functions as parameters. </span><span class="koboSpan" id="kobo.349.2">The best example of a function that accepts another function as an argument can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">sort</span></code><span class="koboSpan" id="kobo.351.1"> package. </span><span class="koboSpan" id="kobo.351.2">You can provide the </span><code class="inlineCode"><span class="koboSpan" id="kobo.352.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.353.1"> function with another function as an argument that specifies the way sorting is implemented. </span><span class="koboSpan" id="kobo.353.2">The signature of </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.355.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">func Slice(slice interface{}, less func(i, j int) bool)</span></code><span class="koboSpan" id="kobo.357.1">. </span><span class="koboSpan" id="kobo.357.2">This means the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.358.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.359.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.360.1"> function does not return any data.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.361.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.362.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.363.1"> function requires two arguments, a slice of type </span><code class="inlineCode"><span class="koboSpan" id="kobo.364.1">interface{}</span></code><span class="koboSpan" id="kobo.365.1"> and another functionâ€”the slice variable is modified inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.366.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.367.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.368.1">The function parameter of </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.370.1"> is named </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">less</span></code><span class="koboSpan" id="kobo.372.1"> and should have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">func(i, j int) bool</span></code><span class="koboSpan" id="kobo.374.1"> signatureâ€”there is no need for you to name the anonymous function. </span><span class="koboSpan" id="kobo.374.2">The name </span><code class="inlineCode"><span class="koboSpan" id="kobo.375.1">less</span></code><span class="koboSpan" id="kobo.376.1"> is required because all function parameters should have a name.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.377.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.378.1">i</span></code><span class="koboSpan" id="kobo.379.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.380.1">j</span></code><span class="koboSpan" id="kobo.381.1"> parameters of </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1">less</span></code><span class="koboSpan" id="kobo.383.1"> are indexes of the slice parameter.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.384.1">Similarly, there is another function in the sort package named </span><code class="inlineCode"><span class="koboSpan" id="kobo.385.1">sort.SliceIsSorted()</span></code><span class="koboSpan" id="kobo.386.1"> that is defined as </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">func SliceIsSorted(slice interface{}, less func(i, j int) bool) bool</span></code><span class="koboSpan" id="kobo.388.1">. </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">sort.SliceIsSorted()</span></code><span class="koboSpan" id="kobo.390.1"> returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">bool</span></code><span class="koboSpan" id="kobo.392.1"> value and checks whether the slice parameter is sorted according to the rules of the second parameter, which is a function.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.393.1">You are not obliged to use an anonymous function in either </span><code class="inlineCode"><span class="koboSpan" id="kobo.394.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.395.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">sort.SliceIsSorted()</span></code><span class="koboSpan" id="kobo.397.1">. </span><span class="koboSpan" id="kobo.397.2">You can define a regular function with the required signature and use that. </span><span class="koboSpan" id="kobo.397.3">However, using an anonymous function is more convenient.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.398.1">The use of both </span><code class="inlineCode"><span class="koboSpan" id="kobo.399.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.400.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.401.1">sort.SliceIsSorted()</span></code><span class="koboSpan" id="kobo.402.1"> is illustrated in the Go program that followsâ€”the </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.403.1">name of the source file is </span><code class="inlineCode"><span class="koboSpan" id="kobo.404.1">sorting.go</span></code><span class="koboSpan" id="kobo.405.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.406.1">package</span></span><span class="koboSpan" id="kobo.407.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.408.1">import</span></span><span class="koboSpan" id="kobo.409.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.410.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.411.1">"sort"</span></span><span class="koboSpan" id="kobo.412.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.413.1">type</span></span><span class="koboSpan" id="kobo.414.1"> Grades </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.415.1">struct</span></span><span class="koboSpan" id="kobo.416.1"> {
    Name    </span><span class="hljs-type"><span class="koboSpan" id="kobo.417.1">string</span></span><span class="koboSpan" id="kobo.418.1">
    Surname </span><span class="hljs-type"><span class="koboSpan" id="kobo.419.1">string</span></span><span class="koboSpan" id="kobo.420.1">
    Grade   </span><span class="hljs-type"><span class="koboSpan" id="kobo.421.1">int</span></span><span class="koboSpan" id="kobo.422.1">
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.423.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.424.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.425.1">()</span></span><span class="koboSpan" id="kobo.426.1"> {
    data := []Grades{{</span><span class="hljs-string"><span class="koboSpan" id="kobo.427.1">"J."</span></span><span class="koboSpan" id="kobo.428.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.429.1">"Lewis"</span></span><span class="koboSpan" id="kobo.430.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.431.1">10</span></span><span class="koboSpan" id="kobo.432.1">}, {</span><span class="hljs-string"><span class="koboSpan" id="kobo.433.1">"M."</span></span><span class="koboSpan" id="kobo.434.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.435.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.436.1">Tsoukalos"</span></span><span class="koboSpan" id="kobo.437.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.438.1">7</span></span><span class="koboSpan" id="kobo.439.1">},
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.440.1">"D."</span></span><span class="koboSpan" id="kobo.441.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.442.1">"Tsoukalos"</span></span><span class="koboSpan" id="kobo.443.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.444.1">8</span></span><span class="koboSpan" id="kobo.445.1">}, {</span><span class="hljs-string"><span class="koboSpan" id="kobo.446.1">"J."</span></span><span class="koboSpan" id="kobo.447.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.448.1">"Lewis"</span></span><span class="koboSpan" id="kobo.449.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.450.1">9</span></span><span class="koboSpan" id="kobo.451.1">}}
    isSorted := sort.SliceIsSorted(data, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.452.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.453.1">(i, j </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.454.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.455.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.456.1">bool</span></span><span class="koboSpan" id="kobo.457.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.458.1">return</span></span><span class="koboSpan" id="kobo.459.1"> data[i].Grade &lt; data[j].Grade
    })
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.460.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">if else</span></code><span class="koboSpan" id="kobo.462.1"> block that follows checks the </span><code class="inlineCode"><span class="koboSpan" id="kobo.463.1">bool</span></code><span class="koboSpan" id="kobo.464.1"> value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.465.1">sort.SliceIsSorted()</span></code><span class="koboSpan" id="kobo.466.1"> to determine whether the slice was sorted or not:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.467.1">if</span></span><span class="koboSpan" id="kobo.468.1"> isSorted {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.469.1">"It is sorted!"</span></span><span class="koboSpan" id="kobo.470.1">)
    } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.471.1">else</span></span><span class="koboSpan" id="kobo.472.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.473.1">"It is NOT sorted!"</span></span><span class="koboSpan" id="kobo.474.1">)
    }
    sort.Slice(data,
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.475.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.476.1">(i, j </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.477.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.478.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.479.1">bool</span></span><span class="koboSpan" id="kobo.480.1"> { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.481.1">return</span></span><span class="koboSpan" id="kobo.482.1"> data[i].Grade &lt; data[j].Grade })
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.483.1">"By Grade:"</span></span><span class="koboSpan" id="kobo.484.1">, data)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.485.1">The call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.486.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.487.1"> sorts the data according to the anonymous function that is passed as the second argument to </span><code class="inlineCode"><span class="koboSpan" id="kobo.488.1">sort.Slice()</span></code><span class="koboSpan" id="kobo.489.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.490.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">sorting.go</span></code><span class="koboSpan" id="kobo.492.1"> produces</span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.493.1"> the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.494.1">It is NOT sorted!
</span><span class="koboSpan" id="kobo.494.2">By Grade: [{M. </span><span class="koboSpan" id="kobo.494.3">Tsoukalos 7} {D. </span><span class="koboSpan" id="kobo.494.4">Tsoukalos 8} {J. </span><span class="koboSpan" id="kobo.494.5">Lewis 9} {J. </span><span class="koboSpan" id="kobo.494.6">Lewis 10}]
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-156"><span class="koboSpan" id="kobo.495.1">Functions can return other functions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.496.1">Apart from</span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.497.1"> accepting functions as arguments, functions can also return anonymous functions, which can be handy when the returned function is not always the same but depends on the functionâ€™s input or other external parameters. </span><span class="koboSpan" id="kobo.497.2">This is illustrated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">returnFunction.go</span></code><span class="koboSpan" id="kobo.499.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.500.1">package</span></span><span class="koboSpan" id="kobo.501.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">import</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.503.1">"fmt"</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.504.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.505.1">funRet</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.506.1">(i </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.507.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.508.1">)</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.509.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.510.1">(</span></span><span class="hljs-type"><span class="koboSpan" id="kobo.511.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.512.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.513.1">int</span></span><span class="koboSpan" id="kobo.514.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.515.1">if</span></span><span class="koboSpan" id="kobo.516.1"> i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.517.1">0</span></span><span class="koboSpan" id="kobo.518.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.519.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.520.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.521.1">(k </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.522.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.523.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.524.1">int</span></span><span class="koboSpan" id="kobo.525.1"> {
            k = -k
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.526.1">return</span></span><span class="koboSpan" id="kobo.527.1"> k + k
        }
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.528.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.529.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.530.1">(k </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.531.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.532.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.533.1">int</span></span><span class="koboSpan" id="kobo.534.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.535.1">return</span></span><span class="koboSpan" id="kobo.536.1"> k * k
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.537.1">The signature of </span><code class="inlineCode"><span class="koboSpan" id="kobo.538.1">funRet()</span></code><span class="koboSpan" id="kobo.539.1"> declares that the function returns another function with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.540.1">func(int) int</span></code><span class="koboSpan" id="kobo.541.1"> signature. </span><span class="koboSpan" id="kobo.541.2">The implementation of the function is unknown, but it is going to be defined at runtime. </span><span class="koboSpan" id="kobo.541.3">Functions are returned using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.542.1">return</span></code><span class="koboSpan" id="kobo.543.1"> keyword. </span><span class="koboSpan" id="kobo.543.2">The developer should take care and save the returned function.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.545.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.546.1">()</span></span><span class="koboSpan" id="kobo.547.1"> {
    n := </span><span class="hljs-number"><span class="koboSpan" id="kobo.548.1">10</span></span><span class="koboSpan" id="kobo.549.1">
    i := funRet(n)
    j := funRet(</span><span class="hljs-number"><span class="koboSpan" id="kobo.550.1">-4</span></span><span class="koboSpan" id="kobo.551.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.552.1">Note that </span><code class="inlineCode"><span class="koboSpan" id="kobo.553.1">n</span></code><span class="koboSpan" id="kobo.554.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">-4</span></code><span class="koboSpan" id="kobo.556.1"> are only used for determining the anonymous functions that are going to be returned from </span><code class="inlineCode"><span class="koboSpan" id="kobo.557.1">funRet()</span></code><span class="koboSpan" id="kobo.558.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.559.1">    fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.560.1">"%T\n"</span></span><span class="koboSpan" id="kobo.561.1">, i)
    fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.562.1">"%T %v\n"</span></span><span class="koboSpan" id="kobo.563.1">, j, j)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.564.1">"j"</span></span><span class="koboSpan" id="kobo.565.1">, j, j(</span><span class="hljs-number"><span class="koboSpan" id="kobo.566.1">-5</span></span><span class="koboSpan" id="kobo.567.1">))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.568.1">The first statement prints the signature of the function whereas the second statement prints the function signature and its memory address. </span><span class="koboSpan" id="kobo.568.2">The last statement also returns the memory address of </span><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">j</span></code><span class="koboSpan" id="kobo.570.1">, because </span><code class="inlineCode"><span class="koboSpan" id="kobo.571.1">j</span></code><span class="koboSpan" id="kobo.572.1"> is a pointer to the anonymous function and the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1">j(-5)</span></code><span class="koboSpan" id="kobo.574.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.575.1">// Same input parameter but DIFFERENT</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.576.1">// anonymous functions assigned to i and j</span></span><span class="koboSpan" id="kobo.577.1">
    fmt.Println(i(</span><span class="hljs-number"><span class="koboSpan" id="kobo.578.1">10</span></span><span class="koboSpan" id="kobo.579.1">))
    fmt.Println(j(</span><span class="hljs-number"><span class="koboSpan" id="kobo.580.1">10</span></span><span class="koboSpan" id="kobo.581.1">))
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.582.1">Although both </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1">i</span></code><span class="koboSpan" id="kobo.584.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">j</span></code><span class="koboSpan" id="kobo.586.1"> are called with the same input (</span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">10</span></code><span class="koboSpan" id="kobo.588.1">), they are going to return different values</span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.589.1"> because they store different anonymous functions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.590.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">returnFunction.go</span></code><span class="koboSpan" id="kobo.592.1"> generates the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.593.1">func(int) int
func(int) int 0x100d446c0
j 0x100d446c0 10
100
-20
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.594.1">The first line of the output shows the data type of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">i</span></code><span class="koboSpan" id="kobo.596.1"> variable that holds the return value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.597.1">funRet(n)</span></code><span class="koboSpan" id="kobo.598.1">, which is </span><code class="inlineCode"><span class="koboSpan" id="kobo.599.1">func(int) int</span></code><span class="koboSpan" id="kobo.600.1"> as it holds a function. </span><span class="koboSpan" id="kobo.600.2">The second line of output shows the data type of </span><code class="inlineCode"><span class="koboSpan" id="kobo.601.1">j</span></code><span class="koboSpan" id="kobo.602.1">, as well as the memory address where the anonymous function is stored. </span><span class="koboSpan" id="kobo.602.2">The third line shows the memory address of the anonymous function stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.603.1">j</span></code><span class="koboSpan" id="kobo.604.1"> variable, as well as the return value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.605.1">j(-5)</span></code><span class="koboSpan" id="kobo.606.1">. </span><span class="koboSpan" id="kobo.606.2">The last two lines are the return values of </span><code class="inlineCode"><span class="koboSpan" id="kobo.607.1">i(10)</span></code><span class="koboSpan" id="kobo.608.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.609.1">j(10)</span></code><span class="koboSpan" id="kobo.610.1">, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.611.1">So, in this subsection, we learned about functions returning functions. </span><span class="koboSpan" id="kobo.611.2">This allows Go to benefit from the functional programming paradigm and makes Go functions first-class citizens.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.612.1">We are now going to examine variadic functions, which are functions with a variable number of</span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.613.1"> parameters.</span></p>
<h2 class="heading-2" id="_idParaDest-157"><span class="koboSpan" id="kobo.614.1">Variadic functions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.615.1">Variadic functions </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.616.1">are functions that can accept a variable number</span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.617.1"> of parametersâ€”you already know about </span><code class="inlineCode"><span class="koboSpan" id="kobo.618.1">fmt.Println()</span></code><span class="koboSpan" id="kobo.619.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.620.1">append()</span></code><span class="koboSpan" id="kobo.621.1">, which are both variadic functions that are widely used. </span><span class="koboSpan" id="kobo.621.2">In fact, most functions found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1">fmt</span></code><span class="koboSpan" id="kobo.623.1"> package are variadic.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.624.1">The general ideas and rules behind variadic functions are the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.625.1">Variadic functions use the pack operator, which consists of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.626.1">...</span></code><span class="koboSpan" id="kobo.627.1">, followed by a data type. </span><span class="koboSpan" id="kobo.627.2">So, for a variadic function to accept a variable number of </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1">int</span></code><span class="koboSpan" id="kobo.629.1"> values, the pack operator should be </span><code class="inlineCode"><span class="koboSpan" id="kobo.630.1">...int</span></code><span class="koboSpan" id="kobo.631.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.632.1">The pack operator can only be used once in any given function.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.633.1">The variable that holds the pack operation is a slice and, therefore, is accessed as a slice inside the variadic function.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.634.1">The variable name that is related to the pack operator is always last in the list of function parameters.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.635.1">When calling a variadic function, you should put a list of values separated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.636.1">,</span></code><span class="koboSpan" id="kobo.637.1"> in the place of the variable with the pack operator or a slice with the unpack operator.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.638.1">The pack operator can also be used with an empty interface. </span><span class="koboSpan" id="kobo.638.2">In fact, most functions in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">fmt</span></code><span class="koboSpan" id="kobo.640.1"> package use </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1">...interface{}</span></code><span class="koboSpan" id="kobo.642.1"> to accept a variable number of arguments of all data types. </span><span class="koboSpan" id="kobo.642.2">You can find the source code of the latest implementation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.643.1">fmt</span></code><span class="koboSpan" id="kobo.644.1"> at </span><a href="https://go.dev/src/fmt/"><span class="url"><span class="koboSpan" id="kobo.645.1">https://go.dev/src/fmt/</span></span></a><span class="koboSpan" id="kobo.646.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.647.1">However, there is a situation that needs special care hereâ€”I made that mistake when I was learning Go and I was wondering about the error message I was getting.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.648.1">If you try to pass </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">os.Args</span></code><span class="koboSpan" id="kobo.650.1">, which is a slice of strings (</span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">[]string</span></code><span class="koboSpan" id="kobo.652.1">), as </span><code class="inlineCode"><span class="koboSpan" id="kobo.653.1">...interface{}</span></code><span class="koboSpan" id="kobo.654.1"> to a variadic function, your code will not compile and will generate an error message similar to </span><code class="inlineCode"><span class="koboSpan" id="kobo.655.1">cannot use os.Args (type []string) as type []interface {} in argument to &lt;function_name&gt;</span></code><span class="koboSpan" id="kobo.656.1">. </span><span class="koboSpan" id="kobo.656.2">This happens because the two data types (</span><code class="inlineCode"><span class="koboSpan" id="kobo.657.1">[]string</span></code><span class="koboSpan" id="kobo.658.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.659.1">[]interface{}</span></code><span class="koboSpan" id="kobo.660.1">) do not have the same representations in memoryâ€”this applies to all data types. </span><span class="koboSpan" id="kobo.660.2">In practice, this means that you cannot write </span><code class="inlineCode"><span class="koboSpan" id="kobo.661.1">os.Args...</span></code><span class="koboSpan" id="kobo.662.1"> to pass each individual value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.663.1">os.Args</span></code><span class="koboSpan" id="kobo.664.1"> slice to a variadic function.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.665.1">On the other hand, if you just use </span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1">os.Args</span></code><span class="koboSpan" id="kobo.667.1">, it will work, but this passes the entire slice as a single entity instead of its individual values! </span><span class="koboSpan" id="kobo.667.2">This means that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">everything(os.Args, os.Args)</span></code><span class="koboSpan" id="kobo.669.1"> statement works but does not do what you want.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.670.1">The solution to this problem is converting the slice of stringsâ€”or any other sliceâ€”into a slice of </span><code class="inlineCode"><span class="koboSpan" id="kobo.671.1">interface{}</span></code><span class="koboSpan" id="kobo.672.1">. </span><span class="koboSpan" id="kobo.672.2">One way to do that is by using the code that follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.673.1">empty := </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.674.1">make</span></span><span class="koboSpan" id="kobo.675.1">([]</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.676.1">interface</span></span><span class="koboSpan" id="kobo.677.1">{}, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.678.1">len</span></span><span class="koboSpan" id="kobo.679.1">(os.Args[</span><span class="hljs-number"><span class="koboSpan" id="kobo.680.1">1</span></span><span class="koboSpan" id="kobo.681.1">:]))
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.682.1">for</span></span><span class="koboSpan" id="kobo.683.1"> i, v := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.684.1">range</span></span><span class="koboSpan" id="kobo.685.1"> os.Args {
    empty[i] = v
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.686.1">Now, you are allowed to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.687.1">empty...</span></code><span class="koboSpan" id="kobo.688.1"> as an argument to the variadic function. </span><span class="koboSpan" id="kobo.688.2">This is the only subtle point related to variadic functions and the pack operator.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.689.1">This approach is an exception and should only be used if the user must provide the entire </span><code class="inlineCode"><span class="koboSpan" id="kobo.690.1">os.Args</span></code><span class="koboSpan" id="kobo.691.1"> slice as a parameter to something like </span><code class="inlineCode"><span class="koboSpan" id="kobo.692.1">fmt.Println()</span></code><span class="koboSpan" id="kobo.693.1">. </span><span class="koboSpan" id="kobo.693.2">The main reason is that this removes some of the compiler guarantees.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.694.1">As there is no standard library function to perform that conversion for you, you have to write your own code. </span><span class="koboSpan" id="kobo.694.2">Note that the conversion takes time as the code must visit all slice elements. </span><span class="koboSpan" id="kobo.694.3">The</span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.695.1"> more elements the slice has, the more time the </span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.696.1">conversion will take. </span><span class="koboSpan" id="kobo.696.2">This topic is also discussed at </span><a href="https://github.com/golang/go/wiki/InterfaceSlice"><span class="url"><span class="koboSpan" id="kobo.697.1">https://github.com/golang/go/wiki/InterfaceSlice</span></span></a><span class="koboSpan" id="kobo.698.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.699.1">We are now ready to see variadic functions in action. </span><span class="koboSpan" id="kobo.699.2">Type the following Go code using your favorite text editor and save it as </span><code class="inlineCode"><span class="koboSpan" id="kobo.700.1">variadic.go</span></code><span class="koboSpan" id="kobo.701.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.702.1">package</span></span><span class="koboSpan" id="kobo.703.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1">import</span></span><span class="koboSpan" id="kobo.705.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.706.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.707.1">"os"</span></span><span class="koboSpan" id="kobo.708.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.709.1">As variadic functions are built into the grammar of the language, you do not need anything extra to support variadic functions.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.710.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.711.1">addFloats</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.712.1">(message </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.713.1">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.714.1">, s ...</span></span><span class="hljs-type"><span class="koboSpan" id="kobo.715.1">float64</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.716.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.717.1">float64</span></span><span class="koboSpan" id="kobo.718.1"> {
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.719.1">This is a variadic function that accepts a string and an unknown number of </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1">float64</span></code><span class="koboSpan" id="kobo.721.1"> values. </span><span class="koboSpan" id="kobo.721.2">It prints the string variable and calculates the sum of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1">float64</span></code><span class="koboSpan" id="kobo.723.1"> values.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.724.1">    fmt.Println(message)
    sum := </span><span class="hljs-type"><span class="koboSpan" id="kobo.725.1">float64</span></span><span class="koboSpan" id="kobo.726.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.727.1">0</span></span><span class="koboSpan" id="kobo.728.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.729.1">for</span></span><span class="koboSpan" id="kobo.730.1"> _, a := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.731.1">range</span></span><span class="koboSpan" id="kobo.732.1"> s {
        sum = sum + a
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.733.1">This </span><code class="inlineCode"><span class="koboSpan" id="kobo.734.1">for</span></code><span class="koboSpan" id="kobo.735.1"> loop accesses the pack operator as a slice, so there is nothing special here.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.736.1">    s[</span><span class="hljs-number"><span class="koboSpan" id="kobo.737.1">0</span></span><span class="koboSpan" id="kobo.738.1">] = </span><span class="hljs-number"><span class="koboSpan" id="kobo.739.1">-1000</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.740.1">return</span></span><span class="koboSpan" id="kobo.741.1"> sum
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.742.1">You can also access individual elements of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.743.1">s</span></code><span class="koboSpan" id="kobo.744.1"> slice.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.745.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.746.1">everything</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.747.1">(input ...</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.748.1">interface</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.749.1">{})</span></span><span class="koboSpan" id="kobo.750.1"> {
    fmt.Println(input)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.751.1">This is another variadic function that accepts an unknown number of </span><code class="inlineCode"><span class="koboSpan" id="kobo.752.1">interface{}</span></code><span class="koboSpan" id="kobo.753.1"> values.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.754.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.755.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.756.1">()</span></span><span class="koboSpan" id="kobo.757.1"> {
    sum := addFloats(</span><span class="hljs-string"><span class="koboSpan" id="kobo.758.1">"Adding numbers..."</span></span><span class="koboSpan" id="kobo.759.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.760.1">1.1</span></span><span class="koboSpan" id="kobo.761.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.762.1">2.12</span></span><span class="koboSpan" id="kobo.763.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.764.1">3.14</span></span><span class="koboSpan" id="kobo.765.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.766.1">4</span></span><span class="koboSpan" id="kobo.767.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.768.1">5</span></span><span class="koboSpan" id="kobo.769.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.770.1">-1</span></span><span class="koboSpan" id="kobo.771.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.772.1">10</span></span><span class="koboSpan" id="kobo.773.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.774.1">You can put</span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.775.1"> the</span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.776.1"> arguments of a variadic function inline.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.777.1">    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.778.1">"Sum:"</span></span><span class="koboSpan" id="kobo.779.1">, sum)
    s := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.780.1">float64</span></span><span class="koboSpan" id="kobo.781.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.782.1">1.1</span></span><span class="koboSpan" id="kobo.783.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.784.1">2.12</span></span><span class="koboSpan" id="kobo.785.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.786.1">3.14</span></span><span class="koboSpan" id="kobo.787.1">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.788.1">But you usually use a slice variable with the unpack operator:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.789.1">    sum = addFloats(</span><span class="hljs-string"><span class="koboSpan" id="kobo.790.1">"Adding numbers..."</span></span><span class="koboSpan" id="kobo.791.1">, s...)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.792.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.793.1">Sum:"</span></span><span class="koboSpan" id="kobo.794.1">, sum)
    everything(s)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.795.1">The previous code works because the content of </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">s</span></code><span class="koboSpan" id="kobo.797.1"> is not unpacked.</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.798.1">// Cannot directly pass []string as []interface{}</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.799.1">// You have to convert it first!</span></span><span class="koboSpan" id="kobo.800.1">
    empty := </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.801.1">make</span></span><span class="koboSpan" id="kobo.802.1">([]</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.803.1">interface</span></span><span class="koboSpan" id="kobo.804.1">{}, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.805.1">len</span></span><span class="koboSpan" id="kobo.806.1">(os.Args[</span><span class="hljs-number"><span class="koboSpan" id="kobo.807.1">1</span></span><span class="koboSpan" id="kobo.808.1">:]))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.809.1">You can convert </span><code class="inlineCode"><span class="koboSpan" id="kobo.810.1">[]string</span></code><span class="koboSpan" id="kobo.811.1"> into </span><code class="inlineCode"><span class="koboSpan" id="kobo.812.1">[]interface{}</span></code><span class="koboSpan" id="kobo.813.1"> in order to use the unpack operator.</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.814.1">for</span></span><span class="koboSpan" id="kobo.815.1"> i, v := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.816.1">range</span></span><span class="koboSpan" id="kobo.817.1"> os.Args[</span><span class="hljs-number"><span class="koboSpan" id="kobo.818.1">1</span></span><span class="koboSpan" id="kobo.819.1">:] {
        empty[i] = v
    }
    everything(empty...)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.820.1">And now, we can unpack the contents of </span><code class="inlineCode"><span class="koboSpan" id="kobo.821.1">empty</span></code><span class="koboSpan" id="kobo.822.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.823.1">    arguments := os.Args[</span><span class="hljs-number"><span class="koboSpan" id="kobo.824.1">1</span></span><span class="koboSpan" id="kobo.825.1">:]
    empty = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.826.1">make</span></span><span class="koboSpan" id="kobo.827.1">([]</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.828.1">interface</span></span><span class="koboSpan" id="kobo.829.1">{}, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.830.1">len</span></span><span class="koboSpan" id="kobo.831.1">(arguments))
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.832.1">for</span></span><span class="koboSpan" id="kobo.833.1"> i := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.834.1">range</span></span><span class="koboSpan" id="kobo.835.1"> arguments {
        empty[i] = arguments[i]
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.836.1">This is a slightly different way of converting </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">[]string</span></code><span class="koboSpan" id="kobo.838.1"> into </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1">[]interface{}</span></code><span class="koboSpan" id="kobo.840.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.841.1">    everything(empty...)
    str := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.842.1">string</span></span><span class="koboSpan" id="kobo.843.1">{</span><span class="hljs-string"><span class="koboSpan" id="kobo.844.1">"One"</span></span><span class="koboSpan" id="kobo.845.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.846.1">"Two"</span></span><span class="koboSpan" id="kobo.847.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.848.1">"Three"</span></span><span class="koboSpan" id="kobo.849.1">}
    everything(str, str, str)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.850.1">The previous statement works because you are passing the entire </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1">str</span></code><span class="koboSpan" id="kobo.852.1"> variable three timesâ€”not its contents. </span><span class="koboSpan" id="kobo.852.2">So, the slice contains three elementsâ€”each element is equal to the contents</span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.853.1"> of </span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.854.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1">str</span></code><span class="koboSpan" id="kobo.856.1"> variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.857.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.858.1">variadic.go</span></code><span class="koboSpan" id="kobo.859.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.860.1">$ </span></span><span class="koboSpan" id="kobo.861.1">go run variadic.go
Adding numbers...
</span><span class="koboSpan" id="kobo.861.2">Sum: 24.36
Adding numbers...
</span><span class="koboSpan" id="kobo.861.3">Sum: 6.36
[[-1000 2.12 3.14]]
[]
[]
[[One Two Three] [One Two Three] [One Two Three]]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.862.1">The last line of the output shows that we have passed the </span><code class="inlineCode"><span class="koboSpan" id="kobo.863.1">str</span></code><span class="koboSpan" id="kobo.864.1"> variable three times to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.865.1">everything()</span></code><span class="koboSpan" id="kobo.866.1"> function as three separate entities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.867.1">Variadic functions really come in handy when you want to have an unknown number of parameters in a function. </span><span class="koboSpan" id="kobo.867.2">The next subsection discusses the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">defer</span></code><span class="koboSpan" id="kobo.869.1">, which we have already used multiple times.</span></p>
<h2 class="heading-2" id="_idParaDest-158"><span class="koboSpan" id="kobo.870.1">The defer keyword</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.871.1">So far, we have seen defer in </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1">ch03/csvData.go</span></code><span class="koboSpan" id="kobo.873.1">. </span><span class="koboSpan" id="kobo.873.2">But what does </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">defer</span></code><span class="koboSpan" id="kobo.875.1"> do? </span><span class="koboSpan" id="kobo.875.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.876.1">defer</span></code><span class="koboSpan" id="kobo.877.1"> keyword </span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.878.1">postpones</span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.879.1"> the execution of a function until the surrounding function returns.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.880.1">Usually, </span><code class="inlineCode"><span class="koboSpan" id="kobo.881.1">defer</span></code><span class="koboSpan" id="kobo.882.1"> is used in file I/O operations to keep the function call that closes an opened file close to the call that opened it, so that you do not have to remember to close a file that you have opened just before the function exits.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.883.1">It is very important to remember that deferred functions are executed in </span><strong class="keyWord"><span class="koboSpan" id="kobo.884.1">Last In, First Out</span></strong><span class="koboSpan" id="kobo.885.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.886.1">LIFO</span></strong><span class="koboSpan" id="kobo.887.1">) order after the surrounding function has been returned. </span><span class="koboSpan" id="kobo.887.2">Putting it simply, this means that if you defer function </span><code class="inlineCode"><span class="koboSpan" id="kobo.888.1">f1()</span></code><span class="koboSpan" id="kobo.889.1"> first, function </span><code class="inlineCode"><span class="koboSpan" id="kobo.890.1">f2()</span></code><span class="koboSpan" id="kobo.891.1"> second, and function </span><code class="inlineCode"><span class="koboSpan" id="kobo.892.1">f3()</span></code><span class="koboSpan" id="kobo.893.1"> third in the same surrounding function, then when the surrounding function is about to return, function </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1">f3()</span></code><span class="koboSpan" id="kobo.895.1"> will be executed first, function </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1">f2()</span></code><span class="koboSpan" id="kobo.897.1"> will be executed second, and function </span><code class="inlineCode"><span class="koboSpan" id="kobo.898.1">f1()</span></code><span class="koboSpan" id="kobo.899.1"> will be the last one to get executed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.900.1">In this section, we will discuss the dangers of careless use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">defer</span></code><span class="koboSpan" id="kobo.902.1"> using a simple program. </span><span class="koboSpan" id="kobo.902.2">The code for </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">defer.go</span></code><span class="koboSpan" id="kobo.904.1"> is as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.905.1">package</span></span><span class="koboSpan" id="kobo.906.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">import</span></span><span class="koboSpan" id="kobo.908.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.909.1">"fmt"</span></span><span class="koboSpan" id="kobo.910.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.911.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.912.1">d1</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.913.1">()</span></span><span class="koboSpan" id="kobo.914.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.915.1">for</span></span><span class="koboSpan" id="kobo.916.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.917.1">3</span></span><span class="koboSpan" id="kobo.918.1">; i &gt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.919.1">0</span></span><span class="koboSpan" id="kobo.920.1">; i-- {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.921.1">defer</span></span><span class="koboSpan" id="kobo.922.1"> fmt.Print(i, </span><span class="hljs-string"><span class="koboSpan" id="kobo.923.1">" "</span></span><span class="koboSpan" id="kobo.924.1">)
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.925.1">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">d1()</span></code><span class="koboSpan" id="kobo.927.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1">defer</span></code><span class="koboSpan" id="kobo.929.1"> is executed inside the function body with just a </span><code class="inlineCode"><span class="koboSpan" id="kobo.930.1">fmt.Print()</span></code><span class="koboSpan" id="kobo.931.1"> call. </span><span class="koboSpan" id="kobo.931.2">Remember that these calls to </span><code class="inlineCode"><span class="koboSpan" id="kobo.932.1">fmt.Print()</span></code><span class="koboSpan" id="kobo.933.1"> are executed just before function </span><code class="inlineCode"><span class="koboSpan" id="kobo.934.1">d1()</span></code><span class="koboSpan" id="kobo.935.1"> returns.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.936.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.937.1">d2</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.938.1">()</span></span><span class="koboSpan" id="kobo.939.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.940.1">for</span></span><span class="koboSpan" id="kobo.941.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.942.1">3</span></span><span class="koboSpan" id="kobo.943.1">; i &gt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.944.1">0</span></span><span class="koboSpan" id="kobo.945.1">; i-- {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">defer</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.947.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.948.1">()</span></span><span class="koboSpan" id="kobo.949.1"> {
            fmt.Print(i, </span><span class="hljs-string"><span class="koboSpan" id="kobo.950.1">" "</span></span><span class="koboSpan" id="kobo.951.1">)
        }()
    }
    fmt.Println()
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.952.1">In </span><code class="inlineCode"><span class="koboSpan" id="kobo.953.1">d2()</span></code><span class="koboSpan" id="kobo.954.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.955.1">defer</span></code><span class="koboSpan" id="kobo.956.1"> is attached to an anonymous function that does not accept any parameters. </span><span class="koboSpan" id="kobo.956.2">In practice, this means that the anonymous function should get the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">i</span></code><span class="koboSpan" id="kobo.958.1"> on its ownâ€”this is dangerous because the current value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.959.1">i</span></code><span class="koboSpan" id="kobo.960.1"> depends on when the anonymous function is executed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.961.1">The anonymous function is a </span><em class="italic"><span class="koboSpan" id="kobo.962.1">closure</span></em><span class="koboSpan" id="kobo.963.1">, and that is why it has access to variables that would normally be out of scope.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.964.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.965.1">d3</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.966.1">()</span></span><span class="koboSpan" id="kobo.967.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.968.1">for</span></span><span class="koboSpan" id="kobo.969.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.970.1">3</span></span><span class="koboSpan" id="kobo.971.1">; i &gt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.972.1">0</span></span><span class="koboSpan" id="kobo.973.1">; i-- {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.974.1">defer</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.975.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.976.1">(n </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.977.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.978.1">)</span></span><span class="koboSpan" id="kobo.979.1"> {
            fmt.Print(n, </span><span class="hljs-string"><span class="koboSpan" id="kobo.980.1">" "</span></span><span class="koboSpan" id="kobo.981.1">)
        }(i)
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.982.1">In this case, the current value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.983.1">i</span></code><span class="koboSpan" id="kobo.984.1"> is passed to the anonymous function as a parameter that initializes </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.985.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.986.1">n</span></code><span class="koboSpan" id="kobo.987.1"> function parameter. </span><span class="koboSpan" id="kobo.987.2">This means that there are no ambiguities </span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.988.1">about the value that </span><code class="inlineCode"><span class="koboSpan" id="kobo.989.1">i</span></code><span class="koboSpan" id="kobo.990.1"> has.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.991.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.992.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.993.1">()</span></span><span class="koboSpan" id="kobo.994.1"> {
    d1()
    d2()
    fmt.Println()
    d3()
    fmt.Println()
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.995.1">The task of </span><code class="inlineCode"><span class="koboSpan" id="kobo.996.1">main()</span></code><span class="koboSpan" id="kobo.997.1"> is to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.998.1">d1()</span></code><span class="koboSpan" id="kobo.999.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1000.1">d2()</span></code><span class="koboSpan" id="kobo.1001.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1002.1">d3()</span></code><span class="koboSpan" id="kobo.1003.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1004.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1">defer.go</span></code><span class="koboSpan" id="kobo.1006.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1007.1">$ </span></span><span class="koboSpan" id="kobo.1008.1">go run defer.go
1 2 3
0 0 0
1 2 3
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1009.1">You will most likely find the generated output complicated and challenging to understand, which proves that the operation and the results of the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1010.1">defer</span></code><span class="koboSpan" id="kobo.1011.1"> can be tricky if your code is not clear and unambiguous. </span><span class="koboSpan" id="kobo.1011.2">Let me explain the results so that you get a better idea of how tricky </span><code class="inlineCode"><span class="koboSpan" id="kobo.1012.1">defer</span></code><span class="koboSpan" id="kobo.1013.1"> can be if you do not pay close attention to your code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1014.1">Let us start with the first line of the output (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1015.1">1 2 3</span></code><span class="koboSpan" id="kobo.1016.1">) that is generated by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1017.1">d1()</span></code><span class="koboSpan" id="kobo.1018.1"> function. </span><span class="koboSpan" id="kobo.1018.2">The values of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1">i</span></code><span class="koboSpan" id="kobo.1020.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1021.1">d1()</span></code><span class="koboSpan" id="kobo.1022.1"> are </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1">3</span></code><span class="koboSpan" id="kobo.1024.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1">2</span></code><span class="koboSpan" id="kobo.1026.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1027.1">1</span></code><span class="koboSpan" id="kobo.1028.1"> in that order. </span><span class="koboSpan" id="kobo.1028.2">The function that is deferred in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1029.1">s</span></code><span class="koboSpan" id="kobo.1030.1"> is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1031.1">fmt.Print()</span></code><span class="koboSpan" id="kobo.1032.1"> statement; as a result, when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1033.1">d1()</span></code><span class="koboSpan" id="kobo.1034.1"> function is about to return, you get the three values of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1">i</span></code><span class="koboSpan" id="kobo.1036.1"> variable of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1">for</span></code><span class="koboSpan" id="kobo.1038.1"> loop in reverse order. </span><span class="koboSpan" id="kobo.1038.2">This is because </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.1039.1">deferred functions are executed in LIFO order</span></strong><span class="koboSpan" id="kobo.1040.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1041.1">Now, let me explain the second line of the output that is produced by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1042.1">d2()</span></code><span class="koboSpan" id="kobo.1043.1"> function. </span><span class="koboSpan" id="kobo.1043.2">It is really strange that we got three zeros instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1044.1">1 2 3</span></code><span class="koboSpan" id="kobo.1045.1"> in the output; however, there is a reason for that â€“ note that this is not an issue with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1046.1">defer</span></code><span class="koboSpan" id="kobo.1047.1"> but with closures. </span><span class="koboSpan" id="kobo.1047.2">After the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1048.1">for</span></code><span class="koboSpan" id="kobo.1049.1"> loop ends, the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1050.1">i</span></code><span class="koboSpan" id="kobo.1051.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1052.1">0</span></code><span class="koboSpan" id="kobo.1053.1">, because it is that value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1054.1">i</span></code><span class="koboSpan" id="kobo.1055.1"> that made the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1056.1">for</span></code><span class="koboSpan" id="kobo.1057.1"> loop terminate. </span><span class="koboSpan" id="kobo.1057.2">However, the tricky point here is that the deferred anonymous function is evaluated after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1058.1">for</span></code><span class="koboSpan" id="kobo.1059.1"> loop ends because it has no parameters, which means that it is evaluated three times for an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1060.1">i</span></code><span class="koboSpan" id="kobo.1061.1"> value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1062.1">0</span></code><span class="koboSpan" id="kobo.1063.1">, hence the generated output. </span><span class="koboSpan" id="kobo.1063.2">This kind of confusing code is what might lead to the creation of nasty bugs in your projects, so try to avoid it. </span><span class="koboSpan" id="kobo.1063.3">Go version 1.22 corrects this kind of errors.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1064.1">Finally, we will talk about the third line of the output, which is generated by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1065.1">d3()</span></code><span class="koboSpan" id="kobo.1066.1"> function. </span><span class="koboSpan" id="kobo.1066.2">Due to the parameter of the anonymous function, each time the anonymous function is deferred, it gets and therefore uses the current value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1067.1">i</span></code><span class="koboSpan" id="kobo.1068.1">. </span><span class="koboSpan" id="kobo.1068.2">As a result, each execution of the anonymous function has a different value to process without any ambiguities, hence the generated output.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1069.1">After that, it should be clear that the best approach to using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1070.1">defer</span></code><span class="koboSpan" id="kobo.1071.1"> is the third one, which is exhibited </span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.1072.1">in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">d3()</span></code><span class="koboSpan" id="kobo.1074.1"> function, because you intentionally pass the</span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.1075.1"> desired variable in the anonymous function in an easy-to-read way. </span><span class="koboSpan" id="kobo.1075.2">Now that we have learned about </span><code class="inlineCode"><span class="koboSpan" id="kobo.1076.1">defer</span></code><span class="koboSpan" id="kobo.1077.1">, it is time to discuss something completely different: the Big O notation.</span></p>
<h1 class="heading-1" id="_idParaDest-159"><span class="koboSpan" id="kobo.1078.1">Big O complexity</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1079.1">The computational </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.1080.1">complexity of an algorithm is usually denoted using the popular Big O notation. </span><span class="koboSpan" id="kobo.1080.2">The Big O notation is used for expressing the worst-case scenario for the order of growth of an algorithm. </span><span class="koboSpan" id="kobo.1080.3">It shows how the performance of an algorithm changes as the size of the data it processes grows.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1081.1">O(1)</span></code><span class="koboSpan" id="kobo.1082.1"> means constant time complexity, which does not depend on the amount of data at hand. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1083.1">O(n)</span></code><span class="koboSpan" id="kobo.1084.1"> means that the execution time is proportional to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1085.1">n</span></code><span class="koboSpan" id="kobo.1086.1"> (linear time)â€”you cannot process data without accessing it, so </span><code class="inlineCode"><span class="koboSpan" id="kobo.1087.1">O(n)</span></code><span class="koboSpan" id="kobo.1088.1"> is considered good. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1089.1">O(n</span></code><sup class="superscript"><span class="koboSpan" id="kobo.1090.1">2</span></sup><code class="inlineCode"><span class="koboSpan" id="kobo.1091.1">)</span></code><span class="koboSpan" id="kobo.1092.1"> (quadratic time) means that the execution time is proportional to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1093.1">n</span></code><sup class="superscript"><span class="koboSpan" id="kobo.1094.1">2</span></sup><span class="koboSpan" id="kobo.1095.1">. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1096.1">O(n!)</span></code><span class="koboSpan" id="kobo.1097.1"> (factorial time) means that the execution time of the algorithm is directly proportional to the factorial of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1098.1">n</span></code><span class="koboSpan" id="kobo.1099.1">. </span><span class="koboSpan" id="kobo.1099.2">Simply put, if you have to process 100 values of some kind, then the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1100.1">O(n)</span></code><span class="koboSpan" id="kobo.1101.1"> algorithm will do about 100 operations, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1102.1">O(n</span></code><sup class="superscript"><span class="koboSpan" id="kobo.1103.1">2</span></sup><code class="inlineCode"><span class="koboSpan" id="kobo.1104.1">)</span></code><span class="koboSpan" id="kobo.1105.1"> is going to perform about 10,000 operations, and the algorithm with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1106.1">O(n!)</span></code><span class="koboSpan" id="kobo.1107.1"> complexity </span><code class="inlineCode"><span class="koboSpan" id="kobo.1108.1">10</span></code><sup class="superscript"><span class="koboSpan" id="kobo.1109.1">158</span></sup><span class="koboSpan" id="kobo.1110.1"> operations!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1111.1">Now that we have</span><a id="_idIndexMarker415"/><span class="koboSpan" id="kobo.1112.1"> learned about the Big O notation, it is time to discuss developing your own packages.</span></p>
<h1 class="heading-1" id="_idParaDest-160"><span class="koboSpan" id="kobo.1113.1">Developing your own packages</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1114.1">At some point, you are </span><a id="_idIndexMarker416"/><span class="koboSpan" id="kobo.1115.1">going to need to develop your own packages to organize your code and distribute it if needed. </span><span class="koboSpan" id="kobo.1115.2">As stated at the beginning of this chapter, everything that begins with an uppercase letter is considered public and can be accessed from outside its package, whereas all other elements are considered private. </span><span class="koboSpan" id="kobo.1115.3">The only exception to this Go rule is package namesâ€”it is a best practice to use lowercase package names, even though uppercase package names are allowed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1116.1">Compiling a Go package can be done manually, if the package exists on the local machine, but it is also done automatically after you download the package from the internet, so there is no need to worry about that. </span><span class="koboSpan" id="kobo.1116.2">Additionally, if the package you are downloading contains any errors, you will learn about them when you try to download it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1117.1">However, if you want to compile a package that has been saved in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">sqlite06.go</span></code><span class="koboSpan" id="kobo.1119.1"> file (a combination of SQLite and Chapter 06) on your own, you can use the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1120.1">$ </span></span><span class="koboSpan" id="kobo.1121.1">go build -o sqlite06.a sqlite06.go
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1122.1">So, the previous command compiles the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1123.1">sqlite06.go</span></code><span class="koboSpan" id="kobo.1124.1"> file and saves its output in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1125.1">sqlite06.a</span></code><span class="koboSpan" id="kobo.1126.1"> file:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1127.1">$ </span></span><span class="koboSpan" id="kobo.1128.1">file sqlite06.a
sqlite06.a: current ar archive
The sqlite06.a file is an ar archive.
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1129.1">The main reason for compiling Go packages on your own is to check for syntax or other kinds of errors in your code without actually using them. </span><span class="koboSpan" id="kobo.1129.2">Additionally, you can build Go packages as plugins (</span><a href="https://pkg.go.dev/plugin"><span class="url"><span class="koboSpan" id="kobo.1130.1">https://pkg.go.dev/plugin</span></span></a><span class="koboSpan" id="kobo.1131.1">) or shared libraries. </span><span class="koboSpan" id="kobo.1131.2">Discussing more about these is </span><a id="_idIndexMarker417"/><span class="koboSpan" id="kobo.1132.1">beyond the scope of this book.</span></p>
<h2 class="heading-2" id="_idParaDest-161"><span class="koboSpan" id="kobo.1133.1">The init() function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1134.1">Each Go package</span><a id="_idIndexMarker418"/><span class="koboSpan" id="kobo.1135.1"> can optionally have a private function</span><a id="_idIndexMarker419"/><span class="koboSpan" id="kobo.1136.1"> named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1137.1">init()</span></code><span class="koboSpan" id="kobo.1138.1"> that is automatically executed at the beginning of execution timeâ€”</span><code class="inlineCode"><span class="koboSpan" id="kobo.1139.1">init()</span></code><span class="koboSpan" id="kobo.1140.1"> runs when the package is initialized at the beginning of program execution. </span><span class="koboSpan" id="kobo.1140.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">init()</span></code><span class="koboSpan" id="kobo.1142.1"> function has the following characteristics:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1143.1">init()</span></code><span class="koboSpan" id="kobo.1144.1"> takes </span><a id="_idIndexMarker420"/><span class="koboSpan" id="kobo.1145.1">no arguments.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1146.1">init()</span></code><span class="koboSpan" id="kobo.1147.1"> returns no values.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1148.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">init()</span></code><span class="koboSpan" id="kobo.1150.1"> function is optional.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1151.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1152.1">init()</span></code><span class="koboSpan" id="kobo.1153.1"> function is called implicitly by Go.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1154.1">You can have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1155.1">init()</span></code><span class="koboSpan" id="kobo.1156.1"> function in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1157.1">main</span></code><span class="koboSpan" id="kobo.1158.1"> package. </span><span class="koboSpan" id="kobo.1158.2">In that case, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">init()</span></code><span class="koboSpan" id="kobo.1160.1"> is executed before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1161.1">main()</span></code><span class="koboSpan" id="kobo.1162.1"> function. </span><span class="koboSpan" id="kobo.1162.2">In fact, all </span><code class="inlineCode"><span class="koboSpan" id="kobo.1163.1">init()</span></code><span class="koboSpan" id="kobo.1164.1"> functions are always executed prior to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1165.1">main()</span></code><span class="koboSpan" id="kobo.1166.1"> function.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1167.1">A source file can contain multiple </span><code class="inlineCode"><span class="koboSpan" id="kobo.1168.1">init()</span></code><span class="koboSpan" id="kobo.1169.1"> functionsâ€”these are executed in the order of declaration.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1170.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1171.1">init()</span></code><span class="koboSpan" id="kobo.1172.1"> function or functions of a package are executed </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.1173.1">only once</span></strong><span class="koboSpan" id="kobo.1174.1">, even if the package is imported multiple times.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1175.1">Go packages can contain multiple files. </span><span class="koboSpan" id="kobo.1175.2">Each source file can contain one or more </span><code class="inlineCode"><span class="koboSpan" id="kobo.1176.1">init()</span></code><span class="koboSpan" id="kobo.1177.1"> functions.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1178.1">The fact that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1179.1">init()</span></code><span class="koboSpan" id="kobo.1180.1"> function is a private function by design means that it cannot be called from outside the package in which it is contained. </span><span class="koboSpan" id="kobo.1180.2">Additionally, as the user of a package has no control over the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1181.1">init()</span></code><span class="koboSpan" id="kobo.1182.1"> function, you should think carefully before using an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1183.1">init()</span></code><span class="koboSpan" id="kobo.1184.1"> function in public packages or changing any global state in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1">init()</span></code><span class="koboSpan" id="kobo.1186.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1187.1">There are some exceptions </span><a id="_idIndexMarker421"/><span class="koboSpan" id="kobo.1188.1">where the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1">init()</span></code><span class="koboSpan" id="kobo.1190.1"> makes sense:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1191.1">For initializing network connections that might take time prior to the execution of package functions or methods.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1192.1">For initializing connections to one or more servers prior to the execution of package functions or methods.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1193.1">For creating required files and directories.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1194.1">For checking</span><a id="_idIndexMarker422"/><span class="koboSpan" id="kobo.1195.1"> whether required resources are available or not.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1196.1">As the order of execution can be perplexing sometimes, in the next subsection, we will explain the order </span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.1197.1">of execution in more detail.</span></p>
<h2 class="heading-2" id="_idParaDest-162"><span class="koboSpan" id="kobo.1198.1">Order of execution</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1199.1">This subsection </span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.1200.1">illustrates how Go code is executed. </span><span class="koboSpan" id="kobo.1200.2">As an</span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.1201.1"> example, if a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1202.1">main</span></code><span class="koboSpan" id="kobo.1203.1"> package imports package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1204.1">A</span></code><span class="koboSpan" id="kobo.1205.1"> and package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1206.1">A</span></code><span class="koboSpan" id="kobo.1207.1"> depends on package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1208.1">B</span></code><span class="koboSpan" id="kobo.1209.1">, then the following will take place:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1210.1">The process starts with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1211.1">main</span></code><span class="koboSpan" id="kobo.1212.1"> package.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1213.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1214.1">main</span></code><span class="koboSpan" id="kobo.1215.1"> package imports package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1216.1">A</span></code><span class="koboSpan" id="kobo.1217.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1218.1">Package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1219.1">A</span></code><span class="koboSpan" id="kobo.1220.1"> imports package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1221.1">B</span></code><span class="koboSpan" id="kobo.1222.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1223.1">The global variables, if any, in package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1224.1">B</span></code><span class="koboSpan" id="kobo.1225.1"> are initialized.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1226.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1">init()</span></code><span class="koboSpan" id="kobo.1228.1"> function or functions of package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1229.1">B</span></code><span class="koboSpan" id="kobo.1230.1">, if they exist, run. </span><span class="koboSpan" id="kobo.1230.2">This is the first </span><code class="inlineCode"><span class="koboSpan" id="kobo.1231.1">init()</span></code><span class="koboSpan" id="kobo.1232.1"> function that gets executed.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1233.1">The global variables, if any, in package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1234.1">A</span></code><span class="koboSpan" id="kobo.1235.1"> are initialized.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1236.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1237.1">init()</span></code><span class="koboSpan" id="kobo.1238.1"> function or functions of package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1239.1">A</span></code><span class="koboSpan" id="kobo.1240.1">, if there are any, run.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1241.1">The global variables in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1">main</span></code><span class="koboSpan" id="kobo.1243.1"> package are initialized.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1244.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1245.1">init()</span></code><span class="koboSpan" id="kobo.1246.1"> function or functions of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1247.1">main</span></code><span class="koboSpan" id="kobo.1248.1"> package, if they exist, run.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1249.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1250.1">main()</span></code><span class="koboSpan" id="kobo.1251.1"> function of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1252.1">main</span></code><span class="koboSpan" id="kobo.1253.1"> package begins its execution.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1254.1">Notice that if the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1">main</span></code><span class="koboSpan" id="kobo.1256.1"> package imports package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1257.1">B</span></code><span class="koboSpan" id="kobo.1258.1"> on its own, nothing is going to happen because everything related to package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1259.1">B</span></code><span class="koboSpan" id="kobo.1260.1"> is triggered by package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1261.1">A</span></code><span class="koboSpan" id="kobo.1262.1">. </span><span class="koboSpan" id="kobo.1262.2">This is because package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1263.1">A</span></code><span class="koboSpan" id="kobo.1264.1"> imported package </span><code class="inlineCode"><span class="koboSpan" id="kobo.1265.1">B</span></code><span class="koboSpan" id="kobo.1266.1"> first.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1267.1">The following diagram shows what is happening behind the scenes regarding the order of execution of Go code:</span></p>
<figure class="mediaobject"> <span class="koboSpan" id="kobo.1268.1"><img alt="" role="presentation" src="../Images/B21003_06_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1269.1">Figure 6.1: Go order of code execution</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1270.1">You can learn </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.1271.1">more</span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.1272.1"> about the order of execution by reading the Go Language Specification document at </span><a href="https://go.dev/ref/spec#Order_of_evaluation"><span class="url"><span class="koboSpan" id="kobo.1273.1">https://go.dev/ref/spec#Order_of_evaluation</span></span></a><span class="koboSpan" id="kobo.1274.1"> and about the </span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.1275.1">package initialization process by </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.1276.1">reading </span><a href="https://go.dev/ref/spec#Package_initialization"><span class="url"><span class="koboSpan" id="kobo.1277.1">https://go.dev/ref/spec#Package_initialization</span></span></a><span class="koboSpan" id="kobo.1278.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-163"><span class="koboSpan" id="kobo.1279.1">Using GitHub to store Go packages</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1280.1">This section will</span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.1281.1"> teach you how to create a GitHub repository </span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.1282.1">where you can keep your Go package and make it available to the world.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1283.1">First, you need to create the GitHub repository on your own. </span><span class="koboSpan" id="kobo.1283.2">The easiest way to create a new GitHub repository is by visiting the GitHub website and going to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1284.1">Repositories</span></strong><span class="koboSpan" id="kobo.1285.1"> tab, where you can see your existing repositories and create new ones. </span><span class="koboSpan" id="kobo.1285.2">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1286.1">New</span></strong><span class="koboSpan" id="kobo.1287.1"> button and type in the necessary information for creating a new GitHub repository. </span><span class="koboSpan" id="kobo.1287.2">If you made your repository public, everyone will be able to see itâ€”if it is a private repository, only the people you choose are going to be able to look into it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1288.1">Having a clear </span><code class="inlineCode"><span class="koboSpan" id="kobo.1289.1">README.md</span></code><span class="koboSpan" id="kobo.1290.1"> file in your GitHub repository that explains the way the Go package works is considered a very good practice.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1291.1">Next, you need to clone the repository on your local computer. </span><span class="koboSpan" id="kobo.1291.2">I usually clone it using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1292.1">git(1)</span></code><span class="koboSpan" id="kobo.1293.1"> utility. </span><span class="koboSpan" id="kobo.1293.2">If the name of the repository is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">sqlite06</span></code><span class="koboSpan" id="kobo.1295.1"> and the GitHub username is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">mactsouk</span></code><span class="koboSpan" id="kobo.1297.1">, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">git clone</span></code><span class="koboSpan" id="kobo.1299.1"> command is going to look as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1300.1">$ </span></span><span class="koboSpan" id="kobo.1301.1">git </span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1302.1">clone</span></span><span class="koboSpan" id="kobo.1303.1"> git@github.com:mactsouk/sqlite06.git
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1304.1">After that, type </span><code class="inlineCode"><span class="koboSpan" id="kobo.1305.1">cd sqlite06</span></code><span class="koboSpan" id="kobo.1306.1"> and you are done! </span><span class="koboSpan" id="kobo.1306.2">At this point, you just have to write the code of the Go package and remember to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1307.1">git commit</span></code><span class="koboSpan" id="kobo.1308.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1309.1">git push</span></code><span class="koboSpan" id="kobo.1310.1"> the changes to the GitHub repository.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1311.1">The best place to host, inspect, develop, or use a Go package is in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1">~/go/src</span></code><span class="koboSpan" id="kobo.1313.1"> directory. </span><span class="koboSpan" id="kobo.1313.2">Put simply, the purpose of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1">~/go/src</span></code><span class="koboSpan" id="kobo.1315.1"> is to store the source code of the packages you create or use.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1316.1">The look of such a repository can be seen in </span><em class="italic"><span class="koboSpan" id="kobo.1317.1">Figure 6.2</span></em><span class="koboSpan" id="kobo.1318.1">â€”you are going to learn more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1319.1">sqlite06</span></code><span class="koboSpan" id="kobo.1320.1"> repository in a while:</span></p>
<figure class="mediaobject"> <span class="koboSpan" id="kobo.1321.1"><img alt="A screenshot of a computer  Description automatically generated" src="../Images/B21003_06_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1322.1">Figure 6.2: A GitHub repository with a Go package</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1323.1">Using GitLab instead of GitHub for hosting your code does not require any changes to the way you work.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1324.1">If you want to use</span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.1325.1"> that </span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.1326.1">package, you just need to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1327.1">go get</span></code><span class="koboSpan" id="kobo.1328.1"> the package using its URL and include it in your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1329.1">import</span></code><span class="koboSpan" id="kobo.1330.1"> blockâ€”we will see this when we actually use it in a program. </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.1331.1">The previous process is about developing a Go package, not using a Go package</span></strong><span class="koboSpan" id="kobo.1332.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1333.1">The next section presents a Go package that allows you to work with a database.</span></p>
<h1 class="heading-1" id="_idParaDest-164"><span class="koboSpan" id="kobo.1334.1">A package for working with SQLite</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1335.1">This section will </span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.1336.1">develop a Go package for working with</span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.1337.1"> a given database schema stored on an SQLite database, with the end goal of demonstrating how to develop, store, and use a package. </span><span class="koboSpan" id="kobo.1337.2">When interacting with specific schemas and tables in your application, you usually create separate packages with all the database-related functionsâ€”this also applies to NoSQL databases.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1338.1">Go offers a generic package (</span><a href="https://pkg.go.dev/database/sql"><span class="url"><span class="koboSpan" id="kobo.1339.1">https://pkg.go.dev/database/sql</span></span></a><span class="koboSpan" id="kobo.1340.1">) for working with databases. </span><span class="koboSpan" id="kobo.1340.2">However, each database requires a specific package that acts as the driver and allows Go to connect and work with that specific database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1341.1">The steps for creating the desired Go package are as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1342.1">Downloading the necessary external Go packages for working with SQLite.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1343.1">Creating package files.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1344.1">Developing the required functions.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1345.1">Using the Go package for developing utilities and testing its functionality.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1346.1">Using CI/CD tools for automation (this is optional).</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1347.1">You might be wondering why we would create such a package for working with a database and not </span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.1348.1">write</span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.1349.1"> the actual commands in our programs when needed. </span><span class="koboSpan" id="kobo.1349.2">The reasons for this include the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1350.1">A Go package can be shared by all team members who work with the application.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1351.1">A Go package allows people to use the database in ways that are documented.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1352.1">The specialized functions you put in your Go package fit your needs a lot better.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1353.1">People do not need full access to the databaseâ€”they just use the package functions and the functionality they offer.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1354.1">If you ever make changes to the database, people do not need to know about them, as long as the functions of the Go package remain the same.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1355.1">Put simply, the functions you create can interact with a specific database schema, along with its tables and dataâ€”it would be almost impossible to work with an unknown database schema without knowing how the tables are connected to each other.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1356.1">Apart from all </span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.1357.1">these</span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.1358.1"> technical reasons, it is really fun to create Go packages that are shared among multiple developers!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1359.1">Let us now continue by learning more about the SQLite database.</span></p>
<h2 class="heading-2" id="_idParaDest-165"><span class="koboSpan" id="kobo.1360.1">Working with SQLite3 and Go</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1361.1">You need to</span><a id="_idIndexMarker440"/><span class="koboSpan" id="kobo.1362.1"> download an additional package for working with a database, such </span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.1363.1">as Postgres, SQLite, MySQL, or MongoDB. </span><span class="koboSpan" id="kobo.1363.2">In this case, we are using SQLite and therefore need to download a Go package that allows us to communicate with SQLite. </span><span class="koboSpan" id="kobo.1363.3">The most popular Go package for working with SQLite3 is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1364.1">go-sqlite3</span></code><span class="koboSpan" id="kobo.1365.1"> and can be found at </span><a href="https://github.com/mattn/go-sqlite3"><span class="url"><span class="koboSpan" id="kobo.1366.1">https://github.com/mattn/go-sqlite3</span></span></a><span class="koboSpan" id="kobo.1367.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1368.1">SQLite databases are single files that are accessed locally and, therefore, they do not need any TCP/IP services or other server processes running.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1369.1">You can download that package by running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1370.1">go get github.com/mattn/go-sqlite3</span></code><span class="koboSpan" id="kobo.1371.1">. </span><span class="koboSpan" id="kobo.1371.2">However, this command no longer works outside of a module. </span><span class="koboSpan" id="kobo.1371.3">The new way of installing the package is by running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1372.1">go install github.com/mattn/go-sqlite3@latest</span></code><span class="koboSpan" id="kobo.1373.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1374.1">Bear in mind that this package uses cgo, which requires the gcc compiler installed on your computer. </span><span class="koboSpan" id="kobo.1374.2">For more details, visit </span><a href="https://github.com/mattn/go-sqlite3"><span class="url"><span class="koboSpan" id="kobo.1375.1">https://github.com/mattn/go-sqlite3</span></span></a><span class="koboSpan" id="kobo.1376.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1377.1">After the successful execution of the previous command, </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.1378.1">the latest version of the package</span></strong><span class="koboSpan" id="kobo.1379.1"> is going to be downloaded. </span><span class="koboSpan" id="kobo.1379.2">In my case, the source code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1380.1">go-sqlite3</span></code><span class="koboSpan" id="kobo.1381.1"> package can be found at </span><code class="inlineCode"><span class="koboSpan" id="kobo.1382.1">~/go/pkg/mod/github.com/mattn</span></code><span class="koboSpan" id="kobo.1383.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1384.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1385.1">ls</span></span><span class="koboSpan" id="kobo.1386.1"> ~/go/pkg/mod/github.com/mattn
go-sqlite3@v1.14.22
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1387.1">Therefore, the version of the downloaded </span><code class="inlineCode"><span class="koboSpan" id="kobo.1388.1">go-sqlite3</span></code><span class="koboSpan" id="kobo.1389.1"> package is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1390.1">1.14.22</span></code><span class="koboSpan" id="kobo.1391.1">. </span><span class="koboSpan" id="kobo.1391.2">Alternatively, you can let the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1392.1">go mod init</span></code><span class="koboSpan" id="kobo.1393.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1394.1">go mod tidy</span></code><span class="koboSpan" id="kobo.1395.1"> commands do the job for you.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1396.1">Before doing any actual work with SQLite3, we are going to present a simple utility that just connects to a database and prints the version of SQLite3. </span><span class="koboSpan" id="kobo.1396.2">Such utilities are really handy while troubleshooting as they perform simple yet critical tasks. </span><span class="koboSpan" id="kobo.1396.3">As </span><code class="inlineCode"><span class="koboSpan" id="kobo.1397.1">testSQLite.go</span></code><span class="koboSpan" id="kobo.1398.1"> uses an external package, it should be placed under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1399.1">~/go/src</span></code><span class="koboSpan" id="kobo.1400.1"> during development and follow the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">go mod init</span></code><span class="koboSpan" id="kobo.1402.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">go mod tidy</span></code><span class="koboSpan" id="kobo.1404.1"> process. </span><span class="koboSpan" id="kobo.1404.2">In my case, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1405.1">testSQLite.go</span></code><span class="koboSpan" id="kobo.1406.1"> is placed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1407.1">~/go/src/github.com/mactsouk/mGo4th/ch06/testSQLite</span></code><span class="koboSpan" id="kobo.1408.1"> directory.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1409.1">The code of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1410.1">testSQLite.go</span></code><span class="koboSpan" id="kobo.1411.1"> is presented in two parts. </span><span class="koboSpan" id="kobo.1411.2">The first part is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1412.1">package</span></span><span class="koboSpan" id="kobo.1413.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1414.1">import</span></span><span class="koboSpan" id="kobo.1415.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1416.1">"database/sql"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1417.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1418.1">"os"</span></span><span class="koboSpan" id="kobo.1419.1">
    _ </span><span class="hljs-string"><span class="koboSpan" id="kobo.1420.1">"github.com/mattn/go-sqlite3"</span></span><span class="koboSpan" id="kobo.1421.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1422.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1423.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1424.1">()</span></span><span class="koboSpan" id="kobo.1425.1"> {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1426.1">// Connect or Create an SQLite database</span></span><span class="koboSpan" id="kobo.1427.1">
    db, err := sql.Open(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1428.1">"sqlite3"</span></span><span class="koboSpan" id="kobo.1429.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1430.1">"test.db"</span></span><span class="koboSpan" id="kobo.1431.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1432.1">if</span></span><span class="koboSpan" id="kobo.1433.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1434.1">nil</span></span><span class="koboSpan" id="kobo.1435.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1436.1">"Error connecting:"</span></span><span class="koboSpan" id="kobo.1437.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1438.1">return</span></span><span class="koboSpan" id="kobo.1439.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1440.1">defer</span></span><span class="koboSpan" id="kobo.1441.1"> db.Close()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1442.1">As the package communicates with SQLite3, we import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1443.1">github.com/mattn/go-sqlite3</span></code><span class="koboSpan" id="kobo.1444.1"> package and we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1445.1">_</span></code><span class="koboSpan" id="kobo.1446.1"> in front of the package path. </span><span class="koboSpan" id="kobo.1446.2">This happens because the imported package is </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.1447.1">registering itself as the database handler</span></strong><span class="koboSpan" id="kobo.1448.1"> for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1449.1">sql</span></code><span class="koboSpan" id="kobo.1450.1"> package, but it is not being</span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.1451.1"> directly </span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.1452.1">used in the code. </span><span class="koboSpan" id="kobo.1452.2">It is only being used through the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1453.1">sql</span></code><span class="koboSpan" id="kobo.1454.1"> package.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1455.1">With the previous code, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1456.1">sql.Open()</span></code><span class="koboSpan" id="kobo.1457.1"> to connect to an SQLite3 database, which is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1458.1">test.db</span></code><span class="koboSpan" id="kobo.1459.1">. </span><span class="koboSpan" id="kobo.1459.2">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1460.1">test.db</span></code><span class="koboSpan" id="kobo.1461.1"> file does not exist, it will be created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1462.1">The second part comes with the following Go code:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1463.1">var</span></span><span class="koboSpan" id="kobo.1464.1"> version </span><span class="hljs-type"><span class="koboSpan" id="kobo.1465.1">string</span></span><span class="koboSpan" id="kobo.1466.1">
    err = db.QueryRow(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1467.1">"SELECT SQLITE_VERSION()"</span></span><span class="koboSpan" id="kobo.1468.1">).Scan(&amp;version)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1469.1">if</span></span><span class="koboSpan" id="kobo.1470.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1471.1">nil</span></span><span class="koboSpan" id="kobo.1472.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1473.1">"Version:"</span></span><span class="koboSpan" id="kobo.1474.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1475.1">return</span></span><span class="koboSpan" id="kobo.1476.1">
    }
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1477.1">"SQLite3 version:"</span></span><span class="koboSpan" id="kobo.1478.1">, version)
os.Remove(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1479.1">"test.db"</span></span><span class="koboSpan" id="kobo.1480.1">)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1481.1">In the second part, we query the SQLite database using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1482.1">db.QueryRow()</span></code><span class="koboSpan" id="kobo.1483.1"> in order to get information about its version number. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">QueryRow()</span></code><span class="koboSpan" id="kobo.1485.1"> is handy for executing queries that are expected to return at most one row, as in our case. </span><span class="koboSpan" id="kobo.1485.2">The return value of the query is read using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">Scan()</span></code><span class="koboSpan" id="kobo.1487.1"> and saved in the variable that is the parameter of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1488.1">Scan()</span></code><span class="koboSpan" id="kobo.1489.1"> using a pointer. </span><span class="koboSpan" id="kobo.1489.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1490.1">os.Remove()</span></code><span class="koboSpan" id="kobo.1491.1"> statement deletes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1492.1">test.db</span></code><span class="koboSpan" id="kobo.1493.1"> fileâ€”in general, this is not a good practice but it works in this particular case.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1494.1">Do not forget to execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1495.1">go mod init</span></code><span class="koboSpan" id="kobo.1496.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1497.1">go mod tidy</span></code><span class="koboSpan" id="kobo.1498.1"> before you execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1499.1">testSQLite.go</span></code><span class="koboSpan" id="kobo.1500.1"> for the first time.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1501.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">testSQLite.go</span></code><span class="koboSpan" id="kobo.1503.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1504.1">$ </span></span><span class="koboSpan" id="kobo.1505.1">go run testSQLite.go
SQLite3 version: 3.42.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1506.1">Now, let us develop something more advanced. </span><span class="koboSpan" id="kobo.1506.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1507.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1508.1"> utility verifies that you can create an SQLite3 database along with some tables, get a list of the available tables, insert and update data in a table, select data from a table, delete data, and get the number of records. </span><span class="koboSpan" id="kobo.1508.2">As the utility uses an external package, it should be placed under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1509.1">~/go/src</span></code><span class="koboSpan" id="kobo.1510.1"> and follow the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1511.1">go mod init</span></code><span class="koboSpan" id="kobo.1512.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1513.1">go mod tidy</span></code><span class="koboSpan" id="kobo.1514.1"> process. </span><span class="koboSpan" id="kobo.1514.2">In my case, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1515.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1516.1"> is placed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1">~/go/src/github.com/mactsouk/mGo4th/ch06/connectSQLite3</span></code><span class="koboSpan" id="kobo.1518.1"> but you can put it anywhere you want</span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.1519.1"> as</span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.1520.1"> long as it is under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1521.1">~/go/src</span></code><span class="koboSpan" id="kobo.1522.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1523.1">The code of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1524.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1525.1"> is going to be presented in six parts, the first part being the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1526.1">package</span></span><span class="koboSpan" id="kobo.1527.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1528.1">import</span></span><span class="koboSpan" id="kobo.1529.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1530.1">"database/sql"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1531.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1532.1">"os"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1533.1">"strconv"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1534.1">"time"</span></span><span class="koboSpan" id="kobo.1535.1">
    _ </span><span class="hljs-string"><span class="koboSpan" id="kobo.1536.1">"github.com/mattn/go-sqlite3"</span></span><span class="koboSpan" id="kobo.1537.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1538.1">var</span></span><span class="koboSpan" id="kobo.1539.1"> dbname = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1540.1">"ch06.db"</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1541.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1542.1">insertData</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1543.1">(db *sql.DB, dsc </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.1544.1">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1545.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.1546.1">error</span></span><span class="koboSpan" id="kobo.1547.1"> {
    cT := time.Now().Format(time.RFC1123)
    stmt, err := db.Prepare(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1548.1">"INSERT INTO book VALUES(NULL,?,?);"</span></span><span class="koboSpan" id="kobo.1549.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1550.1">if</span></span><span class="koboSpan" id="kobo.1551.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1552.1">nil</span></span><span class="koboSpan" id="kobo.1553.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1554.1">"Insert data table:"</span></span><span class="koboSpan" id="kobo.1555.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1556.1">return</span></span><span class="koboSpan" id="kobo.1557.1"> err
    }
    _, err = stmt.Exec(cT, dsc)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1558.1">if</span></span><span class="koboSpan" id="kobo.1559.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1560.1">nil</span></span><span class="koboSpan" id="kobo.1561.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1562.1">"Insert data table:"</span></span><span class="koboSpan" id="kobo.1563.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1564.1">return</span></span><span class="koboSpan" id="kobo.1565.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1566.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1567.1">nil</span></span><span class="koboSpan" id="kobo.1568.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1569.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1570.1">insertData()</span></code><span class="koboSpan" id="kobo.1571.1"> function is used for inserting data into the database and is called by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1572.1">main()</span></code><span class="koboSpan" id="kobo.1573.1"> function. </span><span class="koboSpan" id="kobo.1573.2">We first use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1574.1">db.Prepare()</span></code><span class="koboSpan" id="kobo.1575.1"> to construct the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1576.1">INSERT</span></code><span class="koboSpan" id="kobo.1577.1"> SQL statement with the desired parameters and then we execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1578.1">Exec()</span></code><span class="koboSpan" id="kobo.1579.1"> to actually insert the data. </span><span class="koboSpan" id="kobo.1579.2">It is a common practice to use one or more </span><code class="inlineCode"><span class="koboSpan" id="kobo.1580.1">?</span></code><span class="koboSpan" id="kobo.1581.1"> while preparing an SQL statement and replace those question marks with</span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.1582.1"> the</span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.1583.1"> actual values when calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.1584.1">Exec()</span></code><span class="koboSpan" id="kobo.1585.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1586.1">The second part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1587.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1588.1"> comes with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1589.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1590.1">selectData</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1591.1">(db *sql.DB, n </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.1592.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1593.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.1594.1">error</span></span><span class="koboSpan" id="kobo.1595.1"> {
    rows, err := </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1596.1">db.Query(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1597.1">"SELECT * from book WHERE id &gt; ? </span><span class="koboSpan" id="kobo.1597.2">"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1598.1">, n)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1599.1">if</span></span><span class="koboSpan" id="kobo.1600.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1601.1">nil</span></span><span class="koboSpan" id="kobo.1602.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1603.1">"Select:"</span></span><span class="koboSpan" id="kobo.1604.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1605.1">return</span></span><span class="koboSpan" id="kobo.1606.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1607.1">defer</span></span><span class="koboSpan" id="kobo.1608.1"> rows.Close()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1609.1">for</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1610.1">rows.Next()</span></strong></span><span class="koboSpan" id="kobo.1611.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1612.1">var</span></span><span class="koboSpan" id="kobo.1613.1"> id </span><span class="hljs-type"><span class="koboSpan" id="kobo.1614.1">int</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1615.1">var</span></span><span class="koboSpan" id="kobo.1616.1"> dt </span><span class="hljs-type"><span class="koboSpan" id="kobo.1617.1">string</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1618.1">var</span></span><span class="koboSpan" id="kobo.1619.1"> description </span><span class="hljs-type"><span class="koboSpan" id="kobo.1620.1">string</span></span><span class="koboSpan" id="kobo.1621.1">
        err = rows.Scan(&amp;id, &amp;dt, &amp;description)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1622.1">if</span></span><span class="koboSpan" id="kobo.1623.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1624.1">nil</span></span><span class="koboSpan" id="kobo.1625.1"> {
            fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1626.1">"Row:"</span></span><span class="koboSpan" id="kobo.1627.1">, err)
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1628.1">return</span></span><span class="koboSpan" id="kobo.1629.1"> err
        }
        date, err := time.Parse(time.RFC1123, dt)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1630.1">if</span></span><span class="koboSpan" id="kobo.1631.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1632.1">nil</span></span><span class="koboSpan" id="kobo.1633.1"> {
            fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1634.1">"Date:"</span></span><span class="koboSpan" id="kobo.1635.1">, err)
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1636.1">return</span></span><span class="koboSpan" id="kobo.1637.1"> err
        }
        fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1638.1">"%d %s %s\n"</span></span><span class="koboSpan" id="kobo.1639.1">, id, date, description)
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1640.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1641.1">nil</span></span><span class="koboSpan" id="kobo.1642.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1643.1">In this second part, we show how to query SQLite3 data and read multiple rows. </span><span class="koboSpan" id="kobo.1643.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1644.1">db.Query()</span></code><span class="koboSpan" id="kobo.1645.1"> to construct the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1646.1">SELECT</span></code><span class="koboSpan" id="kobo.1647.1"> SQL query, which returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1648.1">*sql.Rows</span></code><span class="koboSpan" id="kobo.1649.1"> variable. </span><span class="koboSpan" id="kobo.1649.2">We then read the rows by calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.1650.1">Next()</span></code><span class="koboSpan" id="kobo.1651.1"> multiple times using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1652.1">for</span></code><span class="koboSpan" id="kobo.1653.1"> loop, which automatically terminates when there is no more data to read. </span><span class="koboSpan" id="kobo.1653.2">As the time is stored as text in SQLite, we need to convert it into a proper variable using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1654.1">time.Parse()</span></code><span class="koboSpan" id="kobo.1655.1">. </span><span class="koboSpan" id="kobo.1655.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1656.1">selectData()</span></code><span class="koboSpan" id="kobo.1657.1"> function prints the data on its own instead of returning it to the calling function.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1658.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1659.1">db.Query()</span></code><span class="koboSpan" id="kobo.1660.1"> statement does not require </span><code class="inlineCode"><span class="koboSpan" id="kobo.1661.1">Exec()</span></code><span class="koboSpan" id="kobo.1662.1"> to get executed. </span><span class="koboSpan" id="kobo.1662.2">Therefore, we replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.1663.1">?</span></code><span class="koboSpan" id="kobo.1664.1"> with the actual values in the same statement.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1665.1">The third part is</span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.1666.1"> the </span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.1667.1">following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1668.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1669.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1670.1">()</span></span><span class="koboSpan" id="kobo.1671.1"> {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1672.1">// Delete database file</span></span><span class="koboSpan" id="kobo.1673.1">
    os.Remove(dbname)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1674.1">// Connect and Create the SQLite database</span></span><span class="koboSpan" id="kobo.1675.1">
    db, err := sql.Open(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1676.1">"sqlite3"</span></span><span class="koboSpan" id="kobo.1677.1">, dbname)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1678.1">if</span></span><span class="koboSpan" id="kobo.1679.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1680.1">nil</span></span><span class="koboSpan" id="kobo.1681.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1682.1">"Error connecting:"</span></span><span class="koboSpan" id="kobo.1683.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1684.1">return</span></span><span class="koboSpan" id="kobo.1685.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1686.1">defer</span></span><span class="koboSpan" id="kobo.1687.1"> db.Close()
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1688.1">// Create a table</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1689.1">const</span></span><span class="koboSpan" id="kobo.1690.1"> create </span><span class="hljs-type"><span class="koboSpan" id="kobo.1691.1">string</span></span><span class="koboSpan" id="kobo.1692.1"> = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1693.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1694.1">    CREATE TABLE IF NOT EXISTS book (</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1695.1">      id INTEGER NOT NULL PRIMARY KEY,</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1696.1">      time TEXT NOT NULL,</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1697.1">      description TEXT);`</span></span><span class="koboSpan" id="kobo.1698.1">
    _, err = db.Exec(create)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1699.1">if</span></span><span class="koboSpan" id="kobo.1700.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1701.1">nil</span></span><span class="koboSpan" id="kobo.1702.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1703.1">"Create table:"</span></span><span class="koboSpan" id="kobo.1704.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1705.1">return</span></span><span class="koboSpan" id="kobo.1706.1">
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1707.1">In this part, we connect to the SQLite3 database and create a table named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1708.1">book</span></code><span class="koboSpan" id="kobo.1709.1">. </span><span class="koboSpan" id="kobo.1709.2">The table has three fields, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1710.1">id</span></code><span class="koboSpan" id="kobo.1711.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1712.1">time</span></code><span class="koboSpan" id="kobo.1713.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1714.1">description</span></code><span class="koboSpan" id="kobo.1715.1">. </span><span class="koboSpan" id="kobo.1715.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1716.1">db.Exec()</span></code><span class="koboSpan" id="kobo.1717.1"> statement is used for executing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1718.1">CREATE TABLE</span></code><span class="koboSpan" id="kobo.1719.1"> SQL command.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1720.1">The fourth part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1721.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1722.1"> contains the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.1723.1">// Insert 10 rows to the book table</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1724.1">for</span></span><span class="koboSpan" id="kobo.1725.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.1726.1">1</span></span><span class="koboSpan" id="kobo.1727.1">; i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.1728.1">11</span></span><span class="koboSpan" id="kobo.1729.1">; i = i + </span><span class="hljs-number"><span class="koboSpan" id="kobo.1730.1">1</span></span><span class="koboSpan" id="kobo.1731.1"> {
        dsc := </span><span class="hljs-string"><span class="koboSpan" id="kobo.1732.1">"Description: "</span></span><span class="koboSpan" id="kobo.1733.1"> + strconv.Itoa(i)
        err = insertData(db, dsc)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1734.1">if</span></span><span class="koboSpan" id="kobo.1735.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1736.1">nil</span></span><span class="koboSpan" id="kobo.1737.1"> {
            fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1738.1">"Insert data:"</span></span><span class="koboSpan" id="kobo.1739.1">, err)
        }
    }
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1740.1">// Select multiple rows</span></span><span class="koboSpan" id="kobo.1741.1">
    err = selectData(db, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1742.1">5</span></span><span class="koboSpan" id="kobo.1743.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1744.1">if</span></span><span class="koboSpan" id="kobo.1745.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1746.1">nil</span></span><span class="koboSpan" id="kobo.1747.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1748.1">"Select:"</span></span><span class="koboSpan" id="kobo.1749.1">, err)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1750.1">The previous code </span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.1751.1">inserts ten rows into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1752.1">book</span></code><span class="koboSpan" id="kobo.1753.1"> table using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1754.1">insertData()</span></code><span class="koboSpan" id="kobo.1755.1"> function and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1756.1">for</span></code><span class="koboSpan" id="kobo.1757.1"> loop. </span><span class="koboSpan" id="kobo.1757.2">After </span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.1758.1">that, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1759.1">selectData()</span></code><span class="koboSpan" id="kobo.1760.1"> function is called for selecting data from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1761.1">book</span></code><span class="koboSpan" id="kobo.1762.1"> table.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1763.1">The fifth part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1764.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1765.1"> comes with the following Go code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1766.1">    time.Sleep(time.Second)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1767.1">// Update data</span></span><span class="koboSpan" id="kobo.1768.1">
    cT := time.Now().Format(time.RFC1123)
    db.Exec(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">"UPDATE book SET time = ? </span><span class="koboSpan" id="kobo.1769.2">WHERE id &gt; ?"</span></span><span class="koboSpan" id="kobo.1770.1">, cT, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1771.1">7</span></span><span class="koboSpan" id="kobo.1772.1">)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1773.1">// Select multiple rows</span></span><span class="koboSpan" id="kobo.1774.1">
    err = selectData(db, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1775.1">8</span></span><span class="koboSpan" id="kobo.1776.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1777.1">if</span></span><span class="koboSpan" id="kobo.1778.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1779.1">nil</span></span><span class="koboSpan" id="kobo.1780.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1781.1">"Select:"</span></span><span class="koboSpan" id="kobo.1782.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1783.1">return</span></span><span class="koboSpan" id="kobo.1784.1">
    }
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1785.1">// Delete data</span></span><span class="koboSpan" id="kobo.1786.1">
    stmt, err := db.Prepare(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1787.1">"DELETE from book where id = ?"</span></span><span class="koboSpan" id="kobo.1788.1">)
    _, err = stmt.Exec(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1789.1">8</span></span><span class="koboSpan" id="kobo.1790.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1791.1">if</span></span><span class="koboSpan" id="kobo.1792.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1793.1">nil</span></span><span class="koboSpan" id="kobo.1794.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1795.1">"Delete:"</span></span><span class="koboSpan" id="kobo.1796.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1797.1">return</span></span><span class="koboSpan" id="kobo.1798.1">
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1799.1">In this part, we present the implementation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1800.1">UPDATE</span></code><span class="koboSpan" id="kobo.1801.1"> SQL statement, which is based on </span><code class="inlineCode"><span class="koboSpan" id="kobo.1802.1">db.Exec()</span></code><span class="koboSpan" id="kobo.1803.1">â€”once again, the values of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1804.1">UPDATE</span></code><span class="koboSpan" id="kobo.1805.1"> SQL statement are passed to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1806.1">db.Exec()</span></code><span class="koboSpan" id="kobo.1807.1">. </span><span class="koboSpan" id="kobo.1807.2">After that, we call </span><code class="inlineCode"><span class="koboSpan" id="kobo.1808.1">selectData()</span></code><span class="koboSpan" id="kobo.1809.1"> to see the changes we have made. </span><span class="koboSpan" id="kobo.1809.2">Last, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1810.1">db.Prepare()</span></code><span class="koboSpan" id="kobo.1811.1"> to construct a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1812.1">DELETE</span></code><span class="koboSpan" id="kobo.1813.1"> statement, which is executed using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1814.1">Exec()</span></code><span class="koboSpan" id="kobo.1815.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1816.1">The last </span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.1817.1">part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1818.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1819.1"> is</span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.1820.1"> the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.1821.1">// Select multiple rows</span></span><span class="koboSpan" id="kobo.1822.1">
    err = selectData(db, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1823.1">7</span></span><span class="koboSpan" id="kobo.1824.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1825.1">if</span></span><span class="koboSpan" id="kobo.1826.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1827.1">nil</span></span><span class="koboSpan" id="kobo.1828.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1829.1">"Select:"</span></span><span class="koboSpan" id="kobo.1830.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1831.1">return</span></span><span class="koboSpan" id="kobo.1832.1">
    }
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1833.1">// Count rows in table</span></span><span class="koboSpan" id="kobo.1834.1">
    query, err := db.Query(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1835.1">"SELECT count(*) as count from book"</span></span><span class="koboSpan" id="kobo.1836.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1837.1">if</span></span><span class="koboSpan" id="kobo.1838.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1839.1">nil</span></span><span class="koboSpan" id="kobo.1840.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1841.1">"Select:"</span></span><span class="koboSpan" id="kobo.1842.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1843.1">return</span></span><span class="koboSpan" id="kobo.1844.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1845.1">defer</span></span><span class="koboSpan" id="kobo.1846.1"> query.Close()
    count := </span><span class="hljs-number"><span class="koboSpan" id="kobo.1847.1">-100</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1848.1">for</span></span><span class="koboSpan" id="kobo.1849.1"> query.Next() {
        _ = query.Scan(&amp;count)
    }
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1850.1">"count(*):"</span></span><span class="koboSpan" id="kobo.1851.1">, count)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1852.1">In the last part of the utility, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1853.1">db.Query()</span></code><span class="koboSpan" id="kobo.1854.1"> to get the number of rows in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1855.1">book</span></code><span class="koboSpan" id="kobo.1856.1"> table and print the results.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1857.1">As expected, before you execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1858.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1859.1">, you should execute the following commands first:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1860.1">$ </span></span><span class="koboSpan" id="kobo.1861.1">go mod init
go: creating new go.mod: module github.com/mactsouk/mGo4th/ch06/connectSQLite3
go: to add module requirements and sums:
    go mod tidy
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1862.1">$ </span></span><span class="koboSpan" id="kobo.1863.1">go mod tidy
go: finding module for package github.com/mattn/go-sqlite3
go: found github.com/mattn/go-sqlite3 in github.com/mattn/go-sqlite3 v1.14.17
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1864.1">The last line of the output tells us that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1865.1">github.com/mattn/go-sqlite3</span></code><span class="koboSpan" id="kobo.1866.1"> package was found in our Go installation and therefore it was not downloadedâ€”this is a result of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1867.1">go get github.com/mattn/go-sqlite3</span></code><span class="koboSpan" id="kobo.1868.1"> command we executed earlier.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1869.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1870.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1871.1"> generates the following kind of output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1872.1">$ </span></span><span class="koboSpan" id="kobo.1873.1">go run connectSQLite3.go
6 2023-08-16 21:12:00 +0300 EEST Description: 6
7 2023-08-16 21:12:00 +0300 EEST Description: 7
8 2023-08-16 21:12:00 +0300 EEST Description: 8
9 2023-08-16 21:12:00 +0300 EEST Description: 9
10 2023-08-16 21:12:00 +0300 EEST Description: 10
9 2023-08-16 21:12:01 +0300 EEST Description: 9
10 2023-08-16 21:12:01 +0300 EEST Description: 10
9 2023-08-16 21:12:01 +0300 EEST Description: 9
10 2023-08-16 21:12:01 +0300 EEST Description: 10
count(*): 9
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1874.1">The main advantage of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1875.1">connectSQLite3.go</span></code><span class="koboSpan" id="kobo.1876.1"> utility is that it illustrates how to perform a large number of tasks on an SQLite databaseâ€”most of the presented code is going to be reused in the Go package that we are going to create in a while.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1877.1">Now that we know how </span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.1878.1">to</span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.1879.1"> access and query an SQLite3 database using Go, the next task should be to implement the Go package we want to develop.</span></p>
<h2 class="heading-2" id="_idParaDest-166"><span class="koboSpan" id="kobo.1880.1">Storing the Go package</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1881.1">As mentioned</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.1882.1"> earlier, for reasons of simplicity, we will use a public Go repository for the Go module, which is named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1883.1">sqilite06</span></code><span class="koboSpan" id="kobo.1884.1"> and can be found at </span><a href="https://github.com/mactsouk/sqlite06"><span class="url"><span class="koboSpan" id="kobo.1885.1">https://github.com/mactsouk/sqlite06</span></span></a><span class="koboSpan" id="kobo.1886.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1887.1">To use that package on your machines, you should </span><code class="inlineCode"><span class="koboSpan" id="kobo.1888.1">go get</span></code><span class="koboSpan" id="kobo.1889.1"> it first, either manually or with the help of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1890.1">go mod init</span></code><span class="koboSpan" id="kobo.1891.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1892.1">go mod tidy</span></code><span class="koboSpan" id="kobo.1893.1">. </span><span class="koboSpan" id="kobo.1893.2">However, during development, you should begin with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1894.1">git clone git@github.com:mactsouk/sqlite06.git</span></code><span class="koboSpan" id="kobo.1895.1"> to get the contents of the GitHub repository and make changes to it until its functionality is finalized and there are no bugs. </span><span class="koboSpan" id="kobo.1895.2">This implies that you have ssh set up with GitHub, which is what I usually use. </span><span class="koboSpan" id="kobo.1895.3">I am doing the development of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1896.1">sqilite06</span></code><span class="koboSpan" id="kobo.1897.1"> package in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1898.1">~/go/src/github.com/mactsouk/sqlite06</span></code><span class="koboSpan" id="kobo.1899.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-167"><span class="koboSpan" id="kobo.1900.1">The design of the Go package</span></h2>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.1901.1">Figure 6.3</span></em><span class="koboSpan" id="kobo.1902.1"> shows the database </span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.1903.1">schema that the Go package works on. </span><span class="koboSpan" id="kobo.1903.2">Remember that when working with a specific database and schema, you need to </span><em class="italic"><span class="koboSpan" id="kobo.1904.1">include</span></em><span class="koboSpan" id="kobo.1905.1"> the schema information in your Go code. </span><span class="koboSpan" id="kobo.1905.2">Put simply, the Go code should know about the schema it works on:</span></p>
<figure class="mediaobject"> <span class="koboSpan" id="kobo.1906.1"><img alt="" role="presentation" src="../Images/B21003_06_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1907.1">Figure 6.3: The two database tables the Go package works on</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1908.1">This is a simple schema that allows us to keep user data and update it. </span><span class="koboSpan" id="kobo.1908.2">Apart from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1909.1">Users</span></code><span class="koboSpan" id="kobo.1910.1"> table, there is also a table named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1911.1">Userdata</span></code><span class="koboSpan" id="kobo.1912.1"> that holds more detailed information about a user. </span><span class="koboSpan" id="kobo.1912.2">What connects the two tables is the user ID, which should be unique. </span><span class="koboSpan" id="kobo.1912.3">Additionally, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1913.1">Username</span></code><span class="koboSpan" id="kobo.1914.1"> field on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1915.1">Users</span></code><span class="koboSpan" id="kobo.1916.1"> table should also be unique as two or more users cannot share the same username. </span><span class="koboSpan" id="kobo.1916.2">Once a record is entered in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1917.1">Users</span></code><span class="koboSpan" id="kobo.1918.1"> table, it cannot be changed, it can only be deleted. </span><span class="koboSpan" id="kobo.1918.2">What can change, however, is the data stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1919.1">Userdata</span></code><span class="koboSpan" id="kobo.1920.1"> table.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1921.1">These two tables should already exist in SQLite, which means that the Go code assumes that the relevant tables are in the right place.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1922.1">The tasks that the Go package should perform to make our lives easier are as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1923.1">Create a new user.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1924.1">Delete an existing user.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1925.1">Update an existing user.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1926.1">List all users.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1927.1">Each of these tasks</span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.1928.1"> should have one or more Go functions or methods to support it, which is what we are going to implement in the Go package:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1929.1">A function to initiate the SQLite3 connection. </span><span class="koboSpan" id="kobo.1929.2">The helper function to initiate the connection is going to be private.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1930.1">A function that checks whether a given username existsâ€”this is a helper function that is also going to be private.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1931.1">A function that inserts a new user into the database.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1932.1">A function that deletes an existing user from the database.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1933.1">A function for updating an existing user.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1934.1">A function for listing all users.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1935.1">Now that we know the overall structure and functionality of the Go package, we should begin implementing it.</span></p>
<h2 class="heading-2" id="_idParaDest-168"><span class="koboSpan" id="kobo.1936.1">The implementation of the Go package</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1937.1">In this subsection, we</span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.1938.1"> will implement the Go package for working with the SQLite database and the given database schema. </span><span class="koboSpan" id="kobo.1938.2">We will present each function separatelyâ€”if you combine all these functions, then you have the functionality of the entire package.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1939.1">During package development, you should regularly commit your changes to the GitHub or GitLab repository as a backup strategy.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1940.1">All the code of the package is found in a Go source file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1941.1">sqlite06.go</span></code><span class="koboSpan" id="kobo.1942.1">. </span><span class="koboSpan" id="kobo.1942.2">The preamble of the package is as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1943.1">package</span></span><span class="koboSpan" id="kobo.1944.1"> sqlite06
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1945.1">import</span></span><span class="koboSpan" id="kobo.1946.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1947.1">"database/sql"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1948.1">"errors"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1949.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1950.1">"strings"</span></span><span class="koboSpan" id="kobo.1951.1">
    _ </span><span class="hljs-string"><span class="koboSpan" id="kobo.1952.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1953.1">github.com/mattn/go-sqlite3"</span></span><span class="koboSpan" id="kobo.1954.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1955.1">var</span></span><span class="koboSpan" id="kobo.1956.1"> (
    Filename = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1957.1">""</span></span><span class="koboSpan" id="kobo.1958.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1959.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1960.1">Filename</span></code><span class="koboSpan" id="kobo.1961.1"> variable holds the name of the database fileâ€”this is set by the applications that use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1962.1">sqlite06</span></code><span class="koboSpan" id="kobo.1963.1">. </span><span class="koboSpan" id="kobo.1963.2">For the first time in this book, you will see a package name different than </span><code class="inlineCode"><span class="koboSpan" id="kobo.1964.1">main</span></code><span class="koboSpan" id="kobo.1965.1">, which in this case is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1966.1">sqlite06</span></code><span class="koboSpan" id="kobo.1967.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1968.1">The next element that you need in your Go package is one or more structures that can hold the data from the database tables. </span><span class="koboSpan" id="kobo.1968.2">Most of the time, you need as many structures as there are database tablesâ€”we will begin with that and see how it goes. </span><span class="koboSpan" id="kobo.1968.3">Therefore, we will define the following structures:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1969.1">type</span></span><span class="koboSpan" id="kobo.1970.1"> User </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1971.1">struct</span></span><span class="koboSpan" id="kobo.1972.1"> {
    ID       </span><span class="hljs-type"><span class="koboSpan" id="kobo.1973.1">int</span></span><span class="koboSpan" id="kobo.1974.1">
    Username </span><span class="hljs-type"><span class="koboSpan" id="kobo.1975.1">string</span></span><span class="koboSpan" id="kobo.1976.1">
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1977.1">type</span></span><span class="koboSpan" id="kobo.1978.1"> Userdata </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1979.1">struct</span></span><span class="koboSpan" id="kobo.1980.1"> {
    ID          </span><span class="hljs-type"><span class="koboSpan" id="kobo.1981.1">int</span></span><span class="koboSpan" id="kobo.1982.1">
    Name        </span><span class="hljs-type"><span class="koboSpan" id="kobo.1983.1">string</span></span><span class="koboSpan" id="kobo.1984.1">
    Surname     </span><span class="hljs-type"><span class="koboSpan" id="kobo.1985.1">string</span></span><span class="koboSpan" id="kobo.1986.1">
    Description </span><span class="hljs-type"><span class="koboSpan" id="kobo.1987.1">string</span></span><span class="koboSpan" id="kobo.1988.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1989.1">If you think about this, you should see that there is no point in creating two separate Go structures in our case. </span><span class="koboSpan" id="kobo.1989.2">This is because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1990.1">User</span></code><span class="koboSpan" id="kobo.1991.1"> structure holds no real data, and there is no point in passing multiple structures to the functions that process data for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1992.1">Users</span></code><span class="koboSpan" id="kobo.1993.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1994.1">Userdata</span></code><span class="koboSpan" id="kobo.1995.1"> SQLite tables. </span><span class="koboSpan" id="kobo.1995.2">Therefore, we can create a single Go structure for holding all the data that has been defined, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1996.1">type</span></span><span class="koboSpan" id="kobo.1997.1"> Userdata </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1998.1">struct</span></span><span class="koboSpan" id="kobo.1999.1"> {
    ID          </span><span class="hljs-type"><span class="koboSpan" id="kobo.2000.1">int</span></span><span class="koboSpan" id="kobo.2001.1">
    Username    </span><span class="hljs-type"><span class="koboSpan" id="kobo.2002.1">string</span></span><span class="koboSpan" id="kobo.2003.1">
    Name        </span><span class="hljs-type"><span class="koboSpan" id="kobo.2004.1">string</span></span><span class="koboSpan" id="kobo.2005.1">
    Surname     </span><span class="hljs-type"><span class="koboSpan" id="kobo.2006.1">string</span></span><span class="koboSpan" id="kobo.2007.1">
    Description </span><span class="hljs-type"><span class="koboSpan" id="kobo.2008.1">string</span></span><span class="koboSpan" id="kobo.2009.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2010.1">I have decided to name the structure after the database table for simplicityâ€”however, in this case, this is not completely accurate as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2011.1">Userdata</span></code><span class="koboSpan" id="kobo.2012.1"> structure has more fields than the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2013.1">Userdata</span></code><span class="koboSpan" id="kobo.2014.1"> database table.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2015.1">Let us now begin </span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.2016.1">presenting the functions of the package. </span><span class="koboSpan" id="kobo.2016.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2017.1">openConnection()</span></code><span class="koboSpan" id="kobo.2018.1"> function, which is private and only accessed within the scope of the package, is defined as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2019.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2020.1">openConnection</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2021.1">()</span></span><span class="koboSpan" id="kobo.2022.1"> (*sql.DB, </span><span class="hljs-type"><span class="koboSpan" id="kobo.2023.1">error</span></span><span class="koboSpan" id="kobo.2024.1">) {
    db, err := sql.Open(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2025.1">"sqlite3"</span></span><span class="koboSpan" id="kobo.2026.1">, Filename)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2027.1">if</span></span><span class="koboSpan" id="kobo.2028.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2029.1">nil</span></span><span class="koboSpan" id="kobo.2030.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2031.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2032.1">nil</span></span><span class="koboSpan" id="kobo.2033.1">, err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2034.1">return</span></span><span class="koboSpan" id="kobo.2035.1"> db, </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2036.1">nil</span></span><span class="koboSpan" id="kobo.2037.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2038.1">SQLite3 does not require a username or a password and does not operate over a TCP/IP network. </span><span class="koboSpan" id="kobo.2038.2">Therefore, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2039.1">sql.Open()</span></code><span class="koboSpan" id="kobo.2040.1"> requires just a single parameter, which is the filename of the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2041.1">Now, let us consider the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2042.1">exists()</span></code><span class="koboSpan" id="kobo.2043.1"> function, which is also private as it is a helper function:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2044.1">// The function returns the User ID of the username</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2045.1">// -1 if the user does not exist</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2046.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2047.1">exists</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2048.1">(username </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2049.1">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2050.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2051.1">int</span></span><span class="koboSpan" id="kobo.2052.1"> {
    username = strings.ToLower(username)
    db, err := openConnection()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2053.1">if</span></span><span class="koboSpan" id="kobo.2054.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2055.1">nil</span></span><span class="koboSpan" id="kobo.2056.1"> {
        fmt.Println(err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2057.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2058.1">-1</span></span><span class="koboSpan" id="kobo.2059.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2060.1">defer</span></span><span class="koboSpan" id="kobo.2061.1"> db.Close()
    userID := </span><span class="hljs-number"><span class="koboSpan" id="kobo.2062.1">-1</span></span><span class="koboSpan" id="kobo.2063.1">
    statement := fmt.Sprintf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2064.1">`SELECT ID FROM Users where Username = '%s'`</span></span><span class="koboSpan" id="kobo.2065.1">, username)
    rows, err := db.Query(statement)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2066.1">defer</span></span><span class="koboSpan" id="kobo.2067.1"> rows.Close()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2068.1">This is where we define the query that shows whether the provided username exists in the database or not. </span><span class="koboSpan" id="kobo.2068.2">As </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.2069.1">all our data is kept in the database, we need to interact with the database all the time.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2070.1">This is one of the rare cases where returning an indication value from a function makes more sense as it makes the code less complex than returning an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2071.1">error</span></code><span class="koboSpan" id="kobo.2072.1"> value. </span><span class="koboSpan" id="kobo.2072.2">However, returning an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2073.1">error</span></code><span class="koboSpan" id="kobo.2074.1"> value is still more robust and closer to the Go philosophy.</span></p>
</div>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2075.1">for</span></span><span class="koboSpan" id="kobo.2076.1"> rows.Next() {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2077.1">var</span></span><span class="koboSpan" id="kobo.2078.1"> id </span><span class="hljs-type"><span class="koboSpan" id="kobo.2079.1">int</span></span><span class="koboSpan" id="kobo.2080.1">
        err = rows.Scan(&amp;id)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2081.1">if</span></span><span class="koboSpan" id="kobo.2082.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2083.1">nil</span></span><span class="koboSpan" id="kobo.2084.1"> {
            fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2085.1">"exists() Scan"</span></span><span class="koboSpan" id="kobo.2086.1">, err)
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2087.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2088.1">-1</span></span><span class="koboSpan" id="kobo.2089.1">
        }
        userID = id
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2090.1">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2091.1">rows.Scan(&amp;id)</span></code><span class="koboSpan" id="kobo.2092.1"> call is executed without any errors, then we know that a result has been returned, which is the desired user ID.</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2093.1">return</span></span><span class="koboSpan" id="kobo.2094.1"> userID
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2095.1">The last part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2096.1">exists()</span></code><span class="koboSpan" id="kobo.2097.1"> frees resources and returns the ID value of the username that was given as a parameter to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2098.1">exists()</span></code><span class="koboSpan" id="kobo.2099.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2100.1">Here is the implementation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2101.1">AddUser()</span></code><span class="koboSpan" id="kobo.2102.1"> function:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2103.1">// AddUser adds a new user to the database</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2104.1">// Returns new User ID</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2105.1">// -1 if there was an error</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2106.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2107.1">AddUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2108.1">(d Userdata)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2109.1">int</span></span><span class="koboSpan" id="kobo.2110.1"> {
    d.Username = strings.ToLower(d.Username)
    db, err := openConnection()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2111.1">if</span></span><span class="koboSpan" id="kobo.2112.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2113.1">nil</span></span><span class="koboSpan" id="kobo.2114.1"> {
        fmt.Println(err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2115.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2116.1">-1</span></span><span class="koboSpan" id="kobo.2117.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2118.1">defer</span></span><span class="koboSpan" id="kobo.2119.1"> db.Close()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2120.1">All usernames are converted into lowercase using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2121.1">strings.ToLower()</span></code><span class="koboSpan" id="kobo.2122.1"> to avoid duplicates. </span><span class="koboSpan" id="kobo.2122.2">This is a design decision.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2123.1">    userID := exists(d.Username)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2124.1">if</span></span><span class="koboSpan" id="kobo.2125.1"> userID != </span><span class="hljs-number"><span class="koboSpan" id="kobo.2126.1">-1</span></span><span class="koboSpan" id="kobo.2127.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2128.1">"User already exists:"</span></span><span class="koboSpan" id="kobo.2129.1">, d.Username)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2130.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2131.1">-1</span></span><span class="koboSpan" id="kobo.2132.1">
    }
    insertStatement := </span><span class="hljs-string"><span class="koboSpan" id="kobo.2133.1">`INSERT INTO Users values (NULL,?)`</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2134.1">This is how we </span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.2135.1">construct an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2136.1">INSERT</span></code><span class="koboSpan" id="kobo.2137.1"> statement that accepts parameters. </span><span class="koboSpan" id="kobo.2137.2">The presented statement requires one value as there is a single </span><code class="inlineCode"><span class="koboSpan" id="kobo.2138.1">?</span></code><span class="koboSpan" id="kobo.2139.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2140.1">    _, err = db.Exec(insertStatement, d.Username)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2141.1">if</span></span><span class="koboSpan" id="kobo.2142.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2143.1">nil</span></span><span class="koboSpan" id="kobo.2144.1"> {
        fmt.Println(err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2145.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2146.1">-1</span></span><span class="koboSpan" id="kobo.2147.1">
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2148.1">With </span><code class="inlineCode"><span class="koboSpan" id="kobo.2149.1">db.Exec()</span></code><span class="koboSpan" id="kobo.2150.1"> we pass the value of the parameter, which is kept as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2151.1">d.Username</span></code><span class="koboSpan" id="kobo.2152.1">, into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2153.1">insertStatement</span></code><span class="koboSpan" id="kobo.2154.1"> variable.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2155.1">    userID = exists(d.Username)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2156.1">if</span></span><span class="koboSpan" id="kobo.2157.1"> userID == </span><span class="hljs-number"><span class="koboSpan" id="kobo.2158.1">-1</span></span><span class="koboSpan" id="kobo.2159.1"> {
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2160.1">return</span></span><span class="koboSpan" id="kobo.2161.1"> userID
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2162.1">After inserting a new user into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2163.1">Users</span></code><span class="koboSpan" id="kobo.2164.1"> table, we make sure that everything went fine with the help of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2165.1">exists()</span></code><span class="koboSpan" id="kobo.2166.1"> function, which also returns the user ID of the new user. </span><span class="koboSpan" id="kobo.2166.2">That user ID is used for inserting the relevant data into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2167.1">Userdata</span></code><span class="koboSpan" id="kobo.2168.1"> table.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2169.1">    insertStatement = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2170.1">`INSERT INTO Userdata values (?, ?, ?, ?)`</span></span><span class="koboSpan" id="kobo.2171.1">
    _, err = db.Exec(insertStatement, userID, d.Name, d.Surname, d.Description)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2172.1">if</span></span><span class="koboSpan" id="kobo.2173.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2174.1">nil</span></span><span class="koboSpan" id="kobo.2175.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2176.1">"db.Exec()"</span></span><span class="koboSpan" id="kobo.2177.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2178.1">return</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2179.1">-1</span></span><span class="koboSpan" id="kobo.2180.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2181.1">return</span></span><span class="koboSpan" id="kobo.2182.1"> userID
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2183.1">The presented query needs four values that are signified by four </span><code class="inlineCode"><span class="koboSpan" id="kobo.2184.1">?</span></code><span class="koboSpan" id="kobo.2185.1"> characters. </span><span class="koboSpan" id="kobo.2185.2">As we need to pass four variables to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2186.1">insertStatement</span></code><span class="koboSpan" id="kobo.2187.1">, we will put four values in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2188.1">db.Exec()</span></code><span class="koboSpan" id="kobo.2189.1"> call. </span><span class="koboSpan" id="kobo.2189.2">This is the end of the function that adds a new user to the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2190.1">The implementation</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.2191.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2192.1">DeleteUser()</span></code><span class="koboSpan" id="kobo.2193.1"> function is as follows.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2194.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2195.1">DeleteUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2196.1">(id </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2197.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2198.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2199.1">error</span></span><span class="koboSpan" id="kobo.2200.1"> {
    db, err := openConnection()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2201.1">if</span></span><span class="koboSpan" id="kobo.2202.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2203.1">nil</span></span><span class="koboSpan" id="kobo.2204.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2205.1">return</span></span><span class="koboSpan" id="kobo.2206.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2207.1">defer</span></span><span class="koboSpan" id="kobo.2208.1"> db.Close()
statement := fmt.Sprintf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2209.1">`SELECT Username FROM Users WHERE ID = %d`</span></span><span class="koboSpan" id="kobo.2210.1">, id)
    rows, err := db.Query(statement)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2211.1">defer</span></span><span class="koboSpan" id="kobo.2212.1"> rows.Close()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2213.1">var</span></span><span class="koboSpan" id="kobo.2214.1"> username </span><span class="hljs-type"><span class="koboSpan" id="kobo.2215.1">string</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2216.1">for</span></span><span class="koboSpan" id="kobo.2217.1"> rows.Next() {
        </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2218.1">err = rows.Scan(&amp;username)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2219.1">if</span></span><span class="koboSpan" id="kobo.2220.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2221.1">nil</span></span><span class="koboSpan" id="kobo.2222.1"> {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2223.1">return</span></span><span class="koboSpan" id="kobo.2224.1"> err
        }
    }
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2225.1">if</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2226.1">exists(username) != id</span></strong></span><span class="koboSpan" id="kobo.2227.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2228.1">return</span></span><span class="koboSpan" id="kobo.2229.1"> fmt.Errorf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2230.1">"User with ID %d does not exist"</span></span><span class="koboSpan" id="kobo.2231.1">, id)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2232.1">Here, we double-check whether the given user ID exists or not in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2233.1">Users</span></code><span class="koboSpan" id="kobo.2234.1"> table before trying to delete it.</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.2235.1">// Delete from Userdata</span></span><span class="koboSpan" id="kobo.2236.1">
    deleteStatement := </span><span class="hljs-string"><span class="koboSpan" id="kobo.2237.1">`DELETE FROM Userdata WHERE UserID = ?`</span></span><span class="koboSpan" id="kobo.2238.1">
    _, err = db.Exec(deleteStatement, id)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2239.1">if</span></span><span class="koboSpan" id="kobo.2240.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2241.1">nil</span></span><span class="koboSpan" id="kobo.2242.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2243.1">return</span></span><span class="koboSpan" id="kobo.2244.1"> err
    }
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2245.1">// Delete from Users</span></span><span class="koboSpan" id="kobo.2246.1">
    deleteStatement = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2247.1">`DELETE from Users where ID = ?`</span></span><span class="koboSpan" id="kobo.2248.1">
    _, err = db.Exec(deleteStatement, id)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2249.1">if</span></span><span class="koboSpan" id="kobo.2250.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2251.1">nil</span></span><span class="koboSpan" id="kobo.2252.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2253.1">return</span></span><span class="koboSpan" id="kobo.2254.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2255.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2256.1">nil</span></span><span class="koboSpan" id="kobo.2257.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2258.1">If the previously returned </span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.2259.1">username exists and has the same user ID as the parameter to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2260.1">DeleteUser()</span></code><span class="koboSpan" id="kobo.2261.1">, then we can continue the deletion process, which contains two steps: First, deleting the relevant user data from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2262.1">Userdata</span></code><span class="koboSpan" id="kobo.2263.1"> table, and, second, deleting the data from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2264.1">Users</span></code><span class="koboSpan" id="kobo.2265.1"> table.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2266.1">During development, I included many </span><code class="inlineCode"><span class="koboSpan" id="kobo.2267.1">fmt.Println()</span></code><span class="koboSpan" id="kobo.2268.1"> statements in the package code for debugging purposes. </span><span class="koboSpan" id="kobo.2268.2">However, I have removed most of them in the final version of the Go package and replaced them with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2269.1">error</span></code><span class="koboSpan" id="kobo.2270.1"> values. </span><span class="koboSpan" id="kobo.2270.2">These </span><code class="inlineCode"><span class="koboSpan" id="kobo.2271.1">error</span></code><span class="koboSpan" id="kobo.2272.1"> values are passed to the program that uses the functionality of the package, which is responsible for deciding what to do with the error messages and error conditions. </span><span class="koboSpan" id="kobo.2272.2">You can also use logging for thisâ€”the output can go to standard output or even </span><code class="inlineCode"><span class="koboSpan" id="kobo.2273.1">/dev/null</span></code><span class="koboSpan" id="kobo.2274.1"> when not needed.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2275.1">Now, let us examine the implementation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2276.1">ListUsers()</span></code><span class="koboSpan" id="kobo.2277.1"> function.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2278.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2279.1">ListUsers</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2280.1">()</span></span><span class="koboSpan" id="kobo.2281.1"> ([]Userdata, </span><span class="hljs-type"><span class="koboSpan" id="kobo.2282.1">error</span></span><span class="koboSpan" id="kobo.2283.1">) {
    Data := []Userdata{}
    db, err := openConnection()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2284.1">if</span></span><span class="koboSpan" id="kobo.2285.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2286.1">nil</span></span><span class="koboSpan" id="kobo.2287.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2288.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2289.1">nil</span></span><span class="koboSpan" id="kobo.2290.1">, err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2291.1">defer</span></span><span class="koboSpan" id="kobo.2292.1"> db.Close()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2293.1">Once again, we need to open a connection to the database before executing any database queries.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2294.1">    rows, err := db.Query(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2295.1">`SELECT ID, Username, Name, Surname, Description FROM Users, Userdata WHERE Users.ID = Userdata.UserID`</span></span><span class="koboSpan" id="kobo.2296.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2297.1">defer</span></span><span class="koboSpan" id="kobo.2298.1"> rows.Close()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2299.1">if</span></span><span class="koboSpan" id="kobo.2300.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2301.1">nil</span></span><span class="koboSpan" id="kobo.2302.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2303.1">return</span></span><span class="koboSpan" id="kobo.2304.1"> Data, err
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2305.1">This is the query that reads all data from the two tables. </span><span class="koboSpan" id="kobo.2305.2">After that, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2306.1">rows</span></code><span class="koboSpan" id="kobo.2307.1"> variable to get the results of the query:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2308.1">for</span></span><span class="koboSpan" id="kobo.2309.1"> rows.Next() {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2310.1">var</span></span><span class="koboSpan" id="kobo.2311.1"> id </span><span class="hljs-type"><span class="koboSpan" id="kobo.2312.1">int</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2313.1">var</span></span><span class="koboSpan" id="kobo.2314.1"> username </span><span class="hljs-type"><span class="koboSpan" id="kobo.2315.1">string</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2316.1">var</span></span><span class="koboSpan" id="kobo.2317.1"> name </span><span class="hljs-type"><span class="koboSpan" id="kobo.2318.1">string</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2319.1">var</span></span><span class="koboSpan" id="kobo.2320.1"> surname </span><span class="hljs-type"><span class="koboSpan" id="kobo.2321.1">string</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2322.1">var</span></span><span class="koboSpan" id="kobo.2323.1"> desc </span><span class="hljs-type"><span class="koboSpan" id="kobo.2324.1">string</span></span><span class="koboSpan" id="kobo.2325.1">
        err = rows.Scan(&amp;id, &amp;username, &amp;name, &amp;surname, &amp;desc)
        temp := Userdata{ID: id, Username: username, Name: name, Surname: surname, Description: desc}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2326.1">At this point, we will </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.2327.1">store the data we have received from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2328.1">SELECT</span></code><span class="koboSpan" id="kobo.2329.1"> query in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2330.1">Userdata</span></code><span class="koboSpan" id="kobo.2331.1"> structure. </span><span class="koboSpan" id="kobo.2331.2">This is added to the slice that is going to be returned from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2332.1">ListUsers()</span></code><span class="koboSpan" id="kobo.2333.1"> function. </span><span class="koboSpan" id="kobo.2333.2">This process continues until there is nothing left to read:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2334.1">        Data = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2335.1">append</span></span><span class="koboSpan" id="kobo.2336.1">(Data, temp)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2337.1">if</span></span><span class="koboSpan" id="kobo.2338.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2339.1">nil</span></span><span class="koboSpan" id="kobo.2340.1"> {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2341.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2342.1">nil</span></span><span class="koboSpan" id="kobo.2343.1">, err
        }
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2344.1">return</span></span><span class="koboSpan" id="kobo.2345.1"> Data, </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2346.1">nil</span></span><span class="koboSpan" id="kobo.2347.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2348.1">After updating the contents of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2349.1">Data</span></code><span class="koboSpan" id="kobo.2350.1"> slice using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2351.1">append()</span></code><span class="koboSpan" id="kobo.2352.1">, we end the query, and the function returns the list of available users, as stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2353.1">Data</span></code><span class="koboSpan" id="kobo.2354.1"> variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2355.1">Lastly, let us examine the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2356.1">UpdateUser()</span></code><span class="koboSpan" id="kobo.2357.1"> function:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2358.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2359.1">UpdateUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2360.1">(d Userdata)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2361.1">error</span></span><span class="koboSpan" id="kobo.2362.1"> {
    db, err := openConnection()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2363.1">if</span></span><span class="koboSpan" id="kobo.2364.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2365.1">nil</span></span><span class="koboSpan" id="kobo.2366.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2367.1">return</span></span><span class="koboSpan" id="kobo.2368.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2369.1">defer</span></span><span class="koboSpan" id="kobo.2370.1"> db.Close()
    userID := exists(d.Username)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2371.1">if</span></span><span class="koboSpan" id="kobo.2372.1"> userID == </span><span class="hljs-number"><span class="koboSpan" id="kobo.2373.1">-1</span></span><span class="koboSpan" id="kobo.2374.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2375.1">return</span></span><span class="koboSpan" id="kobo.2376.1"> errors.New(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2377.1">"User does not exist"</span></span><span class="koboSpan" id="kobo.2378.1">)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2379.1">First, we need to make sure that the given username exists in the databaseâ€”the update process is based on the username.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2380.1">d.ID = userID
    updateStatement := </span><span class="hljs-string"><span class="koboSpan" id="kobo.2381.1">`UPDATE Userdata set Name = ?, Surname = ?, Description = ? </span><span class="koboSpan" id="kobo.2381.2">where UserID = ?`</span></span><span class="koboSpan" id="kobo.2382.1">
    _, err = db.Exec(updateStatement, d.Name, d.Surname, d.Description, d.ID)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2383.1">if</span></span><span class="koboSpan" id="kobo.2384.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2385.1">nil</span></span><span class="koboSpan" id="kobo.2386.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2387.1">return</span></span><span class="koboSpan" id="kobo.2388.1"> err
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2389.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2390.1">nil</span></span><span class="koboSpan" id="kobo.2391.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2392.1">The update statement </span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.2393.1">stored in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2394.1">updateStatement</span></code><span class="koboSpan" id="kobo.2395.1"> that is executed using the desired parameters with the help of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2396.1">db.Exec()</span></code><span class="koboSpan" id="kobo.2397.1"> updates the user data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2398.1">After you finish writing your code, you should execute the following commands:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2399.1">$ </span></span><span class="koboSpan" id="kobo.2400.1">go mod init
go: creating new go.mod: module github.com/mactsouk/sqlite06
go: to add module requirements and sums:
    go mod tidy
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2401.1">The previous command tells Go that this is a package with external dependencies.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2402.1">$ </span></span><span class="koboSpan" id="kobo.2403.1">go mod tidy
go: finding module for package github.com/mattn/go-sqlite3
go: found github.com/mattn/go-sqlite3 in github.com/mattn/go-sqlite3 v1.14.17
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2404.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2405.1">go mod tidy</span></code><span class="koboSpan" id="kobo.2406.1"> command downloads all required dependencies, if any.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2407.1">Now that we know </span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.2408.1">the details of how to implement each function in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2409.1">sqlite06</span></code><span class="koboSpan" id="kobo.2410.1"> package, it is time to begin using that package!</span></p>
<h2 class="heading-2" id="_idParaDest-169"><span class="koboSpan" id="kobo.2411.1">Testing the Go package</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2412.1">In order to test the </span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.2413.1">package, we must develop a command line utility called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2414.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2415.1">. </span><span class="koboSpan" id="kobo.2415.2">As </span><code class="inlineCode"><span class="koboSpan" id="kobo.2416.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2417.1"> uses an external package, even if we have developed that package, we should not forget to put it somewhere inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.2418.1">~/go/src</span></code><span class="koboSpan" id="kobo.2419.1">. </span><span class="koboSpan" id="kobo.2419.2">If you download the GitHub repository of the book, you are going to find it in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2420.1">ch06/usePackage</span></code><span class="koboSpan" id="kobo.2421.1">. </span><span class="koboSpan" id="kobo.2421.2">As </span><code class="inlineCode"><span class="koboSpan" id="kobo.2422.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2423.1"> is used for testing purposes only, we hardcoded most of the data apart from the username of the user we put into the database. </span><span class="koboSpan" id="kobo.2423.2">All usernames are randomly generated.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2424.1">The code of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2425.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2426.1"> is presented in six parts. </span><span class="koboSpan" id="kobo.2426.2">The first part is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2427.1">package</span></span><span class="koboSpan" id="kobo.2428.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2429.1">import</span></span><span class="koboSpan" id="kobo.2430.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2431.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2432.1">"math/rand"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2433.1">"strings"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2434.1">"time"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2435.1">"github.com/mactsouk/sqlite06"</span></span><span class="koboSpan" id="kobo.2436.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2437.1">In this first part, we import the necessary Go packages, including our own </span><code class="inlineCode"><span class="koboSpan" id="kobo.2438.1">sqlite06</span></code><span class="koboSpan" id="kobo.2439.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2440.1">The second part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2441.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2442.1"> comes with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2443.1">var</span></span><span class="koboSpan" id="kobo.2444.1"> MIN = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2445.1">0</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2446.1">var</span></span><span class="koboSpan" id="kobo.2447.1"> MAX = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2448.1">26</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2449.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2450.1">random</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2451.1">(min, max </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2452.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2453.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2454.1">int</span></span><span class="koboSpan" id="kobo.2455.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2456.1">return</span></span><span class="koboSpan" id="kobo.2457.1"> rand.Intn(max-min) + min
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2458.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2459.1">getString</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2460.1">(length </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2461.1">int64</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2462.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2463.1">string</span></span><span class="koboSpan" id="kobo.2464.1"> {
    startChar := </span><span class="hljs-string"><span class="koboSpan" id="kobo.2465.1">"A"</span></span><span class="koboSpan" id="kobo.2466.1">
    temp := </span><span class="hljs-string"><span class="koboSpan" id="kobo.2467.1">""</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2468.1">var</span></span><span class="koboSpan" id="kobo.2469.1"> i </span><span class="hljs-type"><span class="koboSpan" id="kobo.2470.1">int64</span></span><span class="koboSpan" id="kobo.2471.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.2472.1">1</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2473.1">for</span></span><span class="koboSpan" id="kobo.2474.1"> {
        myRand := random(MIN, MAX)
        newChar := </span><span class="hljs-type"><span class="koboSpan" id="kobo.2475.1">string</span></span><span class="koboSpan" id="kobo.2476.1">(startChar[</span><span class="hljs-number"><span class="koboSpan" id="kobo.2477.1">0</span></span><span class="koboSpan" id="kobo.2478.1">] + </span><span class="hljs-type"><span class="koboSpan" id="kobo.2479.1">byte</span></span><span class="koboSpan" id="kobo.2480.1">(myRand))
        temp = temp + newChar
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2481.1">if</span></span><span class="koboSpan" id="kobo.2482.1"> i == length {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2483.1">break</span></span><span class="koboSpan" id="kobo.2484.1">
        }
        i++
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2485.1">return</span></span><span class="koboSpan" id="kobo.2486.1"> temp
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2487.1">The previous code generates random strings of a given length. </span><span class="koboSpan" id="kobo.2487.2">These strings contain regular characters in uppercase.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2488.1">The third part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2489.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2490.1"> contains the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2491.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2492.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2493.1">()</span></span><span class="koboSpan" id="kobo.2494.1"> {
    sqlite06.Filename = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2495.1">"ch06.db"</span></span><span class="koboSpan" id="kobo.2496.1">
    data, err := sqlite06.ListUsers()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2497.1">if</span></span><span class="koboSpan" id="kobo.2498.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2499.1">nil</span></span><span class="koboSpan" id="kobo.2500.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2501.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2502.1">ListUsers():"</span></span><span class="koboSpan" id="kobo.2503.1">, err)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2504.1">return</span></span><span class="koboSpan" id="kobo.2505.1">
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2506.1">if</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2507.1">len</span></span><span class="koboSpan" id="kobo.2508.1">(data) != </span><span class="hljs-number"><span class="koboSpan" id="kobo.2509.1">0</span></span><span class="koboSpan" id="kobo.2510.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2511.1">for</span></span><span class="koboSpan" id="kobo.2512.1"> _, v := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2513.1">range</span></span><span class="koboSpan" id="kobo.2514.1"> data {
            fmt.Println(v)
        }
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2515.1">This is where the </span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.2516.1">implementation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2517.1">main()</span></code><span class="koboSpan" id="kobo.2518.1"> begins. </span><span class="koboSpan" id="kobo.2518.2">The first statement is where we define the name of the SQLite3 database. </span><span class="koboSpan" id="kobo.2518.3">Although we are using an external package, the database is going to be created in the directory that we execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.2519.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2520.1"> in.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2521.1">After that, we call </span><code class="inlineCode"><span class="koboSpan" id="kobo.2522.1">sqlite06.ListUsers()</span></code><span class="koboSpan" id="kobo.2523.1"> to get the list of available users.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2524.1">The fourth part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2525.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2526.1"> is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2527.1">    SEED := time.Now().Unix()
    rand.Seed(SEED)
    random_username := strings.ToLower(getString(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2528.1">5</span></span><span class="koboSpan" id="kobo.2529.1">))
    t := sqlite06.Userdata{
        Username:    random_username,
        Name:        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2530.1">"Mihalis"</span></span><span class="koboSpan" id="kobo.2531.1">,
        Surname:     </span><span class="hljs-string"><span class="koboSpan" id="kobo.2532.1">"Tsoukalos"</span></span><span class="koboSpan" id="kobo.2533.1">,
        Description: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2534.1">"This is me!"</span></span><span class="koboSpan" id="kobo.2535.1">}
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2536.1">"Adding username:"</span></span><span class="koboSpan" id="kobo.2537.1">, random_username)
    id := sqlite06.AddUser(t)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2538.1">if</span></span><span class="koboSpan" id="kobo.2539.1"> id == </span><span class="hljs-number"><span class="koboSpan" id="kobo.2540.1">-1</span></span><span class="koboSpan" id="kobo.2541.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2542.1">"There was an error adding user"</span></span><span class="koboSpan" id="kobo.2543.1">, t.Username)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2544.1">The previous code generates a random username, creates and populates a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2545.1">Userdata</span></code><span class="koboSpan" id="kobo.2546.1"> structure, and calls </span><code class="inlineCode"><span class="koboSpan" id="kobo.2547.1">sqlite06.AddUser()</span></code><span class="koboSpan" id="kobo.2548.1"> to add a new user.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2549.1">The fifth part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2550.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2551.1"> contains the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2552.1">    err = sqlite06.DeleteUser(id)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2553.1">if</span></span><span class="koboSpan" id="kobo.2554.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2555.1">nil</span></span><span class="koboSpan" id="kobo.2556.1"> {
        fmt.Println(err)
    } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2557.1">else</span></span><span class="koboSpan" id="kobo.2558.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2559.1">"User with ID"</span></span><span class="koboSpan" id="kobo.2560.1">, id, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2561.1">"deleted!"</span></span><span class="koboSpan" id="kobo.2562.1">)
    }
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2563.1">// Trying to delete the same user again!</span></span><span class="koboSpan" id="kobo.2564.1">
    err = sqlite06.DeleteUser(id)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2565.1">if</span></span><span class="koboSpan" id="kobo.2566.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2567.1">nil</span></span><span class="koboSpan" id="kobo.2568.1"> {
        fmt.Println(err)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2569.1">In the previous </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.2570.1">code, we try to delete the same user twice by calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.2571.1">sqlite06.DeleteUser()</span></code><span class="koboSpan" id="kobo.2572.1"> two times. </span><span class="koboSpan" id="kobo.2572.2">In this case, we expect the second attempt to fail.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2573.1">The last part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2574.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2575.1"> is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2576.1">    random_username = strings.ToLower(getString(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2577.1">5</span></span><span class="koboSpan" id="kobo.2578.1">))
    random_name := getString(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2579.1">7</span></span><span class="koboSpan" id="kobo.2580.1">)
    random_surname := getString(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2581.1">10</span></span><span class="koboSpan" id="kobo.2582.1">)
    dsc := time.Now().Format(time.RFC1123)
    t = sqlite06.Userdata{
        Username:    random_username,
        Name:        random_name,
        Surname:     random_surname,
        Description: dsc}
    id = sqlite06.AddUser(t)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2583.1">if</span></span><span class="koboSpan" id="kobo.2584.1"> id == </span><span class="hljs-number"><span class="koboSpan" id="kobo.2585.1">-1</span></span><span class="koboSpan" id="kobo.2586.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2587.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2588.1">There was an error adding user"</span></span><span class="koboSpan" id="kobo.2589.1">, t.Username)
    }
    dsc = time.Now().Format(time.RFC1123)
    t.Description = dsc
    err = sqlite06.UpdateUser(t)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2590.1">if</span></span><span class="koboSpan" id="kobo.2591.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2592.1">nil</span></span><span class="koboSpan" id="kobo.2593.1"> {
        fmt.Println(err)
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2594.1">In this last part, we add another user with random data and then we update its description by calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.2595.1">sqlite06.UpdateUser()</span></code><span class="koboSpan" id="kobo.2596.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2597.1">You should create the two tables in the SQLIte3 database before using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2598.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2599.1">. </span><span class="koboSpan" id="kobo.2599.2">Additionally, the name of the SQLite3 database file should be </span><code class="inlineCode"><span class="koboSpan" id="kobo.2600.1">ch06.db</span></code><span class="koboSpan" id="kobo.2601.1">, unless you change it in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2602.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2603.1">. </span><span class="koboSpan" id="kobo.2603.2">The easiest way to be ready is by running the following commands using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2604.1">sqlite3</span></code><span class="koboSpan" id="kobo.2605.1"> utility:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2606.1">$ </span></span><span class="koboSpan" id="kobo.2607.1">sqlite3 ch06.db
SQLite version 3.39.5 2022-10-14 20:58:05
Enter ".help" for usage hints.
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2608.1">sqlite&gt; </span></span><span class="koboSpan" id="kobo.2609.1">.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2610.1">read</span></span><span class="koboSpan" id="kobo.2611.1"> createTables.sql
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2612.1">The first command</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.2613.1"> creates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2614.1">ch06.db</span></code><span class="koboSpan" id="kobo.2615.1"> database whereas the second command executes the code found in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2616.1">createTables.sql</span></code><span class="koboSpan" id="kobo.2617.1">, which is included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2618.1">usePackage</span></code><span class="koboSpan" id="kobo.2619.1"> directory. </span><span class="koboSpan" id="kobo.2619.2">The content of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2620.1">createTables.sql</span></code><span class="koboSpan" id="kobo.2621.1"> file is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2622.1">DROP</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2623.1">TABLE</span></span><span class="koboSpan" id="kobo.2624.1"> IF </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2625.1">EXISTS</span></span><span class="koboSpan" id="kobo.2626.1"> Users;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2627.1">DROP</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2628.1">TABLE</span></span><span class="koboSpan" id="kobo.2629.1"> IF </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2630.1">EXISTS</span></span><span class="koboSpan" id="kobo.2631.1"> Userdata;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2632.1">CREATE</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2633.1">TABLE</span></span><span class="koboSpan" id="kobo.2634.1"> Users (
    ID </span><span class="hljs-type"><span class="koboSpan" id="kobo.2635.1">INTEGER</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2636.1">PRIMARY</span></span><span class="koboSpan" id="kobo.2637.1"> KEY,
    Username TEXT
);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2638.1">CREATE</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2639.1">TABLE</span></span><span class="koboSpan" id="kobo.2640.1"> Userdata (
    UserID </span><span class="hljs-type"><span class="koboSpan" id="kobo.2641.1">INTEGER</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2642.1">NOT</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2643.1">NULL</span></span><span class="koboSpan" id="kobo.2644.1">,
    Name TEXT,
    Surname TEXT,
    Description TEXT
);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2645.1">After you execute the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2646.1">createTables.sql</span></code><span class="koboSpan" id="kobo.2647.1"> file, you can verify its results as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2648.1">$ </span></span><span class="koboSpan" id="kobo.2649.1">sqlite3 ch06.db
SQLite version 3.39.5 2022-10-14 20:58:05
Enter ".help" for usage hints.
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2650.1">sqlite&gt; </span></span><span class="koboSpan" id="kobo.2651.1">.tables
Userdata  Users
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2652.1">sqlite&gt; </span></span><span class="koboSpan" id="kobo.2653.1">.schema
CREATE TABLE Users (
    ID INTEGER PRIMARY KEY,
    Username TEXT
);
CREATE TABLE Userdata (
    UserID INTEGER NOT NULL,
    Name TEXT,
    Surname TEXT,
    Description TEXT
);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2654.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2655.1">.tables</span></code><span class="koboSpan" id="kobo.2656.1"> command</span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.2657.1"> just lists the available table names, whereas the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2658.1">.schema</span></code><span class="koboSpan" id="kobo.2659.1"> command also displays information about the available tables.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2660.1">Now that we have the necessary infrastructure up and running, we can execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.2661.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2662.1">. </span><span class="koboSpan" id="kobo.2662.2">But before that, we need to enable modules and download any package dependencies:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2663.1">$ </span></span><span class="koboSpan" id="kobo.2664.1">go mod init
go: creating new go.mod: module github.com/mactsouk/mGo4th/ch06/usePackage
go: to add module requirements and sums:
    go mod tidy
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2665.1">$ </span></span><span class="koboSpan" id="kobo.2666.1">go mod tidy
go: finding module for package github.com/mactsouk/sqlite06
go: downloading github.com/mactsouk/sqlite06 v0.0.0-20230817125241-55d77b17637d
go: found github.com/mactsouk/sqlite06 in github.com/mactsouk/sqlite06 v0.0.0-20230817125241-55d77b17637d
go: finding module for package github.com/mattn/go-sqlite3
go: found github.com/mattn/go-sqlite3 in github.com/mattn/go-sqlite3 v1.14.17
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2667.1">Working with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2668.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2669.1"> creates the following kind of output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2670.1">$ </span></span><span class="koboSpan" id="kobo.2671.1">go run sqliteGo.go
Adding username: yzpon
User with ID 1 deleted!
</span><span class="koboSpan" id="kobo.2671.2">User with ID 1 does not exist
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2672.1">$ </span></span><span class="koboSpan" id="kobo.2673.1">go run sqliteGo.go
{1 vjyps AWJTWCI YIXXXQHSQA Thu, 17 Aug 2023 23:26:40 EEST}
Adding username: cqrxf
User with ID 2 deleted!
</span><span class="koboSpan" id="kobo.2673.2">User with ID 2 does not exist
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2674.1">The more times you execute it, the more data you are going to add to the relevant tables. </span><span class="koboSpan" id="kobo.2674.2">Additionally, the previous output confirms that </span><code class="inlineCode"><span class="koboSpan" id="kobo.2675.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.2676.1"> works as expected as it can connect to the database, add a new user, update a user, and delete an existing one. </span><span class="koboSpan" id="kobo.2676.2">This also means</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.2677.1"> that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2678.1">sqlite06</span></code><span class="koboSpan" id="kobo.2679.1"> package works as expected. </span><span class="koboSpan" id="kobo.2679.2">Now that we know how to create Go packages, let us briefly discuss Go modules.</span></p>
<h1 class="heading-1" id="_idParaDest-170"><span class="koboSpan" id="kobo.2680.1">Modules</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2681.1">A Go module is like a Go </span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.2682.1">package with a versionâ€”however, Go modules can consist of multiple packages. </span><span class="koboSpan" id="kobo.2682.2">Go uses semantic versioning for versioning modules. </span><span class="koboSpan" id="kobo.2682.3">This means that versions begin with the letter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2683.1">v</span></code><span class="koboSpan" id="kobo.2684.1">, followed by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2685.1">major.minor.patch</span></code><span class="koboSpan" id="kobo.2686.1"> version numbers. </span><span class="koboSpan" id="kobo.2686.2">Therefore, you can have versions such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2687.1">v1.0.0</span></code><span class="koboSpan" id="kobo.2688.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2689.1">v1.0.5</span></code><span class="koboSpan" id="kobo.2690.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2691.1">v2.0.2</span></code><span class="koboSpan" id="kobo.2692.1">. </span><span class="koboSpan" id="kobo.2692.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2693.1">v1</span></code><span class="koboSpan" id="kobo.2694.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2695.1">v2</span></code><span class="koboSpan" id="kobo.2696.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2697.1">v3</span></code><span class="koboSpan" id="kobo.2698.1"> parts signify the major version of a Go package that is usually not backward compatible. </span><span class="koboSpan" id="kobo.2698.2">This means that if your Go program works with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2699.1">v1</span></code><span class="koboSpan" id="kobo.2700.1">, it will not necessarily work with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2701.1">v2</span></code><span class="koboSpan" id="kobo.2702.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2703.1">v3</span></code><span class="koboSpan" id="kobo.2704.1">â€”it might work, but you cannot count on it. </span><span class="koboSpan" id="kobo.2704.2">The second number in a version is about features. </span><span class="koboSpan" id="kobo.2704.3">Usually, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2705.1">v1.1.0</span></code><span class="koboSpan" id="kobo.2706.1"> has more features than </span><code class="inlineCode"><span class="koboSpan" id="kobo.2707.1">v1.0.2</span></code><span class="koboSpan" id="kobo.2708.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2709.1">v1.0.0</span></code><span class="koboSpan" id="kobo.2710.1">, while being compatible with all older versions. </span><span class="koboSpan" id="kobo.2710.2">Lastly, the third number is just about bug fixes without having any new features. </span><span class="koboSpan" id="kobo.2710.3">Note that semantic versioning is also used for Go versions.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2711.1">Go modules were introduced in Go v1.11 but were finalized in Go v1.13.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2712.1">If you want to learn more about modules, visit and read </span><a href="https://go.dev/blog/using-go-modules"><span class="url"><span class="koboSpan" id="kobo.2713.1">https://go.dev/blog/using-go-modules</span></span></a><span class="koboSpan" id="kobo.2714.1">, which has five parts, as well as </span><a href="https://go.dev/doc/modules/developing"><span class="url"><span class="koboSpan" id="kobo.2715.1">https://go.dev/doc/modules/developing</span></span></a><span class="koboSpan" id="kobo.2716.1">. </span><span class="koboSpan" id="kobo.2716.2">Just remember that a Go module is similar but not identical to a regular Go package with a version, and that a module can consist of multiple packages.</span></p>
<h1 class="heading-1" id="_idParaDest-171"><span class="koboSpan" id="kobo.2717.1">Creating better packages</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2718.1">This section provides handy advice that can help you develop better Go packages. </span><span class="koboSpan" id="kobo.2718.2">Here are several good rules</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.2719.1"> to follow to create high-class Go packages:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2720.1">The first unofficial rule of a successful package is that its </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.2721.1">elements must be connected in some way</span></strong><span class="koboSpan" id="kobo.2722.1">. </span><span class="koboSpan" id="kobo.2722.2">Thus, you can create a package for supporting cars, but it would not be a good idea to create a single package for supporting cars, bicycles, and airplanes. </span><span class="koboSpan" id="kobo.2722.3">Put simply, it is better to split the functionality of a package unnecessarily into multiple packages than to add too much functionality to a single Go package.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2723.1">A second practical rule is that you should use your own packages first for a reasonable amount of time before making them public. </span><span class="koboSpan" id="kobo.2723.2">This helps you discover bugs and make sure that your packages operate as expected. </span><span class="koboSpan" id="kobo.2723.3">After that, give them to some fellow developers for additional testing before making them publicly available. </span><span class="koboSpan" id="kobo.2723.4">Additionally, you should always write tests for any package you intend to be used by others.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2724.1">Next, make sure your package has a clear and useful API so that any consumer can be productive with it quickly.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2725.1">Try and limit the public API of your packages to only what is necessary. </span><span class="koboSpan" id="kobo.2725.2">Additionally, give your functions descriptive but not very long names.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2726.1">Interfaces and generics can improve the usefulness of your functions, so when you think it is appropriate, use an interface or a generic data type instead of a single type as a function parameter or return type.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2727.1">When updating one of your packages, try not to break things and create incompatibilities with older versions unless it is absolutely necessary.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2728.1">When developing a new Go package, try to use multiple files in order to group similar tasks or concepts.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2729.1">Do not create a package that already exists from scratch. </span><span class="koboSpan" id="kobo.2729.2">Make changes to the existing package and maybe create your own version of it.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2730.1">Nobody wants a Go package that prints logging information on the screen. </span><span class="koboSpan" id="kobo.2730.2">It would be more professional to have a flag for turning on logging when needed. </span><span class="koboSpan" id="kobo.2730.3">The Go code of your packages should be in harmony with the Go code of your programs. </span><span class="koboSpan" id="kobo.2730.4">This means that if you look at a program that uses your packages and your function names stand out in the code in a bad way, it would be better to change the names of your functions. </span><span class="koboSpan" id="kobo.2730.5">As the name of a package is used almost everywhere, try to use concise and expressive package names.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2731.1">It is more convenient if you put new Go type definitions near where they are used the first time because nobody, including yourself, wants to search huge source files for definitions of new data types.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2732.1">Try to create test files for your packages, because packages with test files are considered more professional than ones without them; small details make all the difference and give people confidence that you are a serious developer! </span><span class="koboSpan" id="kobo.2732.2">Notice that writing tests for your packages is not optional and that you should avoid using packages that do not include tests. </span><span class="koboSpan" id="kobo.2732.3">You will learn more about testing in </span><em class="chapterRef"><span class="koboSpan" id="kobo.2733.1">Chapter 12</span></em><span class="koboSpan" id="kobo.2734.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2735.1">Code Testing and Profiling</span></em><span class="koboSpan" id="kobo.2736.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2737.1">Always remember that apart from the fact that the actual Go code in a package should be bug-free, the next most important element of a successful package is its documentation, as well</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.2738.1"> as some code examples that clarify its use and showcase the idiosyncrasies of the functions of the package. </span><span class="koboSpan" id="kobo.2738.2">The next section discusses creating documentation in Go.</span></p>
<h1 class="heading-1" id="_idParaDest-172"><span class="koboSpan" id="kobo.2739.1">Generating documentation</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2740.1">This section discusses </span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.2741.1">how to create documentation for your Go code using the code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2742.1">sqlite06</span></code><span class="koboSpan" id="kobo.2743.1"> package as an example. </span><span class="koboSpan" id="kobo.2743.2">The new package is renamed and is now called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2744.1">document</span></code><span class="koboSpan" id="kobo.2745.1">â€”you can find it in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2746.1">ch06/document</span></code><span class="koboSpan" id="kobo.2747.1"> in the GitHub repository of the book.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2748.1">Go follows a simple rule regarding documentation: in order to document a function, a method, a variable, or even the package itself, you can write comments, as usual, that should be located directly before the element you want to document, without any empty lines in between. </span><span class="koboSpan" id="kobo.2748.2">You can use one or more single-line comments, which are lines beginning with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2749.1">//</span></code><span class="koboSpan" id="kobo.2750.1">, or block comments, which begin with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2751.1">/*</span></code><span class="koboSpan" id="kobo.2752.1"> and end with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2753.1">*/</span></code><span class="koboSpan" id="kobo.2754.1">â€”everything in between is considered a comment.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2755.1">It is highly recommended that each Go package you create has a block comment preceding the package declaration that introduces developers to the package, and also explains what the package does.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2756.1">Instead of presenting the entire code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2757.1">sqlite06</span></code><span class="koboSpan" id="kobo.2758.1"> package, which has been renamed </span><code class="inlineCode"><span class="koboSpan" id="kobo.2759.1">document</span></code><span class="koboSpan" id="kobo.2760.1">, we will only present the important parts, which means that function implementations are going to be empty here (the actual file contains the full version). </span><span class="koboSpan" id="kobo.2760.2">The new version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2761.1">sqlite06.go</span></code><span class="koboSpan" id="kobo.2762.1"> is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2763.1">document.go</span></code><span class="koboSpan" id="kobo.2764.1"> and comes with the following code and comments:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2765.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2766.1">The package works on 2 tables on an SQLite database.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2767.1">The names of the tables are:</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2768.1">    * Users</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2769.1">    * Userdata</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2770.1">The definitions of the tables are:</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2771.1">    CREATE TABLE Users (</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2772.1">        ID INTEGER PRIMARY KEY,</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2773.1">        Username TEXT</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2774.1">    );</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2775.1">    CREATE TABLE Userdata (</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2776.1">        UserID INTEGER NOT NULL,</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2777.1">        Name TEXT,</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2778.1">        Surname TEXT,</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2779.1">        Description TEXT</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2780.1">    );</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2781.1">    This is rendered as code</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2782.1">This is not rendered as code</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2783.1">*/</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2784.1">package</span></span><span class="koboSpan" id="kobo.2785.1"> document
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2786.1">This is the first block of documentation that is located right before the name of the package. </span><span class="koboSpan" id="kobo.2786.2">This is the </span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.2787.1">appropriate place to document the functionality of the package, as well as other essential information. </span><span class="koboSpan" id="kobo.2787.2">In this case, we are presenting the SQL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2788.1">CREATE TABLE</span></code><span class="koboSpan" id="kobo.2789.1"> commands that fully describe the database tables we are going to work on. </span><span class="koboSpan" id="kobo.2789.2">Another important element is specifying the database server this package interacts with. </span><span class="koboSpan" id="kobo.2789.3">Other information that you can put at the beginning of a package is the author, the license, and the version of the package.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2790.1">If a line in a block comment begins with a tab, then it is rendered differently in the graphical output, which is good for differentiating between various kinds of information in the documentation.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2791.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2792.1">BUG</span></code><span class="koboSpan" id="kobo.2793.1"> keyword is special when writing documentation. </span><span class="koboSpan" id="kobo.2793.2">Go knows that bugs are part of the code and therefore should be documented as well. </span><span class="koboSpan" id="kobo.2793.3">You can write any message you want after a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2794.1">BUG</span></code><span class="koboSpan" id="kobo.2795.1"> keyword, and you can place them anywhere you wantâ€”preferably close to the bugs they describe:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2796.1">// BUG(1): Function ListUsers() not working as expected</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2797.1">// BUG(2): Function AddUser() is too slow</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2798.1">Next, we present the implementation details of the package.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2799.1">import (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2800.1">"database/sql"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2801.1">"errors"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2802.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2803.1">"strings"</span></span><span class="koboSpan" id="kobo.2804.1">
    _ </span><span class="hljs-string"><span class="koboSpan" id="kobo.2805.1">"github.com/mattn/go-sqlite3"</span></span><span class="koboSpan" id="kobo.2806.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2807.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2808.1">import</span></code><span class="koboSpan" id="kobo.2809.1"> block of the packageâ€”nothing special here.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2810.1">The following code shows a way of documenting a global variableâ€”this also works for multiple </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.2811.1">variables:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2812.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2813.1">This global variable holds the SQLite3 database filepath</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2814.1">    Filename: In the filepath to the database file</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2815.1">*/</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2816.1">var</span></span><span class="koboSpan" id="kobo.2817.1"> (
    Filename = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2818.1">""</span></span><span class="koboSpan" id="kobo.2819.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2820.1">The good thing with this way is that you do not have to put a comment before each global variable and make the code less readable. </span><span class="koboSpan" id="kobo.2820.2">The only downside of this method is that you should remember to update the comments, should you wish to make any changes to the code. </span><span class="koboSpan" id="kobo.2820.3">However, documenting multiple variables at once might not end up rendering correctly in web-based </span><code class="inlineCode"><span class="koboSpan" id="kobo.2821.1">godoc</span></code><span class="koboSpan" id="kobo.2822.1"> pages. </span><span class="koboSpan" id="kobo.2822.2">For that reason, you might want to document each field independently.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2823.1">The next excerpt shows how to document a Go structureâ€”this is especially useful when you have lots of structures in a source file and you want to have a quick look at them:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2824.1">// The Userdata structure is for holding full user data</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2825.1">// from the Userdata table and the Username from the</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2826.1">// Users table</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2827.1">type</span></span><span class="koboSpan" id="kobo.2828.1"> Userdata </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2829.1">struct</span></span><span class="koboSpan" id="kobo.2830.1"> {
    ID          </span><span class="hljs-type"><span class="koboSpan" id="kobo.2831.1">int</span></span><span class="koboSpan" id="kobo.2832.1">
    Username    </span><span class="hljs-type"><span class="koboSpan" id="kobo.2833.1">string</span></span><span class="koboSpan" id="kobo.2834.1">
    Name        </span><span class="hljs-type"><span class="koboSpan" id="kobo.2835.1">string</span></span><span class="koboSpan" id="kobo.2836.1">
    Surname     </span><span class="hljs-type"><span class="koboSpan" id="kobo.2837.1">string</span></span><span class="koboSpan" id="kobo.2838.1">
    Description </span><span class="hljs-type"><span class="koboSpan" id="kobo.2839.1">string</span></span><span class="koboSpan" id="kobo.2840.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2841.1">When documenting a function, it is good to begin the first line of the comments with the function name. </span><span class="koboSpan" id="kobo.2841.2">Apart from that, you can write any information that you consider important in the comments.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2842.1">// openConnection() is for opening the SQLite3 connection</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2843.1">// in order to be used by the other functions of the package.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2844.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2845.1">openConnection</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2846.1">()</span></span><span class="koboSpan" id="kobo.2847.1"> (*sql.DB, </span><span class="hljs-type"><span class="koboSpan" id="kobo.2848.1">error</span></span><span class="koboSpan" id="kobo.2849.1">) {
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2850.1">Next, we explain </span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.2851.1">the return values of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2852.1">exists()</span></code><span class="koboSpan" id="kobo.2853.1"> function as they have a special meaning.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2854.1">// The function returns the User ID of the username</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2855.1">// -1 if the user does not exist</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2856.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2857.1">exists</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2858.1">(username </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2859.1">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2860.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2861.1">int</span></span><span class="koboSpan" id="kobo.2862.1"> {
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2863.1">You can use block comments anywhere you want, not only at the beginning of a package, as in the following excerpt:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2864.1">// AddUser adds a new user to the database</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2865.1">//</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2866.1">// Returns new User ID</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2867.1">// -1 if there was an error</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2868.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2869.1">AddUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2870.1">(d Userdata)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2871.1">int</span></span><span class="koboSpan" id="kobo.2872.1"> {
}
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2873.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2874.1">DeleteUser deletes an existing user if the user exists.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2875.1">It requires the User ID of the user to be deleted.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2876.1">*/</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2877.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2878.1">DeleteUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2879.1">(id </span></span><span class="hljs-type"><span class="koboSpan" id="kobo.2880.1">int</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2881.1">)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2882.1">error</span></span><span class="koboSpan" id="kobo.2883.1"> {
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2884.1">When you request the documentation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2885.1">Userdata</span></code><span class="koboSpan" id="kobo.2886.1"> structure, Go automatically presents the functions that use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2887.1">Userdata</span></code><span class="koboSpan" id="kobo.2888.1">, as happens with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2889.1">ListUsers()</span></code><span class="koboSpan" id="kobo.2890.1">.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2891.1">// ListUsers() lists all users in the database.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2892.1">//</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2893.1">// Returns a slice of Userdata to the calling function.</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2894.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2895.1">ListUsers</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2896.1">()</span></span><span class="koboSpan" id="kobo.2897.1"> ([]Userdata, </span><span class="hljs-type"><span class="koboSpan" id="kobo.2898.1">error</span></span><span class="koboSpan" id="kobo.2899.1">) {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2900.1">// Data holds the records returned by the SQL query</span></span><span class="koboSpan" id="kobo.2901.1">
    Data := []Userdata{}
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2902.1">Similar to what we have seen so far is the documentation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2903.1">UpdateUser()</span></code><span class="koboSpan" id="kobo.2904.1"> function.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2905.1">/*</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2906.1">UpdateUser() is for updating an existing user</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2907.1">given a Userdata structure.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2908.1">The user ID of the user to be updated is found</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2909.1">inside the function.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2910.1">*/</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2911.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.2912.1">UpdateUser</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2913.1">(d Userdata)</span></span> <span class="hljs-type"><span class="koboSpan" id="kobo.2914.1">error</span></span><span class="koboSpan" id="kobo.2915.1"> {
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2916.1">We are not done yet because we need to see the documentation somehow. </span><span class="koboSpan" id="kobo.2916.2">There are two ways to see the documentation of the package. </span><span class="koboSpan" id="kobo.2916.3">The first one involves using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2917.1">go get</span></code><span class="koboSpan" id="kobo.2918.1">, which also means </span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.2919.1">creating a GitHub repository of the package, as we did with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2920.1">sqlite06</span></code><span class="koboSpan" id="kobo.2921.1">. </span><span class="koboSpan" id="kobo.2921.2">However, as this is for testing purposes, we are going to do things the easy way using the second way: as the package is already located under </span><code class="inlineCode"><span class="koboSpan" id="kobo.2922.1">~/go/src</span></code><span class="koboSpan" id="kobo.2923.1">, we can access it from thereâ€”I am doing my development from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2924.1">~/go/src/github.com/mactsouk/mGo4th/ch06/document</span></code><span class="koboSpan" id="kobo.2925.1">. </span><span class="koboSpan" id="kobo.2925.2">Therefore, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2926.1">go doc</span></code><span class="koboSpan" id="kobo.2927.1"> command is going to work just fine with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2928.1">document</span></code><span class="koboSpan" id="kobo.2929.1"> package.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2930.1">$ </span></span><span class="koboSpan" id="kobo.2931.1">go doc document.go
package document // import "command-line-arguments"
The package works on 2 tables on an SQLite database.
</span><span class="koboSpan" id="kobo.2931.2">The names of the tables are:
  - Users
  - Userdata
The definitions of the tables are:
        CREATE TABLE Users (
            ID INTEGER PRIMARY KEY,
            Username TEXT
        );
        CREATE TABLE Userdata (
            UserID INTEGER NOT NULL,
            Name TEXT,
            Surname TEXT,
            Description TEXT
        );
        This is rendered as code
This is not rendered as code
var Filename = ""
func AddUser(d Userdata) int
func DeleteUser(id int) error
func UpdateUser(d Userdata) error
type Userdata struct{ ... </span><span class="koboSpan" id="kobo.2931.3">}
    func ListUsers() ([]Userdata, error)
BUG: Function ListUsers() not working as expected
BUG: Function AddUser() is too slow
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2932.1">Please keep in mind that </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.2933.1">only the documentation of public elements is displayed</span></strong><span class="koboSpan" id="kobo.2934.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2935.1">If you want to see information </span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.2936.1">about a specific function, you should use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2937.1">go doc</span></code><span class="koboSpan" id="kobo.2938.1">, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2939.1">$ </span></span><span class="koboSpan" id="kobo.2940.1">go doc document.go ListUsers
package document // import "command-line-arguments"
func ListUsers() ([]Userdata, error)
    ListUsers() lists all users in the database.
    </span><span class="koboSpan" id="kobo.2940.2">Returns a slice of Userdata to the calling function.
</span></code></pre>
<h1 class="heading-1" id="_idParaDest-173"><span class="koboSpan" id="kobo.2941.1">Workspaces</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2942.1">Workspaces is a relatively </span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.2943.1">new Go feature. </span><span class="koboSpan" id="kobo.2943.2">When you are working in workspace mode, you are allowed to work on multiple modules simultaneously. </span><span class="koboSpan" id="kobo.2943.3">A Go Workspace contains both </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.2944.1">source files and compiled binaries</span></strong><span class="koboSpan" id="kobo.2945.1">. </span><span class="koboSpan" id="kobo.2945.2">As usual, </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.2946.1">you are not obliged to use workspaces if you do not want to</span></strong><span class="koboSpan" id="kobo.2947.1">. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.2948.1">Fortunately, Go is flexible and allows the developer to make their own decisions. </span><span class="koboSpan" id="kobo.2948.2">However, knowing the features of Go is important, even if you do not want to use them all the time. </span><span class="koboSpan" id="kobo.2948.3">Not all Go features are for everyone.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2949.1">When using Go workspaces, you control all dependencies using a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2950.1">go.work</span></code><span class="koboSpan" id="kobo.2951.1">, which is located in the root directory of the workspace. </span><span class="koboSpan" id="kobo.2951.2">Inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.2952.1">go.work</span></code><span class="koboSpan" id="kobo.2953.1">, there exist </span><code class="inlineCode"><span class="koboSpan" id="kobo.2954.1">use</span></code><span class="koboSpan" id="kobo.2955.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2956.1">replace</span></code><span class="koboSpan" id="kobo.2957.1"> directives that override the information found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2958.1">go.mod</span></code><span class="koboSpan" id="kobo.2959.1"> files of the directories of the workspaceâ€”this saves you from having to manually edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.2960.1">go.mod</span></code><span class="koboSpan" id="kobo.2961.1"> files.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2962.1">Let us now look at an example of the use of workspaces. </span><span class="koboSpan" id="kobo.2962.2">Imagine that we want to further develop the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2963.1">sqlite06</span></code><span class="koboSpan" id="kobo.2964.1"> package while having the stable version present in our system. </span><span class="koboSpan" id="kobo.2964.2">One way to do that is with the help of a workspace where we are going to keep a local copy of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2965.1">sqlite06</span></code><span class="koboSpan" id="kobo.2966.1"> package that we are going to modify and test. </span><span class="koboSpan" id="kobo.2966.2">For reasons of simplicity, we are going to work with a single function only. </span><span class="koboSpan" id="kobo.2966.3">More specifically, we are going to make the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2967.1">openConnection()</span></code><span class="koboSpan" id="kobo.2968.1"> function</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.2969.1"> public, which means that we are going to rename it to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2970.1">OpenConnection()</span></code><span class="koboSpan" id="kobo.2971.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2972.1">First, we execute the following commands from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2973.1">ch06</span></code><span class="koboSpan" id="kobo.2974.1"> directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2975.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2976.1">mkdir</span></span><span class="koboSpan" id="kobo.2977.1"> ws
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2978.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2979.1">cd</span></span><span class="koboSpan" id="kobo.2980.1"> ws
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2981.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2982.1">cp</span></span><span class="koboSpan" id="kobo.2983.1"> -r ~/go/src/github.com/mactsouk/sqlite06 .
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2984.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2985.1">cd</span></span><span class="koboSpan" id="kobo.2986.1"> sqlite06
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2987.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2988.1">rm</span></span><span class="koboSpan" id="kobo.2989.1"> go.mod go.sum
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2990.1">$ </span></span><span class="koboSpan" id="kobo.2991.1">go mod init
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2992.1">$ </span></span><span class="koboSpan" id="kobo.2993.1">go mod tidy
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2994.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2995.1">cd</span></span><span class="koboSpan" id="kobo.2996.1"> ..
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2997.1">The previous commands are for creating a local copy of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2998.1">sqlite06</span></code><span class="koboSpan" id="kobo.2999.1"> module. </span><span class="koboSpan" id="kobo.2999.2">The version you are going to find inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.3000.1">ws</span></code><span class="koboSpan" id="kobo.3001.1"> is pretty minimal.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3002.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3003.1">mkdir</span></span><span class="koboSpan" id="kobo.3004.1"> util
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3005.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3006.1">cp</span></span><span class="koboSpan" id="kobo.3007.1"> ~/go/src/github.com/mactsouk/mGo4th/ch06/usePackage/sqliteGo.go .
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3008.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3009.1">cd</span></span><span class="koboSpan" id="kobo.3010.1"> util
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3011.1">$ </span></span><span class="koboSpan" id="kobo.3012.1">go mod init
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3013.1">$ </span></span><span class="koboSpan" id="kobo.3014.1">go mod tidy
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3015.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3016.1">cd</span></span><span class="koboSpan" id="kobo.3017.1"> ..
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3018.1">The previous command is for copying the command line utility we have created for testing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3019.1">sqlite06</span></code><span class="koboSpan" id="kobo.3020.1"> module. </span><span class="koboSpan" id="kobo.3020.2">As we are going to use a single function from </span><code class="inlineCode"><span class="koboSpan" id="kobo.3021.1">sqlite06</span></code><span class="koboSpan" id="kobo.3022.1">, we are also going to modify </span><code class="inlineCode"><span class="koboSpan" id="kobo.3023.1">sqliteGo.go</span></code><span class="koboSpan" id="kobo.3024.1"> in order to call that function only.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3025.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3026.1">go work init .</span></code><span class="koboSpan" id="kobo.3027.1"> command creates the workspace. </span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3028.1">$ </span></span><span class="koboSpan" id="kobo.3029.1">go work use ./util
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3030.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3031.1">cat</span></span><span class="koboSpan" id="kobo.3032.1"> go.work
go 1.21.0
use ./util
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3033.1">The previous command says that we want to create a workspace for the modules in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3034.1">./util</span></code><span class="koboSpan" id="kobo.3035.1"> directory.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3036.1">$ </span></span><span class="koboSpan" id="kobo.3037.1">go work use ./sqlite06
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3038.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3039.1">cat</span></span><span class="koboSpan" id="kobo.3040.1"> go.work
go 1.21.0
use (
    ./sqlite06
    ./util
)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3041.1">$</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3042.1">The previous command says that we want to use the local copies. </span><span class="koboSpan" id="kobo.3042.2">There is another command missing</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.3043.1"> from </span><code class="inlineCode"><span class="koboSpan" id="kobo.3044.1">go.work</span></code><span class="koboSpan" id="kobo.3045.1">, which is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3046.1">replace github.com/mactsouk/sqlite06 =&gt; ./sqlite06
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3047.1">This last command tells Go that </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.3048.1">we want to replace</span></strong> <code class="inlineCode"><span class="koboSpan" id="kobo.3049.1">github.com/mactsouk/sqlite06</span></code><span class="koboSpan" id="kobo.3050.1"> with the version of the module found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3051.1">./sqlite06</span></code><span class="koboSpan" id="kobo.3052.1"> directory, </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.3053.1">which is the copy that we are actually changing</span></strong><span class="koboSpan" id="kobo.3054.1">. </span><span class="koboSpan" id="kobo.3054.2">This is the most important command of the process.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3055.1">After that, we are ready to try running the modified version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.3056.1">./util/sqliteGo.go</span></code><span class="koboSpan" id="kobo.3057.1">.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3058.1">$ </span></span><span class="koboSpan" id="kobo.3059.1">go run ./util/sqliteGo.go
Connection string: &amp;{{{} {} 0} {ch06.db 0x14000072020} {{} {} 0} {0 0} [] map[] 0 0 0x1400001c120 false map[] map[] 0 0 0 0 &lt;nil&gt; 0 0 0 0 0x1001512d0}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3060.1">The output verifies that we executed the local and modified version of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3061.1">sqlite06</span></code><span class="koboSpan" id="kobo.3062.1"> module! </span><span class="koboSpan" id="kobo.3062.2">This means that we can keep developing and changing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3063.1">sqlite06</span></code><span class="koboSpan" id="kobo.3064.1"> module and when we are done, we can replace the original one with the newer version!</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3065.1">If you want to learn about all the options of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3066.1">go work</span></code><span class="koboSpan" id="kobo.3067.1"> command, type </span><code class="inlineCode"><span class="koboSpan" id="kobo.3068.1">go help work</span></code><span class="koboSpan" id="kobo.3069.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.3070.1">The last section of this</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.3071.1"> chapter is about versioning utilities and defining unique version strings.</span></p>
<h1 class="heading-1" id="_idParaDest-174"><span class="koboSpan" id="kobo.3072.1">Versioning utilities</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3073.1">One of the most </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.3074.1">difficult tasks is to automatically and uniquely version command line utilities, especially when using a CI/CD system. </span><span class="koboSpan" id="kobo.3074.2">This section presents a technique that uses a GitHub value to version a command line utility on your local machine. </span><span class="koboSpan" id="kobo.3074.3">You can apply the same technique to GitLabâ€”just search for the available GitLab variables and values and choose one that fits your needs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3075.1">This technique is used by both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3076.1">docker</span></code><span class="koboSpan" id="kobo.3077.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3078.1">kubectl</span></code><span class="koboSpan" id="kobo.3079.1"> utilities, among others:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3080.1">$ </span></span><span class="koboSpan" id="kobo.3081.1">docker version
Client:
 Version:           24.0.5
 API version:       1.43
 Go version:        go1.20.6
 Git commit:        ced0996600
 Built:             Wed Jul 26 21:44:58 2023
 OS/Arch:           linux/amd64
 Context:           default
Server:
 Engine:
  Version:          24.0.5
  API version:      1.43 (minimum version 1.12)
  Go version:       go1.20.6
  Git commit:       a61e2b4c9c
  Built:            Wed Jul 26 21:44:58 2023
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          v1.7.2
  GitCommit:        0cae528dd6cb557f7201036e9f43420650207b58.m
 runc:
  Version:          1.1.9
  GitCommit:
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3082.1">The previous output shows that </span><code class="inlineCode"><span class="koboSpan" id="kobo.3083.1">docker</span></code><span class="koboSpan" id="kobo.3084.1"> uses the Git commit value for versioningâ€”we are going to use a slightly different value that is longer than the one used by </span><code class="inlineCode"><span class="koboSpan" id="kobo.3085.1">docker</span></code><span class="koboSpan" id="kobo.3086.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3087.1">The utility that is used, which is saved as </span><code class="inlineCode"><span class="koboSpan" id="kobo.3088.1">gitVersion.go</span></code><span class="koboSpan" id="kobo.3089.1">, is implemented as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3090.1">package</span></span><span class="koboSpan" id="kobo.3091.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3092.1">import</span></span><span class="koboSpan" id="kobo.3093.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.3094.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3095.1">"os"</span></span><span class="koboSpan" id="kobo.3096.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3097.1">var</span></span><span class="koboSpan" id="kobo.3098.1"> VERSION </span><span class="hljs-type"><span class="koboSpan" id="kobo.3099.1">string</span></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.3100.1">VERSION</span></code><span class="koboSpan" id="kobo.3101.1"> is the variable that is going to be set at runtime using the Go linker.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3102.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.3103.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3104.1">()</span></span><span class="koboSpan" id="kobo.3105.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3106.1">if</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.3107.1">len</span></span><span class="koboSpan" id="kobo.3108.1">(os.Args) == </span><span class="hljs-number"><span class="koboSpan" id="kobo.3109.1">2</span></span><span class="koboSpan" id="kobo.3110.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3111.1">if</span></span><span class="koboSpan" id="kobo.3112.1"> os.Args[</span><span class="hljs-number"><span class="koboSpan" id="kobo.3113.1">1</span></span><span class="koboSpan" id="kobo.3114.1">] == </span><span class="hljs-string"><span class="koboSpan" id="kobo.3115.1">"version"</span></span><span class="koboSpan" id="kobo.3116.1"> {
            fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3117.1">"Version:"</span></span><span class="koboSpan" id="kobo.3118.1">, VERSION)
        }
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3119.1">The previous code </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.3120.1">says that if there is a command line argument and its value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.3121.1">version</span></code><span class="koboSpan" id="kobo.3122.1">, print the version message with the help of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3123.1">VERSION</span></code><span class="koboSpan" id="kobo.3124.1"> variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3125.1">What we need to do is tell the Go linker that we are going to define the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3126.1">VERSION</span></code><span class="koboSpan" id="kobo.3127.1"> variable. </span><span class="koboSpan" id="kobo.3127.2">This happens with the help of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3128.1">-ldflags</span></code><span class="koboSpan" id="kobo.3129.1"> flag, which stands for linker flagsâ€”this passes values to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3130.1">cmd/link</span></code><span class="koboSpan" id="kobo.3131.1"> package, which allows us to change values in imported packages at build time. </span><span class="koboSpan" id="kobo.3131.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3132.1">-X</span></code><span class="koboSpan" id="kobo.3133.1"> value that is used requires a key/value pair, where the key is a variable name, and the value is the value that we want to set for that key. </span><span class="koboSpan" id="kobo.3133.2">In our case, the key has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3134.1">main.Variable</span></code><span class="koboSpan" id="kobo.3135.1"> form because we change the value of a variable in the main package. </span><span class="koboSpan" id="kobo.3135.2">As the name of the variable in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3136.1">gitVersion.go</span></code><span class="koboSpan" id="kobo.3137.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.3138.1">VERSION</span></code><span class="koboSpan" id="kobo.3139.1">, the key is </span><code class="inlineCode"><span class="koboSpan" id="kobo.3140.1">main.VERSION</span></code><span class="koboSpan" id="kobo.3141.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3142.1">But first, we need to decide on the GitHub value that we are going to use as the version string. </span><span class="koboSpan" id="kobo.3142.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3143.1">git rev-list HEAD</span></code><span class="koboSpan" id="kobo.3144.1"> command returns a full list of commits for the current repository from the latest to the oldest. </span><span class="koboSpan" id="kobo.3144.2">We only need the last oneâ€”the most recentâ€”which we can get using </span><code class="inlineCode"><span class="koboSpan" id="kobo.3145.1">git rev-list -1 HEAD</span></code><span class="koboSpan" id="kobo.3146.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.3147.1">git rev-list HEAD | head -1</span></code><span class="koboSpan" id="kobo.3148.1">. </span><span class="koboSpan" id="kobo.3148.2">So, we need to assign that value to an environment variable and pass that environment variable to the Go compiler. </span><span class="koboSpan" id="kobo.3148.3">As this value changes each time you make a commit and you always want to have the latest value, you should reevaluate it each time you execute go buildâ€”this will be shown in a while.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3149.1">In order to provide </span><code class="inlineCode"><span class="koboSpan" id="kobo.3150.1">gitVersion.go</span></code><span class="koboSpan" id="kobo.3151.1"> with the value of the desired environment variable, we should execute it as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3152.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3153.1">export</span></span><span class="koboSpan" id="kobo.3154.1"> VERSION=$(git rev-list -1 HEAD)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3155.1">$ </span></span><span class="koboSpan" id="kobo.3156.1">go build -ldflags </span><span class="hljs-con-string"><span class="koboSpan" id="kobo.3157.1">"-X main.VERSION=</span></span><span class="hljs-con-variable"><span class="koboSpan" id="kobo.3158.1">$VERSION</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.3159.1">"</span></span><span class="koboSpan" id="kobo.3160.1"> gitVersion.go
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3161.1">This works on both </span><code class="inlineCode"><span class="koboSpan" id="kobo.3162.1">bash</span></code><span class="koboSpan" id="kobo.3163.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3164.1">zsh</span></code><span class="koboSpan" id="kobo.3165.1"> shells. </span><span class="koboSpan" id="kobo.3165.2">If you are using a different shell, you should make sure that you are defining an environment variable the right way.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.3166.1">If you want to execute the two commands at the same time, you can do the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3167.1">$ </span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.3168.1">export</span></span><span class="koboSpan" id="kobo.3169.1"> VERSION=$(git rev-list -1 HEAD) &amp;&amp; go build -ldflags </span><span class="hljs-con-string"><span class="koboSpan" id="kobo.3170.1">"-X main.VERSION=</span></span><span class="hljs-con-variable"><span class="koboSpan" id="kobo.3171.1">$VERSION</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.3172.1">"</span></span><span class="koboSpan" id="kobo.3173.1"> gitVersion.go
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3174.1">Running the generated executable, which is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.3175.1">gitVersion</span></code><span class="koboSpan" id="kobo.3176.1">, produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3177.1">$ </span></span><span class="koboSpan" id="kobo.3178.1">./gitVersion version
Version: 4dc3d6b5fd030bf7075ed26f9ab471e8835a8a77
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3179.1">Your output is going </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.3180.1">to be different because your GitHub repository is going to be different. </span><span class="koboSpan" id="kobo.3180.2">As GitHub generates random and unique values, you will not have the same version number twice!</span></p>
<h1 class="heading-1" id="_idParaDest-175"><span class="koboSpan" id="kobo.3181.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3182.1">This chapter presented two primary topics: functions and packages. </span><span class="koboSpan" id="kobo.3182.2">Functions are first-class citizens in Go, which makes them powerful and handy. </span><span class="koboSpan" id="kobo.3182.3">Remember that everything that begins with an uppercase letter is public. </span><span class="koboSpan" id="kobo.3182.4">The only exception to this rule is package names. </span><span class="koboSpan" id="kobo.3182.5">Private variables, functions, data type names, and structure fields can be strictly used and called internally in a package, whereas public ones are available to everyone. </span><span class="koboSpan" id="kobo.3182.6">Additionally, we learned more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3183.1">defer</span></code><span class="koboSpan" id="kobo.3184.1"> keyword. </span><span class="koboSpan" id="kobo.3184.2">Also, remember that Go packages are not like Java classesâ€”a Go package can be as big as it needs to be. </span><span class="koboSpan" id="kobo.3184.3">Regarding Go modules, keep in mind that a Go module is multiple packages with a version.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3185.1">Finally, this chapter discussed creating documentation, which is an important part of development, workspaces, and versioning command line utilities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3186.1">The next chapter discusses systems programming as well as file I/O in more detail.</span></p>
<h1 class="heading-1" id="_idParaDest-176"><span class="koboSpan" id="kobo.3187.1">Exercises</span></h1>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3188.1">Can you write a function that sorts three int values? </span><span class="koboSpan" id="kobo.3188.2">Try to write two versions of the function: one with named returned values and another without named return values. </span><span class="koboSpan" id="kobo.3188.3">Which one do you think is better?</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3189.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3190.1">sqlite06</span></code><span class="koboSpan" id="kobo.3191.1"> package does not support searching by username. </span><span class="koboSpan" id="kobo.3191.2">Can you implement that?</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3192.1">Rewrite the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3193.1">sqlite06</span></code><span class="koboSpan" id="kobo.3194.1"> package so that it works with MySQL databases.</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-177"><span class="koboSpan" id="kobo.3195.1">Additional resources</span></h1>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3196.1">How do you structure your Go apps? </span><span class="koboSpan" id="kobo.3196.2">Talk by Kat Zien from GopherCon UK 2018: </span><a href="https://www.youtube.com/watch?v=1rxDzs0zgcE"><span class="url"><span class="koboSpan" id="kobo.3197.1">https://www.youtube.com/watch?v=1rxDzs0zgcE</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3198.1">Get familiar with workspaces: </span><a href="https://go.dev/blog/get-familiar-with-workspaces"><span class="url"><span class="koboSpan" id="kobo.3199.1">https://go.dev/blog/get-familiar-with-workspaces</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3200.1">Tutorial: Getting started with multi-module workspaces: </span><a href="https://go.dev/doc/tutorial/workspaces"><span class="url"><span class="koboSpan" id="kobo.3201.1">https://go.dev/doc/tutorial/workspaces</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3202.1">Experimenting with project templates: </span><a href="https://go.dev/blog/gonew"><span class="url"><span class="koboSpan" id="kobo.3203.1">https://go.dev/blog/gonew</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3204.1">SQLite: </span><a href="https://www.sqlite.org/index.html"><span class="url"><span class="koboSpan" id="kobo.3205.1">https://www.sqlite.org/index.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3206.1">Go SQLite package: </span><a href="https://github.com/mattn/go-sqlite3"><span class="url"><span class="koboSpan" id="kobo.3207.1">https://github.com/mattn/go-sqlite3</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3208.1">The documentation of </span><code class="inlineCode"><span class="koboSpan" id="kobo.3209.1">database/sql</span></code><span class="koboSpan" id="kobo.3210.1">: </span><a href="https://pkg.go.dev/database/sql"><span class="url"><span class="koboSpan" id="kobo.3211.1">https://pkg.go.dev/database/sql</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3212.1">The documentation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3213.1">cmd/link</span></code><span class="koboSpan" id="kobo.3214.1"> package: </span><a href="https://pkg.go.dev/cmd/link"><span class="url"><span class="koboSpan" id="kobo.3215.1">https://pkg.go.dev/cmd/link</span></span></a></li>
<li class="bulletList"><a href="https://golang.org"><span class="url"><span class="koboSpan" id="kobo.3216.1">golang.org</span></span></a><span class="koboSpan" id="kobo.3217.1"> moving to </span><a href="https://go.dev"><span class="url"><span class="koboSpan" id="kobo.3218.1">go.dev</span></span></a><span class="koboSpan" id="kobo.3219.1">: </span><a href="https://go.dev/blog/tidy-web"><span class="url"><span class="koboSpan" id="kobo.3220.1">https://go.dev/blog/tidy-web</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.3221.1">Join our community on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3222.1">Join our communityâ€™s Discord space for discussions with the authors and other readers:</span></p>
<p class="normal"><a href="https://discord.gg/FzuQbc8zd6 "><span class="url"><span class="koboSpan" id="kobo.3223.1">https://discord.gg/FzuQbc8zd6</span></span></a></p>
<p class="normal"><a href="https://discord.gg/FzuQbc8zd6 "><span class="url"><span class="koboSpan" id="kobo.3224.1"><img alt="" role="presentation" src="../Images/QR_Code2286825896190168453.png"/></span></span></a></p>
</div>
</body></html>