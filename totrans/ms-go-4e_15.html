<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer208">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 class="chapterTitle" id="_idParaDest-408"><span class="koboSpan" id="kobo.2.1">Changes in Recent Go Versions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">This chapter is about the changes introduced in the latest Go versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">First, we will see what has changed about the random number generation capabilities of Go. </span><span class="koboSpan" id="kobo.4.2">More specifically, we will talk about </span><code class="inlineCode"><span class="koboSpan" id="kobo.5.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.6.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.7.1">The remainder of the chapter is about Go 1.21 and Go 1.22, which at the time of writing are the latest Go versions. </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.8.1">We should not forget that a programming language is also a piece of software developed by programmers</span></strong><span class="koboSpan" id="kobo.9.1">. </span><span class="koboSpan" id="kobo.9.2">Therefore, programming languages and compilers are being improved all the time with new functionality, better code generation, code optimizations, and faster operation. </span><span class="koboSpan" id="kobo.9.3">We close this chapter by discussing the most important improvements introduced in Go versions 1.21 and 1.22.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.10.1">We will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">About </span><code class="inlineCode"><span class="koboSpan" id="kobo.12.1">rand.Seed()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">What is new in Go 1.21?</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">What is new in Go 1.22?</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.15.1">The first section discusses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.16.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.17.1"> function and why it is not necessary to use it, starting from Go version 1.20.</span></p>
<h1 class="heading-1" id="_idParaDest-409"><span class="koboSpan" id="kobo.18.1">About rand.Seed()</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.19.1">As of Go 1.20, there is </span><a id="_idIndexMarker1283"/><span class="koboSpan" id="kobo.20.1">no reason for calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.22.1"> using a random value to initiate the random number generator. </span><span class="koboSpan" id="kobo.22.2">However, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.24.1"> is not going to break existing code. </span><span class="koboSpan" id="kobo.24.2">To get a specific sequence of numbers, it is recommended to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">New(NewSource(seed))</span></code><span class="koboSpan" id="kobo.26.1"> instead. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.27.1">This is illustrated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.28.1">ch15/randSeed.go</span></code><span class="koboSpan" id="kobo.29.1">—the relevant Go code is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.30.1">    src := rand.NewSource(seed)
    r := rand.New(src)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.31.1">for</span></span><span class="koboSpan" id="kobo.32.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.33.1">0</span></span><span class="koboSpan" id="kobo.34.1">; i &lt; times; i++ {
        fmt.Println(r.Uint64())
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.35.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">rand.NewSource()</span></code><span class="koboSpan" id="kobo.37.1"> call returns a new (pseudo) random source based on the given seed. </span><span class="koboSpan" id="kobo.37.2">Therefore, if called with the same seed, it is going to return the same sequence of values. </span><span class="koboSpan" id="kobo.37.3">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.38.1">rand.New()</span></code><span class="koboSpan" id="kobo.39.1"> call</span><a id="_idIndexMarker1284"/><span class="koboSpan" id="kobo.40.1"> returns a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">*rand.Rand</span></code><span class="koboSpan" id="kobo.42.1"> variable, which is what generates the (pseudo) random values. </span><span class="koboSpan" id="kobo.42.2">Due to the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">Uint64()</span></code><span class="koboSpan" id="kobo.44.1">, we are generating unsigned </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1">int64</span></code><span class="koboSpan" id="kobo.46.1"> values.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.47.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1">randSeed.go</span></code><span class="koboSpan" id="kobo.49.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.50.1">$ </span></span><span class="koboSpan" id="kobo.51.1">go run randSeed.go 1
Using seed: 1
5577006791947779410
8674665223082153551
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.52.1">$ </span></span><span class="koboSpan" id="kobo.53.1">go run randSeed.go 1
Using seed: 1
5577006791947779410
8674665223082153551
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.54.1">The next section introduces the changes introduced with Go 1.21.</span></p>
<h1 class="heading-1" id="_idParaDest-410"><span class="koboSpan" id="kobo.55.1">What is new in Go 1.21?</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.56.1">In this section, we are going to talk about two new features that came with Go 1.21: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.58.1"> function</span><a id="_idIndexMarker1285"/><span class="koboSpan" id="kobo.59.1"> of the standard library and the built-in function </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">clear</span></code><span class="koboSpan" id="kobo.61.1">, which deletes or zeroes out all elements of a map, a slice, or a </span><em class="italic"><span class="koboSpan" id="kobo.62.1">type parameter</span></em><span class="koboSpan" id="kobo.63.1"> type. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.64.1">We are going to begin with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.66.1"> function. </span></p>
<h2 class="heading-2" id="_idParaDest-411"><span class="koboSpan" id="kobo.67.1">The sync.OnceFunc() function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.68.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.69.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.70.1"> function is</span><a id="_idIndexMarker1286"/><span class="koboSpan" id="kobo.71.1"> a helper function of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">sync</span></code><span class="koboSpan" id="kobo.73.1"> package. </span><span class="koboSpan" id="kobo.73.2">Its full signature is </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">func OnceFunc(f func()) func()</span></code><span class="koboSpan" id="kobo.75.1">, which means that it accepts a function as a parameter and returns another function. </span><span class="koboSpan" id="kobo.75.2">In more detail, </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.77.1"> returns a function that invokes function </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">f</span></code> <strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.79.1">only once</span></strong><span class="koboSpan" id="kobo.80.1">—the important detail here is the </span><em class="italic"><span class="koboSpan" id="kobo.81.1">only once</span></em><span class="koboSpan" id="kobo.82.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.83.1">This might look unclear now but the presented code, which is saved as </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">syncOnce.go</span></code><span class="koboSpan" id="kobo.85.1">, is going to shed some light on the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.87.1">. </span><span class="koboSpan" id="kobo.87.2">The code of </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">syncOnce.go</span></code><span class="koboSpan" id="kobo.89.1"> is presented in two parts. </span><span class="koboSpan" id="kobo.89.2">The first part is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.90.1">package</span></span><span class="koboSpan" id="kobo.91.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.92.1">import</span></span><span class="koboSpan" id="kobo.93.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.94.1">"fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.95.1">"sync"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.96.1">"time"</span></span><span class="koboSpan" id="kobo.97.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.98.1">var</span></span><span class="koboSpan" id="kobo.99.1"> x = </span><span class="hljs-number"><span class="koboSpan" id="kobo.100.1">0</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.101.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.102.1">initializeValue</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.103.1">()</span></span><span class="koboSpan" id="kobo.104.1"> {
    x = </span><span class="hljs-number"><span class="koboSpan" id="kobo.105.1">5</span></span><span class="koboSpan" id="kobo.106.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.107.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.108.1">initializeValue()</span></code><span class="koboSpan" id="kobo.109.1"> function is used for initializing the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1">x</span></code><span class="koboSpan" id="kobo.111.1"> global variable. </span><span class="koboSpan" id="kobo.111.2">Let us make certain that </span><code class="inlineCode"><span class="koboSpan" id="kobo.112.1">initializeValue()</span></code><span class="koboSpan" id="kobo.113.1"> gets executed only once.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.114.1">The second part comes with</span><a id="_idIndexMarker1287"/><span class="koboSpan" id="kobo.115.1"> the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.116.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.117.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.118.1">()</span></span><span class="koboSpan" id="kobo.119.1"> {
    function := sync.OnceFunc(initializeValue)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.120.1">for</span></span><span class="koboSpan" id="kobo.121.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.122.1">0</span></span><span class="koboSpan" id="kobo.123.1">; i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.124.1">10</span></span><span class="koboSpan" id="kobo.125.1">; i++ {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.126.1">go</span></span><span class="koboSpan" id="kobo.127.1"> function()
    }
    time.Sleep(time.Second)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.128.1">for</span></span><span class="koboSpan" id="kobo.129.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.130.1">0</span></span><span class="koboSpan" id="kobo.131.1">; i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.132.1">10</span></span><span class="koboSpan" id="kobo.133.1">; i++ {
        x = x + </span><span class="hljs-number"><span class="koboSpan" id="kobo.134.1">1</span></span><span class="koboSpan" id="kobo.135.1">
    }
    fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.136.1">"x = %d\n"</span></span><span class="koboSpan" id="kobo.137.1">, x)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.138.1">for</span></span><span class="koboSpan" id="kobo.139.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.140.1">0</span></span><span class="koboSpan" id="kobo.141.1">; i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.142.1">10</span></span><span class="koboSpan" id="kobo.143.1">; i++ {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.144.1">go</span></span><span class="koboSpan" id="kobo.145.1"> function()
    }
    time.Sleep(time.Second)
    fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.146.1">"x = %d\n"</span></span><span class="koboSpan" id="kobo.147.1">, x)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.148.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">sync.OnceFunc(initializeValue)</span></code><span class="koboSpan" id="kobo.150.1"> call is used for making sure that </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1">initializeValue()</span></code><span class="koboSpan" id="kobo.152.1"> is going to be executed only once, despite the fact that </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">function()</span></code><span class="koboSpan" id="kobo.154.1"> is executed multiple</span><a id="_idIndexMarker1288"/><span class="koboSpan" id="kobo.155.1"> times. </span><span class="koboSpan" id="kobo.155.2">In other words, we make sure that </span><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">initializeValue()</span></code><span class="koboSpan" id="kobo.157.1"> is going to be executed </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.158.1">by the first goroutine only</span></strong><span class="koboSpan" id="kobo.159.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.160.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">syncOnce.go</span></code><span class="koboSpan" id="kobo.162.1"> produces the next output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.163.1">$ </span></span><span class="koboSpan" id="kobo.164.1">go run syncOnce.go
x = 15
x = 15
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.165.1">The output shows that the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">x</span></code><span class="koboSpan" id="kobo.167.1"> variable has been initialized only once. </span><span class="koboSpan" id="kobo.167.2">This means that </span><code class="inlineCode"><span class="koboSpan" id="kobo.168.1">sync.OnceFunc()</span></code><span class="koboSpan" id="kobo.169.1"> might be used for initializing variables, connections, or files with the assurance that the initialization process is going to be executed only once.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.170.1">Now, it is time to learn about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.171.1">clear</span></code><span class="koboSpan" id="kobo.172.1"> function.</span></p>
<h2 class="heading-2" id="_idParaDest-412"><span class="koboSpan" id="kobo.173.1">The clear function</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.174.1">In this subsection, we are going </span><a id="_idIndexMarker1289"/><span class="koboSpan" id="kobo.175.1">to present the use of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.176.1">clear</span></code><span class="koboSpan" id="kobo.177.1"> function when working with maps and arrays. </span><span class="koboSpan" id="kobo.177.2">When used on a map object, </span><code class="inlineCode"><span class="koboSpan" id="kobo.178.1">clear()</span></code><span class="koboSpan" id="kobo.179.1"> clears all the elements of the map object. </span><span class="koboSpan" id="kobo.179.2">When used on a slice object, </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">clear()</span></code><span class="koboSpan" id="kobo.181.1"> resets all the elements of the slice to the zero value of its data type while keeping the same slice length and capacity—this is totally different from what happens with a map object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.182.1">The name of the relevant program is </span><code class="inlineCode"><span class="koboSpan" id="kobo.183.1">clr.go</span></code><span class="koboSpan" id="kobo.184.1">—the important Go code is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.185.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.186.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.187.1">()</span></span><span class="koboSpan" id="kobo.188.1"> {
    m := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.189.1">map</span></span><span class="koboSpan" id="kobo.190.1">[</span><span class="hljs-type"><span class="koboSpan" id="kobo.191.1">string</span></span><span class="koboSpan" id="kobo.192.1">]</span><span class="hljs-type"><span class="koboSpan" id="kobo.193.1">int</span></span><span class="koboSpan" id="kobo.194.1">{</span><span class="hljs-string"><span class="koboSpan" id="kobo.195.1">"One"</span></span><span class="koboSpan" id="kobo.196.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.197.1">1</span></span><span class="koboSpan" id="kobo.198.1">}
    m[</span><span class="hljs-string"><span class="koboSpan" id="kobo.199.1">"Two"</span></span><span class="koboSpan" id="kobo.200.1">] = </span><span class="hljs-number"><span class="koboSpan" id="kobo.201.1">2</span></span><span class="koboSpan" id="kobo.202.1">
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.203.1">"Before clear:"</span></span><span class="koboSpan" id="kobo.204.1">, m)
    clear(m)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.205.1">"After clear:"</span></span><span class="koboSpan" id="kobo.206.1">, m)
    s := </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.207.1">make</span></span><span class="koboSpan" id="kobo.208.1">([]</span><span class="hljs-type"><span class="koboSpan" id="kobo.209.1">int</span></span><span class="koboSpan" id="kobo.210.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.211.1">0</span></span><span class="koboSpan" id="kobo.212.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.213.1">10</span></span><span class="koboSpan" id="kobo.214.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.215.1">for</span></span><span class="koboSpan" id="kobo.216.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.217.1">0</span></span><span class="koboSpan" id="kobo.218.1">; i &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.219.1">5</span></span><span class="koboSpan" id="kobo.220.1">; i++ {
        s = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.221.1">append</span></span><span class="koboSpan" id="kobo.222.1">(s, i)
    }
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.223.1">"Before clear:"</span></span><span class="koboSpan" id="kobo.224.1">, s, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.225.1">len</span></span><span class="koboSpan" id="kobo.226.1">(s), </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.227.1">cap</span></span><span class="koboSpan" id="kobo.228.1">(s))
    clear(s)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.229.1">"After clear:"</span></span><span class="koboSpan" id="kobo.230.1">, s, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.231.1">len</span></span><span class="koboSpan" id="kobo.232.1">(s), </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.233.1">cap</span></span><span class="koboSpan" id="kobo.234.1">(s))
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.235.1">In the previous code, we create a map variable named </span><code class="inlineCode"><span class="koboSpan" id="kobo.236.1">m</span></code><span class="koboSpan" id="kobo.237.1"> and a slice variable named </span><code class="inlineCode"><span class="koboSpan" id="kobo.238.1">s</span></code><span class="koboSpan" id="kobo.239.1">. </span><span class="koboSpan" id="kobo.239.2">After putting some data in them, we call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.240.1">clear()</span></code><span class="koboSpan" id="kobo.241.1"> function.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.242.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">clr.go</span></code><span class="koboSpan" id="kobo.244.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.245.1">$ </span></span><span class="koboSpan" id="kobo.246.1">go run clr.go
Before clear: map[One:1 Two:2]
After clear: map[]
Before clear: [0 1 2 3 4] 5 10
After clear: [0 0 0 0 0] 5 10
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.247.1">So, what has just happened? </span><span class="koboSpan" id="kobo.247.2">After calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">clear()</span></code><span class="koboSpan" id="kobo.249.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.250.1">m</span></code><span class="koboSpan" id="kobo.251.1"> is an empty map and </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">s</span></code><span class="koboSpan" id="kobo.253.1"> is a slice with the same length and capacity as before with all its elements reset to the zero element of its data type, which is </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">int</span></code><span class="koboSpan" id="kobo.255.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.256.1">The next section presents</span><a id="_idIndexMarker1290"/><span class="koboSpan" id="kobo.257.1"> the most important changes introduced in Go 1.22.</span></p>
<h1 class="heading-1" id="_idParaDest-413"><span class="koboSpan" id="kobo.258.1">What is new in Go 1.22?</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.259.1">While finishing the writing of this book, Go 1.22 was officially released. </span><span class="koboSpan" id="kobo.259.2">In this section, we are going to present the</span><a id="_idIndexMarker1291"/><span class="koboSpan" id="kobo.260.1"> most interesting new features and improvements of Go 1.22. </span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.261.1">There is no more sharing in the variables of loops.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.262.1">Functions that shrink the size of a slice (</span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1">Delete()</span></code><span class="koboSpan" id="kobo.264.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.265.1">DeleteFunc()</span></code><span class="koboSpan" id="kobo.266.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">Compact()</span></code><span class="koboSpan" id="kobo.268.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.269.1">CompactFunc()</span></code><span class="koboSpan" id="kobo.270.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.271.1">Replace()</span></code><span class="koboSpan" id="kobo.272.1">) now zero the elements between the new length and the old length.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.273.1">There is an updated version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">math/rand</span></code><span class="koboSpan" id="kobo.275.1">, which is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">math/rand/v2</span></code><span class="koboSpan" id="kobo.277.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.278.1">Keep in mind that in Go 1.22 the HTTP routing capabilities of the standard library are improved. </span><span class="koboSpan" id="kobo.278.2">In practice, this means that the patterns used by </span><code class="inlineCode"><span class="koboSpan" id="kobo.279.1">net/http.ServeMux</span></code><span class="koboSpan" id="kobo.280.1"> have been enhanced to accept methods and wildcards. </span><span class="koboSpan" id="kobo.280.2">You can find more about that at </span><a href="https://pkg.go.dev/net/http@master#ServeMux"><span class="url"><span class="koboSpan" id="kobo.281.1">https://pkg.go.dev/net/http@master#ServeMux</span></span></a><span class="koboSpan" id="kobo.282.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.283.1">We’ll begin by presenting the changes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">slices</span></code><span class="koboSpan" id="kobo.285.1"> package.</span></p>
<h2 class="heading-2" id="_idParaDest-414"><span class="koboSpan" id="kobo.286.1">Changes in slices</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.287.1">Apart from the changes in the </span><a id="_idIndexMarker1292"/><span class="koboSpan" id="kobo.288.1">functions that shrink the size of a slice, there is also the addition of </span><code class="inlineCode"><span class="koboSpan" id="kobo.289.1">slices.Concat()</span></code><span class="koboSpan" id="kobo.290.1">, which </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.291.1">concatenates multiple slices</span></strong><span class="koboSpan" id="kobo.292.1">. </span><span class="koboSpan" id="kobo.292.2">All these are illustrated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">sliceChanges.go</span></code><span class="koboSpan" id="kobo.294.1">. </span><span class="koboSpan" id="kobo.294.2">The code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.295.1">main()</span></code><span class="koboSpan" id="kobo.296.1"> function is presented in two parts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.297.1">The code of the first part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">sliceChanges.go</span></code><span class="koboSpan" id="kobo.299.1"> is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.300.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.301.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.302.1">()</span></span><span class="koboSpan" id="kobo.303.1"> {
    s1 := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.304.1">int</span></span><span class="koboSpan" id="kobo.305.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.306.1">1</span></span><span class="koboSpan" id="kobo.307.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.308.1">2</span></span><span class="koboSpan" id="kobo.309.1">}
    s2 := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.310.1">int</span></span><span class="koboSpan" id="kobo.311.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.312.1">-1</span></span><span class="koboSpan" id="kobo.313.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.314.1">-2</span></span><span class="koboSpan" id="kobo.315.1">}
    s3 := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.316.1">int</span></span><span class="koboSpan" id="kobo.317.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.318.1">10</span></span><span class="koboSpan" id="kobo.319.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.320.1">20</span></span><span class="koboSpan" id="kobo.321.1">}
    conCat := slices.Concat(s1, s2, s3)
    fmt.Println(conCat)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.322.1">In the previous code, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">slices.Concat()</span></code><span class="koboSpan" id="kobo.324.1"> to concatenate three slices.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.325.1">The rest of </span><code class="inlineCode"><span class="koboSpan" id="kobo.326.1">sliceChanges.go</span></code><span class="koboSpan" id="kobo.327.1"> contains the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.328.1">    v1 := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.329.1">int</span></span><span class="koboSpan" id="kobo.330.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.331.1">-1</span></span><span class="koboSpan" id="kobo.332.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.333.1">1</span></span><span class="koboSpan" id="kobo.334.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.335.1">2</span></span><span class="koboSpan" id="kobo.336.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.337.1">3</span></span><span class="koboSpan" id="kobo.338.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.339.1">4</span></span><span class="koboSpan" id="kobo.340.1">}
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.341.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.342.1">v1:"</span></span><span class="koboSpan" id="kobo.343.1">, v1)
    v2 := slices.Delete(v1, </span><span class="hljs-number"><span class="koboSpan" id="kobo.344.1">1</span></span><span class="koboSpan" id="kobo.345.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.346.1">3</span></span><span class="koboSpan" id="kobo.347.1">)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.348.1">"v1:"</span></span><span class="koboSpan" id="kobo.349.1">, v1)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.350.1">"v2:"</span></span><span class="koboSpan" id="kobo.351.1">, v2)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.352.1">As mentioned earlier, </span><code class="inlineCode"><span class="koboSpan" id="kobo.353.1">slices.Delete()</span></code><span class="koboSpan" id="kobo.354.1"> zeros the deleted elements of the slice that is given as its parameter, and returns a slice without the deleted slice elements—so </span><code class="inlineCode"><span class="koboSpan" id="kobo.355.1">v1</span></code><span class="koboSpan" id="kobo.356.1"> has the same length as before but </span><code class="inlineCode"><span class="koboSpan" id="kobo.357.1">v2</span></code><span class="koboSpan" id="kobo.358.1"> is smaller in length.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.359.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.360.1">sliceChanges.go</span></code><span class="koboSpan" id="kobo.361.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.362.1">$ </span></span><span class="koboSpan" id="kobo.363.1">go run sliceChanges.go
[1 2 -1 -2 10 20]
v1: [-1 1 2 3 4]
v1: [-1 3 4 0 0]
v2: [-1 3 4]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.364.1">The first line shows the contents of the concatenated slice (</span><code class="inlineCode"><span class="koboSpan" id="kobo.365.1">conCat</span></code><span class="koboSpan" id="kobo.366.1">). </span><span class="koboSpan" id="kobo.366.2">The second line contains the initial version of </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">v1</span></code><span class="koboSpan" id="kobo.368.1">, whereas the third line shows the contents of </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">v1</span></code><span class="koboSpan" id="kobo.370.1"> after the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">slices.Delete()</span></code><span class="koboSpan" id="kobo.372.1">. </span><span class="koboSpan" id="kobo.372.2">The last line contains the return value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">slices.Delete()</span></code><span class="koboSpan" id="kobo.374.1"> as stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.375.1">v2</span></code><span class="koboSpan" id="kobo.376.1"> slice.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.377.1">Next, we are going to look at the changes in </span><code class="inlineCode"><span class="koboSpan" id="kobo.378.1">for</span></code><span class="koboSpan" id="kobo.379.1"> loops.</span></p>
<h2 class="heading-2" id="_idParaDest-415"><span class="koboSpan" id="kobo.380.1">Changes in for loops</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.381.1">Go 1.22 introduced some changes</span><a id="_idIndexMarker1293"/><span class="koboSpan" id="kobo.382.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.383.1">for</span></code><span class="koboSpan" id="kobo.384.1"> loops, which we are going to present in this subsection using </span><code class="inlineCode"><span class="koboSpan" id="kobo.385.1">changesForLoops.go</span></code><span class="koboSpan" id="kobo.386.1">. </span><span class="koboSpan" id="kobo.386.2">The code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">main()</span></code><span class="koboSpan" id="kobo.388.1"> function of </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">changesForLoops.go</span></code><span class="koboSpan" id="kobo.390.1"> is going to be presented in two parts. </span><span class="koboSpan" id="kobo.390.2">The first part is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.391.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.392.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.393.1">()</span></span><span class="koboSpan" id="kobo.394.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.395.1">for</span></span><span class="koboSpan" id="kobo.396.1"> x := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.397.1">range</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.398.1">5</span></span><span class="koboSpan" id="kobo.399.1"> {
        fmt.Print(</span><span class="hljs-string"><span class="koboSpan" id="kobo.400.1">" "</span></span><span class="koboSpan" id="kobo.401.1">, x)
    }
    fmt.Println()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.402.1">So, starting with Go 1.22, </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">for</span></code><span class="koboSpan" id="kobo.404.1"> loops can range over integers.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.405.1">The last part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">changesForLoops.go</span></code><span class="koboSpan" id="kobo.407.1"> is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.408.1">    values := []</span><span class="hljs-type"><span class="koboSpan" id="kobo.409.1">int</span></span><span class="koboSpan" id="kobo.410.1">{</span><span class="hljs-number"><span class="koboSpan" id="kobo.411.1">1</span></span><span class="koboSpan" id="kobo.412.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.413.1">2</span></span><span class="koboSpan" id="kobo.414.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.415.1">3</span></span><span class="koboSpan" id="kobo.416.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.417.1">4</span></span><span class="koboSpan" id="kobo.418.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.419.1">5</span></span><span class="koboSpan" id="kobo.420.1">}
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.421.1">for</span></span><span class="koboSpan" id="kobo.422.1"> _, val := </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.423.1">range</span></span><span class="koboSpan" id="kobo.424.1"> values {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.425.1">go</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.426.1">func</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.427.1">()</span></span><span class="koboSpan" id="kobo.428.1"> {
            fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.429.1">"%d "</span></span><span class="koboSpan" id="kobo.430.1">, val)
        }()
    }
    time.Sleep(time.Second)
    fmt.Println()
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.431.1">So, starting with Go 1.22, each time the </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">for</span></code><span class="koboSpan" id="kobo.433.1"> loop is executed, </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.434.1">a new variable is allocated</span></strong><span class="koboSpan" id="kobo.435.1">. </span><span class="koboSpan" id="kobo.435.2">This means that there is no more sharing of loop variables, which means that it is safe to use a loop variable inside a goroutine without having to worry about race conditions.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.436.1">This also means that </span><code class="inlineCode"><span class="koboSpan" id="kobo.437.1">ch08/goClosure.go</span></code><span class="koboSpan" id="kobo.438.1"> is not going to have any issues with its execution. </span><span class="koboSpan" id="kobo.438.2">However, writing clear code is always considered a good practice.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.439.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">changesForLoops.go</span></code><span class="koboSpan" id="kobo.441.1"> produces the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.442.1">$ </span></span><span class="koboSpan" id="kobo.443.1">go run changesForLoops.go
 0 1 2 3 4
5 3 4 1 2
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.444.1">The first line of output shows that loops can range over integers. </span><span class="koboSpan" id="kobo.444.2">The second line of output verifies that each goroutine that is created with the help of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.445.1">for</span></code><span class="koboSpan" id="kobo.446.1"> loop uses a different, separate copy </span><a id="_idIndexMarker1294"/><span class="koboSpan" id="kobo.447.1">of the loop variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.448.1">Last, we present the new capabilities of the updated version of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.449.1">math/rand</span></code><span class="koboSpan" id="kobo.450.1"> package.</span></p>
<h2 class="heading-2" id="_idParaDest-416"><span class="koboSpan" id="kobo.451.1">The math/rand/v2 package</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.452.1">Go 1.22 introduced an update to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.453.1">math/rand</span></code><span class="koboSpan" id="kobo.454.1"> package </span><a id="_idIndexMarker1295"/><span class="koboSpan" id="kobo.455.1">named </span><code class="inlineCode"><span class="koboSpan" id="kobo.456.1">math/rand/v2</span></code><span class="koboSpan" id="kobo.457.1">. </span><span class="koboSpan" id="kobo.457.2">The capabilities of this package are illustrated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.458.1">randv2.go</span></code><span class="koboSpan" id="kobo.459.1">, which is presented in three parts. </span><span class="koboSpan" id="kobo.459.2">The first part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.460.1">randv2.go</span></code><span class="koboSpan" id="kobo.461.1"> is the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.462.1">package</span></span><span class="koboSpan" id="kobo.463.1"> main
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.464.1">import</span></span><span class="koboSpan" id="kobo.465.1"> (
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.466.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.467.1">fmt"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.468.1">"math/rand/v2"</span></span><span class="koboSpan" id="kobo.469.1">
)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.470.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.471.1">Read</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.472.1">(p []</span></span><span class="hljs-type"><span class="koboSpan" id="kobo.473.1">byte</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.474.1">)</span></span><span class="koboSpan" id="kobo.475.1"> (n </span><span class="hljs-type"><span class="koboSpan" id="kobo.476.1">int</span></span><span class="koboSpan" id="kobo.477.1">, err </span><span class="hljs-type"><span class="koboSpan" id="kobo.478.1">error</span></span><span class="koboSpan" id="kobo.479.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.480.1">for</span></span><span class="koboSpan" id="kobo.481.1"> i := </span><span class="hljs-number"><span class="koboSpan" id="kobo.482.1">0</span></span><span class="koboSpan" id="kobo.483.1">; i &lt; </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.484.1">len</span></span><span class="koboSpan" id="kobo.485.1">(p); {
        val := rand.Uint64()
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.486.1">for</span></span><span class="koboSpan" id="kobo.487.1"> j := </span><span class="hljs-number"><span class="koboSpan" id="kobo.488.1">0</span></span><span class="koboSpan" id="kobo.489.1">; j &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.490.1">8</span></span><span class="koboSpan" id="kobo.491.1"> &amp;&amp; i &lt; </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.492.1">len</span></span><span class="koboSpan" id="kobo.493.1">(p); j++ {
            p[i] = </span><span class="hljs-type"><span class="koboSpan" id="kobo.494.1">byte</span></span><span class="koboSpan" id="kobo.495.1">(val &amp; </span><span class="hljs-number"><span class="koboSpan" id="kobo.496.1">0xff</span></span><span class="koboSpan" id="kobo.497.1">)
            val &gt;&gt;= </span><span class="hljs-number"><span class="koboSpan" id="kobo.498.1">8</span></span><span class="koboSpan" id="kobo.499.1">
            i++
        }
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.500.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.501.1">len</span></span><span class="koboSpan" id="kobo.502.1">(p), </span><span class="hljs-literal"><span class="koboSpan" id="kobo.503.1">nil</span></span><span class="koboSpan" id="kobo.504.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.505.1">One of the most important changes is the deprecation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.506.1">Read()</span></code><span class="koboSpan" id="kobo.507.1"> method from </span><code class="inlineCode"><span class="koboSpan" id="kobo.508.1">math/rand</span></code><span class="koboSpan" id="kobo.509.1">. </span><span class="koboSpan" id="kobo.509.2">However, a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.510.1">Read()</span></code><span class="koboSpan" id="kobo.511.1"> function is implemented using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.512.1">Uint64()</span></code><span class="koboSpan" id="kobo.513.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.514.1">The second part comes with the next code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.515.1">func</span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.516.1">main</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.517.1">()</span></span><span class="koboSpan" id="kobo.518.1"> {
    str := </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.519.1">make</span></span><span class="koboSpan" id="kobo.520.1">([]</span><span class="hljs-type"><span class="koboSpan" id="kobo.521.1">byte</span></span><span class="koboSpan" id="kobo.522.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.523.1">3</span></span><span class="koboSpan" id="kobo.524.1">)
    nChar, err := Read(str)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.525.1">if</span></span><span class="koboSpan" id="kobo.526.1"> err != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.527.1">nil</span></span><span class="koboSpan" id="kobo.528.1"> {
        fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.529.1">"Error:"</span></span><span class="koboSpan" id="kobo.530.1">, err)
    } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.531.1">else</span></span><span class="koboSpan" id="kobo.532.1"> {
        fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.533.1">"Read %d random bytes\n"</span></span><span class="koboSpan" id="kobo.534.1">, nChar)
        fmt.Printf(</span><span class="hljs-string"><span class="koboSpan" id="kobo.535.1">"The 3 random bytes are: %v\n"</span></span><span class="koboSpan" id="kobo.536.1">, str)
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.537.1">In this part, we call the </span><a id="_idIndexMarker1296"/><span class="koboSpan" id="kobo.538.1">previously implemented </span><code class="inlineCode"><span class="koboSpan" id="kobo.539.1">Read()</span></code><span class="koboSpan" id="kobo.540.1"> to get 3 random bytes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.541.1">The last part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.542.1">randv2.go</span></code><span class="koboSpan" id="kobo.543.1"> contains the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">var</span></span><span class="koboSpan" id="kobo.545.1"> max </span><span class="hljs-type"><span class="koboSpan" id="kobo.546.1">int</span></span><span class="koboSpan" id="kobo.547.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.548.1">100</span></span><span class="koboSpan" id="kobo.549.1">
    n := rand.N(max)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.550.1">"integer n ="</span></span><span class="koboSpan" id="kobo.551.1">, n)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.552.1">var</span></span><span class="koboSpan" id="kobo.553.1"> uMax </span><span class="hljs-type"><span class="koboSpan" id="kobo.554.1">uint</span></span><span class="koboSpan" id="kobo.555.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.556.1">100</span></span><span class="koboSpan" id="kobo.557.1">
    uN := rand.N(uMax)
    fmt.Println(</span><span class="hljs-string"><span class="koboSpan" id="kobo.558.1">"unsigned int uN ="</span></span><span class="koboSpan" id="kobo.559.1">, uN)
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.560.1">There is the introduction of generic functions that work for any integer type. </span><span class="koboSpan" id="kobo.560.2">In the previous code, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">rand.N()</span></code><span class="koboSpan" id="kobo.562.1"> to get an </span><code class="inlineCode"><span class="koboSpan" id="kobo.563.1">int</span></code><span class="koboSpan" id="kobo.564.1"> value as well as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">uint</span></code><span class="koboSpan" id="kobo.566.1"> value. </span><span class="koboSpan" id="kobo.566.2">The parameter of </span><code class="inlineCode"><span class="koboSpan" id="kobo.567.1">rand.N()</span></code><span class="koboSpan" id="kobo.568.1"> is what specifies the type of value that it is going to return.</span></p>
<div class="note">
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">rand.N()</span></code><span class="koboSpan" id="kobo.570.1"> also works for time durations as </span><code class="inlineCode"><span class="koboSpan" id="kobo.571.1">time.Duration</span></code><span class="koboSpan" id="kobo.572.1"> is based on </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1">int64</span></code><span class="koboSpan" id="kobo.574.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.575.1">Running </span><code class="inlineCode"><span class="koboSpan" id="kobo.576.1">randv2.go</span></code><span class="koboSpan" id="kobo.577.1"> with Go 1.22 or newer produces the following kind of output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.578.1">$ </span></span><span class="koboSpan" id="kobo.579.1">go run randv2.go
Read 3 random bytes
The 3 random bytes are: [71 215 175]
integer n = 0
unsigned int uN = 2
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.580.1">This subsection concludes this chapter, which is also the last chapter of this book! </span><span class="koboSpan" id="kobo.580.2">Thank you for reading the entire book and thank you for choosing my book to learn Go!</span></p>
<h1 class="heading-1" id="_idParaDest-417"><span class="koboSpan" id="kobo.581.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.582.1">In this final chapter of the book, we presented the interesting and important changes introduced in Go 1.21 and Go 1.22 in order to have a clearer understanding of how the Go language keeps improving and evolving. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.583.1">So, what does the future look like for Go developers? </span><span class="koboSpan" id="kobo.583.2">In short, it looks wonderful! </span><span class="koboSpan" id="kobo.583.3">You should already be enjoying programming in Go, and you should continue to do so as the language evolves. </span><span class="koboSpan" id="kobo.583.4">If you want to know about the latest and greatest of Go, you should definitely visit the official GitHub page of the Go team at </span><a href="https://github.com/golang"><span class="url"><span class="koboSpan" id="kobo.584.1">https://github.com/golang</span></span></a><span class="koboSpan" id="kobo.585.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.586.1">Go helps you to create great software! </span><span class="koboSpan" id="kobo.586.2">So, go and create great software! </span><span class="koboSpan" id="kobo.586.3">And remember that </span><strong class="bold-italic" style="font-style: italic;"><span class="koboSpan" id="kobo.587.1">we are most productive when we are enjoying what we do!</span></strong></p>
<h1 class="heading-1" id="_idParaDest-418"><span class="koboSpan" id="kobo.588.1">Exercises</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.589.1">Try to do the following exercises:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.590.1">Make the necessary changes to </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">./ch02/genPass.go</span></code><span class="koboSpan" id="kobo.592.1"> to remove the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.594.1"> and replace it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">rand.New(rand.NewSource(seed))</span></code><span class="koboSpan" id="kobo.596.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.597.1">Similarly, make the necessary changes to </span><code class="inlineCode"><span class="koboSpan" id="kobo.598.1">./ch02/randomNumbers.go</span></code><span class="koboSpan" id="kobo.599.1"> to replace the call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">rand.Seed()</span></code><span class="koboSpan" id="kobo.601.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.602.1">rand.New(rand.NewSource(seed))</span></code><span class="koboSpan" id="kobo.603.1">.</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-419"><span class="koboSpan" id="kobo.604.1">Additional resources</span></h1>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.605.1">Rob Pike—What We Got Right, What We Got Wrong talk from GopherConAU 2023: </span><a href="https://www.youtube.com/watch?v=yE5Tpp2BSGw"><span class="url"><span class="koboSpan" id="kobo.606.1">https://www.youtube.com/watch?v=yE5Tpp2BSGw</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.607.1">Meet the authors of Go: </span><a href="https://youtu.be/3yghHvvZQmA"><span class="url"><span class="koboSpan" id="kobo.608.1">https://youtu.be/3yghHvvZQmA</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.609.1">This is a video of Brian Kernighan interviewing Ken Thompson—not directly related to Go: </span><a href="https://youtu.be/EY6q5dv_B-o"><span class="url"><span class="koboSpan" id="kobo.610.1">https://youtu.be/EY6q5dv_B-o</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.611.1">Brian Kernighan on successful language design—not directly related to Go: </span><a href="https://youtu.be/Sg4U4r_AgJU"><span class="url"><span class="koboSpan" id="kobo.612.1">https://youtu.be/Sg4U4r_AgJU</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.613.1">Brian Kernighan: UNIX, C, AWK, AMPL, and Go Programming from the Lex Fridman Podcast: </span><a href="https://youtu.be/O9upVbGSBFo"><span class="url"><span class="koboSpan" id="kobo.614.1">https://youtu.be/O9upVbGSBFo</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.615.1">Go 1.21 release notes: </span><a href="https://go.dev/doc/go1.21"><span class="url"><span class="koboSpan" id="kobo.616.1">https://go.dev/doc/go1.21</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.617.1">Go 1.22 release notes: </span><a href="https://go.dev/doc/go1.22 "><span class="url"><span class="koboSpan" id="kobo.618.1">https://go.dev/doc/go1.22</span></span></a></li>
</ul>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.619.1">A note from the author</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.620.1">Being a good programmer is hard, but it can be done. </span><span class="koboSpan" id="kobo.620.2">Keep improving and—who knows—you might become famous and have a movie made about you!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.621.1">Thank you for reading this book. </span><span class="koboSpan" id="kobo.621.2">Feel free to contact me with suggestions, questions, or maybe ideas for other books!</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.622.1">Soli Deo gloria</span></em></p>
</div>
<h1 class="heading-1"><span class="koboSpan" id="kobo.623.1">Join our community on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.624.1">Join our community’s Discord space for discussions with the authors and other readers:</span></p>
<p class="normal"><a href="https://discord.gg/FzuQbc8zd6 "><span class="url"><span class="koboSpan" id="kobo.625.1">https://discord.gg/FzuQbc8zd6</span></span></a></p>
<p class="normal"><a href="https://discord.gg/FzuQbc8zd6 "><span class="url"><span class="koboSpan" id="kobo.626.1"><img alt="" role="presentation" src="../Images/QR_Code2286825896190168453.png"/></span></span></a></p>
</div>
</body></html>