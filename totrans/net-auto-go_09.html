<html><head></head><body>
<div id="_idContainer080">
<h1 class="chapter-number" id="_idParaDest-210"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-211"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.2.1">OpenConfig</span></h1>
<p><span class="koboSpan" id="kobo.3.1">OpenConfig is a group of network</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.4.1"> operators (see the </span><em class="italic"><span class="koboSpan" id="kobo.5.1">Further reading</span></em><span class="koboSpan" id="kobo.6.1"> section) with the common goal of streamlining the way we manage and operate networks. </span><span class="koboSpan" id="kobo.6.2">They welcome anyone operating a production network as a member and, more recently, have started to accept contributions from vendors when more than one of them implements the same feature (that they want to include in a </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">YANG model).</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">Their initial focus was to create a set of vendor-neutral YANG data models based on common operational use cases</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.9.1"> and requirements from the field. </span><span class="koboSpan" id="kobo.9.2">This later expanded to include vendor-neutral </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Remote Procedure Calls</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.12.1">RPCs</span></strong><span class="koboSpan" id="kobo.13.1">) for configuring, streaming telemetry, performing operational commands, and manipulating forwarding entries (see </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Further reading</span></em><span class="koboSpan" id="kobo.15.1">) on network devices. </span><span class="koboSpan" id="kobo.15.2">In this chapter, we will focus primarily on the OpenConfig RPCs, as we already covered YANG data models in </span><a href="B16971_08.xhtml#_idTextAnchor182"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.16.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.17.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.18.1">Network APIs</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.20.1">One thing that sets OpenConfig apart from other similar initiatives is that they not only work publicly on the specifications but also write open source code that implements these specifications, helping you to interact with OpenConfig-compliant devices. </span><span class="koboSpan" id="kobo.20.2">They write most of these projects in Go, including but not limited to ygot, gNxI Tools, the gNMI collector, the gNMI CLI utility, the gNMI test framework, gRPC tunnels, and IS-IS LSDB parsing (see </span><em class="italic"><span class="koboSpan" id="kobo.21.1">Further reading</span></em><span class="koboSpan" id="kobo.22.1">). </span><span class="koboSpan" id="kobo.22.2">We encourage you to explore those projects, especially the ones we do not cover in this book, as they target a wide range of </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">network-related applications.</span></span></p>
<p><span class="koboSpan" id="kobo.24.1">At the time of writing, OpenConfig includes four </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">gRPC services:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.26.1">gRPC Network Management Interface</span></strong><span class="koboSpan" id="kobo.27.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.28.1">gNMI</span></strong><span class="koboSpan" id="kobo.29.1">): For streaming telemetry</span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.30.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">configuration management</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.32.1">gRPC Network Operations Interface</span></strong><span class="koboSpan" id="kobo.33.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.34.1">gNOI</span></strong><span class="koboSpan" id="kobo.35.1">): For executing operational commands</span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.36.1"> on </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">network devices</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.38.1">gRPC Routing Information Base Interface</span></strong><span class="koboSpan" id="kobo.39.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.40.1">gRIBI</span></strong><span class="koboSpan" id="kobo.41.1">): To let an external client inject routing entries</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.42.1"> on a </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">network element</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.44.1">gRPC Network Security Interface</span></strong><span class="koboSpan" id="kobo.45.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.46.1">gNSI</span></strong><span class="koboSpan" id="kobo.47.1">): Infrastructure services for securing access</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.48.1"> to a compliant </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">network device</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.50.1">In the following sections, we will examine the following common </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">operational tasks:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.52.1">Device provisioning, with the gNMI </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">Set</span></strong><span class="koboSpan" id="kobo.54.1"> RPC, to label correctly the primary and backup interfaces between two nodes in the </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">lab topology</span></span></li>
<li><span class="koboSpan" id="kobo.56.1">Streaming telemetry, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">Subscribe</span></strong><span class="koboSpan" id="kobo.58.1"> RPC, where a Go program reacts to a gNMI telemetry stream to make changes to </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">the network</span></span></li>
<li><span class="koboSpan" id="kobo.60.1">Network operations, with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">traceroute</span></strong><span class="koboSpan" id="kobo.62.1"> example with the gNOI </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">Traceroute</span></strong><span class="koboSpan" id="kobo.64.1"> RPC, to check that all the forwarding paths in the network are working </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">as expected</span></span></li>
</ul>
<h1 id="_idParaDest-212"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.66.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.67.1">You can find the code examples for this chapter in the book’s GitHub repository (see </span><em class="italic"><span class="koboSpan" id="kobo.68.1">Further reading</span></em><span class="koboSpan" id="kobo.69.1">), in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">ch09</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.71.1"> folder.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.72.1">Important Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.73.1">We recommend you execute the Go programs in this chapter in a virtual lab environment. </span><span class="koboSpan" id="kobo.73.2">Refer to the appendix for prerequisites and instructions on how to build the fully configured </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">network topology.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">The first example we discuss in the following section explores gNMI to configure network devices </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">with Go.</span></span></p>
<h1 id="_idParaDest-213"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.77.1">Device provisioning</span></h1>
<p><span class="koboSpan" id="kobo.78.1">In </span><a href="B16971_06.xhtml#_idTextAnchor144"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.79.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.80.1">, </span><em class="italic"><span class="koboSpan" id="kobo.81.1">Configuration Management</span></em><span class="koboSpan" id="kobo.82.1">, we discussed applying the desired</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.83.1"> configuration state</span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.84.1"> on a network device. </span><span class="koboSpan" id="kobo.84.2">Network engineers routinely have to log in to network devices to provision new services, bring up new connections, or remove outdated configurations. </span><span class="koboSpan" id="kobo.84.3">We covered the different transport options available to configure network devices such as SSH or HTTP in the same chapter, and in </span><a href="B16971_08.xhtml#_idTextAnchor182"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.85.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.86.1">, </span><em class="italic"><span class="koboSpan" id="kobo.87.1">Network APIs</span></em><span class="koboSpan" id="kobo.88.1">, we added gRPC as </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">another option.</span></span></p>
<p><span class="koboSpan" id="kobo.90.1">We briefly touched on modeling network device configurations with a data modeling language such as YANG, so we could move from configuring networks with semi-structured vendor-specific CLI syntax to a model where we exchange structured data with the network to change its </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">configuration state.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">OpenConfig defines a gRPC service</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.93.1"> specifically for configuration management called gNMI. </span><span class="koboSpan" id="kobo.93.2">It aims to provide a common gRPC protobuf definition that any vendor can implement, alongside their existing proprietary </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">gRPC services.</span></span></p>
<p><span class="koboSpan" id="kobo.95.1">The protobuf definition for gNMI is </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.97.1">service gNMI {
   rpc Capabilities(CapabilityRequest) returns (CapabilityResponse);
   rpc Get(GetRequest) returns (GetResponse);
   rpc Set(SetRequest) returns (SetResponse);
   rpc Subscribe(stream SubscribeRequest) returns (stream SubscribeResponse);
}</span></pre>
<p><span class="koboSpan" id="kobo.98.1">gNMI particularly offers configuration management capabilities via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">Set</span></strong><span class="koboSpan" id="kobo.100.1"> RPC that you can use to make changes on a target node. </span><span class="koboSpan" id="kobo.100.2">The gNMI specification (see </span><em class="italic"><span class="koboSpan" id="kobo.101.1">Further reading</span></em><span class="koboSpan" id="kobo.102.1">) has extensive documentation on all available gNMI RPCs. </span><span class="koboSpan" id="kobo.102.2">In this section, we will focus </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">on </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">Set</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">.</span></span></p>
<h2 id="_idParaDest-214"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.106.1">Set RPC</span></h2>
<p><span class="koboSpan" id="kobo.107.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">Set</span></strong><span class="koboSpan" id="kobo.109.1"> RPC lets</span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.110.1"> you change the state</span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.111.1"> of a target network device. </span><span class="koboSpan" id="kobo.111.2">You do this by sending a </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">SetRequest</span></strong><span class="koboSpan" id="kobo.113.1"> message that encodes all changes you want to make. </span></p>
<p><span class="koboSpan" id="kobo.114.1">You can update, replace, or delete values in the data tree of the target device in a single transaction, using dedicated fields of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">SetRequest</span></strong><span class="koboSpan" id="kobo.116.1"> message. </span><span class="koboSpan" id="kobo.116.2">This means that unless the target can apply every specified change, it must roll all of them back and return to its previous state. </span><span class="koboSpan" id="kobo.116.3">The following protobuf definition shows the options you have in a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">SetRequest</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.118.1"> message:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.119.1">message </span></span><span class="koboSpan" id="kobo.120.1">SetRequest {
   Path prefix </span><span class="Code_Red"><span class="koboSpan" id="kobo.121.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.122.1">1</span></span><span class="koboSpan" id="kobo.123.1">;
   repeated Path delete </span><span class="Code_Red"><span class="koboSpan" id="kobo.124.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.125.1">2</span></span><span class="koboSpan" id="kobo.126.1">;
   repeated Update replace </span><span class="Code_Red"><span class="koboSpan" id="kobo.127.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.128.1">3</span></span><span class="koboSpan" id="kobo.129.1">;
   repeated Update update </span><span class="Code_Red"><span class="koboSpan" id="kobo.130.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.131.1">4</span></span><span class="koboSpan" id="kobo.132.1">;
   repeated gnmi_ext.Extension extension </span><span class="Code_Red"><span class="koboSpan" id="kobo.133.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.134.1">5</span></span><span class="koboSpan" id="kobo.135.1">;
}</span></pre>
<p><span class="koboSpan" id="kobo.136.1">The field called </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">Path</span></strong><span class="koboSpan" id="kobo.138.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">SetRequest</span></strong><span class="koboSpan" id="kobo.140.1"> encodes a YANG data tree path. </span><span class="koboSpan" id="kobo.140.2">It’s worth noting that gNMI is not limited to using OpenConfig YANG models; it works equally well with vendor-defined YANG models. </span><span class="koboSpan" id="kobo.140.3">gNMI describes the data tree path as a series of </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">PathElem</span></strong><span class="koboSpan" id="kobo.142.1"> (path elements). </span><span class="koboSpan" id="kobo.142.2">Each one of these is a data tree node that has a name, and it may have one or more attributes (keys) associated </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">with it:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.144.1">message </span></span><span class="koboSpan" id="kobo.145.1">Path {
  string origin </span><span class="Code_Red"><span class="koboSpan" id="kobo.146.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.147.1">2</span></span><span class="koboSpan" id="kobo.148.1">;
  repeated PathElem elem </span><span class="Code_Red"><span class="koboSpan" id="kobo.149.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.150.1">3</span></span><span class="koboSpan" id="kobo.151.1">;
  string target </span><span class="Code_Red"><span class="koboSpan" id="kobo.152.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.153.1">4</span></span><span class="koboSpan" id="kobo.154.1">;
}
</span><span class="Code_Purple"><span class="koboSpan" id="kobo.155.1">message </span></span><span class="koboSpan" id="kobo.156.1">PathElem {
  string name </span><span class="Code_Red"><span class="koboSpan" id="kobo.157.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.158.1">1</span></span><span class="koboSpan" id="kobo.159.1">;
  map&lt;string, string&gt; key </span><span class="Code_Red"><span class="koboSpan" id="kobo.160.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.161.1">2</span></span><span class="koboSpan" id="kobo.162.1">;
}</span></pre>
<p><span class="koboSpan" id="kobo.163.1">For instance, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">/interfaces/interface[name=Ethernet2]/config/description</span></strong><span class="koboSpan" id="kobo.165.1"> path lets</span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.166.1"> you set the description</span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.167.1"> on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">Ethernet2</span></strong><span class="koboSpan" id="kobo.169.1"> interface on a target device. </span><span class="koboSpan" id="kobo.169.2">The only data node in this case that has an attribute is </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">interface</span></strong><span class="koboSpan" id="kobo.171.1">, which needs a </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">name</span></strong><span class="koboSpan" id="kobo.173.1">. </span><span class="koboSpan" id="kobo.173.2">To configure an IPv4 address on the native VLAN in that same interface, you can use a path that looks like this: </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">/interfaces/interface[name=Ethernet2]/subinterfaces/subinterface[index=0]/ipv4/addresses/address[ip=192.0.2.2]</span></strong><span class="koboSpan" id="kobo.175.1">. </span><span class="koboSpan" id="kobo.175.2">In this case, you need to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">subinterface</span></strong><span class="koboSpan" id="kobo.177.1"> index, as the interface could have IP addresses on </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">different sub-interfaces.</span></span></p>
<p><span class="koboSpan" id="kobo.179.1">Once you have identified the data path, you need to build the content that has the new values you want to set on the target device, which is a data instance of a YANG schema. </span><span class="koboSpan" id="kobo.179.2">You only need this for </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">replace</span></strong><span class="koboSpan" id="kobo.181.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">update</span></strong><span class="koboSpan" id="kobo.183.1">. </span><span class="koboSpan" id="kobo.183.2">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">delete</span></strong><span class="koboSpan" id="kobo.185.1">, the path is enough to tell the target device what to remove from </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">the configuration.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">An </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">Update</span></strong><span class="koboSpan" id="kobo.189.1"> message that you would use to send the values for either </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">replace</span></strong><span class="koboSpan" id="kobo.191.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">update</span></strong><span class="koboSpan" id="kobo.193.1"> has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">Path</span></strong><span class="koboSpan" id="kobo.195.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">TypedValue</span></strong><span class="koboSpan" id="kobo.197.1"> pair. </span><span class="koboSpan" id="kobo.197.2">The latter lets you encode the content in </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">different formats:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.199.1">message </span></span><span class="koboSpan" id="kobo.200.1">Update {
  Path path </span><span class="Code_Red"><span class="koboSpan" id="kobo.201.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.202.1">1</span></span><span class="koboSpan" id="kobo.203.1">;
  TypedValue val </span><span class="Code_Red"><span class="koboSpan" id="kobo.204.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.205.1">3</span></span><span class="koboSpan" id="kobo.206.1">;
  uint32 duplicates </span><span class="Code_Red"><span class="koboSpan" id="kobo.207.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.208.1">4</span></span><span class="koboSpan" id="kobo.209.1">;
}
</span><span class="Code_Purple"><span class="koboSpan" id="kobo.210.1">message </span></span><span class="koboSpan" id="kobo.211.1">TypedValue {
  oneof value {
    string string_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.212.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.213.1">1</span></span><span class="koboSpan" id="kobo.214.1">;
    int64 int_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.215.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.216.1">2</span></span><span class="koboSpan" id="kobo.217.1">;
    uint64 uint_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.218.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.219.1">3</span></span><span class="koboSpan" id="kobo.220.1">;
    bool bool_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.221.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.222.1">4</span></span><span class="koboSpan" id="kobo.223.1">;
    bytes bytes_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.224.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.225.1">5</span></span><span class="koboSpan" id="kobo.226.1">;
    double double_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.227.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.228.1">14</span></span><span class="koboSpan" id="kobo.229.1">;
    ScalarArray leaflist_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.230.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.231.1">8</span></span><span class="koboSpan" id="kobo.232.1">;
    google.protobuf.Any any_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.233.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.234.1">9</span></span><span class="koboSpan" id="kobo.235.1">;
    bytes json_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.236.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.237.1">10</span></span><span class="koboSpan" id="kobo.238.1">;
    bytes json_ietf_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.239.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.240.1">11</span></span><span class="koboSpan" id="kobo.241.1">;
    string ascii_val </span><span class="Code_Red"><span class="koboSpan" id="kobo.242.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.243.1">12</span></span><span class="koboSpan" id="kobo.244.1">;
    bytes proto_bytes </span><span class="Code_Red"><span class="koboSpan" id="kobo.245.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.246.1">13</span></span><span class="koboSpan" id="kobo.247.1">;
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.248.1">A value could be a string</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.249.1"> for an interface</span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.250.1"> description, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">PRIMARY: TO -&gt; CVX:swp1</span></strong><span class="koboSpan" id="kobo.252.1"> or a JSON value to describe the IPv4 address of an interface such </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">{"config":{"ip":"192.0.2.2","prefix-length":31}}</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">.</span></span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.256.1">Using gNMI to configure network interfaces</span></h2>
<p><span class="koboSpan" id="kobo.257.1">The virtual lab topology</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.258.1"> for this chapter, which</span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.259.1"> you can bring up by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">make lab-full</span></strong><span class="koboSpan" id="kobo.261.1"> from the root of this book’s GitHub repository, has two connections between </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">ceos</span></strong><span class="koboSpan" id="kobo.263.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">cvx</span></strong><span class="koboSpan" id="kobo.265.1">. </span><span class="koboSpan" id="kobo.265.2">They have IPv4 addresses configured already, but they don’t have a description that lets you identify the roles of these interfaces, whether they are the primary or the </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">backup link:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer075">
<span class="koboSpan" id="kobo.267.1"><img alt="Figure 9.1 – A dual link between ceos and cvx" src="image/B16971_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.268.1">Figure 9.1 – A dual link between ceos and cvx</span></p>
<p><span class="koboSpan" id="kobo.269.1">In the next example, we add</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.270.1"> a description</span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.271.1"> to those interfaces on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">ceos</span></strong><span class="koboSpan" id="kobo.273.1"> side via gNMI. </span><span class="koboSpan" id="kobo.273.2">To do this, we use the gNMIc package (</span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">karimra/gnmic/api</span></strong><span class="koboSpan" id="kobo.275.1">). </span><span class="koboSpan" id="kobo.275.2">We chose gNMIc over the official gNMI package (</span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">openconfig/gnmi</span></strong><span class="koboSpan" id="kobo.277.1">) because it’s more developer-friendly and higher-level. </span><span class="koboSpan" id="kobo.277.2">It lets us conveniently encode the gNMI paths as strings, instead of Go data structures, as the gNMIc docs (see </span><em class="italic"><span class="koboSpan" id="kobo.278.1">Further reading</span></em><span class="koboSpan" id="kobo.279.1">) describe. </span><span class="koboSpan" id="kobo.279.2">You can find the code for this example in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">ch09/gnmi</span></strong><span class="koboSpan" id="kobo.281.1"> directory of this book’s GitHub repository (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.282.1">Further reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.284.1">The gNMIc package has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">NewTarget</span></strong><span class="koboSpan" id="kobo.286.1"> function that creates a new gNMI target device. </span><span class="koboSpan" id="kobo.286.2">In the following example, we wrap this function in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">createTarget</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.288.1"> method:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.289.1">func </span></span><span class="koboSpan" id="kobo.290.1">(r Router) createTarget() (</span><span class="Code_Red"><span class="koboSpan" id="kobo.291.1">*</span></span><span class="koboSpan" id="kobo.292.1">target.Target, </span><span class="Code_Purple"><span class="koboSpan" id="kobo.293.1">error</span></span><span class="koboSpan" id="kobo.294.1">) {
      </span><span class="Code_Purple"><span class="koboSpan" id="kobo.295.1">return </span></span><span class="koboSpan" id="kobo.296.1">api.NewTarget(
           api.Name(</span><span class="Code_Red"><span class="koboSpan" id="kobo.297.1">"gnmi"</span></span><span class="koboSpan" id="kobo.298.1">),
           api.Address(r.Hostname</span><span class="Code_Red"><span class="koboSpan" id="kobo.299.1">+":"+</span></span><span class="koboSpan" id="kobo.300.1">r.Port),
           api.Username(r.Username),
           api.Password(r.Password),
           api.Insecure(r.Insecure),
      )
}</span></pre>
<p><span class="koboSpan" id="kobo.301.1">The first step in the code is to read the connection details from a YAML file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">input.yml</span></strong><span class="koboSpan" id="kobo.303.1">) to create this </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">target device:</span></span></p>
<pre class="source-code"><span class="Code_Brown"><span class="koboSpan" id="kobo.305.1"># input.yml</span></span><span class="koboSpan" id="kobo.306.1">
- </span><span class="Code_Blue"><span class="koboSpan" id="kobo.307.1">hostname</span></span><span class="koboSpan" id="kobo.308.1">: clab-netgo-ceos
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.309.1">port</span></span><span class="koboSpan" id="kobo.310.1">: </span><span class="Code_Green"><span class="koboSpan" id="kobo.311.1">6030</span></span><span class="koboSpan" id="kobo.312.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.313.1">insecure</span></span><span class="koboSpan" id="kobo.314.1">: </span><span class="Code_Purple"><span class="koboSpan" id="kobo.315.1">true</span></span><span class="koboSpan" id="kobo.316.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.317.1">username</span></span><span class="koboSpan" id="kobo.318.1">: admin
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.319.1">password</span></span><span class="koboSpan" id="kobo.320.1">: admin</span></pre>
<p><span class="koboSpan" id="kobo.321.1">We store all target devices in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">Routers</span></strong><span class="koboSpan" id="kobo.323.1"> data</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.324.1"> structure. </span><span class="koboSpan" id="kobo.324.2">In our</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.325.1"> case, we only have one device (</span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">clab-netgo-ceos</span></strong><span class="koboSpan" id="kobo.327.1">) but the connection details are a list, so we could’ve added more devices if we wanted to. </span><span class="koboSpan" id="kobo.327.2">Now, with the target data, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">CreateGNMIClient</span></strong><span class="koboSpan" id="kobo.329.1"> method to set up the underlying gRPC connection to the target </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">device (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">clab-netgo-ceos:6030</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">):</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.333.1">func</span></span><span class="koboSpan" id="kobo.334.1"> main() {
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.335.1">/* ... </span><span class="koboSpan" id="kobo.335.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.335.3">*/</span></span><span class="koboSpan" id="kobo.336.1">
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.337.1">for</span></span><span class="koboSpan" id="kobo.338.1"> _, router :</span><span class="Code_Red"><span class="koboSpan" id="kobo.339.1">=</span></span> <span class="Code_Purple"><span class="koboSpan" id="kobo.340.1">range</span></span><span class="koboSpan" id="kobo.341.1"> inv.Routers {
    tg, err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.342.1">=</span></span><span class="koboSpan" id="kobo.343.1"> router.createTarget()
    </span><span class="Code_Brown"><span class="koboSpan" id="kobo.344.1">// process error</span></span><span class="koboSpan" id="kobo.345.1">
 
    ctx, cancel :</span><span class="Code_Red"><span class="koboSpan" id="kobo.346.1">=</span></span><span class="koboSpan" id="kobo.347.1"> context.WithCancel(
    context.Background())
    </span><span class="Code_Purple"><span class="koboSpan" id="kobo.348.1">defer</span></span><span class="koboSpan" id="kobo.349.1"> cancel()
 
    err </span><span class="Code_Red"><span class="koboSpan" id="kobo.350.1">=</span></span><span class="koboSpan" id="kobo.351.1"> tg.CreateGNMIClient(ctx)
    </span><span class="Code_Brown"><span class="koboSpan" id="kobo.352.1">// process error</span></span><span class="koboSpan" id="kobo.353.1">
    </span><span class="Code_Purple"><span class="koboSpan" id="kobo.354.1">defer</span></span><span class="koboSpan" id="kobo.355.1"> tg.Close()
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.356.1">/* ... </span><span class="koboSpan" id="kobo.356.2">&lt;continues next &gt; ... </span><span class="koboSpan" id="kobo.356.3">*/</span></span><span class="koboSpan" id="kobo.357.1">
}</span></pre>
<p><span class="koboSpan" id="kobo.358.1">With the connection</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.359.1"> established, we now</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.360.1"> can send the </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">Set</span></strong><span class="koboSpan" id="kobo.362.1"> requests. </span><span class="koboSpan" id="kobo.362.2">Another YAML file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">api-ceos.yml</span></strong><span class="koboSpan" id="kobo.364.1">) has a list of parameters for each request: </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">prefix</span></strong><span class="koboSpan" id="kobo.366.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">encoding</span></strong><span class="koboSpan" id="kobo.368.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">path</span></strong><span class="koboSpan" id="kobo.370.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">value</span></strong><span class="koboSpan" id="kobo.372.1">. </span><span class="koboSpan" id="kobo.372.2">You can add </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">prefix</span></strong><span class="koboSpan" id="kobo.374.1"> when you want to reduce the length of a path. </span><span class="koboSpan" id="kobo.374.2">In our Go program, we save this list of parameters in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">info</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.376.1"> slice:</span></span></p>
<pre class="source-code"><span class="Code_Brown"><span class="koboSpan" id="kobo.377.1"># api-ceos.yml</span></span><span class="koboSpan" id="kobo.378.1">
- </span><span class="Code_Blue"><span class="koboSpan" id="kobo.379.1">prefix</span></span><span class="koboSpan" id="kobo.380.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.381.1">"/interfaces/interface[name=Ethernet2]"</span></span><span class="koboSpan" id="kobo.382.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.383.1">encoding</span></span><span class="koboSpan" id="kobo.384.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.385.1">"json_ietf"</span></span><span class="koboSpan" id="kobo.386.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.387.1">path</span></span><span class="koboSpan" id="kobo.388.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.389.1">'/subinterfaces/subinterface[index=0]/ipv4/addresses/address[ip=192.0.2.2]'</span></span><span class="koboSpan" id="kobo.390.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.391.1">value</span></span><span class="koboSpan" id="kobo.392.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.393.1">'{"config":{"ip":"192.0.2.2","prefix-length":31}}'</span></span><span class="koboSpan" id="kobo.394.1">
- </span><span class="Code_Blue"><span class="koboSpan" id="kobo.395.1">prefix</span></span><span class="koboSpan" id="kobo.396.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.397.1">""</span></span><span class="koboSpan" id="kobo.398.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.399.1">encoding</span></span><span class="koboSpan" id="kobo.400.1">: "</span><span class="Code_Red"><span class="koboSpan" id="kobo.401.1">json_ietf"</span></span><span class="koboSpan" id="kobo.402.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.403.1">path</span></span><span class="koboSpan" id="kobo.404.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.405.1">'/interfaces/interface[name=Ethernet2]/config/description'</span></span><span class="koboSpan" id="kobo.406.1">
  </span><span class="Code_Blue"><span class="koboSpan" id="kobo.407.1">value</span></span><span class="koboSpan" id="kobo.408.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.409.1">'PRIMARY: TO -&gt; CVX:swp1''</span></span>
<span class="Code_Brown"><span class="koboSpan" id="kobo.410.1">## ... </span><span class="koboSpan" id="kobo.410.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.410.3">##</span></span></pre>
<p><span class="koboSpan" id="kobo.411.1">The last step is to iterate over the </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">info</span></strong><span class="koboSpan" id="kobo.413.1"> slice, build a </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">Set</span></strong><span class="koboSpan" id="kobo.415.1"> request with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">NewSetRequest</span></strong><span class="koboSpan" id="kobo.417.1"> function, and send it to the target device using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">Set</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.419.1"> method:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.420.1">func</span></span><span class="koboSpan" id="kobo.421.1"> main() {
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.422.1">/* ... </span><span class="koboSpan" id="kobo.422.2">&lt;continues from before &gt; ... </span><span class="koboSpan" id="kobo.422.3">*/</span></span><span class="koboSpan" id="kobo.423.1">
    </span><span class="Code_Purple"><span class="koboSpan" id="kobo.424.1">for</span></span><span class="koboSpan" id="kobo.425.1"> _, data :</span><span class="Code_Red"><span class="koboSpan" id="kobo.426.1">=</span></span> <span class="Code_Purple"><span class="koboSpan" id="kobo.427.1">range</span></span><span class="koboSpan" id="kobo.428.1"> info {
      setReq, err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.429.1">=</span></span><span class="koboSpan" id="kobo.430.1"> api.NewSetRequest(
              api.Update(
                    api.Path(data.Prefix+data.Path),
                    api.Value(data.Value, data.Encoding)),
      )
      </span><span class="Code_Brown"><span class="koboSpan" id="kobo.431.1">// process error</span></span><span class="koboSpan" id="kobo.432.1">
  
      configResp, err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.433.1">=</span></span><span class="koboSpan" id="kobo.434.1"> tg.Set(ctx, setReq)
      </span><span class="Code_Brown"><span class="koboSpan" id="kobo.435.1">// process error</span></span><span class="koboSpan" id="kobo.436.1">
      fmt.Println(prototext.Format(configResp))
    }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.437.1">Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">NewSetRequest</span></strong><span class="koboSpan" id="kobo.439.1"> has only</span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.440.1"> one </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">Update</span></strong><span class="koboSpan" id="kobo.442.1"> message, but</span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.443.1"> you could include several messages in a single request. </span></p>
<p><span class="koboSpan" id="kobo.444.1">You get the following output when running </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">this example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.446.1">ch09/gnmi</span><span class="Code_Blue"><span class="koboSpan" id="kobo.447.1">$ go </span></span><span class="koboSpan" id="kobo.448.1">run main.go 
response: {
  path: {
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.449.1">"interfaces"</span></span><span class="koboSpan" id="kobo.450.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.451.1">"interface"</span></span><span class="koboSpan" id="kobo.452.1">
      key: {
        key: </span><span class="Code_Red"><span class="koboSpan" id="kobo.453.1">"name"</span></span><span class="koboSpan" id="kobo.454.1">
        value: </span><span class="Code_Red"><span class="koboSpan" id="kobo.455.1">"Ethernet2"</span></span><span class="koboSpan" id="kobo.456.1">
      }
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.457.1">"subinterfaces"</span></span><span class="koboSpan" id="kobo.458.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.459.1">"subinterface"</span></span><span class="koboSpan" id="kobo.460.1">
      key: {
        key: </span><span class="Code_Red"><span class="koboSpan" id="kobo.461.1">"index"</span></span><span class="koboSpan" id="kobo.462.1">
        value: </span><span class="Code_Red"><span class="koboSpan" id="kobo.463.1">"0"</span></span><span class="koboSpan" id="kobo.464.1">
      }
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.465.1">"ipv4"</span></span><span class="koboSpan" id="kobo.466.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.467.1">"addresses"</span></span><span class="koboSpan" id="kobo.468.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.469.1">"address"</span></span><span class="koboSpan" id="kobo.470.1">
      key: {
        key: </span><span class="Code_Red"><span class="koboSpan" id="kobo.471.1">"ip"</span></span><span class="koboSpan" id="kobo.472.1">
        value: </span><span class="Code_Red"><span class="koboSpan" id="kobo.473.1">"192.0.2.2"</span></span><span class="koboSpan" id="kobo.474.1">
      }
    }
  }
  op: UPDATE
}
timestamp: </span><span class="Code_Green"><span class="koboSpan" id="kobo.475.1">1660148355191641746</span></span><span class="koboSpan" id="kobo.476.1">
response: {
  path: {
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.477.1">"interfaces"</span></span><span class="koboSpan" id="kobo.478.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.479.1">"interface"</span></span><span class="koboSpan" id="kobo.480.1">
      key: {
        key: </span><span class="Code_Red"><span class="koboSpan" id="kobo.481.1">"name"</span></span><span class="koboSpan" id="kobo.482.1">
        value: </span><span class="Code_Red"><span class="koboSpan" id="kobo.483.1">"Ethernet2"</span></span><span class="koboSpan" id="kobo.484.1">
      }
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.485.1">"config"</span></span><span class="koboSpan" id="kobo.486.1">
    }
    elem: {
      name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.487.1">"description"</span></span><span class="koboSpan" id="kobo.488.1">
    }
  }
  op: UPDATE
}
timestamp: </span><span class="Code_Green"><span class="koboSpan" id="kobo.489.1">1660148355192866023</span></span>
<span class="Code_Brown"><span class="koboSpan" id="kobo.490.1">## ... </span><span class="koboSpan" id="kobo.490.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.490.3">##</span></span></pre>
<p><span class="koboSpan" id="kobo.491.1">What you see</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.492.1"> on the terminal screen</span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.493.1"> are the </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">SetResponse</span></strong><span class="koboSpan" id="kobo.495.1"> messages, containing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">path</span></strong><span class="koboSpan" id="kobo.497.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">response</span></strong><span class="koboSpan" id="kobo.499.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">timestamp</span></strong><span class="koboSpan" id="kobo.501.1"> values of </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">the operation:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.503.1">message SetResponse {
  Path prefix = 1;
  repeated UpdateResult response = 2;
  int64 timestamp = 4;
  repeated gnmi_ext.Extension extension = 5;
}</span></pre>
<p><span class="koboSpan" id="kobo.504.1">If you connect to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">ceos</span></strong><span class="koboSpan" id="kobo.506.1"> device now, you will see the following in its </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">running configuration:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.508.1">interface Ethernet2
   description PRIMARY: TO -&gt; CVX:swp1
   no switchport
   ip address 192.0.2.2/31
!
</span><span class="koboSpan" id="kobo.508.2">interface Ethernet3
   description BACKUP: TO -&gt; CVX:swp2
   no switchport
   ip address 192.0.2.4/31
!</span></pre>
<p><span class="koboSpan" id="kobo.509.1">Configuring network devices is one of those repetitive tasks that most network engineers spend a good amount of time on, so automating this process has the potential to have a good return </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">on investment.</span></span></p>
<p><span class="koboSpan" id="kobo.511.1">The years of work of the OpenConfig working group, which released the official gNMI package (</span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">openconfig/gnmi</span></strong><span class="koboSpan" id="kobo.513.1">), set the path for the emergence of other open source packages and libraries such as gNMIc (</span><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">karimra/gnmic</span></strong><span class="koboSpan" id="kobo.515.1">) and pyGNMI (</span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">akarneliuk/pygnmi</span></strong><span class="koboSpan" id="kobo.517.1">), creating a community around these vendor-neutral gRPC services to drive consistent automation practices in </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">our networks.</span></span></p>
<p><span class="koboSpan" id="kobo.519.1">In the following section, we</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.520.1"> will cover another</span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.521.1"> OpenConfig gRPC service that enhances your network </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">visibility capabilities.</span></span></p>
<h1 id="_idParaDest-216"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.523.1">Streaming telemetry</span></h1>
<p><span class="koboSpan" id="kobo.524.1">Traditionally, network</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.525.1"> engineers have</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.526.1"> relied on the </span><strong class="bold"><span class="koboSpan" id="kobo.527.1">Simple Network Management Protocol</span></strong><span class="koboSpan" id="kobo.528.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.529.1">SNMP</span></strong><span class="koboSpan" id="kobo.530.1">) to gather state information</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.531.1"> from network devices. </span><span class="koboSpan" id="kobo.531.2">Devices</span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.532.1"> encode this information</span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.533.1"> in a binary format using the </span><strong class="bold"><span class="koboSpan" id="kobo.534.1">Abstract Syntax Notation One</span></strong><span class="koboSpan" id="kobo.535.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.536.1">ASN.1</span></strong><span class="koboSpan" id="kobo.537.1">) and send it to a receiver, typically a collector or a </span><strong class="bold"><span class="koboSpan" id="kobo.538.1">Network Management System</span></strong><span class="koboSpan" id="kobo.539.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.540.1">NMS</span></strong><span class="koboSpan" id="kobo.541.1">). </span><span class="koboSpan" id="kobo.541.2">The latter would use one of the </span><strong class="bold"><span class="koboSpan" id="kobo.542.1">Management Information Bases</span></strong><span class="koboSpan" id="kobo.543.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.544.1">MIBs</span></strong><span class="koboSpan" id="kobo.545.1">) to decode the received</span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.546.1"> information and store it locally for </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">further processing.</span></span></p>
<p><span class="koboSpan" id="kobo.548.1">This has been the way we’ve done network monitoring for decades, but this approach has room</span><a id="_idIndexMarker829"/> <span class="No-Break"><span class="koboSpan" id="kobo.549.1">for improvement:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.550.1">The limited number of vendor-neutral data models means that even the basic things require unique MIBs that you may need to update every time you do a major network </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">OS upgrade.</span></span></li>
<li><span class="koboSpan" id="kobo.552.1">MIBs use a notation defined by a subset of ASN.1, which isn’t the best way to structure values. </span><span class="koboSpan" id="kobo.552.2">It has no concept of lists or key-value pairs. </span><span class="koboSpan" id="kobo.552.3">Instead, you must implement these with indexed values and extra </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">lookup tables.</span></span></li>
<li><span class="koboSpan" id="kobo.554.1">SNMP uses UDP as its transport protocol to avoid putting an extra burden on the collector. </span><span class="koboSpan" id="kobo.554.2">This means that you could miss some events completely, leaving blind spots in the stream of </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">telemetry data.</span></span></li>
<li><span class="koboSpan" id="kobo.556.1">Since SNMP primarily relies on polling, we can only see aggregated values and may miss important </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">state transitions.</span></span></li>
<li><span class="koboSpan" id="kobo.558.1">SNMP does not generally timestamp when a value changes. </span><span class="koboSpan" id="kobo.558.2">Collectors can only infer timing based on the time </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">of collection.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.560.1">gNMI offers a new approach</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.561.1"> to network monitoring via a dedicated </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">Subscribe</span></strong><span class="koboSpan" id="kobo.563.1"> RPC. </span><span class="koboSpan" id="kobo.563.2">At the very least, it offers the same capabilities as SNMP but takes it further, making the protocol more feature-rich </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">and versatile:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.565.1">One of the greatest improvements is telemetry streaming. </span><span class="koboSpan" id="kobo.565.2">Now, you can continuously receive any value of the operational YANG tree from a network device, which gives you better visibility into all state transitions along with </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">their timestamps.</span></span></li>
<li><span class="koboSpan" id="kobo.567.1">You have a choice to receive telemetry data only when there is a change as opposed to a periodic transmission. </span></li>
<li><span class="koboSpan" id="kobo.568.1">Thanks to the underlying gRPC transport, gNMI supports both dial-in and dial-out connection methods and delivers messages using a reliable </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">HTTP/2 protocol.</span></span></li>
<li><span class="koboSpan" id="kobo.570.1">OpenConfig defines vendor-neutral YANG models to describe the operational state of a network device, which enables clients to parse and process the received data from different vendors in a </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">standard pipeline.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.572.1">Important Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.573.1">Even with streaming telemetry, you are not necessarily getting an update for every counter increment. </span><span class="koboSpan" id="kobo.573.2">Network devices have local processes that periodically poll internal data stores to get the latest metrics or stats, such as interface packet counters, which they feed to their gNMI process. </span><span class="koboSpan" id="kobo.573.3">Hence, how real-time the data you receive is depends not only on how often you get streaming messages but also on the internal polling cadence. </span><span class="koboSpan" id="kobo.573.4">Still, you will probably see the most relevant system events, such as BGP state transitions, which you would otherwise miss </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">with SNMP.</span></span></p>
<p><span class="koboSpan" id="kobo.575.1">These features are just a subset</span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.576.1"> of the gNMI capabilities. </span><span class="koboSpan" id="kobo.576.2">The gNMI specification (see </span><em class="italic"><span class="koboSpan" id="kobo.577.1">Further reading</span></em><span class="koboSpan" id="kobo.578.1">) can serve as a good reference for all gNMI protocol features. </span><span class="koboSpan" id="kobo.578.2">Next, we examine the gNMI protobuf message for the telemetry service to help you understand how </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">it works.</span></span></p>
<h2 id="_idParaDest-217"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.580.1">Subscribe RPC</span></h2>
<p><span class="koboSpan" id="kobo.581.1">gNMI defines</span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.582.1"> a single RPC</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.583.1"> to subscribe to a telemetry stream. </span><span class="koboSpan" id="kobo.583.2">Network devices receive one or more </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">SubscribeRequest</span></strong><span class="koboSpan" id="kobo.585.1"> messages and respond with a stream of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">SubscribeResponse</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.587.1"> messages:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.588.1">service gNMI {
     rpc Subscribe(stream SubscribeRequest) returns (stream SubscribeResponse);
}</span></pre>
<p><span class="koboSpan" id="kobo.589.1">gNMI clients have different options to control their telemetry subscriptions. </span><span class="koboSpan" id="kobo.589.2">The following figure shows the composition of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1">SubscribeRequest</span></strong><span class="koboSpan" id="kobo.591.1"> message, highlighting some of </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">these options:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer076">
<span class="koboSpan" id="kobo.593.1"><img alt="Figure 9.2 – gNMI subscribe protobuf messages" src="image/B16971_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.594.1">Figure 9.2 – gNMI subscribe protobuf messages</span></p>
<p><span class="koboSpan" id="kobo.595.1">The most basic way</span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.596.1"> to control the telemetry subscription</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.597.1"> is by specifying </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">Path</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.599.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">SubscriptionMode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.602.1">Path</span></strong><span class="koboSpan" id="kobo.603.1">: References the part of the YANG</span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.604.1"> tree you want to monitor. </span><span class="koboSpan" id="kobo.604.2">You can subscribe to anything, from the entire device state to just a single leaf value. </span><span class="koboSpan" id="kobo.604.3">It follows the gNMI path convention (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.605.1">Further reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.607.1">SubscriptionMode</span></strong><span class="koboSpan" id="kobo.608.1">: Determines whether to send</span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.609.1"> the telemetry on-change </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">or periodically:</span></span><pre class="console"><span class="koboSpan" id="kobo.611.1">enum SubscriptionMode {</span></pre><pre class="console"><span class="koboSpan" id="kobo.612.1">     TARGET_DEFINED = 0;</span></pre><pre class="console"><span class="koboSpan" id="kobo.613.1">     ON_CHANGE      = 1;</span></pre><pre class="console"><span class="koboSpan" id="kobo.614.1">     SAMPLE         = 2;</span></pre><pre class="console"><span class="koboSpan" id="kobo.615.1">}</span></pre></li>
</ul>
<p><span class="koboSpan" id="kobo.616.1">In return, a network device sends you a stream of response messages with the </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">following information:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.618.1">TypedValue</span></strong><span class="koboSpan" id="kobo.619.1">: The most critical field, containing the actual </span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">telemetry value</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.621.1">Path</span></strong><span class="koboSpan" id="kobo.622.1">: The full gNMI path of the value, which identifies the unique YANG </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">leaf node</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.624.1">timestamp</span></strong><span class="koboSpan" id="kobo.625.1">: To help you arrange and process received data in the right order or find out when a value last changed for those that do not </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">change frequently:</span></span><pre class="console"><span class="koboSpan" id="kobo.627.1">message Notification {</span></pre><pre class="console"><span class="koboSpan" id="kobo.628.1">     int64 timestamp </span><span class="Code_Red"><span class="koboSpan" id="kobo.629.1">=</span></span><span class="koboSpan" id="kobo.630.1"> 1;</span></pre><pre class="console"><span class="koboSpan" id="kobo.631.1">     Path prefix </span><span class="Code_Red"><span class="koboSpan" id="kobo.632.1">=</span></span><span class="koboSpan" id="kobo.633.1"> 2;</span></pre><pre class="console"><span class="koboSpan" id="kobo.634.1">     string alias </span><span class="Code_Red"><span class="koboSpan" id="kobo.635.1">=</span></span><span class="koboSpan" id="kobo.636.1"> 3;</span></pre><pre class="console"><span class="koboSpan" id="kobo.637.1">     repeated Update update </span><span class="Code_Red"><span class="koboSpan" id="kobo.638.1">=</span></span><span class="koboSpan" id="kobo.639.1"> 4;</span></pre><pre class="console"><span class="koboSpan" id="kobo.640.1">     repeated Path delete </span><span class="Code_Red"><span class="koboSpan" id="kobo.641.1">=</span></span><span class="koboSpan" id="kobo.642.1"> 5;</span></pre><pre class="console"><span class="koboSpan" id="kobo.643.1">     bool atomic </span><span class="Code_Red"><span class="koboSpan" id="kobo.644.1">=</span></span><span class="koboSpan" id="kobo.645.1"> 6;</span></pre><pre class="console"><span class="koboSpan" id="kobo.646.1">}</span></pre><pre class="console"><span class="koboSpan" id="kobo.647.1">message Update {</span></pre><pre class="console"><span class="koboSpan" id="kobo.648.1">     Path path </span><span class="Code_Red"><span class="koboSpan" id="kobo.649.1">=</span></span><span class="koboSpan" id="kobo.650.1"> 1;</span></pre><pre class="console"><span class="koboSpan" id="kobo.651.1">     TypedValue val </span><span class="Code_Red"><span class="koboSpan" id="kobo.652.1">=</span></span><span class="koboSpan" id="kobo.653.1"> 3;</span></pre><pre class="console"><span class="koboSpan" id="kobo.654.1">     uint32 duplicates </span><span class="Code_Red"><span class="koboSpan" id="kobo.655.1">=</span></span><span class="koboSpan" id="kobo.656.1"> 4;</span></pre><pre class="console"><span class="koboSpan" id="kobo.657.1">}</span></pre></li>
</ul>
<p><span class="koboSpan" id="kobo.658.1">We are just scratching</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.659.1"> the surface </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.660.1">of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">Subscribe</span></strong><span class="koboSpan" id="kobo.662.1"> RPC. </span><span class="koboSpan" id="kobo.662.2">You can check the </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">gnmi.proto</span></strong><span class="koboSpan" id="kobo.664.1"> file to see the complete set of protobuf messages and read the telemetry section of the gNMI specification (see </span><em class="italic"><span class="koboSpan" id="kobo.665.1">Further reading</span></em><span class="koboSpan" id="kobo.666.1">) to get a better idea of the capabilities and features offered by the protocol. </span><span class="koboSpan" id="kobo.666.2">Here are some features you can learn about that we don’t cover in </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">this book:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.668.1">gNMI lets you poll or take an instant one-off (</span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">ONCE</span></strong><span class="koboSpan" id="kobo.670.1">) snapshot of </span><span class="No-Break"><span class="koboSpan" id="kobo.671.1">telemetry values.</span></span></li>
<li><span class="koboSpan" id="kobo.672.1">Some network devices can send several </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">Update</span></strong><span class="koboSpan" id="kobo.674.1"> messages bundled in a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">SubscribeResponse</span></strong><span class="koboSpan" id="kobo.676.1">. </span><span class="koboSpan" id="kobo.676.2">This comes at the expense of reduced timestamp accuracy, since there’s only a single timestamp for all </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">transported values.</span></span></li>
<li><span class="koboSpan" id="kobo.678.1">If you are not interested in seeing every single value, you can let a network device aggregate </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">those values.</span></span></li>
<li><span class="koboSpan" id="kobo.680.1">For values that different YANG</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.681.1"> models define, you can specify</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.682.1"> the definition you prefer </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">to use.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.684.1">Important Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.685.1">As with OpenConfig YANG models, the exact set of implemented features varies from vendor </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">to vendor.</span></span></p>
<h2 id="_idParaDest-218"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.687.1">Streaming telemetry processing pipelines with gNMI</span></h2>
<p><span class="koboSpan" id="kobo.688.1">To receive</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.689.1"> or collect the data from a gNMI-compliant</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.690.1"> network device, you could use the Go gNMI client implementation from the official gNMI repository (see </span><em class="italic"><span class="koboSpan" id="kobo.691.1">Further reading</span></em><span class="koboSpan" id="kobo.692.1">). </span><span class="koboSpan" id="kobo.692.2">Another alternative is gNMIc (see </span><em class="italic"><span class="koboSpan" id="kobo.693.1">Further reading</span></em><span class="koboSpan" id="kobo.694.1">), which builds on top of the official gNMI client and provides more capabilities, such as data transformation and wide support of northbound interfaces. </span></p>
<p><span class="koboSpan" id="kobo.695.1">gNMIc can serve</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.696.1"> as a link between a network device and a </span><strong class="bold"><span class="koboSpan" id="kobo.697.1">T</span></strong><strong class="bold"><span class="koboSpan" id="kobo.698.1">ime-Series Database</span></strong><span class="koboSpan" id="kobo.699.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.700.1">TSDB</span></strong><span class="koboSpan" id="kobo.701.1">) or a message queue, as it can transform the received telemetry data into a format popular open source projects, such as Prometheus, InfluxDB, NATS, and Kafka, can understand. </span><span class="koboSpan" id="kobo.701.2">You can run gNMIc as a command-line tool to interact with network devices or as a daemon, subscribing to telemetry data and publishing it into a message queue or </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">a database.</span></span></p>
<h2 id="_idParaDest-219"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.703.1">Event-manager sample program</span></h2>
<p><span class="koboSpan" id="kobo.704.1">Let’s examine </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.705.1">one example of a telemetry</span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.706.1"> processing pipeline via an implementation of a primitive event-manager application. </span><span class="koboSpan" id="kobo.706.2">The goal</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.707.1"> of this program is to react to an increased packet rate by temporarily enabling</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.708.1"> a backup interface to redistribute incoming traffic. </span><span class="koboSpan" id="kobo.708.2">The following diagram depicts the high-level architecture of the telemetry processing pipeline and includes the following </span><span class="No-Break"><span class="koboSpan" id="kobo.709.1">main components:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.710.1">A gNMIC process running as a daemon, collecting and processing network </span><span class="No-Break"><span class="koboSpan" id="kobo.711.1">telemetry data</span></span></li>
<li><span class="koboSpan" id="kobo.712.1">A TSDB (Prometheus) storing the collected </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">telemetry data</span></span></li>
<li><span class="koboSpan" id="kobo.714.1">AlertManager (see </span><em class="italic"><span class="koboSpan" id="kobo.715.1">Further reading</span></em><span class="koboSpan" id="kobo.716.1">) processing alerts received from Prometheus and triggering </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">external events</span></span></li>
<li><span class="koboSpan" id="kobo.718.1">A Go program that implements the event-manager </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">business logic:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer077">
<span class="koboSpan" id="kobo.720.1"><img alt="Figure 9.3 – The event-manager application" src="image/B16971_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.721.1">Figure 9.3 – The event-manager application</span></p>
<p><span class="koboSpan" id="kobo.722.1">You can spin up</span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.723.1"> these components</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.724.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">make gnmic-start</span></strong><span class="koboSpan" id="kobo.726.1"> from the root of this book’s GitHub repository (see </span><em class="italic"><span class="koboSpan" id="kobo.727.1">Further reading</span></em><span class="koboSpan" id="kobo.728.1">). </span><span class="koboSpan" id="kobo.728.2">This command starts the gNMIc daemon and brings up Prometheus, Grafana, and AlertManager using </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">docker-compose</span></strong><span class="koboSpan" id="kobo.730.1">. </span><span class="koboSpan" id="kobo.730.2">These applications now run alongside our test lab topology and interact with it over standard </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">network interfaces:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer078">
<span class="koboSpan" id="kobo.732.1"><img alt="Figure 9.4 – The event-manager topology" src="image/B16971_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.733.1">Figure 9.4 – The event-manager topology</span></p>
<p><span class="koboSpan" id="kobo.734.1">We configured these applications using a series of files located in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">topo</span></strong><span class="koboSpan" id="kobo.736.1">-</span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">full/workdir/</span></strong><span class="koboSpan" id="kobo.738.1"> (see </span><em class="italic"><span class="koboSpan" id="kobo.739.1">Further reading</span></em><span class="koboSpan" id="kobo.740.1">) directory of this book’s GitHub repository (see </span><em class="italic"><span class="koboSpan" id="kobo.741.1">Further reading</span></em><span class="koboSpan" id="kobo.742.1">). </span><span class="koboSpan" id="kobo.742.2">These files get mounted into their respective containers, as we define in the configuration files of either Containerlab (</span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">topo.yml</span></strong><span class="koboSpan" id="kobo.744.1"> – see </span><em class="italic"><span class="koboSpan" id="kobo.745.1">Further reading</span></em><span class="koboSpan" id="kobo.746.1">) or Docker Compose (</span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">docker-compose.yml</span></strong><span class="koboSpan" id="kobo.748.1"> – see </span><em class="italic"><span class="koboSpan" id="kobo.749.1">Further reading</span></em><span class="koboSpan" id="kobo.750.1">). </span><span class="koboSpan" id="kobo.750.2">Here’s a brief description of the role these applications play in </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">our setup:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.752.1">The gNMIc daemon</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.753.1"> process runs in </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">Host-3</span></strong><span class="koboSpan" id="kobo.755.1"> of the test</span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.756.1"> topology. </span><span class="koboSpan" id="kobo.756.2">It subscribes to telemetry data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">cvx</span></strong><span class="koboSpan" id="kobo.758.1"> device and exposes it as Prometheus-style metrics. </span><span class="koboSpan" id="kobo.758.2">We manage these settings in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">gnmic.yaml</span></strong><span class="koboSpan" id="kobo.760.1"> file that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">like this:</span></span><pre class="console"><span class="koboSpan" id="kobo.762.1">targets:</span></pre><pre class="console"><span class="koboSpan" id="kobo.763.1"> "clab-netgo-cvx:9339":</span></pre><pre class="console"><span class="koboSpan" id="kobo.764.1">    username: cumulus</span></pre><pre class="console"><span class="koboSpan" id="kobo.765.1">    password: cumulus</span></pre><pre class="console"><span class="koboSpan" id="kobo.766.1">subscriptions:</span></pre><pre class="console"><span class="koboSpan" id="kobo.767.1">  counters:</span></pre><pre class="console"><span class="koboSpan" id="kobo.768.1">    target: netq</span></pre><pre class="console"><span class="koboSpan" id="kobo.769.1">    paths:</span></pre><pre class="console"><span class="koboSpan" id="kobo.770.1">      - /interfaces</span></pre><pre class="console"><span class="koboSpan" id="kobo.771.1">    updates-only: true</span></pre><pre class="console"><span class="koboSpan" id="kobo.772.1">outputs:</span></pre><pre class="console"><span class="koboSpan" id="kobo.773.1">  prom-output:</span></pre><pre class="console"><span class="koboSpan" id="kobo.774.1">    type: prometheus</span></pre><pre class="console"><span class="koboSpan" id="kobo.775.1">    listen: </span><span class="Code_Red"><span class="koboSpan" id="kobo.776.1">":9313"</span></span></pre></li>
<li><span class="koboSpan" id="kobo.777.1">You can find the Prometheus configuration values in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.778.1">prometheus.yml</span></strong><span class="koboSpan" id="kobo.779.1"> file. </span><span class="koboSpan" id="kobo.779.2">We configure it to scrape the gNMIc endpoint every 2 seconds and store the collected data in </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">its TSDB:</span></span><pre class="console"><span class="koboSpan" id="kobo.781.1">scrape_configs:</span></pre><pre class="console"><span class="koboSpan" id="kobo.782.1">  - job_name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.783.1">'event-trigger'</span></span></pre><pre class="console"><span class="koboSpan" id="kobo.784.1">    scrape_interval: 2s</span></pre><pre class="console"><span class="koboSpan" id="kobo.785.1">    static_configs:</span></pre><pre class="console"><span class="koboSpan" id="kobo.786.1">      - targets: [</span><span class="Code_Red"><span class="koboSpan" id="kobo.787.1">'clab-netgo-host-3:9313'</span></span><span class="koboSpan" id="kobo.788.1">]</span></pre></li>
<li><span class="koboSpan" id="kobo.789.1">The same configuration</span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.790.1"> file includes</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.791.1"> a reference to the alert definition file, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">alert.rules</span></strong><span class="koboSpan" id="kobo.793.1">, and the connection details of </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1">the AlertManager:</span></span><pre class="console"><span class="koboSpan" id="kobo.795.1">rule_files:</span></pre><pre class="console"><span class="koboSpan" id="kobo.796.1">  - </span><span class="Code_Red"><span class="koboSpan" id="kobo.797.1">'alert.rules'</span></span></pre><pre class="console"><span class="koboSpan" id="kobo.798.1">alerting:</span></pre><pre class="console"><span class="koboSpan" id="kobo.799.1">  alertmanagers:</span></pre><pre class="console"><span class="koboSpan" id="kobo.800.1">  - scheme: http</span></pre><pre class="console"><span class="koboSpan" id="kobo.801.1">    static_configs:</span></pre><pre class="console"><span class="koboSpan" id="kobo.802.1">    - targets:</span></pre><pre class="console"><span class="koboSpan" id="kobo.803.1">      - </span><span class="Code_Red"><span class="koboSpan" id="kobo.804.1">"alertmanager:9093"</span></span></pre></li>
<li><span class="koboSpan" id="kobo.805.1">Inside of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">alert.rules</span></strong><span class="koboSpan" id="kobo.807.1"> file, we define a single alert we call </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">HighLinkUtilization</span></strong><span class="koboSpan" id="kobo.809.1">. </span><span class="koboSpan" id="kobo.809.2">Every 10 seconds, Prometheus checks whether the incoming packet rate has exceeded a predefined threshold of 50 packets per 30-second interval, in which case it fires an alert and sends it to </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">the AlertManager:</span></span><pre class="console"><span class="koboSpan" id="kobo.811.1">groups:</span></pre><pre class="console"><span class="koboSpan" id="kobo.812.1">- name: thebook</span></pre><pre class="console"><span class="koboSpan" id="kobo.813.1">  interval: 10s</span></pre><pre class="console"><span class="koboSpan" id="kobo.814.1">  rules:</span></pre><pre class="console"><span class="koboSpan" id="kobo.815.1">  - alert: HighLinkUtilization</span></pre><pre class="console"><span class="koboSpan" id="kobo.816.1">    expr: rate(interfaces_interface_state_counters_in_pkts[30s]) &gt; 50</span></pre><pre class="console"><span class="koboSpan" id="kobo.817.1">    for: 0m</span></pre><pre class="console"><span class="koboSpan" id="kobo.818.1">    labels:</span></pre><pre class="console"><span class="koboSpan" id="kobo.819.1">      severity: warning</span></pre><pre class="console"><span class="koboSpan" id="kobo.820.1">    annotations:</span></pre><pre class="console"><span class="koboSpan" id="kobo.821.1">      summary: Transit link {{ $labels.interface_name }} is under high load</span></pre><pre class="console"><span class="koboSpan" id="kobo.822.1">      description: </span><span class="Code_Red"><span class="koboSpan" id="kobo.823.1">"Transit link {{ $labels.interface_name }} is under high load LABELS = {{ $labels }}"</span></span></pre><pre class="console"><span class="koboSpan" id="kobo.824.1">      value: </span><span class="Code_Red"><span class="koboSpan" id="kobo.825.1">'{{ $value }}'</span></span></pre></li>
<li><span class="koboSpan" id="kobo.826.1">AlertManager has its</span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.827.1"> own configuration</span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.828.1"> file, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">alertmanager.yml</span></strong><span class="koboSpan" id="kobo.830.1">, that controls how to aggregate and route incoming alerts from Prometheus. </span><span class="koboSpan" id="kobo.830.2">In our case, we have a single alert type, so we only need one route. </span><span class="koboSpan" id="kobo.830.3">We decrease the default aggregation timers to enable faster reaction time and specify the webhook URL where to send </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">these alerts:</span></span><pre class="console"><span class="koboSpan" id="kobo.832.1">route:</span></pre><pre class="console"><span class="koboSpan" id="kobo.833.1">  receiver: </span><span class="Code_Red"><span class="koboSpan" id="kobo.834.1">'event-manager'</span></span></pre><pre class="console"><span class="koboSpan" id="kobo.835.1">  group_wait: 5s</span></pre><pre class="console"><span class="koboSpan" id="kobo.836.1">  group_interval: 10s</span></pre><pre class="console"><span class="koboSpan" id="kobo.837.1">receivers:</span></pre><pre class="console"><span class="koboSpan" id="kobo.838.1">  - name: </span><span class="Code_Red"><span class="koboSpan" id="kobo.839.1">'event-manager'</span></span></pre><pre class="console"><span class="koboSpan" id="kobo.840.1">    webhook_configs:</span></pre><pre class="console"><span class="koboSpan" id="kobo.841.1">    - url: http://clab-netgo-host-2:10000/alert</span></pre></li>
<li><span class="koboSpan" id="kobo.842.1">event-manager parses the alert and toggles a backup interface to re-balance the traffic coming into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.843.1">cvx</span></strong><span class="koboSpan" id="kobo.844.1"> device. </span><span class="koboSpan" id="kobo.844.2">Its behavior is fairly static, so we don’t need a configuration file </span><span class="No-Break"><span class="koboSpan" id="kobo.845.1">for it.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.846.1">The event-manager program</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.847.1"> implements a standard</span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.848.1"> web server that listens to incoming requests and dispatches them to a handler function. </span><span class="koboSpan" id="kobo.848.2">Here, we decode the received Prometheus alert and invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">toggleBackup</span></strong><span class="koboSpan" id="kobo.850.1"> function based on </span><span class="No-Break"><span class="koboSpan" id="kobo.851.1">its status:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.852.1">func</span></span><span class="koboSpan" id="kobo.853.1"> alertHandler(w http.ResponseWriter, req </span><span class="Code_Red"><span class="koboSpan" id="kobo.854.1">*</span></span><span class="koboSpan" id="kobo.855.1">http.Request) {
  log.Println(</span><span class="Code_Red"><span class="koboSpan" id="kobo.856.1">"Incoming alert"</span></span><span class="koboSpan" id="kobo.857.1">)
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.858.1">var</span></span><span class="koboSpan" id="kobo.859.1"> alerts Alerts
  err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.860.1">=</span></span><span class="koboSpan" id="kobo.861.1"> json.NewDecoder(req.Body).Decode(</span><span class="Code_Red"><span class="koboSpan" id="kobo.862.1">&amp;</span></span><span class="koboSpan" id="kobo.863.1">alerts)
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.864.1">// process error</span></span><span class="koboSpan" id="kobo.865.1">
 
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.866.1">for</span></span><span class="koboSpan" id="kobo.867.1"> _, alert :</span><span class="Code_Red"><span class="koboSpan" id="kobo.868.1">=</span></span> <span class="Code_Purple"><span class="koboSpan" id="kobo.869.1">range</span></span><span class="koboSpan" id="kobo.870.1"> alerts.Alerts {
    </span><span class="Code_Purple"><span class="koboSpan" id="kobo.871.1">if</span></span><span class="koboSpan" id="kobo.872.1"> alert.Status </span><span class="Code_Red"><span class="koboSpan" id="kobo.873.1">== "firing"</span></span><span class="koboSpan" id="kobo.874.1"> {
      </span><span class="Code_Purple"><span class="koboSpan" id="kobo.875.1">if</span></span><span class="koboSpan" id="kobo.876.1"> err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.877.1">=</span></span><span class="koboSpan" id="kobo.878.1"> toggleBackup(alert.Labels.InterfaceName, </span><span class="Code_Red"><span class="koboSpan" id="kobo.879.1">"permit"</span></span><span class="koboSpan" id="kobo.880.1">); err != </span><span class="Code_Blue"><span class="koboSpan" id="kobo.881.1">nil</span></span><span class="koboSpan" id="kobo.882.1"> {
        w.WriteHeader(http.StatusInternalServerError)
        </span><span class="Code_Purple"><span class="koboSpan" id="kobo.883.1">return</span></span><span class="koboSpan" id="kobo.884.1">
      }
      continue
    }
 
    </span><span class="Code_Purple"><span class="koboSpan" id="kobo.885.1">if</span></span><span class="koboSpan" id="kobo.886.1"> err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.887.1">=</span></span><span class="koboSpan" id="kobo.888.1"> toggleBackup(alert.Labels.InterfaceName, </span><span class="Code_Red"><span class="koboSpan" id="kobo.889.1">"deny"</span></span><span class="koboSpan" id="kobo.890.1">); err != </span><span class="Code_Blue"><span class="koboSpan" id="kobo.891.1">nil</span></span><span class="koboSpan" id="kobo.892.1"> {
      w.WriteHeader(http.StatusInternalServerError)
      </span><span class="Code_Purple"><span class="koboSpan" id="kobo.893.1">return</span></span><span class="koboSpan" id="kobo.894.1">
    }
  }
  w.WriteHeader(http.StatusOK)
}</span></pre>
<p><span class="koboSpan" id="kobo.895.1">We have two </span><em class="italic"><span class="koboSpan" id="kobo.896.1">uplinks</span></em><span class="koboSpan" id="kobo.897.1"> between</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.898.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">cvx</span></strong><span class="koboSpan" id="kobo.900.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.901.1">ceos</span></strong><span class="koboSpan" id="kobo.902.1"> devices, and we only use one of them by default. </span><span class="koboSpan" id="kobo.902.2">The backup</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.903.1"> uplink does BGP ASN prepending and only receives traffic when we announce more specific or disaggregated prefixes. </span><span class="koboSpan" id="kobo.903.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">toggleBackup</span></strong><span class="koboSpan" id="kobo.905.1"> function does this by toggling a permit/deny statement on an IP prefix list (on </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">cvx</span></strong><span class="koboSpan" id="kobo.907.1">), thereby enabling or disabling the BGP </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">disaggregation behavior:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.909.1">var</span></span><span class="koboSpan" id="kobo.910.1"> (
  backupRules = </span><span class="Code_Purple"><span class="koboSpan" id="kobo.911.1">map</span></span><span class="koboSpan" id="kobo.912.1">[</span><span class="Code_Purple"><span class="koboSpan" id="kobo.913.1">string</span></span><span class="koboSpan" id="kobo.914.1">][]</span><span class="Code_Purple"><span class="koboSpan" id="kobo.915.1">int</span></span><span class="koboSpan" id="kobo.916.1">{
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.917.1">"swp1":</span></span><span class="koboSpan" id="kobo.918.1"> {</span><span class="Code_Green"><span class="koboSpan" id="kobo.919.1">10</span></span><span class="koboSpan" id="kobo.920.1">, </span><span class="Code_Green"><span class="koboSpan" id="kobo.921.1">20</span></span><span class="koboSpan" id="kobo.922.1">},
  }
)
 
</span><span class="Code_Purple"><span class="koboSpan" id="kobo.923.1">func</span></span><span class="koboSpan" id="kobo.924.1"> toggleBackup(intf </span><span class="Code_Purple"><span class="koboSpan" id="kobo.925.1">string</span></span><span class="koboSpan" id="kobo.926.1">, action </span><span class="Code_Purple"><span class="koboSpan" id="kobo.927.1">string</span></span><span class="koboSpan" id="kobo.928.1">) </span><span class="Code_Purple"><span class="koboSpan" id="kobo.929.1">error</span></span><span class="koboSpan" id="kobo.930.1"> {
  log.Printf(</span><span class="Code_Red"><span class="koboSpan" id="kobo.931.1">"%s needs to %s backup prefixes"</span></span><span class="koboSpan" id="kobo.932.1">,
              intf, action)
  ruleIDs, ok :</span><span class="Code_Red"><span class="koboSpan" id="kobo.933.1">=</span></span><span class="koboSpan" id="kobo.934.1"> backupRules[intf]
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.935.1">// process error</span></span><span class="koboSpan" id="kobo.936.1">
 
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.937.1">var</span></span><span class="koboSpan" id="kobo.938.1"> pl PrefixList
  pl.Rules = </span><span class="Code_Blue"><span class="koboSpan" id="kobo.939.1">make</span></span><span class="koboSpan" id="kobo.940.1">(</span><span class="Code_Purple"><span class="koboSpan" id="kobo.941.1">map</span></span><span class="koboSpan" id="kobo.942.1">[</span><span class="Code_Purple"><span class="koboSpan" id="kobo.943.1">string</span></span><span class="koboSpan" id="kobo.944.1">]Rule)
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.945.1">for</span></span><span class="koboSpan" id="kobo.946.1"> _, ruleID :</span><span class="Code_Red"><span class="koboSpan" id="kobo.947.1">=</span></span> <span class="Code_Purple"><span class="koboSpan" id="kobo.948.1">range</span></span><span class="koboSpan" id="kobo.949.1"> ruleIDs {
    pl.Rules[strconv.Itoa(ruleID)] </span><span class="Code_Red"><span class="koboSpan" id="kobo.950.1">=</span></span><span class="koboSpan" id="kobo.951.1"> Rule{
      Action: action,
    }
  }
 
 
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.952.1">var</span></span><span class="koboSpan" id="kobo.953.1"> payload nvue
  payload.Router.Policy.PrefixLists </span><span class="Code_Red"><span class="koboSpan" id="kobo.954.1">=</span></span> <span class="Code_Purple"><span class="koboSpan" id="kobo.955.1">map</span></span><span class="koboSpan" id="kobo.956.1">[</span><span class="Code_Purple"><span class="koboSpan" id="kobo.957.1">string</span></span><span class="koboSpan" id="kobo.958.1">]PrefixList{
    plName: pl,
  }
 
  b, err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.959.1">=</span></span><span class="koboSpan" id="kobo.960.1"> json.Marshal(payload)
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.961.1">// process error</span></span><span class="koboSpan" id="kobo.962.1">
 
  </span><span class="Code_Purple"><span class="koboSpan" id="kobo.963.1">return</span></span><span class="koboSpan" id="kobo.964.1"> sendBytes(b)
}</span></pre>
<p><span class="koboSpan" id="kobo.965.1">The final </span><strong class="source-inline"><span class="koboSpan" id="kobo.966.1">sendBytes</span></strong><span class="koboSpan" id="kobo.967.1"> function applies</span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.968.1"> the constructed configuration</span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.969.1"> using the three-stage commit process we discussed in </span><a href="B16971_06.xhtml#_idTextAnchor144"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.970.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.971.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.972.1">Configuration Management</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">.</span></span></p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.974.1">Visualizing the data</span></h2>
<p><span class="koboSpan" id="kobo.975.1">You can connect</span><a id="_idIndexMarker863"/><span class="koboSpan" id="kobo.976.1"> to the local instance of Grafana running at </span><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">:3000</span></strong><span class="koboSpan" id="kobo.978.1"> using </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">admin</span></strong><span class="koboSpan" id="kobo.980.1"> as the</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.981.1"> username/password to test the complete telemetry-driven pipeline in action. </span><span class="koboSpan" id="kobo.981.2">This Grafana instance comes up pre-integrated with Prometheus as its data source, and it includes a pre-built </span><strong class="source-inline"><span class="koboSpan" id="kobo.982.1">event-manager</span></strong><span class="koboSpan" id="kobo.983.1"> dashboard that plots the incoming packet rate for both </span><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">cvx</span></strong><span class="koboSpan" id="kobo.985.1"> links to </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">ceos</span></strong><span class="koboSpan" id="kobo.987.1">. </span></p>
<p><span class="koboSpan" id="kobo.988.1">Run </span><strong class="source-inline"><span class="koboSpan" id="kobo.989.1">make traffic-start</span></strong><span class="koboSpan" id="kobo.990.1"> from the root of this book’s GitHub repository (see </span><em class="italic"><span class="koboSpan" id="kobo.991.1">Further reading</span></em><span class="koboSpan" id="kobo.992.1">) to generate traffic in the lab topology. </span><span class="koboSpan" id="kobo.992.2">All traffic should initially flow over the primary connection between </span><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">cvx</span></strong><span class="koboSpan" id="kobo.994.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">ceos</span></strong><span class="koboSpan" id="kobo.996.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.997.1">swp1</span></strong><span class="koboSpan" id="kobo.998.1">). </span></p>
<p><span class="koboSpan" id="kobo.999.1">Next, we want to start the event-manager application so that we can load-balance traffic across both connections. </span><span class="koboSpan" id="kobo.999.2">To do this, run the event-manager Go application inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">host-2</span></strong><span class="koboSpan" id="kobo.1001.1"> container. </span><span class="koboSpan" id="kobo.1001.2">This translates to the command that we execute in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1">following snippet:</span></span></p>
<pre class="source-code"><span class="Code_Blue"><span class="koboSpan" id="kobo.1003.1">$ sudo </span></span><span class="koboSpan" id="kobo.1004.1">ip netns exec clab-netgo-host-2 /usr/local/go/bin/go run ch09/event-manager/main.go
AlertManager event-triggered webhook
2022/08/01 21:51:13 Starting web server at 0.0.0.0:10000</span></pre>
<p><span class="koboSpan" id="kobo.1005.1">Open a new terminal window or tab and run </span><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1">make traffic-start</span></strong><span class="koboSpan" id="kobo.1007.1"> again, but increase the traffic generation period from the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.1008.1">60s</span></strong><span class="koboSpan" id="kobo.1009.1"> using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">DURATION</span></strong><span class="koboSpan" id="kobo.1011.1"> variable. </span><span class="koboSpan" id="kobo.1011.2">For example, the following command would generate traffic for </span><span class="No-Break"><span class="koboSpan" id="kobo.1012.1">2 minutes:</span></span></p>
<pre class="source-code"><span class="Code_Blue"><span class="koboSpan" id="kobo.1013.1">$ DURATION</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1014.1">=</span></span><span class="koboSpan" id="kobo.1015.1">2m make traffic-start</span></pre>
<p><span class="koboSpan" id="kobo.1016.1">This can help you see the longer-term effect of traffic re-balancing. </span><span class="koboSpan" id="kobo.1016.2">Logs should show that the traffic rate has triggered an alert and the application implemented </span><span class="No-Break"><span class="koboSpan" id="kobo.1017.1">corrective actions:</span></span></p>
<pre class="source-code"><span class="Code_Red"><span class="koboSpan" id="kobo.1018.1">$</span></span><span class="koboSpan" id="kobo.1019.1"> sudo ip netns </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1020.1">exec </span></span><span class="koboSpan" id="kobo.1021.1">clab-netgo-host-2 </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1022.1">/</span></span><span class="koboSpan" id="kobo.1023.1">usr</span><span class="Code_Brown"><span class="koboSpan" id="kobo.1024.1">/</span></span><span class="koboSpan" id="kobo.1025.1">local</span><span class="Code_Brown"><span class="koboSpan" id="kobo.1026.1">/</span></span><span class="koboSpan" id="kobo.1027.1">go</span><span class="Code_Brown"><span class="koboSpan" id="kobo.1028.1">/</span></span><span class="Code_Blue"><span class="koboSpan" id="kobo.1029.1">bin</span></span><span class="Code_Brown"><span class="koboSpan" id="kobo.1030.1">/</span></span><span class="koboSpan" id="kobo.1031.1">go run ch09</span><span class="Code_Brown"><span class="koboSpan" id="kobo.1032.1">/</span></span><span class="koboSpan" id="kobo.1033.1">event-manager</span><span class="Code_Brown"><span class="koboSpan" id="kobo.1034.1">/</span></span><span class="koboSpan" id="kobo.1035.1">main.go
AlertManager event-triggered webhook
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1036.1">2022</span></span><span class="koboSpan" id="kobo.1037.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1038.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1039.1">8</span></span><span class="koboSpan" id="kobo.1040.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1041.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1042.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1043.1">21:51:13 </span></span><span class="koboSpan" id="kobo.1044.1">Starting web server at </span><span class="Code_Green"><span class="koboSpan" id="kobo.1045.1">0.0.0.0:10000</span></span><span class="koboSpan" id="kobo.1046.1">
ch09/event-manager/main.go
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1047.1">2022</span></span><span class="koboSpan" id="kobo.1048.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1049.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1050.1">8</span></span><span class="koboSpan" id="kobo.1051.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1052.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1053.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1054.1">21:53:10 </span></span><span class="koboSpan" id="kobo.1055.1">Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1056.1">2022</span></span><span class="koboSpan" id="kobo.1057.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1058.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1059.1">8</span></span><span class="koboSpan" id="kobo.1060.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1061.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1062.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1063.1">21:53:10 </span></span><span class="koboSpan" id="kobo.1064.1">swp1 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1065.1">2022</span></span><span class="koboSpan" id="kobo.1066.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1067.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1068.1">8</span></span><span class="koboSpan" id="kobo.1069.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1070.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1071.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1072.1">21:53:10 </span></span><span class="koboSpan" id="kobo.1073.1">Created revisionID: changeset/cumulus/</span><span class="Code_Green"><span class="koboSpan" id="kobo.1074.1">2022</span></span><span class="koboSpan" id="kobo.1075.1">-0</span><span class="Code_Green"><span class="koboSpan" id="kobo.1076.1">8</span></span><span class="koboSpan" id="kobo.1077.1">-</span><span class="Code_Green"><span class="koboSpan" id="kobo.1078.1">01_21.53.10</span></span><span class="koboSpan" id="kobo.1079.1">_ASP0
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1080.1">"state"</span></span><span class="koboSpan" id="kobo.1081.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1082.1">"apply"</span></span><span class="koboSpan" id="kobo.1083.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1084.1">"transition"</span></span><span class="koboSpan" id="kobo.1085.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1086.1">"issue"</span></span><span class="koboSpan" id="kobo.1087.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1088.1">"progress"</span></span><span class="koboSpan" id="kobo.1089.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1090.1">""</span></span><span class="koboSpan" id="kobo.1091.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1092.1">2022</span></span><span class="koboSpan" id="kobo.1093.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1094.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1095.1">8</span></span><span class="koboSpan" id="kobo.1096.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1097.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1098.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1099.1">21:54:</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1100.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1101.1">0</span></span><span class="koboSpan" id="kobo.1102.1"> Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1103.1">2022</span></span><span class="koboSpan" id="kobo.1104.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1105.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1106.1">8</span></span><span class="koboSpan" id="kobo.1107.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1108.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1109.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1110.1">21:54:</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1111.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1112.1">0</span></span><span class="koboSpan" id="kobo.1113.1"> swp1 needs to deny backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1114.1">2022</span></span><span class="koboSpan" id="kobo.1115.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1116.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1117.1">8</span></span><span class="koboSpan" id="kobo.1118.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1119.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1120.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1121.1">21:54:</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1122.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1123.1">0</span></span><span class="koboSpan" id="kobo.1124.1"> Created revisionID: changeset/cumulus/</span><span class="Code_Green"><span class="koboSpan" id="kobo.1125.1">2022</span></span><span class="koboSpan" id="kobo.1126.1">-</span><span class="Code_Red"><span class="koboSpan" id="kobo.1127.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1128.1">8</span></span><span class="koboSpan" id="kobo.1129.1">-</span><span class="Code_Green"><span class="koboSpan" id="kobo.1130.1">01_21.54.00</span></span><span class="koboSpan" id="kobo.1131.1">_ASP2
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1132.1">"state"</span></span><span class="koboSpan" id="kobo.1133.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1134.1">"apply"</span></span><span class="koboSpan" id="kobo.1135.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1136.1">"transition"</span></span><span class="koboSpan" id="kobo.1137.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1138.1">"issue"</span></span><span class="koboSpan" id="kobo.1139.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1140.1">"progress"</span></span><span class="koboSpan" id="kobo.1141.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1142.1">""</span></span><span class="koboSpan" id="kobo.1143.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1144.1">2022</span></span><span class="koboSpan" id="kobo.1145.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1146.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1147.1">8</span></span><span class="koboSpan" id="kobo.1148.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1149.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1150.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1151.1">21:54:</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1152.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1153.1">0</span></span><span class="koboSpan" id="kobo.1154.1"> swp2 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1155.1">2022</span></span><span class="koboSpan" id="kobo.1156.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1157.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1158.1">8</span></span><span class="koboSpan" id="kobo.1159.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1160.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1161.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1162.1">21:54:</span></span><span class="Code_Red"><span class="koboSpan" id="kobo.1163.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1164.1">0</span></span><span class="koboSpan" id="kobo.1165.1"> Could </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1166.1">not </span></span><span class="koboSpan" id="kobo.1167.1">find a backup prefix </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1168.1">for </span></span><span class="koboSpan" id="kobo.1169.1">swp2
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1170.1">2022</span></span><span class="koboSpan" id="kobo.1171.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1172.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1173.1">8</span></span><span class="koboSpan" id="kobo.1174.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1175.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1176.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1177.1">21:54:20 </span></span><span class="koboSpan" id="kobo.1178.1">Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1179.1">2022</span></span><span class="koboSpan" id="kobo.1180.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1181.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1182.1">8</span></span><span class="koboSpan" id="kobo.1183.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1184.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1185.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1186.1">21:54:20 </span></span><span class="koboSpan" id="kobo.1187.1">swp2 needs to deny backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1188.1">2022</span></span><span class="koboSpan" id="kobo.1189.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1190.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1191.1">8</span></span><span class="koboSpan" id="kobo.1192.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1193.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1194.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1195.1">21:54:20 </span></span><span class="koboSpan" id="kobo.1196.1">Could </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1197.1">not </span></span><span class="koboSpan" id="kobo.1198.1">find a backup prefix </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1199.1">for </span></span><span class="koboSpan" id="kobo.1200.1">swp2
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1201.1">2022</span></span><span class="koboSpan" id="kobo.1202.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1203.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1204.1">8</span></span><span class="koboSpan" id="kobo.1205.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1206.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1207.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1208.1">21:54:30 </span></span><span class="koboSpan" id="kobo.1209.1">Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1210.1">2022</span></span><span class="koboSpan" id="kobo.1211.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1212.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1213.1">8</span></span><span class="koboSpan" id="kobo.1214.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1215.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1216.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1217.1">21:54:30 </span></span><span class="koboSpan" id="kobo.1218.1">swp1 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1219.1">2022</span></span><span class="koboSpan" id="kobo.1220.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1221.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1222.1">8</span></span><span class="koboSpan" id="kobo.1223.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1224.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1225.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1226.1">21:54:30 </span></span><span class="koboSpan" id="kobo.1227.1">Created revisionID: changeset/cumulus/</span><span class="Code_Green"><span class="koboSpan" id="kobo.1228.1">2022</span></span><span class="koboSpan" id="kobo.1229.1">-</span><span class="Code_Red"><span class="koboSpan" id="kobo.1230.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1231.1">8</span></span><span class="koboSpan" id="kobo.1232.1">-</span><span class="Code_Green"><span class="koboSpan" id="kobo.1233.1">01_21.54.30</span></span><span class="koboSpan" id="kobo.1234.1">_ASP4
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1235.1">"state"</span></span><span class="koboSpan" id="kobo.1236.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1237.1">"apply"</span></span><span class="koboSpan" id="kobo.1238.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1239.1">"transition"</span></span><span class="koboSpan" id="kobo.1240.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1241.1">"issue"</span></span><span class="koboSpan" id="kobo.1242.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1243.1">"progress"</span></span><span class="koboSpan" id="kobo.1244.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1245.1">""</span></span><span class="koboSpan" id="kobo.1246.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1247.1">2022</span></span><span class="koboSpan" id="kobo.1248.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1249.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1250.1">8</span></span><span class="koboSpan" id="kobo.1251.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1252.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1253.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1254.1">21:55:20 </span></span><span class="koboSpan" id="kobo.1255.1">Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1256.1">2022</span></span><span class="koboSpan" id="kobo.1257.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1258.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1259.1">8</span></span><span class="koboSpan" id="kobo.1260.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1261.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1262.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1263.1">21:55:20 </span></span><span class="koboSpan" id="kobo.1264.1">swp1 needs to deny backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1265.1">2022</span></span><span class="koboSpan" id="kobo.1266.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1267.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1268.1">8</span></span><span class="koboSpan" id="kobo.1269.1">/</span><span class="Code_Red"><span class="koboSpan" id="kobo.1270.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1271.1">1</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1272.1">21:55:20 </span></span><span class="koboSpan" id="kobo.1273.1">Created revisionID: changeset/cumulus/</span><span class="Code_Green"><span class="koboSpan" id="kobo.1274.1">2022</span></span><span class="koboSpan" id="kobo.1275.1">-</span><span class="Code_Red"><span class="koboSpan" id="kobo.1276.1">0</span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1277.1">8</span></span><span class="koboSpan" id="kobo.1278.1">-</span><span class="Code_Green"><span class="koboSpan" id="kobo.1279.1">01_21.55.20</span></span><span class="koboSpan" id="kobo.1280.1">_ASP6
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1281.1">"state"</span></span><span class="koboSpan" id="kobo.1282.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1283.1">"apply"</span></span><span class="koboSpan" id="kobo.1284.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1285.1">"transition"</span></span><span class="koboSpan" id="kobo.1286.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1287.1">"issue"</span></span><span class="koboSpan" id="kobo.1288.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1289.1">"progress"</span></span><span class="koboSpan" id="kobo.1290.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1291.1">""</span></span><span class="koboSpan" id="kobo.1292.1">
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1293.1">All three</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.1294.1"> of the tests</span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.1295.1"> we performed should get you a </span><span class="No-Break"><span class="koboSpan" id="kobo.1296.1">similar-looking graph:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer079">
<span class="koboSpan" id="kobo.1297.1"><img alt="Figure 9.5 – Event-manager visualization" src="image/B16971_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1298.1">Figure 9.5 – Event-manager visualization</span></p>
<p><span class="koboSpan" id="kobo.1299.1">Streaming telemetry is a powerful capability that you can adapt to a wide variety of business use cases. </span><span class="koboSpan" id="kobo.1299.2">However, most of these use cases are specific to the operating network environment, so it’s hard to come up with a set of </span><em class="italic"><span class="koboSpan" id="kobo.1300.1">killer applications</span></em><span class="koboSpan" id="kobo.1301.1"> that would apply to every network. </span><span class="koboSpan" id="kobo.1301.2">Hence, it’s important to know how to implement the required business logic in code, which is what we have tried to show you in this chapter. </span></p>
<p><span class="koboSpan" id="kobo.1302.1">In the following section, we cover</span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.1303.1"> another OpenConfig gRPC service</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.1304.1"> you can use to automate </span><span class="No-Break"><span class="koboSpan" id="kobo.1305.1">operational tasks.</span></span></p>
<h1 id="_idParaDest-221"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.1306.1">Network operations</span></h1>
<p><span class="koboSpan" id="kobo.1307.1">In the preceding sections, we explored </span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.1308.1">how the OpenConfig management</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.1309.1"> interface approaches two common network automation use cases: configuration management and operational state collection. </span><span class="koboSpan" id="kobo.1309.2">These two tasks alone can get you a long way in your network automation journey, but there is a set of common operational tasks that don’t fall into either of </span><span class="No-Break"><span class="koboSpan" id="kobo.1310.1">these categories.</span></span></p>
<p><span class="koboSpan" id="kobo.1311.1">To automate all aspects</span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.1312.1"> of network operations, we need to perform tasks such as network device reloads, software life cycle management, and counter and adjacency resets. </span><span class="koboSpan" id="kobo.1312.2">You normally execute these activities as part of interactive CLI workflows, with prompts and warnings that assume a human operator is involved in the process. </span><span class="koboSpan" id="kobo.1312.3">This makes the automation of these tasks a major undertaking, as we have to resort to screen-scraping, which increases the already high risk of </span><span class="No-Break"><span class="koboSpan" id="kobo.1313.1">these tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.1314.1">To address these challenges, OpenConfig proposed a new gRPC API, designed to abstract away the interactive commands and surface these network operations capabilities in a standard, </span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1">vendor-neutral way.</span></span></p>
<h3><span class="koboSpan" id="kobo.1316.1">gNOI</span></h3>
<p><span class="koboSpan" id="kobo.1317.1">gNOI defines</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.1318.1"> a list of gRPC services that address a wide range</span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.1319.1"> of network operations use cases. </span><span class="koboSpan" id="kobo.1319.2">Each service represents one operational process with a set of actions, and the following table includes a few examples to give you an idea of the challenges gNOI attempts </span><span class="No-Break"><span class="koboSpan" id="kobo.1320.1">to solve:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1321.1">Service</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1322.1">Description</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1323.1">RPC examples</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1324.1">OS</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1325.1">NOS </span><span class="No-Break"><span class="koboSpan" id="kobo.1326.1">package management</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1327.1">Install, Activate, </span><span class="No-Break"><span class="koboSpan" id="kobo.1328.1">and Verify</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1329.1">File</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1330.1">File operations</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1331.1">Get, Transfer, Put, </span><span class="No-Break"><span class="koboSpan" id="kobo.1332.1">and Remove</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1333.1">L2</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1334.1">L2 </span><span class="No-Break"><span class="koboSpan" id="kobo.1335.1">protocols operations</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1336.1">ClearNeighborDiscovery </span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1">and ClearLLDPInterface</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1338.1">Cert</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1339.1">Certificate management</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1340.1">Rotate, Install, GenerateCSR, </span><span class="No-Break"><span class="koboSpan" id="kobo.1341.1">and RevokeCertificates</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1342.1">System</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.1343.1">System operations</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1344.1">Ping, Traceroute, Reboot, </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1">and Time</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1346.1">Table 9.1 – gNOI use case examples</span></p>
<p><span class="koboSpan" id="kobo.1347.1">Some RPCs are a one-shot with immediate response, some stream responses synchronously until complete or canceled, and some </span><span class="No-Break"><span class="koboSpan" id="kobo.1348.1">work asynchronously.</span></span></p>
<p><span class="koboSpan" id="kobo.1349.1">The gNOI GitHub</span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.1350.1"> repository (see </span><em class="italic"><span class="koboSpan" id="kobo.1351.1">Further reading</span></em><span class="koboSpan" id="kobo.1352.1">) protobuf files</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.1353.1"> have the most recent list of actions for each service. </span><span class="koboSpan" id="kobo.1353.2">At the time of writing, this is the top-level definition of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1354.1">system.proto</span></strong><span class="koboSpan" id="kobo.1355.1"> file (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1356.1">Further reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1357.1">):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1358.1">service System {
     rpc Ping(PingRequest) returns (stream PingResponse) {}
     rpc Traceroute(TracerouteRequest) returns (stream TracerouteResponse) {}
     rpc Time(TimeRequest) returns (TimeResponse) {}
     rpc SetPackage(stream SetPackageRequest) returns (SetPackageResponse) {}
     rpc SwitchControlProcessor(SwitchControlProcessorRequest)
       returns (SwitchControlProcessorResponse) {}
     rpc Reboot(RebootRequest) returns (RebootResponse) {}
     rpc RebootStatus(RebootStatusRequest) returns (RebootStatusResponse) {}
     rpc CancelReboot(CancelRebootRequest) returns (CancelRebootResponse) {}
     rpc KillProcess(KillProcessRequest) returns (KillProcessResponse) {}
}</span></pre>
<p><span class="koboSpan" id="kobo.1359.1">We don’t cover all gNOI RPCs in this book. </span><span class="koboSpan" id="kobo.1359.2">Instead, we focus on just one and include an example program built </span><span class="No-Break"><span class="koboSpan" id="kobo.1360.1">around it.</span></span></p>
<h2 id="_idParaDest-222"><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.1361.1">Traceroute RPC</span></h2>
<p><span class="koboSpan" id="kobo.1362.1">Most, if not all, network</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.1363.1"> engineers are familiar</span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.1364.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1365.1">traceroute</span></strong><span class="koboSpan" id="kobo.1366.1"> command. </span><span class="koboSpan" id="kobo.1366.2">This is a common way to explore the forwarding path between a pair of network</span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.1367.1"> endpoints. </span><span class="koboSpan" id="kobo.1367.2">When you run </span><strong class="source-inline"><span class="koboSpan" id="kobo.1368.1">traceroute</span></strong><span class="koboSpan" id="kobo.1369.1"> from a network device’s interactive</span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.1370.1"> shell, the terminal prints the result on your screen. </span><span class="koboSpan" id="kobo.1370.2">With gNOI, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1371.1">traceroute</span></strong><span class="koboSpan" id="kobo.1372.1"> is an action we request via an RPC with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1373.1">TracerouteRequest</span></strong><span class="koboSpan" id="kobo.1374.1"> message in the payload, and the result is a stream (one or many) of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1375.1">TracerouteResponse</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1376.1"> messages:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1377.1">service System {
     rpc Traceroute(TracerouteRequest) returns (stream TracerouteResponse) {}</span></pre>
<p><span class="koboSpan" id="kobo.1378.1">As with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">traceroute</span></strong><span class="koboSpan" id="kobo.1380.1"> command-line arguments and flags, the request message lets you specify options such as source address, the maximum number of hops, and whether to perform reverse </span><span class="No-Break"><span class="koboSpan" id="kobo.1381.1">DNS lookups:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.1382.1">message </span></span><span class="koboSpan" id="kobo.1383.1">TracerouteRequest {
     string source </span><span class="Code_Red"><span class="koboSpan" id="kobo.1384.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1385.1">1</span></span><span class="koboSpan" id="kobo.1386.1">;      </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1387.1">// Source addr to ping from.</span></span><span class="koboSpan" id="kobo.1388.1">
     String destination </span><span class="Code_Red"><span class="koboSpan" id="kobo.1389.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1390.1">2</span></span><span class="koboSpan" id="kobo.1391.1">; </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1392.1">// Destination addr to ping.</span></span><span class="koboSpan" id="kobo.1393.1">
     Uint32 initial_ttl </span><span class="Code_Red"><span class="koboSpan" id="kobo.1394.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1395.1">3</span></span><span class="koboSpan" id="kobo.1396.1">; </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1397.1">// Initial TTL. </span><span class="koboSpan" id="kobo.1397.2">(default=1)</span></span><span class="koboSpan" id="kobo.1398.1">
     int32 max_ttl </span><span class="Code_Red"><span class="koboSpan" id="kobo.1399.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1400.1">4</span></span><span class="koboSpan" id="kobo.1401.1">;      </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1402.1">// Maximum number of hops.</span></span><span class="koboSpan" id="kobo.1403.1"> 
     Int64 wait </span><span class="Code_Red"><span class="koboSpan" id="kobo.1404.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1405.1">5</span></span><span class="koboSpan" id="kobo.1406.1">;         </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1407.1">// Response wait-time (ns).</span></span><span class="koboSpan" id="kobo.1408.1">
     Bool do_not_fragment </span><span class="Code_Red"><span class="koboSpan" id="kobo.1409.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1410.1">6</span></span><span class="koboSpan" id="kobo.1411.1">;  
     bool do_not_resolve </span><span class="Code_Red"><span class="koboSpan" id="kobo.1412.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1413.1">7</span></span><span class="koboSpan" id="kobo.1414.1">;
     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1415.1">/* ... </span><span class="koboSpan" id="kobo.1415.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.1415.3">*/</span></span><span class="koboSpan" id="kobo.1416.1">
}</span></pre>
<p><span class="koboSpan" id="kobo.1417.1">Each response message includes the results of a single measurement cycle, including the hop count, the round-trip time, and the responding address extracted from a </span><span class="No-Break"><span class="koboSpan" id="kobo.1418.1">probe reply:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.1419.1">message </span></span><span class="koboSpan" id="kobo.1420.1">TracerouteResponse {
     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1421.1">/* ... </span><span class="koboSpan" id="kobo.1421.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.1421.3">*/</span></span><span class="koboSpan" id="kobo.1422.1">
     int32 hop </span><span class="Code_Red"><span class="koboSpan" id="kobo.1423.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1424.1">5</span></span><span class="koboSpan" id="kobo.1425.1">;          </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1426.1">// Hop number. </span><span class="koboSpan" id="kobo.1426.2">required.</span></span><span class="koboSpan" id="kobo.1427.1">
     string address </span><span class="Code_Red"><span class="koboSpan" id="kobo.1428.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1429.1">6</span></span><span class="koboSpan" id="kobo.1430.1">;     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1431.1">// Address of responding hop.</span></span><span class="koboSpan" id="kobo.1432.1"> 
     string name </span><span class="Code_Red"><span class="koboSpan" id="kobo.1433.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1434.1">7</span></span><span class="koboSpan" id="kobo.1435.1">;        </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1436.1">// Name of responding hop.</span></span><span class="koboSpan" id="kobo.1437.1">
     int64 rtt </span><span class="Code_Red"><span class="koboSpan" id="kobo.1438.1">=</span></span> <span class="Code_Green"><span class="koboSpan" id="kobo.1439.1">8</span></span><span class="koboSpan" id="kobo.1440.1">;          </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1441.1">// Round trip time in nanoseconds.</span></span><span class="koboSpan" id="kobo.1442.1">
     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1443.1">/* ... </span><span class="koboSpan" id="kobo.1443.2">&lt;omitted for brevity &gt; ... </span><span class="koboSpan" id="kobo.1443.3">*/</span></span><span class="koboSpan" id="kobo.1444.1">
}</span></pre>
<p><span class="koboSpan" id="kobo.1445.1">Now, let’s see an</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.1446.1"> example of how</span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.1447.1"> to use the gNOI interface </span><span class="No-Break"><span class="koboSpan" id="kobo.1448.1">with Go.</span></span></p>
<h2 id="_idParaDest-223"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.1449.1">Path verifier application</span></h2>
<p><span class="koboSpan" id="kobo.1450.1">In the streaming telemetry</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.1451.1"> section of this chapter, we explored</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.1452.1"> the implementation of an event-manager application that enables or disables a backup link as the traffic through the primary interface crosses a pre-defined threshold. </span><span class="koboSpan" id="kobo.1452.2">We used Grafana to plot the traffic rate for both interfaces to confirm that the application works </span><span class="No-Break"><span class="koboSpan" id="kobo.1453.1">as intended.</span></span></p>
<p><span class="koboSpan" id="kobo.1454.1">In real-world automation use cases involving complex workflows, relying on visual clues is not always the right approach. </span><span class="koboSpan" id="kobo.1454.2">Ideally, we need a programmatic way to verify that the backup link is actually working. </span><span class="koboSpan" id="kobo.1454.3">We use the gNOI </span><strong class="source-inline"><span class="koboSpan" id="kobo.1455.1">Traceroute</span></strong><span class="koboSpan" id="kobo.1456.1"> RPC to check this in the next code example. </span><span class="koboSpan" id="kobo.1456.2">The goal is to explore diverse network paths and confirm that we are forwarding some traffic flows over the backup interface. </span><span class="koboSpan" id="kobo.1456.3">You can find the code example for this section in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1457.1">ch09/gnoi-trace</span></strong><span class="koboSpan" id="kobo.1458.1"> directory of this book’s GitHub repository (see </span><em class="italic"><span class="koboSpan" id="kobo.1459.1">Further reading</span></em><span class="koboSpan" id="kobo.1460.1">). </span></p>
<p><span class="koboSpan" id="kobo.1461.1">We start by setting up a gRPC session to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1462.1">ceos</span></strong><span class="koboSpan" id="kobo.1463.1"> virtual network device and creating a new API client for the gNOI </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1464.1">System</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1465.1"> service:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.1466.1">var </span></span><span class="koboSpan" id="kobo.1467.1">target </span><span class="Code_Red"><span class="koboSpan" id="kobo.1468.1">= "clab-netgo-ceos:6030"</span></span>
<span class="Code_Purple"><span class="koboSpan" id="kobo.1469.1">import </span></span><span class="koboSpan" id="kobo.1470.1">(
     </span><span class="Code_Red"><span class="koboSpan" id="kobo.1471.1">"google.golang.org/grpc"</span></span><span class="koboSpan" id="kobo.1472.1">
     </span><span class="Code_Red"><span class="koboSpan" id="kobo.1473.1">"github.com/openconfig/gnoi/system"</span></span><span class="koboSpan" id="kobo.1474.1">
)
</span><span class="Code_Purple"><span class="koboSpan" id="kobo.1475.1">func </span></span><span class="koboSpan" id="kobo.1476.1">main() {
     conn, err :</span><span class="Code_Red"><span class="koboSpan" id="kobo.1477.1">=</span></span><span class="koboSpan" id="kobo.1478.1"> grpc.Dial(target, grpc.WithInsecure())
     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1479.1">// process error</span></span><span class="koboSpan" id="kobo.1480.1">
     </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1481.1">defer </span></span><span class="koboSpan" id="kobo.1482.1">conn.Close()
     sysSvc := system.NewSystemClient(conn)
     ctx, cancel := context.WithCancel(context.Background())
     </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1483.1">defer </span></span><span class="koboSpan" id="kobo.1484.1">cancel()
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1485.1">/* ... </span><span class="koboSpan" id="kobo.1485.2">&lt;continues next &gt; ... </span><span class="koboSpan" id="kobo.1485.3">*/</span></span><span class="koboSpan" id="kobo.1486.1">
}</span></pre>
<p><span class="koboSpan" id="kobo.1487.1">Next, we create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1488.1">sync.WaitGroup</span></strong><span class="koboSpan" id="kobo.1489.1"> to coordinate</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.1490.1"> all goroutines running traceroutes</span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.1491.1"> to different destinations. </span><span class="koboSpan" id="kobo.1491.2">These goroutines send the collected results back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1492.1">main</span></strong><span class="koboSpan" id="kobo.1493.1"> goroutine over the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1494.1">traceCh</span></strong><span class="koboSpan" id="kobo.1495.1"> channel. </span><span class="koboSpan" id="kobo.1495.2">For each traceroute destination encoded as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1">string</span></strong><span class="koboSpan" id="kobo.1497.1">, the traceroute result includes a list of responded IP addresses per network hop. </span></p>
<p><span class="koboSpan" id="kobo.1498.1">To make it easier to compare lists of IP addresses in the following steps, we store them as a set using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1499.1">deckarep/golang-set</span></strong><span class="koboSpan" id="kobo.1500.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1501.1">mapset</span></strong><span class="koboSpan" id="kobo.1502.1">) third-party package, because Go doesn’t implement sets natively in the standard library. </span><span class="koboSpan" id="kobo.1502.2">We encode the hop count implicitly as the index of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1503.1">[]</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1504.1">mapset.Set</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1505.1"> array:</span></span></p>
<pre class="source-code"><span class="Code_Purple"><span class="koboSpan" id="kobo.1506.1">var </span></span><span class="koboSpan" id="kobo.1507.1">destinations = []</span><span class="Code_Purple"><span class="koboSpan" id="kobo.1508.1">string</span></span><span class="koboSpan" id="kobo.1509.1">{
           </span><span class="Code_Red"><span class="koboSpan" id="kobo.1510.1">"203.0.113.251"</span></span><span class="koboSpan" id="kobo.1511.1">,
           </span><span class="Code_Red"><span class="koboSpan" id="kobo.1512.1">"203.0.113.252"</span></span><span class="koboSpan" id="kobo.1513.1">,
           </span><span class="Code_Red"><span class="koboSpan" id="kobo.1514.1">"203.0.113.253"</span></span><span class="koboSpan" id="kobo.1515.1">,
}
</span><span class="Code_Purple"><span class="koboSpan" id="kobo.1516.1">func </span></span><span class="koboSpan" id="kobo.1517.1">main() {
     </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1518.1">/* ... </span><span class="koboSpan" id="kobo.1518.2">&lt;continues from before &gt; ... </span><span class="koboSpan" id="kobo.1518.3">*/</span></span><span class="koboSpan" id="kobo.1519.1">
     </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1520.1">var </span></span><span class="koboSpan" id="kobo.1521.1">wg sync.WaitGroup
     wg.Add(</span><span class="Code_Blue"><span class="koboSpan" id="kobo.1522.1">len</span></span><span class="koboSpan" id="kobo.1523.1">(destinations))
     traceCh := </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1524.1">make</span></span><span class="koboSpan" id="kobo.1525.1">(</span><span class="Code_Purple"><span class="koboSpan" id="kobo.1526.1">chan map</span></span><span class="koboSpan" id="kobo.1527.1">[</span><span class="Code_Purple"><span class="koboSpan" id="kobo.1528.1">string</span></span><span class="koboSpan" id="kobo.1529.1">][]mapset.Set,
                            </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1530.1">len</span></span><span class="koboSpan" id="kobo.1531.1">(destinations))
  </span><span class="Code_Brown"><span class="koboSpan" id="kobo.1532.1">/* ... </span><span class="koboSpan" id="kobo.1532.2">&lt;continues next &gt; ... </span><span class="koboSpan" id="kobo.1532.3">*/</span></span><span class="koboSpan" id="kobo.1533.1">
}</span></pre>
<p><span class="koboSpan" id="kobo.1534.1">Each goroutine runs a single</span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.1535.1"> traceroute, and we only specify the source</span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.1536.1"> and destination fields of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1537.1">TracerouteRequest</span></strong><span class="koboSpan" id="kobo.1538.1"> message, leaving the rest options as default. </span><span class="koboSpan" id="kobo.1538.2">As we receive responses, we store the results in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1539.1">route</span></strong><span class="koboSpan" id="kobo.1540.1"> slice. </span><span class="koboSpan" id="kobo.1540.2">When the traceroute stops, which is when the error type is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">io.EOF</span></strong><span class="koboSpan" id="kobo.1542.1">, we send the accumulated response over the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1543.1">traceCh</span></strong><span class="koboSpan" id="kobo.1544.1"> channel and </span><span class="No-Break"><span class="koboSpan" id="kobo.1545.1">call </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1546.1">wg.Done</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1547.1">:</span></span></p>
<pre class="source-code"><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1548.1">var</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1549.1"> source </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1550.1">= "203.0.113.3"</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1551.1">func main() {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1552.1">  </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1553.1">/* ... </span><span class="koboSpan" id="kobo.1553.2">&lt;continues from before &gt; ... </span><span class="koboSpan" id="kobo.1553.3">*/</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1554.1">  </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1555.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1556.1"> _, dest :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1557.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1558.1">range</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1559.1"> destinations {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1560.1">    </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1561.1">go func</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1562.1">(d </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1563.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1564.1">) {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1565.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1566.1">defer</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1567.1"> wg.Done()</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1568.1">      retryMax :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1569.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1570.1">3</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1571.1">      retryCount :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1572.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1573.1">0</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1574.1">    START:</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1575.1">      response, err :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1576.1">=</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1577.1"> sysSvc.Traceroute(ctx,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1578.1">                        </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1579.1">&amp;</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1580.1">system.TracerouteRequest{</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1581.1">                                 Destination: d,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1582.1">                                 Source: source,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1583.1">      })</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1584.1">      </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1585.1">// process error</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1586.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1587.1">var</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1588.1"> route []mapset.Set</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1589.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1590.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1591.1"> {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1592.1">        resp, err :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1593.1">=</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1594.1"> response.Recv()</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1595.1">        </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1596.1">if</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1597.1"> errors.Is(err, io.EOF) {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1598.1">        </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1599.1">// end of stream, traceroute completed</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1600.1">          </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1601.1">break</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1602.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1603.1">        </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1604.1">// process error</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1605.1">        </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1606.1">// timed out, restarting the traceroute</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1607.1">        </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1608.1">if int</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1609.1">(resp.Hop) </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1610.1">&gt;</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1611.1">len</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1612.1">(route)</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1613.1">+</span></span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1614.1">1</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1615.1"> {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1616.1">          </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1617.1">if</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1618.1"> retryCount </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1619.1">&gt;</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1620.1"> retryMax</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1621.1">-</span></span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1622.1">1</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1623.1"> {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1624.1">            </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1625.1">goto</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1626.1"> FINISH</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1627.1">          }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1628.1">          retryCount </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1629.1">+=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1630.1">1</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1631.1">          </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1632.1">goto</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1633.1"> START</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1634.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1635.1">       </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1636.1"> // first response</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1637.1">        </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1638.1">if</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1639.1"> len(route) </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1640.1">&lt;</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1641.1">int</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1642.1">(resp.Hop) {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1643.1">          route </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1644.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1645.1">append</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1646.1">(route, mapset.NewSet())</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1647.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1648.1">        </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1649.1">// subsequent responses</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1650.1">          route[resp.Hop-</span></span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1651.1">1</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1652.1">].Add(resp.Address)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1653.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1654.1">    FINISH:</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1655.1">      traceCh </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1656.1">&lt;-</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1657.1">map</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1658.1">[</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1659.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1660.1">][]mapset.Set{</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1661.1">               d: route,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1662.1">             }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1663.1">    }(dest)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1664.1">  }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1665.1">  wg.Wait()</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1666.1">  </span></span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1667.1">close</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1668.1">(traceCh)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1669.1">  </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1670.1">/* ... </span><span class="koboSpan" id="kobo.1670.2">&lt;continues next &gt; ... </span><span class="koboSpan" id="kobo.1670.3">*/</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1671.1">}</span></span></pre>
<p><span class="koboSpan" id="kobo.1672.1">Since network devices</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.1673.1"> have default control plane security settings</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.1674.1"> that may restrict</span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.1675.1"> them from processing every incoming </span><strong class="bold"><span class="koboSpan" id="kobo.1676.1">ICMP</span></strong><span class="koboSpan" id="kobo.1677.1"> packet they receive, you might see gaps in your traceroute results. </span><span class="koboSpan" id="kobo.1677.2">To overcome this, we use Go’s labels and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1678.1">goto</span></strong><span class="koboSpan" id="kobo.1679.1"> statements in the code to retry a traceroute in case we don’t get any information for any one hop. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1680.1">START</span></strong><span class="koboSpan" id="kobo.1681.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1682.1">FINISH</span></strong><span class="koboSpan" id="kobo.1683.1"> are the two labels we used to implement this retry logic, with the latter serving as a fall-through case when we don’t get a result after </span><span class="No-Break"><span class="koboSpan" id="kobo.1684.1">several attempts.</span></span></p>
<p><span class="koboSpan" id="kobo.1685.1">Once we have completed all traceroute requests, we can process and analyze the results. </span><span class="koboSpan" id="kobo.1685.2">To simplify the code logic, we first transform the data to store a map between a hop count and a set of IP addresses per </span><span class="No-Break"><span class="koboSpan" id="kobo.1686.1">traceroute destination:</span></span></p>
<pre class="source-code"><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1687.1">func</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1688.1"> main() {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1689.1">  </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1690.1">/* ... </span><span class="koboSpan" id="kobo.1690.2">&lt;continues from before &gt; ... </span><span class="koboSpan" id="kobo.1690.3">*/</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1691.1">  routes := </span></span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1692.1">make</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1693.1">(</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1694.1">map</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1695.1">[</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1696.1">int</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1697.1">]</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1698.1">map</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1699.1">[</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1700.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1701.1">]mapset.Set)</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1702.1">  </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1703.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1704.1"> trace := </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1705.1">range</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1706.1"> traceCh {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1707.1">    </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1708.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1709.1"> dest, paths := range trace {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1710.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1711.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1712.1"> hop, path := range paths {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1713.1">        </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1714.1">if</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1715.1"> _, ok := routes[hop]; !ok {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1716.1">          routes[hop] = </span></span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1717.1">make</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1718.1">(</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1719.1">map</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1720.1">[</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1721.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1722.1">]mapset.Set)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1723.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1724.1">        routes[hop][dest] = path</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1725.1">      }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1726.1">    }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1727.1">  }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1728.1">  </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1729.1">/* ... </span><span class="koboSpan" id="kobo.1729.2">&lt;continues next &gt; ... </span><span class="koboSpan" id="kobo.1729.3">*/</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1730.1">}</span></span></pre>
<p><span class="koboSpan" id="kobo.1731.1">Finally, we can traverse over each</span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.1732.1"> hop and check whether there is a discrepancy between a set of responding IP </span><a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.1733.1">addresses for different traceroute destinations, which would mean that the packets went over different paths. </span><span class="koboSpan" id="kobo.1733.2">If we detect this, we print it on </span><span class="No-Break"><span class="koboSpan" id="kobo.1734.1">the screen:</span></span></p>
<pre class="source-code"><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1735.1">func</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1736.1"> main() {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1737.1">  </span></span><span class="Code_Brown" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1738.1">/* ... </span><span class="koboSpan" id="kobo.1738.2">&lt;continues from before &gt; ... </span><span class="koboSpan" id="kobo.1738.3">*/</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1739.1">  </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1740.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1741.1"> hop, route :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1742.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1743.1">range</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1744.1"> routes {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1745.1">    if hop </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1746.1">==</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1747.1"> len(routes)-</span></span><span class="Code_Green" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1748.1">1</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1749.1"> {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1750.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1751.1">continue</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1752.1">    }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1753.1">    found :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1754.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Blue" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1755.1">make</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1756.1">(</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1757.1">map</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1758.1">[</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1759.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1760.1">]</span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1761.1">string</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1762.1">)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1763.1">    </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1764.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1765.1"> myDest, myPaths :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1766.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1767.1">range</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1768.1"> route {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1769.1">      </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1770.1">for</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1771.1"> otherDest, otherPaths :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1772.1">=</span></span><span lang="en-US" xml:lang="en-US"> </span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1773.1">range</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1774.1"> route {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1775.1">        </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1776.1">if</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1777.1"> myDest </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1778.1">==</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1779.1"> otherDest {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1780.1">          </span></span><span class="Code_Purple" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1781.1">continue</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1782.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1783.1">        diff := myPaths.Difference(otherPaths)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1784.1">        if diff.Cardinality() </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1785.1">==</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1786.1"> 0 {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1787.1">          </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1788.1">continue</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1789.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1790.1">        v, ok :</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1791.1">=</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1792.1"> found[myDest]</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1793.1">        if ok </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1794.1">&amp;&amp;</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1795.1"> v </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1796.1">==</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1797.1"> otherDest {</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1798.1">          continue</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1799.1">        }</span></span>
<span lang="en-US" xml:lang="en-US"> </span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1800.1">        log.Printf(</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1801.1">"Found different paths at hop %d"</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1802.1">, hop)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1803.1">        log.Printf(</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1804.1">"Destination %s: %+v"</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1805.1">, myDest, myPaths)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1806.1">        log.Printf(</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1807.1">                </span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1808.1">"Destination %s: %+v"</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1809.1">,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1810.1">                        otherDest,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1811.1">                        otherPaths,</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1812.1">                        )</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1813.1">        found[otherDest] = myDest</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1814.1">      }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1815.1">    }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1816.1">  }</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1817.1">  log.Println(</span></span><span class="Code_Red" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1818.1">"Check complete"</span></span><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1819.1">)</span></span>
<span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1820.1">}</span></span></pre>
<p><span class="koboSpan" id="kobo.1821.1">You can run</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.1822.1"> this program</span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.1823.1"> from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1824.1">ch09/gnoi-trace</span></strong><span class="koboSpan" id="kobo.1825.1"> folder. </span><span class="koboSpan" id="kobo.1825.2">Make sure </span><strong class="source-inline"><span class="koboSpan" id="kobo.1826.1">lab-full</span></strong><span class="koboSpan" id="kobo.1827.1"> is up and running first. </span><span class="koboSpan" id="kobo.1827.2">You should see output like </span><span class="No-Break"><span class="koboSpan" id="kobo.1828.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1829.1">ch09/gnoi-trace$ go run main.go
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1830.1">2022</span></span><span class="koboSpan" id="kobo.1831.1">/06/26 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1832.1">16</span></span><span class="koboSpan" id="kobo.1833.1">:51:10 Checking </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1834.1">if </span></span><span class="koboSpan" id="kobo.1835.1">routes have different paths
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1836.1">2022</span></span><span class="koboSpan" id="kobo.1837.1">/06/26 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1838.1">16</span></span><span class="koboSpan" id="kobo.1839.1">:51:16 Missed at least one hop </span><span class="Code_Purple"><span class="koboSpan" id="kobo.1840.1">in </span></span><span class="Code_Green"><span class="koboSpan" id="kobo.1841.1">203</span></span><span class="koboSpan" id="kobo.1842.1">.0.113.251
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1843.1">2022</span></span><span class="koboSpan" id="kobo.1844.1">/06/26 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1845.1">16</span></span><span class="koboSpan" id="kobo.1846.1">:51:16 retrying </span><span class="Code_Green"><span class="koboSpan" id="kobo.1847.1">203</span></span><span class="koboSpan" id="kobo.1848.1">.0.113.251
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1849.1">2022</span></span><span class="koboSpan" id="kobo.1850.1">/06/26 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1851.1">16</span></span><span class="koboSpan" id="kobo.1852.1">:51:17 Check complete</span></pre>
<p><span class="koboSpan" id="kobo.1853.1">Generate traffic with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1854.1">make traffic-start</span></strong><span class="koboSpan" id="kobo.1855.1"> and run this program again. </span><span class="koboSpan" id="kobo.1855.2">In another tab, run simultaneously the event-manager application from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1856.1">clab-netgo-host-2</span></strong><span class="koboSpan" id="kobo.1857.1"> host to activate the </span><span class="No-Break"><span class="koboSpan" id="kobo.1858.1">backup link:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1859.1">$ DURATION=2m </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1860.1">make </span></span><span class="koboSpan" id="kobo.1861.1">traffic-start
docker exec </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1862.1">-d</span></span><span class="koboSpan" id="kobo.1863.1"> clab-netgo-cvx systemctl </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1864.1">restart </span></span><span class="koboSpan" id="kobo.1865.1">hsflowd
docker exec </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1866.1">-d</span></span><span class="koboSpan" id="kobo.1867.1"> clab-netgo-host-3 ./ethr </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1868.1">-s</span></span><span class="koboSpan" id="kobo.1869.1">
docker exec </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1870.1">-d</span></span><span class="koboSpan" id="kobo.1871.1"> clab-netgo-host-1 ./ethr </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1872.1">-c</span></span><span class="koboSpan" id="kobo.1873.1"> 203.0.113.253 </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1874.1">-b</span></span><span class="koboSpan" id="kobo.1875.1"> 900K </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1876.1">-d</span></span><span class="koboSpan" id="kobo.1877.1"> 2m </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1878.1">-p</span></span><span class="koboSpan" id="kobo.1879.1"> udp </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1880.1">-l</span></span><span class="koboSpan" id="kobo.1881.1"> 1KB
docker exec </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1882.1">-d</span></span><span class="koboSpan" id="kobo.1883.1"> clab-netgo-host-1 ./ethr </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1884.1">-c</span></span><span class="koboSpan" id="kobo.1885.1"> 203.0.113.252 </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1886.1">-b</span></span><span class="koboSpan" id="kobo.1887.1"> 600K </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1888.1">-d</span></span><span class="koboSpan" id="kobo.1889.1"> 2m </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1890.1">-p</span></span><span class="koboSpan" id="kobo.1891.1"> udp </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1892.1">-l</span></span><span class="koboSpan" id="kobo.1893.1"> 1KB
docker exec </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1894.1">-d</span></span><span class="koboSpan" id="kobo.1895.1"> clab-netgo-host-1 ./ethr </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1896.1">-c</span></span><span class="koboSpan" id="kobo.1897.1"> 203.0.113.251 </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1898.1">-b</span></span><span class="koboSpan" id="kobo.1899.1"> 400K </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1900.1">-d</span></span><span class="koboSpan" id="kobo.1901.1"> 2m </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1902.1">-p</span></span><span class="koboSpan" id="kobo.1903.1"> udp </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1904.1">-l</span></span><span class="koboSpan" id="kobo.1905.1"> 1KB
$ sudo ip netns exec clab-netgo-host-2 /usr/local/go/bin/go run ch09/event-manager/main.go
AlertManager event-triggered webhook
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1906.1">2022</span></span><span class="koboSpan" id="kobo.1907.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1908.1">21</span></span><span class="koboSpan" id="kobo.1909.1">:02:57 Starting web server at </span><span class="Code_Green"><span class="koboSpan" id="kobo.1910.1">0</span></span><span class="koboSpan" id="kobo.1911.1">.0.0.0:10000
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1912.1">2022</span></span><span class="koboSpan" id="kobo.1913.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1914.1">21</span></span><span class="koboSpan" id="kobo.1915.1">:02:58 Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1916.1">2022</span></span><span class="koboSpan" id="kobo.1917.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1918.1">21</span></span><span class="koboSpan" id="kobo.1919.1">:02:58 swp1 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1920.1">2022</span></span><span class="koboSpan" id="kobo.1921.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1922.1">21</span></span><span class="koboSpan" id="kobo.1923.1">:02:58 Created revisionID: changeset/cumulus/2022-09-14_21.02.58_S4SQ
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1924.1">"state"</span></span><span class="koboSpan" id="kobo.1925.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1926.1">"apply"</span></span><span class="koboSpan" id="kobo.1927.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1928.1">"transition"</span></span><span class="koboSpan" id="kobo.1929.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1930.1">"issue"</span></span><span class="koboSpan" id="kobo.1931.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1932.1">"progress"</span></span><span class="koboSpan" id="kobo.1933.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1934.1">""</span></span><span class="koboSpan" id="kobo.1935.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1936.1">2022</span></span><span class="koboSpan" id="kobo.1937.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1938.1">21</span></span><span class="koboSpan" id="kobo.1939.1">:03:40 Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1940.1">2022</span></span><span class="koboSpan" id="kobo.1941.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1942.1">21</span></span><span class="koboSpan" id="kobo.1943.1">:03:40 swp1 needs to deny backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1944.1">2022</span></span><span class="koboSpan" id="kobo.1945.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1946.1">21</span></span><span class="koboSpan" id="kobo.1947.1">:03:40 Created revisionID: changeset/cumulus/2022-09-14_21.03.40_S4SS
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1948.1">"state"</span></span><span class="koboSpan" id="kobo.1949.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1950.1">"apply"</span></span><span class="koboSpan" id="kobo.1951.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1952.1">"transition"</span></span><span class="koboSpan" id="kobo.1953.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1954.1">"issue"</span></span><span class="koboSpan" id="kobo.1955.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1956.1">"progress"</span></span><span class="koboSpan" id="kobo.1957.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1958.1">""</span></span><span class="koboSpan" id="kobo.1959.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1960.1">2022</span></span><span class="koboSpan" id="kobo.1961.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1962.1">21</span></span><span class="koboSpan" id="kobo.1963.1">:03:40 swp2 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1964.1">2022</span></span><span class="koboSpan" id="kobo.1965.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1966.1">21</span></span><span class="koboSpan" id="kobo.1967.1">:03:40 Could not </span><span class="Code_Blue"><span class="koboSpan" id="kobo.1968.1">find </span></span><span class="koboSpan" id="kobo.1969.1">a backup prefix for swp2
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1970.1">2022</span></span><span class="koboSpan" id="kobo.1971.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1972.1">21</span></span><span class="koboSpan" id="kobo.1973.1">:04:10 Incoming alert
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1974.1">2022</span></span><span class="koboSpan" id="kobo.1975.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1976.1">21</span></span><span class="koboSpan" id="kobo.1977.1">:04:10 swp1 needs to permit backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1978.1">2022</span></span><span class="koboSpan" id="kobo.1979.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1980.1">21</span></span><span class="koboSpan" id="kobo.1981.1">:04:10 Created revisionID: changeset/cumulus/2022-09-14_21.04.10_S4SV
{
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1982.1">"state"</span></span><span class="koboSpan" id="kobo.1983.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1984.1">"apply"</span></span><span class="koboSpan" id="kobo.1985.1">,
  </span><span class="Code_Red"><span class="koboSpan" id="kobo.1986.1">"transition"</span></span><span class="koboSpan" id="kobo.1987.1">: {
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1988.1">"issue"</span></span><span class="koboSpan" id="kobo.1989.1">: {},
    </span><span class="Code_Red"><span class="koboSpan" id="kobo.1990.1">"progress"</span></span><span class="koboSpan" id="kobo.1991.1">: </span><span class="Code_Red"><span class="koboSpan" id="kobo.1992.1">""</span></span><span class="koboSpan" id="kobo.1993.1">
  }
}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1994.1">2022</span></span><span class="koboSpan" id="kobo.1995.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.1996.1">21</span></span><span class="koboSpan" id="kobo.1997.1">:04:10 swp2 needs to deny backup prefixes
</span><span class="Code_Green"><span class="koboSpan" id="kobo.1998.1">2022</span></span><span class="koboSpan" id="kobo.1999.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2000.1">21</span></span><span class="koboSpan" id="kobo.2001.1">:04:10 Could not </span><span class="Code_Blue"><span class="koboSpan" id="kobo.2002.1">find </span></span><span class="koboSpan" id="kobo.2003.1">a backup prefix for swp2</span></pre>
<p><span class="koboSpan" id="kobo.2004.1">The output of the program would look </span><span class="No-Break"><span class="koboSpan" id="kobo.2005.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2006.1">ch09/gnoi-trace$ go run main.go
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2007.1">2022</span></span><span class="koboSpan" id="kobo.2008.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2009.1">21</span></span><span class="koboSpan" id="kobo.2010.1">:03:29 Checking if routes have different paths
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2011.1">2022</span></span><span class="koboSpan" id="kobo.2012.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2013.1">21</span></span><span class="koboSpan" id="kobo.2014.1">:03:34 Missed at least one hop in </span><span class="Code_Green"><span class="koboSpan" id="kobo.2015.1">203</span></span><span class="koboSpan" id="kobo.2016.1">.0.113.253
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2017.1">2022</span></span><span class="koboSpan" id="kobo.2018.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2019.1">21</span></span><span class="koboSpan" id="kobo.2020.1">:03:34 retrying 203.0.113.253
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2021.1">2022</span></span><span class="koboSpan" id="kobo.2022.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2023.1">21</span></span><span class="koboSpan" id="kobo.2024.1">:03:34 Found different paths at hop 0
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2025.1">2022</span></span><span class="koboSpan" id="kobo.2026.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2027.1">21</span></span><span class="koboSpan" id="kobo.2028.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2029.1">203</span></span><span class="koboSpan" id="kobo.2030.1">.0.113.252: Set{192.0.2.5}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2031.1">2022</span></span><span class="koboSpan" id="kobo.2032.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2033.1">21</span></span><span class="koboSpan" id="kobo.2034.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2035.1">203</span></span><span class="koboSpan" id="kobo.2036.1">.0.113.253: Set{192.0.2.3}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2037.1">2022</span></span><span class="koboSpan" id="kobo.2038.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2039.1">21</span></span><span class="koboSpan" id="kobo.2040.1">:03:34 Found different paths at hop 0
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2041.1">2022</span></span><span class="koboSpan" id="kobo.2042.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2043.1">21</span></span><span class="koboSpan" id="kobo.2044.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2045.1">203</span></span><span class="koboSpan" id="kobo.2046.1">.0.113.251: Set{192.0.2.5}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2047.1">2022</span></span><span class="koboSpan" id="kobo.2048.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2049.1">21</span></span><span class="koboSpan" id="kobo.2050.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2051.1">203</span></span><span class="koboSpan" id="kobo.2052.1">.0.113.253: Set{192.0.2.3}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2053.1">2022</span></span><span class="koboSpan" id="kobo.2054.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2055.1">21</span></span><span class="koboSpan" id="kobo.2056.1">:03:34 Found different paths at hop 0
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2057.1">2022</span></span><span class="koboSpan" id="kobo.2058.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2059.1">21</span></span><span class="koboSpan" id="kobo.2060.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2061.1">203</span></span><span class="koboSpan" id="kobo.2062.1">.0.113.253: Set{192.0.2.3}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2063.1">2022</span></span><span class="koboSpan" id="kobo.2064.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2065.1">21</span></span><span class="koboSpan" id="kobo.2066.1">:03:34 Destination </span><span class="Code_Green"><span class="koboSpan" id="kobo.2067.1">203</span></span><span class="koboSpan" id="kobo.2068.1">.0.113.252: Set{192.0.2.5}
</span><span class="Code_Green"><span class="koboSpan" id="kobo.2069.1">2022</span></span><span class="koboSpan" id="kobo.2070.1">/09/14 </span><span class="Code_Green"><span class="koboSpan" id="kobo.2071.1">21</span></span><span class="koboSpan" id="kobo.2072.1">:03:34 Check complete</span></pre>
<p><span class="koboSpan" id="kobo.2073.1">The last output</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.2074.1"> shows that</span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.2075.1"> the path that </span><strong class="source-inline"><span class="koboSpan" id="kobo.2076.1">203.0.113.252/32</span></strong><span class="koboSpan" id="kobo.2077.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2078.1">203.0.113.251/32</span></strong><span class="koboSpan" id="kobo.2079.1"> follow is different from the path that </span><strong class="source-inline"><span class="koboSpan" id="kobo.2080.1">203.0.113.253/32</span></strong><span class="koboSpan" id="kobo.2081.1"> follows (primary link). </span><span class="koboSpan" id="kobo.2081.2">This is because the event-manager disaggregated </span><strong class="source-inline"><span class="koboSpan" id="kobo.2082.1">.252</span></strong><span class="koboSpan" id="kobo.2083.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2084.1">.251</span></strong><span class="koboSpan" id="kobo.2085.1"> from the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.2086.1">203.0.113.250/30</span></strong><span class="koboSpan" id="kobo.2087.1"> prefix. </span><span class="koboSpan" id="kobo.2087.2">Now, we know that the backup link is working as expected, as it is carrying traffic for these two </span><span class="No-Break"><span class="koboSpan" id="kobo.2088.1">IP addresses.</span></span></p>
<p><span class="koboSpan" id="kobo.2089.1">Historically, networking vendors were not incentivized to create vendor-neutral APIs and data models, as it doesn’t allow them to differentiate themselves from the competition. </span><span class="koboSpan" id="kobo.2089.2">And while standards bodies such as the Internet Engineering Task Force (IETF) produce standards for the networking industry, they can’t always influence what vendors actually implement. </span><span class="koboSpan" id="kobo.2089.3">Also, some vendors might still perceive technological lock-ins as an effective way to keep their existing </span><span class="No-Break"><span class="koboSpan" id="kobo.2090.1">customer base.</span></span></p>
<p><span class="koboSpan" id="kobo.2091.1">By contrast, the OpenConfig community of network operators has more leverage to influence networking vendors to adopt vendor-independent data models and APIs. </span><span class="koboSpan" id="kobo.2091.2">OpenConfig adoption is still relatively low, in both model and feature coverage, but, as long as the OC participants continue to push for more, the coverage will increase, which, in turn, will drive the adoption in the wider networking community. </span></p>
<p><span class="koboSpan" id="kobo.2092.1">Even today, OpenConfig provides</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.2093.1"> a vendor-neutral way of doing a lot of common networking</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.2094.1"> tasks, including configuration management, monitoring, and operations. </span><span class="koboSpan" id="kobo.2094.2">In this chapter, we’ve shown the two most popular interfaces, gNMI and gNOI, ignoring the less common gRIBI, which is outside of the scope of this book. </span><span class="koboSpan" id="kobo.2094.3">We hope this chapter provides enough examples of tools and workflows that you can use with Go to consume and interact with OpenConfig-compliant devices. </span></p>
<h1 id="_idParaDest-224"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.2095.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.2096.1">In this chapter, by introducing streaming telemetry, we have started exploring the world of network monitoring, a critical task for a business. </span><span class="koboSpan" id="kobo.2096.2">The ability to observe network-wide state and collect and process data plane information are all important in determining the health of your network. </span><span class="koboSpan" id="kobo.2096.3">In the next chapter, we will examine a few concrete examples of network monitoring tasks and use cases and learn how Go can help us </span><span class="No-Break"><span class="koboSpan" id="kobo.2097.1">automate them.</span></span></p>
<h1 id="_idParaDest-225"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.2098.1">Further reading</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.2099.1">Network operators: </span><a href="https://www.openconfig.net/about/participants/"><span class="koboSpan" id="kobo.2100.1">https://www.openconfig.net/about/participants/</span></a><span class="koboSpan" id="kobo.2101.1"> </span></li>
<li><span class="koboSpan" id="kobo.2102.1">Manipulating forwarding </span><span class="No-Break"><span class="koboSpan" id="kobo.2103.1">entries: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.2104.1">https://github.com/openconfig/gribi/blob/master/doc/motivation.md#grpc-service-for-rib-injection</span></span></li>
<li><span class="koboSpan" id="kobo.2105.1">gNMI </span><span class="No-Break"><span class="koboSpan" id="kobo.2106.1">collector: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.2107.1">https://github.com/openconfig/gnmi/tree/master/cmd/gnmi_collector</span></span></li>
<li><span class="koboSpan" id="kobo.2108.1">gNMI CLI </span><span class="No-Break"><span class="koboSpan" id="kobo.2109.1">utility: </span></span><a href="https://github.com/openconfig/gnmi/tree/master/cmd/gnmi_cli "><span class="No-Break"><span class="koboSpan" id="kobo.2110.1">https://github.com/openconfig/gnmi/tree/master/cmd/gnmi_cli</span></span></a></li>
<li><span class="koboSpan" id="kobo.2111.1">gNMI Test </span><span class="No-Break"><span class="koboSpan" id="kobo.2112.1">framework: </span></span><a href="https://github.com/openconfig/gnmitest "><span class="No-Break"><span class="koboSpan" id="kobo.2113.1">https://github.com/openconfig/gnmitest</span></span></a></li>
<li><span class="koboSpan" id="kobo.2114.1">gRPC </span><span class="No-Break"><span class="koboSpan" id="kobo.2115.1">tunnel: </span></span><a href="https://github.com/openconfig/grpctunnel "><span class="No-Break"><span class="koboSpan" id="kobo.2116.1">https://github.com/openconfig/grpctunnel</span></span></a></li>
<li><span class="koboSpan" id="kobo.2117.1">IS-IS LSDB </span><span class="No-Break"><span class="koboSpan" id="kobo.2118.1">parsing: </span></span><a href="https://github.com/openconfig/lsdbparse "><span class="No-Break"><span class="koboSpan" id="kobo.2119.1">https://github.com/openconfig/lsdbparse</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2120.1">Ygot: </span></span><a href="https://github.com/openconfig/ygot "><span class="No-Break"><span class="koboSpan" id="kobo.2121.1">https://github.com/openconfig/ygot</span></span></a></li>
<li><span class="koboSpan" id="kobo.2122.1">gNxI </span><span class="No-Break"><span class="koboSpan" id="kobo.2123.1">Tools: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.2124.1">https://github.com/google/gnxi</span></span></li>
<li><span class="koboSpan" id="kobo.2125.1">Book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.2126.1">repository: </span></span><a href="https://github.com/PacktPublishing/Network-Automation-with-Go "><span class="No-Break"><span class="koboSpan" id="kobo.2127.1">https://github.com/PacktPublishing/Network-Automation-with-Go</span></span></a></li>
<li><span class="koboSpan" id="kobo.2128.1">gNMI </span><span class="No-Break"><span class="koboSpan" id="kobo.2129.1">specification: </span></span><a href="https://github.com/openconfig/reference/blob/master/rpc/gnmi/gnmi-specification.md"><span class="No-Break"><span class="koboSpan" id="kobo.2130.1">https://github.com/openconfig/reference/blob/master/rpc/gnmi/gnmi-specification.md</span></span></a></li>
<li><span class="koboSpan" id="kobo.2131.1">gNMIc </span><span class="No-Break"><span class="koboSpan" id="kobo.2132.1">docs: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.2133.1">https://gnmic.kmrd.dev/user_guide/golang_package/intro/#set-request</span></span></li>
<li><span class="koboSpan" id="kobo.2134.1">gNMI path </span><span class="No-Break"><span class="koboSpan" id="kobo.2135.1">convention: </span></span><a href="https://github.com/openconfig/reference/blob/master/rpc/gnmi/gnmi-path-conventions.md "><span class="No-Break"><span class="koboSpan" id="kobo.2136.1">https://github.com/openconfig/reference/blob/master/rpc/gnmi/gnmi-path-conventions.md</span></span></a></li>
<li><span class="koboSpan" id="kobo.2137.1">gNMI </span><span class="No-Break"><span class="koboSpan" id="kobo.2138.1">repository: </span></span><a href="https://github.com/openconfig/gnmi "><span class="No-Break"><span class="koboSpan" id="kobo.2139.1">https://github.com/openconfig/gnmi</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2140.1">gNMIc: </span></span><a href="https://gnmic.kmrd.dev/ "><span class="No-Break"><span class="koboSpan" id="kobo.2141.1">https://gnmic.kmrd.dev/</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.2142.1">AlertManager: </span></span><a href="https://prometheus.io/docs/alerting/latest/alertmanager/ "><span class="No-Break"><span class="koboSpan" id="kobo.2143.1">https://prometheus.io/docs/alerting/latest/alertmanager/</span></span></a></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2144.1">full/workdir/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2145.1">: </span></span><a href="https://github.com/PacktPublishing/Network-Automation-with-Go/tree/main/topo-full/workdir "><span class="No-Break"><span class="koboSpan" id="kobo.2146.1">https://github.com/PacktPublishing/Network-Automation-with-Go/tree/main/topo-full/workdir</span></span></a></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2147.1">topo.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2148.1">: </span></span><a href="https://github.com/PacktPublishing/Network-Automation-with-Go/blob/main/topo-full/topo.yml "><span class="No-Break"><span class="koboSpan" id="kobo.2149.1">https://github.com/PacktPublishing/Network-Automation-with-Go/blob/main/topo-full/topo.yml</span></span></a></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2150.1">docker-compose.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2151.1">: </span></span><a href="https://github.com/PacktPublishing/Network-Automation-with-Go/blob/main/ch09/docker-compose.yml "><span class="No-Break"><span class="koboSpan" id="kobo.2152.1">https://github.com/PacktPublishing/Network-Automation-with-Go/blob/main/ch09/docker-compose.yml</span></span></a></li>
<li><span class="koboSpan" id="kobo.2153.1">gNOI GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.2154.1">repository: </span></span><a href="https://github.com/openconfig/gnoi "><span class="No-Break"><span class="koboSpan" id="kobo.2155.1">https://github.com/openconfig/gnoi</span></span></a></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2156.1">system.proto</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2157.1">file: </span></span><a href="https://github.com/openconfig/gnoi/blob/master/system/system.proto"><span class="No-Break"><span class="koboSpan" id="kobo.2158.1">https://github.com/openconfig/gnoi/blob/master/system/system.proto</span></span></a></li>
</ul>
</div>
</body></html>